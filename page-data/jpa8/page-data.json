{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/jpa8/",
    "result": {"data":{"cur":{"id":"82e6428f-f8dc-5910-93fa-96947ef11565","html":"<h2 id=\"1-jpa에서-프록시란-무엇인가\" style=\"position:relative;\"><a href=\"#1-jpa%EC%97%90%EC%84%9C-%ED%94%84%EB%A1%9D%EC%8B%9C%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80\" aria-label=\"1 jpa에서 프록시란 무엇인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JPA에서 프록시란 무엇인가?</h2>\n<h3 id=\"1-emfind-vs-emgetreference\" style=\"position:relative;\"><a href=\"#1-emfind-vs-emgetreference\" aria-label=\"1 emfind vs emgetreference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) em.find vs em.getReference</h3>\n<p>em.find를 하게 되면 JPA가 실제 entity 객체를 반환하지만,</p>\n<p>em.getReference를 하게 되면 DB조회를 미루는 ‘프록시’ entity 객체를 반환한다.</p>\n<p>프록시 객체는 실제 Entity 타깃 객체는 가지고 있지 않고, id값만 가지고 있는 비어있는 객체이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABC0lEQVQoz5VS24qDUAz0/3+kfe+z4KLFCxYEi0URBPFFj1WrrXedJYHKsmy7u4EwnJwwkwyRxnHEuq6geOJv8b3v61u6XC4YhmErzPOMZVnQ9z3atgUJ0pt6KOu65roQAmEYIssydF2HsigZJcdx8Hg8WGWaJnieB9u2oSgKFOUDx+MRuq4zJkkC6nddF6ZpYr/b43Q64Xw+M3lRFJCyTPBkt+qGsixRVRV/ENI0hFS/3++IogiqquJwOEDTNBaP4xi0JYkxIRVosr8ErWQYBmRZhmVZ8H0feZ6z6EYYBAGaptnMfZUU5OX1eoUQOXuYpikj+UjENJhERlPjO8L/XID06hR+Oot3GzzzE4D5ZCURMAveAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/835023913ed13c3757f317293e052c76/37523/image1.png\"\n        srcset=\"/static/835023913ed13c3757f317293e052c76/e9ff0/image1.png 180w,\n/static/835023913ed13c3757f317293e052c76/f21e7/image1.png 360w,\n/static/835023913ed13c3757f317293e052c76/37523/image1.png 720w,\n/static/835023913ed13c3757f317293e052c76/612f7/image1.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>프록시 객체는 실제 Entity를 상속해서 만들어지며, Hibernate가 내부적으로 만든다.</p>\n<p>실제 클래스와 겉 모양이 같기 때문에 사용하는 입장에서는 진짜 객체인지 프록시 객체인지 구분하지 않고 사용할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 338px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 206.1111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAElUlEQVRIx7WXZ09iURCG+a3+Dz/qFxMTTewKxGQt2HUFLNi7AtLE3ksEe6/M5hlzrndR3HWTnWRyuefMmTPtvjM4RESurq4kHA5LNBqTaDSqHIlEJR6PK6+ursrKyoo+l5eXdc3I2fn5+VkcKIzFYpJILMn9/b1cXFzKxcWFbg4MDIjH45FQKCT9/f3S1NQkyaWkHB0dyc3NjVxevsk+Pj7K2NiYpNPpd4UHBweSTePj49LQ0CDV1dVSV1cnxcXFUlJSInt7ex9kg8GgpFKpN4WLi4vS09MjkUhEpqamZGFhQa2amJhQy2ZnZ9WCyclJaW9v130UwPPz8+puc3Pzu4XEJJFI6AEOPj09qRu4nclk9Pn6+iovLy9qDfuGHx4edG1mZkaOj4/fFW6sb8jS0pJsbm5+cAeln/22v2O15TIx3Nra0iCfnJzI7u6uxpTgn5+ff6rIEJZDuG4pxDKUzs3NSWtrq8YTgc7OTi0VCHc5nM0mDJz9LSler9dKxOjoqMZyeHhYlZIo6tQkIhgMqSzMO8ZQXlZSSAhx5GBbW5v4/X7xen3i8/k0q8lkUq0hASQINkkheSYploUo5Eug7rgtlUrLzs6ObGxsqLLb21srZrj4WZIW5m1JwTqSwsLh4aEqwl2UnZ6eytramiaJPdxE9ssso9AUt9PplKGhIWXcJ4a4HgqGpLGxUdfxCEvtLk9PT7/XIe5VVFRIUVGRVFZWSm1trbicLn1WVVVJTU2N5Ofn6+dXVlYm1dU14na79XKXyyV1TqfU19draBzGZG4yNxJ8GLBgH4QJBIbUbd5Zt/Pd3Z0mClKFuYoWAlU6Ojpkbm5eS+srQo/D/MjFEMngO8cak+VcbLmcrcSeQVwicXa5D992xmZhLvON8PX1tUJbrovt5PhTTHIpzEX/V6FdONtlUPmvFdqVAAL257cV2pXlon+2kIN0tLOzM0Vt0y++baGBcYCgsLBQv+G8vDzp7e3VdVrDtyw0CkHpgoICRWyQpbu7W9dp5ibLuVqBibkju+rBPzuYQrjOxPA35DB9Fggjbny3/AZEQRdAE4BlLDF78Pb2trKRZc/69FaWV7SfIECXQwGCuA7e0QFpUnRHWgW8vr6uvLq6JtvbOzph0HJVIQEns9kEINBWAVZiWl5erihuYp4tayE28M8N9BAzmgHzpn329fVJS0uLdHV1KYKzRjN7G/siCsBcZLVRFmGySczY4EmCmCRYZ4Y0zBoy6fSJylGn9BqrSXETtwDj9AU7tIPYHKAWjULeDbNOUmnBlkJcoLHPzszq5ECXowZ//uwVt8utLZVLCU04vKjy/IZDobCGx+NpkVTq2Mw2Sc3syMiIBp8CHxsbVzeI7f7+/h/rj0t+G+cohbepIaVuUFtMX8TK9F6IQ8TUzI24CzGUvo8i8YQWNXXFjGJCQFyI7cTEpD6ZsDj42QxJUi0LY7G4AkNpaanO0Gako5nT5Ftb28Tb69VZ+8ePBi0j4mb+LXAZQ5VVNhS13+dXJSRgcHBQPzWaeyAQkMHBgL6zR0xR6Pf36ZTGk35tRmnHV1D0fcrILzMgyWew/71eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/a7e3860d5829674a4505da8f3c996663/2b41d/image2.png\"\n        srcset=\"/static/a7e3860d5829674a4505da8f3c996663/e9ff0/image2.png 180w,\n/static/a7e3860d5829674a4505da8f3c996663/2b41d/image2.png 338w\"\n        sizes=\"(max-width: 338px) 100vw, 338px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>프록시 객체는 실제 객체의 참조(target)를 보관하고, 프록시 객체를 호출하면 프록시 객체는 실제 객체의 메소드를 호출한다.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\b<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">getReference</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"id1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmembmer<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>이렇게 호출을 한다고 생각해보자.</p>\n<p>getName 호출하게 되면 MemberProxy객체에 target이 없기 때문에 JPA가 영속성 컨텍스트에 진짜 Member객체 가져오라고 초기화 요청을 하게 되고, 영속성 컨텍스트는 DB를 조회해서 실제 Member 엔티티 객체를 생성해준다.</p>\n<p>그리고 Proxy와 진짜 객체를 연결해주어 getName()을 했을 때 target.getName()을 통해서 진짜 엔티티 객체로부터 값을 가져오게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVQY031Ry4qDUAz1/z9kunDXZUGwGx0tdLS2UopvLdVW+1DEtj7OkAwOMosJhJtLTpKTE6Hve0xt/D+fT3ieh+PxiCzLcLlccD6fUdc1hmFA27Z4v994vV6/cdd1EMqyRBAEME0TaZrier3idrsxiBqSR1EEx3EY1zQNYyg+HA4QRRGapnGt7/sQFEXBcrnE7GOG+XyOMAzhui43HI0YTV8aYFkWHo8SRVEwgaqqkCQJBFmWIUkS9vs9NpsN8jxnVgQkJn+dirfbLVT1E7qusxQkD+XiOP5hqKoqg4Ig5OTpdMJ/RkMXiwVvRlLRVvf7nZkLu92OtaDXtm1el9iNK059PBixXK1WMAwD6/UXDMNk/eiA30ASvJtRl37AAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/d89fd057014a0a8083cf8726068048f8/37523/image3.png\"\n        srcset=\"/static/d89fd057014a0a8083cf8726068048f8/e9ff0/image3.png 180w,\n/static/d89fd057014a0a8083cf8726068048f8/f21e7/image3.png 360w,\n/static/d89fd057014a0a8083cf8726068048f8/37523/image3.png 720w,\n/static/d89fd057014a0a8083cf8726068048f8/612f7/image3.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-proxy-객체의-특징\" style=\"position:relative;\"><a href=\"#2-proxy-%EA%B0%9D%EC%B2%B4%EC%9D%98-%ED%8A%B9%EC%A7%95\" aria-label=\"2 proxy 객체의 특징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Proxy 객체의 특징</h2>\n<p>(1) 프록시 객체는 처음 사용할 때 한 번만 초기화 된다.</p>\n<p>(2) 프록시 객체가 실제 entity로 바뀌는게 아니라 프록시 객체를 통해 실제 entity로 접근하게 되는 것이다.</p>\n<p>(3) 프록시 객체는 원본 엔티티를 상속받은 객체기 때문에 타입 비교 시에 ’==’ 대신 ‘instance of’를 사용한다.</p>\n<ul>\n<li>JPA에서 타입 비교시 instance of 사용을 권장하는 이유임</li>\n</ul>\n<p>(4) 영속성 컨텍스트에 찾는 엔티티가 이미 존재한다면, em.getReference 호출 시에도 실제 엔티티를 반환한다.</p>\n<ul>\n<li>\n<p>반대로, 이미 getReference로 반환했다면 동일한 id로 find를 해도 proxy객체를 반환한다.</p>\n</li>\n<li>\n<p>JPA에서는 동일한 데이터에 대해서 ’==’ 비교를 true로 해주는 것이 보장되어야 하기 때문이다.</p>\n</li>\n</ul>\n<p>(5) 영속성 컨텍스트의 도움을 받을 수 없는 준영속 상태일 때 프록시를 초기화 시에 에러가 발생한다.(종종 발생!)</p>\n<ul>\n<li>org.hibernate.LazyInitializationException</li>\n</ul>\n<p>​</p>\n<h2 id=\"3-프록시-확인\" style=\"position:relative;\"><a href=\"#3-%ED%94%84%EB%A1%9D%EC%8B%9C-%ED%99%95%EC%9D%B8\" aria-label=\"3 프록시 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 프록시 확인</h2>\n<p>(1) 프록시 인스턴스 초기화 여부 확인</p>\n<ul>\n<li>PersistenceUnitUtil.isLoaded(entity)</li>\n</ul>\n<p>(2) 프록시 클래스 확인 방법</p>\n<ul>\n<li>entity.getClass()해서 찍어봐야 함</li>\n</ul>\n<p>(3) 프록시 강제초기화</p>\n<ul>\n<li>\n<p>Hibernate.initialize(entity) // JPA 표준에는 없음</p>\n</li>\n<li>\n<p>entity.getUserName() 이런식으로 실제 entity의 멤버값을 호출하면 강제 초기화 됨.</p>\n</li>\n</ul>\n<hr>\n<p>그리고 이렇게 JPA의 Proxy에 대해  설명한 것은 즉시로딩과 지연로딩에 대해서 이해하기 위함이다.</p>\n<h2 id=\"4-지연-로딩lazy-loading\" style=\"position:relative;\"><a href=\"#4-%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9lazy-loading\" aria-label=\"4 지연 로딩lazy loading permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 지연 로딩(Lazy loading)</h2>\n<p>지연로딩을 사용해서 Team 엔티티에 대해서 ManyToOne 매핑을 한다고 하면, 아래와 같이 FetchType을 Lazy로 설정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> team_id<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Team</span> team<span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러면 JPA에서 member를 find했을 때 member 테이블만 select 해 온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> m <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// member 테이블만 select</span></code></pre></div>\n<p>아래를 실행하면 Team 프록시 객체를 반환함을 알 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"m=\"</span><span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">.</span><span class=\"token function\">getTeam</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>아래와 같이 Team 엔티티의 실제 값을 조회오고자 할 때 그 시점에 JPA에서 Team 테이블에 대한 select 쿼리를 날려서 데이터를 조회해온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">m<span class=\"token punctuation\">.</span><span class=\"token function\">getTeam</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 이 시점에 select 쿼리 날림 </span></code></pre></div>\n<p>정리해보면 아래와 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQ4y42TW4+CMBCF+/9/kMojL75qIg8uoHEBo1y9goDi2ZxJuul2zbqTDCV05sw306JutxvKsoRtj8cD5/MZp9NJVsY9n88fMff7XXKjKMJut8PlcoHiY71eS3Ce59hsPpFlGVarFRzHgTNxMBqNsFwukaYpttst4jgWAd/3EQQBPM9DGIayr7quQ1VV6PteaOh1XWM+n2M8HstKcVIURSEUOoYg0+lUCjCfIIrtsKptbGWxWCAIQiRJImJ2y2VZwXVdzGYzod3vUyjOQc/HdNr1epUxJHGC4/Eo3/T+MAxCyn2SEUAIzYqmmE6isyi74GhYvGkaIaZI27ZSmN+5KpvKfqcxmImHw0GI6JxZ09RS0DRlz+6VMIn0geV5Ia1x9izA62XG/xJ8JU4KJrNNTUfnDbG7+VPQDGTLpPI//O8DsmPeCtrV2TIvL68RCV/FvBU0E0jGtjlDW/BfhLYo/w7OkKL6dG3BLxE/7cvtiDCAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/1845d59f1268873ac620a122fd487dab/37523/image4.png\"\n        srcset=\"/static/1845d59f1268873ac620a122fd487dab/e9ff0/image4.png 180w,\n/static/1845d59f1268873ac620a122fd487dab/f21e7/image4.png 360w,\n/static/1845d59f1268873ac620a122fd487dab/37523/image4.png 720w,\n/static/1845d59f1268873ac620a122fd487dab/612f7/image4.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>만약에 Member와 Team을 항상 같이 조회시킨다면 지연로딩이 아닌 즉시 로딩을 사용하는 것이 낫다.</p>\n<h2 id=\"5-즉시-로딩-eager-loading\" style=\"position:relative;\"><a href=\"#5-%EC%A6%89%EC%8B%9C-%EB%A1%9C%EB%94%A9-eager-loading\" aria-label=\"5 즉시 로딩 eager loading permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 즉시 로딩 (Eager loading)</h2>\n<p>즉시 로딩을 하기 위해서는 ManyToOne의 fetchtype을 EAGER로 설정만 해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>EAGER<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> team_id<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Team</span> team<span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하면 em.find(member) 하면 Member와 Team에 대한 데이터를 조인해서 한 번에 다 가져오게 된다. 그래서 proxy객체를 사용하지 않게 된다.</p>\n<h2 id=\"6-실무에서-지연로딩만-쓰는-이유\" style=\"position:relative;\"><a href=\"#6-%EC%8B%A4%EB%AC%B4%EC%97%90%EC%84%9C-%EC%A7%80%EC%97%B0%EB%A1%9C%EB%94%A9%EB%A7%8C-%EC%93%B0%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"6 실무에서 지연로딩만 쓰는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 실무에서 지연로딩만 쓰는 이유</h2>\n<h3 id=\"1-즉시-로딩을-사용하면-전혀-예상할-수-없는-sql이-발생한다\" style=\"position:relative;\"><a href=\"#1-%EC%A6%89%EC%8B%9C-%EB%A1%9C%EB%94%A9%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EB%A9%B4-%EC%A0%84%ED%98%80-%EC%98%88%EC%83%81%ED%95%A0-%EC%88%98-%EC%97%86%EB%8A%94-sql%EC%9D%B4-%EB%B0%9C%EC%83%9D%ED%95%9C%EB%8B%A4\" aria-label=\"1 즉시 로딩을 사용하면 전혀 예상할 수 없는 sql이 발생한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) 즉시 로딩을 사용하면 전혀 예상할 수 없는 SQL이 발생한다.</h3>\n<p>1,2개 조인한다고 해서 문제가 없지만, 모두 EAGER로 되어 있고 5개 테이블이 연결되어 있다고 생각하면 find시 조인이 5개~10개 테이블이 한꺼번에 불러오는 문제가 발생한다.</p>\n<h3 id=\"2-즉시-로딩은-jpql에서-n1-문제를-일으킨다\" style=\"position:relative;\"><a href=\"#2-%EC%A6%89%EC%8B%9C-%EB%A1%9C%EB%94%A9%EC%9D%80-jpql%EC%97%90%EC%84%9C-n1-%EB%AC%B8%EC%A0%9C%EB%A5%BC-%EC%9D%BC%EC%9C%BC%ED%82%A8%EB%8B%A4\" aria-label=\"2 즉시 로딩은 jpql에서 n1 문제를 일으킨다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) 즉시 로딩은 JPQL에서 N+1 문제를 일으킨다.</h3>\n<p>N+1 문제는 쿼리를 1개 날렸는데 그에 따른 따른 쿼리를 처음 날린 쿼리의 데이터 개수인 N개 만큼 더 실행시켜야 하는 문제이다. 예컨대 EAGER로 Team을 설정 후, JPQL을 통해 member를 조회해온다고 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Members</span><span class=\"token punctuation\">></span></span> members <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">createQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select m from Member m\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">getResultList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그러면 select * from member 쿼리가 처음에 1번 호출되게 될 것이고,</p>\n<p>불러와놓고 보니 team이 EAGER로 설정되어 있기 때문에, member 각각에 대해서 team 데이터를 다 가지고 있어야 하기 때문에 아래와 같이 member각각에 설정된 team 데이터를 불러오기 위해 SQL문이 N번 호출되게 된다는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">from</span> team <span class=\"token keyword\">where</span> team_id <span class=\"token operator\">=</span> ?</code></pre></div>\n<p>그래서 Member와 Team을 항상 같이 조회해온다고 하더라도 그냥 fetchType은 LAZY로 해두고, JPQL에서 fetch join 같은 걸 아래처럼 사용하는 것이 안전하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Members</span><span class=\"token punctuation\">></span></span> members <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">createQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select m from Member m join fetch m.team\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">getResultList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>따라서 ManyToOne, OneToOne 은 기본이 EAGER이므로 항상 LAZY로 설정해주어야 한다.</p>\n<hr>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>","excerpt":"1. JPA에서 프록시란 무엇인가? 1) em.find vs em.getReference em.find를 하게 되면 JPA가 실제 entity 객체를 반환하지만, em.getReference를 하게 되면 DB조회를 미루는 ‘프록시’ entity 객체를 반환한다. 프록시 객체는 실제 Entity 타깃 객체는 가지고 있지 않고, id값만 가지고 있는 비어있는 객체이다.  프록시 객체는 실제 Entity를 상속해서 만들어지며, Hibernate가 내부적으로 만든다. 실제 클래스와 겉 모양이 같기 때문에 사용하는 입장에서는 진짜 객체인지 프록시 객체인지 구분하지 않고 사용할 수 있다.  프록시 객체는 실제 객체의 참조(target)를 보관하고, 프록시 객체를 호출하면 프록시 객체는 실제 객체의 메소드를 호출한다. 이렇게 호출을 한다고 생각해보자. getName 호출하게 되면 MemberProxy객체에 target이 없기 때문에 JPA가 영속성 컨텍스트에 진짜 Member객체 가져오라고 초…","frontmatter":{"date":"March 15, 2022","title":"[JPA] 8. JPA프록시와 지연로딩(Lazy Loading)과 즉시로딩(Eager Loading)","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa8/"}},"next":{"id":"c7e517d4-5e33-5d3e-8aa2-451e7b99ae12","html":"<p>JPA 연관관계 매핑을 배우기에 앞서, 객체와 테이블의 연관관계를 맺는 방법이 다르다는 것을 이해해야 한다.\nJPA 1. 에서 언급했듯이, 객체는 참조를 통해, 테이블은 FK를 통한 조인으로 연관관계를 맺는다.</p>\n<p>회원과 팀이 다대일 관계일 때 객체를 테이블에 맞추어 모델링 한다면 아래와 같을 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQoz4WT56oiURCEff+X8Y+YrqgggiLmhDnnnLN1+XpRZFnchoNjT3V1dfUZh77E7XZTt9vVeDzWYDBQv9/XaDT6ViLH4/HQ5XLR6XTSbrfT8XjU+Xy2HM8QQdjr9Yx8MpmIGjD7/d4wYPlP3kGi2WxqNpspEAjI5/Mpk8loPp+bon8F72hQr9fldrsN1+l0dDgc5IA9Ho+/SRmT3PV6fat5Pp92eCbApdNpLRYLUwmeKYyQwmAwKI/Ho1gspuFwqM1mo9VqZeO+yD4Jt9utUqmUCoWC2YDaVqtlxI77/W5Gc3iB/Ol0ah0p/F9Q/5rClvINTMdarWYqaMQvSlD/d7wJGRkAqnK5nC0EEtSRQzlqWQS/+AYeW7CHGjDL5fLPyFyXbDarZDIpp9Mpl8ulcDisarVqHr4CHFeDW4HKcrlsPrLlRCKhSqViCzKFPz8/RhSJRBQKhQyAmnw+b9eB7mwWUorI0RQsz1hBgzdhNBqV1+u1e+j3+9VoNGw0gK/NfgZKi8WiSqWSEeJvu922vH0pePLyZb1e24EQRS/DP8+3T+8X4wKHHPXfanAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/e02aa46a2594edb30559c00d2ec684bb/37523/image1.png\"\n        srcset=\"/static/e02aa46a2594edb30559c00d2ec684bb/e9ff0/image1.png 180w,\n/static/e02aa46a2594edb30559c00d2ec684bb/f21e7/image1.png 360w,\n/static/e02aa46a2594edb30559c00d2ec684bb/37523/image1.png 720w,\n/static/e02aa46a2594edb30559c00d2ec684bb/612f7/image1.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>그리고 이렇게 Entity 상에서 이렇게 매핑을 하게 되면 서로 연관된 데이터를 가져오고 싶을 때</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> findMember <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Team</span> findTeam <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Team</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> findMember<span class=\"token punctuation\">.</span><span class=\"token function\">getTeamId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>이렇게 Id를 통해서만 가져올 수 있게 된다. 그리고 이것은 객체지향스럽지 않은 방식이다.\nJPA에서는(ORM에선) 이를 어떻게 모델링 할 수 있을까?\nJPA에서는 단방향, 양방향 연관관계를 통해 객체지향적으로 프로그래밍이 가능하도록 해준다.</p>\n<h2 id=\"1-단방향-연관관계\" style=\"position:relative;\"><a href=\"#1-%EB%8B%A8%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84\" aria-label=\"1 단방향 연관관계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 단방향 연관관계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVQoz32S16oCQRBE5///xwD6oCAqKqKYMWfFnLN1OQ27COIdaHZmtru6q2qcJL3fb/23ptOput2uBoOB2u22hsPhz1zngV0uFx0OByumiOL9fq/NZqPFYqHZbGbBf87cH49HjUYj9ft9bbdby3ceMsmAdDodJZNJZbNZKySZ4uv1ak1Xq5WdG42G3zyXy2m9XtvkbjweG1CtVlM8Hlez2VS9XjcAFp1vt5vtn8+nTqeT7QFOpVLWkDsfkAvWbrezToVCQZlMxhInk4l6vZ4ej8eXVjRkQnLm87kFkzsmI5iKAJCfr9fLigBjQuJ+v9uX+19GunK5bHrl83mxTyQSNhXFFJ7PZ5OhVCqZXq1WS5VKRcvl0sAxBsrkke9wyXOZpGKxqGAwqHA4bAZByZsGDQFhelhgJIwCgYA1RQJHEejQDoVCikajZk4sFrNkZEBsnhQgPA0aV6tV0xpG7GEHlkNIXIZyJBLxg0SKYUBnJPg0B/fT6bTJRT2BVP47hDJj04UvU0EXWp8L+gS0PZNgiI7s/wDjnDOvInCJCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/42f00aa8f5e469244bb23504ffda6698/37523/image2.png\"\n        srcset=\"/static/42f00aa8f5e469244bb23504ffda6698/e9ff0/image2.png 180w,\n/static/42f00aa8f5e469244bb23504ffda6698/f21e7/image2.png 360w,\n/static/42f00aa8f5e469244bb23504ffda6698/37523/image2.png 720w,\n/static/42f00aa8f5e469244bb23504ffda6698/612f7/image2.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Entity 클래스에서 참고하고자 하는 다른 Entity 클래스의 참조형을 멤버변수로 선언하는데,\n이 때 참조형으로 생성하는 Entity는 FK를 가지고 있지 않은 쪽 ( ‘Many’ 인 쪽 ) 이다.\n즉 Team과 Member와의 관계에서는 Team이 될 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"team_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Team</span> team<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러면 이제 우리는 객체지향적으로 아래와 같이 코드를 짤 수 있다.\n즉, 객체 그래프 탐색이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> findMember <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Team</span> findTeam <span class=\"token operator\">=</span> findMember<span class=\"token punctuation\">.</span><span class=\"token function\">getTeam</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//이게 된다.</span></code></pre></div>\n<h2 id=\"2-양방향-연관관계\" style=\"position:relative;\"><a href=\"#2-%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84\" aria-label=\"2 양방향 연관관계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 양방향 연관관계</h2>\n<p>위의 예에서는 Member.getTeam()은 할 수 있었지만, 즉 member가 team을 참조할 순 있었지만</p>\n<p>Team이 Member를 참조할 수는 없었다. 그래서 그걸 해보려면 아래와 같이 객체 연관관계 매핑 시에 Team 클래스에는 List members 가 추가되어야 한다.</p>\n<p>반면, 테이블 연관관계는 단방향 일 때와 차이가 없다. 테이블에서 FK로 연관관계를 맺을 때는 방향성이 없고 그냥 FK로 join걸면 서로 연관된 데이터를 모두 가져오게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQoz4VS12pCURA8//8jvgj6YEFULAiiiL037L33PskM3JCESBYOnLa7U9bgTYzHY2QyGZRKJXQ6HRQKBbRaLRSLRZTLZXS73T/zzGKxwGazUUIul0M+n8dkMsF8PlcBvh+PR+x2O/3bbre66/f7ums0GshmswKwXq9hWGi1WiGdTiORSCAWi6k774jOang4HLDf75U4Go2Envt6vY5QKCQWBGH4UK1WVZ2Fns/nF3wW/R1E+3q9hHAwGOByufyknEwm4fV6EY1G4Xa79ZHFl8sler2ekrnY6HszaunxeBAMBsXK5/NJMsMuLMJFKhal4XAojd7FbDaTfu12W7QrlYr2Bv8EkRIxdeTimbTfhSEN6nA6naQZhaUR1+tVjrI7kVBful6r1TCdTnG/32US/zKXNW63GwwT+ZkuuVwuOBwOBAIBJf6eNUtDFmk2m3LabrcjHA6LLgGZx+OBVCoFp9MJv98vczgG1kxSS44MZ5OISZ+IaYjNZkM8HpcpNJf6G0Ln2LBLJBJRMc4m7+kyNTufzzpbwTObcXbJjM1o6uxzDj8AyDouDpZFei8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/fe327661c5c61d9b0765b87c8cd5a9f0/37523/image3.png\"\n        srcset=\"/static/fe327661c5c61d9b0765b87c8cd5a9f0/e9ff0/image3.png 180w,\n/static/fe327661c5c61d9b0765b87c8cd5a9f0/f21e7/image3.png 360w,\n/static/fe327661c5c61d9b0765b87c8cd5a9f0/37523/image3.png 720w,\n/static/fe327661c5c61d9b0765b87c8cd5a9f0/612f7/image3.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>문제는 객체의 연관관계다. 객체에서는 Team에서 Member로 참조할 수 있게 하기 위해 Member 타입의 List를 넣어주어야 Team이 Member를 참조할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Team</span><span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy<span class=\"token operator\">=</span><span class=\"token string\">\"team\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> members <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러면 아래처럼 양방향으로 참조가 가능하게 된다.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> findMember <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> members <span class=\"token operator\">=</span> findMember<span class=\"token punctuation\">.</span><span class=\"token function\">getTeam</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//이게 된다</span></code></pre></div>\n<br>\n<h3 id=\"그런데-mappedby가-무엇인가연관관계의-주인\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%B0%EB%8D%B0-mappedby%EA%B0%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B8\" aria-label=\"그런데 mappedby가 무엇인가연관관계의 주인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그런데 mappedBy가 무엇인가?(연관관계의 주인)</h3>\n<p>객체와 테이블의 연관관계의 차이에 대해서 다시 짚어보자.</p>\n<ul>\n<li>\n<ol>\n<li>\n<p>객체는 Member -> Team , Team -> Member 의 단방향 관계 2개로 양방향 관계를 맺는다.</p>\n<p>즉, 객체의 양방향 관계는 사실 서로 다른 단방향 관계 2개이다.</p>\n</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>반면 테이블은 TEAM_ID 라는 1개의 값으로 양방향 관계를 맺는다.</li>\n</ol>\n</li>\n</ul>\n<p>따라서 객체에서는 양방향 관계 중 Member의 team으로 FK를 관리할 지 Team의 members로 FK를 관리할 지를 정해주어야 한다.</p>\n<ul>\n<li>객체의 두 관계 중 하나를 주인으로 지정(FK관리)해주어야 한다는 것이다.</li>\n<li>주인이 아닌 쪽은 Read-only이며 따라서 Team의 members에 뭔가 데이터를 넣고 Team을 저장한다고 해서 Member 테이블에 데이터가 쌓이지 않을 것이다.</li>\n<li>mappedBy 속성으로 주인을 지정해주어야 한다.</li>\n</ul>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQoz42Sx24CUQxF399nwc/Mii0IECA2VNH7CJihiN7LjY6TQdkgxZLlKbZvec/pN9brtTabjdrtttLptPL5vMIw1Gw2s7rb7ez/crnUarVSt9vVYrFQo9Gw/vl8riAI5B6Ph0jf99VqtWyYZur9fjeg7XYb4Wq/3+t8PttiwAHiGwGAOxwOul6vmkwmymazyuVySqVS74XT6VSdTufNkOXM9Pt9JRIJFYtFIwJTdjjQiMvlovF4rOFwqNFoZAuRQL3dbm+Gz+dTp9PJmDebTctqtapSqfQjmYFer2cSQCV5rtfrNvg3WAaB1+ulT+GQwmBkOIjIzmQyJpf/SI98RhbJIQwGA5NKrVQq1u+Ox6Nthi5ecGLxeNz8KZfL1swwPmML/nEIzJF4GlWYm4cwrNVqtsjzPCWTSVsYeQryfwJCLnrhbnFihULB5GI014B7CDMCBp+S+IrF9A1Ktp+p2rDNqgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/ac4651bba63717b0a97fcd9efbf8248d/37523/image4.png\"\n        srcset=\"/static/ac4651bba63717b0a97fcd9efbf8248d/e9ff0/image4.png 180w,\n/static/ac4651bba63717b0a97fcd9efbf8248d/f21e7/image4.png 360w,\n/static/ac4651bba63717b0a97fcd9efbf8248d/37523/image4.png 720w,\n/static/ac4651bba63717b0a97fcd9efbf8248d/612f7/image4.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>그렇다면 누구를 주인으로 지정해주어야 할까?</p>\n<p>비즈니스 중요성과 관계없이 무조건 FK가 있는 테이블 쪽 ( <strong>N:1에서 N인 곳</strong> ) 을 주인으로 정해야 한다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVQoz22Sx4oDQQxE+/+/x8YHY3DEBmOcc84551jLEztmDysQ3dMjlUoluc/nI+zxeJj3ej3l83lls1lNp1O1Wi3V63U1m00Nh0ONx2PVajWlUillMhnzSCSi0Wik5/Mpp1/jATCSASsUCppMJgZ0PB7ND4eD5vO5FouFSqWS5RSLRSMwGAzU7/flLpeLrtergVWrVa1WKwt8vV5WaLPZiBg6wYmlE4rRAaw82263clQjgXbC4bCi0aj5crnUbrczhhS53W4Ght/vd7Xb7W98LBazEzkcbWBU2u/3Rj2dTpsu5XLZ9AKUDvjmjm65XE7JZFLBYFCBQMD+Ucx1Oh3Tg5NWG42GMfhrfNOmd57PZ7u/329zb7CYox2YcaJBt9s1cdHndDrZMP4zOgJ4vV5bLHfiHWAYIjNZ9AiFQtYy04axNxASSKQw75VKxdYH/ZAAWRxTBJSffr9fPp9PiUTiu1usEayJgQ06wRpACsfjcdOdDTFAqKMHj4jM5LyBwATQvxp5BlOWHnnYzdlsZiv2A+kw4JaHCyP3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/687624527312986690a0e8ee411b42aa/37523/image5.png\"\n        srcset=\"/static/687624527312986690a0e8ee411b42aa/e9ff0/image5.png 180w,\n/static/687624527312986690a0e8ee411b42aa/f21e7/image5.png 360w,\n/static/687624527312986690a0e8ee411b42aa/37523/image5.png 720w,\n/static/687624527312986690a0e8ee411b42aa/612f7/image5.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<h3 id=\"양방향-매핑-시-가장-많이-하는-실수\" style=\"position:relative;\"><a href=\"#%EC%96%91%EB%B0%A9%ED%96%A5-%EB%A7%A4%ED%95%91-%EC%8B%9C-%EA%B0%80%EC%9E%A5-%EB%A7%8E%EC%9D%B4-%ED%95%98%EB%8A%94-%EC%8B%A4%EC%88%98\" aria-label=\"양방향 매핑 시 가장 많이 하는 실수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>양방향 매핑 시 가장 많이 하는 실수</h3>\n<ol>\n<li>\n<p>연관관계의 주인이 아닌 쪽에서 수정/저장을 하는 경우</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setUserName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Team</span> team <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Team</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nteam<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TeamA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nteam<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위와 같이 코드를 실행하면 member 테이블이 가지고 있는 FK인 team_id에 데이터가 저장되지 않는다. 앞서 말했듯, 연관관계의 주인이 아닌 쪽은 ‘Read-only’이기 때문이다.</p>\n<p>그렇기 때문에 아래와 같이 연관관계의 주인인 Member 클래스에서 team을 추가해주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Team</span> team <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Team</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nteam<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TeamA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//team.getMembers().add(member);</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setUserName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setTeam</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// team_id 로 매핑됨. </span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"2\">\n<li>\n<p>연관관계의 주인이 아닌 쪽에서 연관관계를 매핑하지 않는 경우</p>\n<p>아니 주인이 아닌 쪽에서는 연관관계 매핑을 하지말라며? 뭔 소리야? 라고 생각 할 수 있다.</p>\n<p>하지만 정확히는 위와 같이 연관관계의 주인이 아닌 쪽에서 사용해서 수정/저장을 하지 말라는 거지 이렇게 주인이 아닌 쪽에서 연관관계 매핑을 쓰지 말라는 뜻이 아니다.</p>\n<p>오히려 2가지 이유로 양쪽 클래스 모두에 값을 설정\b해주어야 한다. 즉 Team에서도 아래와 같이 add Member를 해주어야 한다는 뜻이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">team<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>\n<p>(1) 객체지향으로 생각해보면 team에도 add member를 해주고,member에도 team을 설정해주는게 맞다.</p>\n</li>\n<li>\n<p>(2) <strong>JPA에서는 영속성 컨텍스트의 1차캐시에서 먼저 값을 조회해오기 때문에 발생하는 이슈</strong>가 있다.\n즉 DB가 아닌 1차캐시에서 데이터를 가져오게 되면 사실 상 순수 객체 상태기 때문에 양방향 매핑이 필요하다. 아래 코드를 살펴보자.\n<br></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  <span class=\"token class-name\">Team</span> team <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Team</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  team<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TeamA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  em<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  member<span class=\"token punctuation\">.</span><span class=\"token function\">setUserName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  member<span class=\"token punctuation\">.</span><span class=\"token function\">setTeam</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// team_id 로 매핑됨. </span>\n  em<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//team.getMembers().add(member); 이걸 주석해제 해주면 1차캐시 문제를 해결 가능</span>\n  <span class=\"token comment\">// em.flush();</span>\n  <span class=\"token comment\">// em.clear();   </span>\n\n  <span class=\"token comment\">/* 위에서 저장된 team을 DB가 아닌 영속성 컨텍스트 내의 1차캐시로부터 불러온다. (flush, clear가 안되었다면)\n  즉 반환되는 값은 순수 객체상태라고 보면 되고 따라서 team 객체의 member list는 비어 있을 것이다. \n  셋팅해준 적이 없으니깐. */</span>\n  <span class=\"token class-name\">Team</span> findTeam <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Team</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> team<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">Lis</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> members <span class=\"token operator\">=</span> findTeam<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span> m <span class=\"token operator\">:</span> members<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"m=\"</span><span class=\"token operator\">+</span>m<span class=\"token punctuation\">.</span><span class=\"token function\">getUserName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//아무것도 안찍힘. </span>\n  <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>위 코드에서 Flush, clear를 해주지 않았다면 영속성 컨텍스트의 1차캐시로부터 team 객체를 가져오게 될 것이기 때문에 사실상 순수 team객체를 가지고 오는 것과 같고, team객체에는 member list에 대해서 설정해준 것이 아무것도 없기 때문에 null값을 반환하게 될 것이다.</p>\n<p>따라서 이와 같은 문제 해결을 위해 주석을 해제하여 객체 간 서로 참조할 수 있게 아래와 같이 매핑해주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">team<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그리고 이를 쉽게 해주기 위해 **‘양방향 편의 메소드’**를 설정해주면 좋다. 연관관계의 주인 쪽(Member)에 아래와 같이 setTeam메소드 대신 changeTeam으로 변경해주고 Member.changeTeam(team)시 Member와 Team쪽에서 모두 값이 매핑되도록 설정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token function\">changeTeam</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Team</span> team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>team <span class=\"token operator\">=</span> team<span class=\"token punctuation\">;</span>\n  team<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//양방향 매핑. </span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>반대로 연관관계의 주인이 아닌 Team쪽에서 양방향 매핑되도록 편의 메소드 설정을 해줘도 된다.\n그러나 <strong>반드시 Member 또는 Team 둘 중 한 곳에서만</strong> 편의 메소드를 설정해야 함에 주의하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token function\">addMember</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  members<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  member<span class=\"token punctuation\">.</span><span class=\"token function\">setTeam</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>(3) 양방향 매핑시 발생하는 무한 Loop</p>\n<p>toString이나 json 생성 라이브러리 사용 시에 순환 참조 문제가 발생한다.  즉 Member가 Team을 참조하고 Team안에는 또 Member가 있고 다시 그 Member안에 Team 참조…무한 반복되는 문제. toString은 쓰지 않는 것을 추천하고 json으로 controller에서 내려줄 때는 entity로 절대 반환하지 말고 DTO를 통해 response 주도록 해야 한다.</p>\n</li>\n</ul>\n</li>\n</ol>\n<hr>\n<p>오늘의 간단 정리</p>\n<ul>\n<li>단방향 매핑만으로도 연관관계 매핑은 끝난다.</li>\n<li>양방향은 필요하면 추가하면 되고 편의메소드를 쓰면 됨.</li>\n<li>연관관계의 주인은 FK가 있는 곳이 기준이다.</li>\n</ul>\n<hr>\n<p>참고자료</p>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>\n<p>​</p>","frontmatter":{"date":"March 12, 2022","title":"[JPA] 5. 연관관계 매핑 (feat. 연관관계의 주인)","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa5/"}},"prev":{"id":"63bd45bc-1012-5983-9b4c-f4c1913af714","html":"<p>JPA에서 제공하는 다양한 연관관계 매핑하는 방법에 대해서 알아보기에 앞서,\n연관관계를 매핑할 때 고려해야 할 요소는 3가지임을 기억하자.</p>\n<ol>\n<li>다중성</li>\n</ol>\n<ul>\n<li>@ManyToOne -> 제일 많이 사용된다.</li>\n<li>@OneToMany -> 사용할 수는 있지만 ManyToOne의 양방향으로 커버 가능하다.</li>\n<li>@OneToOne -> 가끔</li>\n<li>@ManyToMany ->실무에서 안 씀</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>단방향인가 양방향인가</p>\n</li>\n<li>\n<p>연관관계의 주인이 어느 쪽인가</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"1-다대일-manytoone-\" style=\"position:relative;\"><a href=\"#1-%EB%8B%A4%EB%8C%80%EC%9D%BC-manytoone-\" aria-label=\"1 다대일 manytoone  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 다대일( ManyToOne )</h2>\n<p>다대일 관계는 가장 많이 사용되는 관계이다. 사실 상 거의 이것으로만 설계할 수 있다.</p>\n<p>다대일 관계의 특징은 FK를 ‘다’ 쪽에서 관리하는 것이고, 연관관계의 주인도 ‘다’ 쪽이라는 것이다.</p>\n<h3 id=\"1-단방향\" style=\"position:relative;\"><a href=\"#1-%EB%8B%A8%EB%B0%A9%ED%96%A5\" aria-label=\"1 단방향 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 단방향</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVQoz4VT2YrCUBTz/z9HfBDcQBAXWpX64NpRW3HfWpfWNUMidZxhnLlw8NabJjk5t7H7/Y6/1mAwgG3b6Pf76HQ68DzvLZZcMW7O5zNWqxWGwyFM04RlWZhOpxiPx9hutzpbLBbP3+isVqvBcRw9X69XkcYulwuWyyVarRZGo5HI2u22nLiui91uh9PpJNHj8Qjf92FZDWG73a7eJXkYhA9C3/OlWq1WUa/XYRqmSLj4/+12+9YSFwXpbjabqdgZjYkwssqMms2mwFSnKsHvsqIQXZMoElWG5XIZ+XwelUoFpVJJbUSLYKo7jqvigBjDq+tX5yJkVpvNRu3RXTabVfvz+Vz5rNdr7TkQFrERnjiKMNcwDL+Gst/vYRgGMpkMEokEkskkisWiIqAqY2GuQRA8idgR8YVCQUai3OWQKul0GvF4XA5zuZxe5P1ji7w6JKM4J86BpFKp580g7nA4PAijrHq9nhw1rAZs+0N3azKZ/DoUklKAJCzuoxxj/30pPP9Zf30pn+k8PP3fdzUnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/e1fa8c7612c32aaee92ab56fd1c6c340/37523/image1.png\"\n        srcset=\"/static/e1fa8c7612c32aaee92ab56fd1c6c340/e9ff0/image1.png 180w,\n/static/e1fa8c7612c32aaee92ab56fd1c6c340/f21e7/image1.png 360w,\n/static/e1fa8c7612c32aaee92ab56fd1c6c340/37523/image1.png 720w,\n/static/e1fa8c7612c32aaee92ab56fd1c6c340/612f7/image1.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"2-양방향\" style=\"position:relative;\"><a href=\"#2-%EC%96%91%EB%B0%A9%ED%96%A5\" aria-label=\"2 양방향 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 양방향</h3>\n<p>설계는 다대일 단방향에서 끝났지만 만약에 Team 에서도 Member에 대한 조회를 하고 싶다면 OneToMany를 ‘일’ 쪽인 Team에 추가하여 매핑해주면 된다. 연관관계의 주인은 Member이므로 조회만 된다는 점에 유의하자.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.55555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQoz4VT2W7CMBDk/3+HCKUK5RTlASFxCJpAuMV9JUACKcegWRS3IKCWLDv27OzMehMBgMvlglfDdV30+330ej1ZZ7MZXsXwLBJeBMGPBA+HQ5imicFgAMd1sVgssFwuZW232ygWi5jP54JtNptqfzwehUcRMohEnU4HhUIBrVYLq9UKtm1jNBphPB7D8zwhrlQqkrhcLguO+/1+fyM8HA4SOJ1OkUqlRAGBPN9ut7AsS8ho1fd9UWKaFnK5nCis1+uSNAiCGyFBDOQBg2u1mgCZgMpI/DjEzbcpypiI2NPpdCOkjWQyifxXHqVSCZlM5o6EFhuNBrrdriihxVDN00ehdyrc7XaiiPXT9Q9ZqYCETMp7x3Gw2WyUetpmPVmSX8ueL8DJZIJ4PI5YLAbDMJD4TKhHYlJi/j5KNptFOp2WxNVqVbmK0DsDqCYajULTNOi6LkAmoUUSMSDsCLYU1bHe3N89Suj/fD5LgTlJxN5ar9eq2GGN3v0EqrHfgZ4Rhd+P866xX4Ee7/8jvAI0W4tP60jqrAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/bb687090b89642bddc93ca50b45018f8/37523/image2.png\"\n        srcset=\"/static/bb687090b89642bddc93ca50b45018f8/e9ff0/image2.png 180w,\n/static/bb687090b89642bddc93ca50b45018f8/f21e7/image2.png 360w,\n/static/bb687090b89642bddc93ca50b45018f8/37523/image2.png 720w,\n/static/bb687090b89642bddc93ca50b45018f8/612f7/image2.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-일대다-onetomany-\" style=\"position:relative;\"><a href=\"#2-%EC%9D%BC%EB%8C%80%EB%8B%A4-onetomany-\" aria-label=\"2 일대다 onetomany  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 일대다( OneToMany )</h2>\n<p>일대다는 이제껏 봤던 ManyToOne 중심의 모델링과는 달리 실무에서 거의 쓰이지 않는다.</p>\n<ul>\n<li>외래키를 반대 테이블에서 관리하고,</li>\n<li>연관관계를 위해 추가적은 update문 실행이 필요하기 때문.</li>\n</ul>\n<h3 id=\"1-단방향-1\" style=\"position:relative;\"><a href=\"#1-%EB%8B%A8%EB%B0%A9%ED%96%A5-1\" aria-label=\"1 단방향 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 단방향</h3>\n<p>일대다 단방향에서 ‘One’ 쪽이 연관관계의 주인이 된다. 그런데 FK를 ‘다’ 쪽에서 관리하는 것은 다대일 관계와 같다. 이것은 db테이블 구조 상 변경 불가능한 것이기 때문임.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQoz32TWYsqUQyE/f//RtCHuaJzHxRFQYVR3HBfWm1t932p4YscGbzeCYRj5+RUUpUYkqT7/a53dj6f1W631ev17BwOh/rNwAk5sN1up8VioUajIc/ztFwutdlsdLlcFAQL5fN5FYtFuyNOgXq9rul0arnkYU/AwWCgfr+vZrOp+XxuTvLhcNB2u7Viq9XKCgJWLpdVKBQ0mUw0Go203+8fgA652+0qmUyq0+kYKOCAvRqFstmsSqWS5Xre2M7T6fQApPpsNrMgtDKZjFGj6v+0dXrdbrd/ckKOBo7oUHcPGAoOi58nnTsgYnR3PB4fQyFwvV61Xq/l+zPTBrGDIDD/+irZd61WU6VSsYlDm7xcLmd68s17gJ9DQTMSEomE0um0gbRaLfm+b/SZJF0AkEqlFI1GFQ6H9fn5V9Vq1QbHfQgd3JQ/Pv5YF1AHjKpuH5EGUPSNRCKKxWKKx+OmPQVpCKxnhzxiF9kxgPj9bum5hz4OC/ZyPB6bbDaU3/4pxF/9nUHVLfY3NwFAMKpB5nAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/77efbaf770cc8da924e8fa65fb18a715/37523/image3.png\"\n        srcset=\"/static/77efbaf770cc8da924e8fa65fb18a715/e9ff0/image3.png 180w,\n/static/77efbaf770cc8da924e8fa65fb18a715/f21e7/image3.png 360w,\n/static/77efbaf770cc8da924e8fa65fb18a715/37523/image3.png 720w,\n/static/77efbaf770cc8da924e8fa65fb18a715/612f7/image3.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>‘일’ 쪽인 Team 클래스에서 JoinColumn을 team_id로 설정하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Team</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@OneToMany</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"team_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> <span class=\"token comment\">//이걸 반드시 해줘야 함. 아니면 조인테이블 방식을 사용함.  </span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> members <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 아래와 같이 실행해주면 team, member 테이블 모두에 잘 등록된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Team</span> team <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Team</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nteam<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"teamA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nteam<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//update 쿼리가 한 번 더 나감</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그러나 실무에서 테이블 수십개가 엮여서 돌아가는 상황에서 ManyToOne 단방향과 OneToMany 단방향을 혼용하는 것은 혼란스러울 수 있다. 그렇기 때문에 ‘다’ 쪽을 연관관계의 주인으로 가져가고</p>\n<p><strong>필요시에만 ManyToOne 양방향을 사용하는 방식</strong>으로 설계를 하는 것이 좋다.</p>\n<h3 id=\"2-양방향-1\" style=\"position:relative;\"><a href=\"#2-%EC%96%91%EB%B0%A9%ED%96%A5-1\" aria-label=\"2 양방향 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 양방향</h3>\n<p>공식스펙상에서는 없는 설계이지만,</p>\n<p>@JoinColumn의 옵션을 사용해서 설정가능하다. 그러나, 역시.. 다대일 양방향을 사용하자는 것이 결론이다.\n​\n<br></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdElEQVQoz3VSy46CQBDk/7+Gg/HgwYMnFQ6gUR5qggqKb9DwUNDaVCfjstGdpBOY7q6urhrt9Xrh23k8HoiiCIfDAdvtFmVZfq1jfzM09fF8PlEUBbIsQ13XuN/vOJ1OWK/XcB0Xx+NR6pi/3W6SZ53qZQggp1RVhTAM4Xs+HMfBbrdDHMcyIEkS+Q+CAMtgCc/zMBgMsFqtsN/vPxi/AV3XQxAscblcBMD3fZzP53dhnucwTROj0UhYs4fg0+lU7kzDRBRG0K7pVdjMZjPYtg3HcaWBYGTI1RgEXCwWsCwb4/FY8uyjFNQ4TVOp15iYz+eyMtdgIw/1oREEU8DN09SNBv5ZWRnAFYbDoUzkADLhHdlTAjIyDAPdbheTyUSkUSYpxzXFhoXtdlsEtyxL2GZZLquxYbPZoNPpQNd1tFot9Pt9kYBEkiT9BVTPhqzoJAGoC4eoIhpAtzms1+sJGAfynXJdrv4B+N+j/aYbg0MUULP2B4ly9ZA/UqPwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/8637766bc83a546101992b997aaf0321/37523/image4.png\"\n        srcset=\"/static/8637766bc83a546101992b997aaf0321/e9ff0/image4.png 180w,\n/static/8637766bc83a546101992b997aaf0321/f21e7/image4.png 360w,\n/static/8637766bc83a546101992b997aaf0321/37523/image4.png 720w,\n/static/8637766bc83a546101992b997aaf0321/612f7/image4.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"team_id\"</span><span class=\"token punctuation\">,</span> insertable<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> updatable<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Team</span> team<span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"3-일대일onetoone\" style=\"position:relative;\"><a href=\"#3-%EC%9D%BC%EB%8C%80%EC%9D%BConetoone\" aria-label=\"3 일대일onetoone permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 일대일(OneToOne)</h3>\n<p>일대일 관계에서 FK는 양쪽 어디에 있어도 상관없지만 ‘주 테이블’을 정해서 그쪽에 FK를 두면 된다.</p>\n<p>Member Locker의 경우 Memberrk 주테이블이 된다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABkUlEQVQoz41Ta4/BUBS8///H8E1tCBtBP6gIImg9Wm9atKhnmM0caSMbsnuSk/vouTNn5t6qx+MB5qfY7/fodDoYj8ewLEvGT0EcFYHx4Hq9RrfbRb1eR6vVwmw2w2q1gud5Mi4WC5kvl0tZs6bdbsv6cAgFR93vd9xuNziOg+FwCNO0YBiGAG+3W4xGIyE7nU4IwzDumN0SrN/vY7PZCIEABkEgRQTUdV3AGo0GXNfD5XKRjl4lMXi4Wq0KGb9PJhP4vv8EjCZkJzOTrJQxnU5l/11Eyq7Xq4yxh2RoNpswTRO2bYuM16CvlBdZ0uv1sNvt3l5I3CH94UEm2y+Xy5IEcV0Xg8EAtMb3g9gv2kSiYrEoTdBvEilO2D79yOe/kU5/IZXSkEwmUSgU4NiOAFN6RMzbrVQqyGazUlMqlWCZlhCp4/EohrJI0zQkEglkMhnUajVhph0kez6Ng8iaz+fI5XJSw6dFVVRBMhV5wGJK4IXQTxZSLt8eZf6+EL6A8/ksnbMpJvfVX3/Kq+n/qf0B/5w5z6jaPPMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/4007557c9861fbbef71de9607e6bf53f/37523/image5.png\"\n        srcset=\"/static/4007557c9861fbbef71de9607e6bf53f/e9ff0/image5.png 180w,\n/static/4007557c9861fbbef71de9607e6bf53f/f21e7/image5.png 360w,\n/static/4007557c9861fbbef71de9607e6bf53f/37523/image5.png 720w,\n/static/4007557c9861fbbef71de9607e6bf53f/8ae3e/image5.png 756w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>다대일 단방향과 아주 유사하다. 아래처럼 설정해주면 끝.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"locker_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Locker</span> locker<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>만약 Locker도 member를 참조하고 싶다면, (양방향이라면) 아래와 같이 하면 된다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQoz4VTa4uCUBT0//+QfkDQh4iKih5GQRqk5ZLmI+2hPbQ3Ncucxd0PS7sH5F6545yZOVcFAF6vF97V4/HAYrHAcrmE53kIwwh/lZKT3W43ZFmG1WoF27YRBAHSNEUcJ/BcD1EUwbI+oKoqwjAU7Ha7heM4su73e+FQcubdbieHJOt2uxiNRgKkuvP5jMvlIiRJksCyLFHL5v1+X9RzTw6FQG7YlUSDwQDj8Ri+70sjgqn0+XyKfa5xHAuWxKfTSZq4ros0zaCw6/V6xf1+x2QygaZp0DQdju2IbSr+yi4USyzaa7fbaLVaUNU+Op0Oer2ekAuhYZjSjfZM0xSLefF8Pp9LHLRF5cfj8f1QyMqOtM3gqWo4HIp1NiDJdDqVlQ8xm81GYqByYg3DkO8Ph8OPZb6QhNmUy2UUi0XUajX4fiD5sBhLrpjRNBoNVCoV1Ot1cUgxCsmokKBSqYRCoSCEzWZTJs0pMgYqowoOkftqtSqEdMGcvwlz7wx8NpuJPV3XJTNa4zDW6/WvrIinmPxKcaUDudh//Sl55bj/sJ9X+zWGAJwvqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/7a5f34d06a1b00fa8a6503e20a90dca7/37523/image6.png\"\n        srcset=\"/static/7a5f34d06a1b00fa8a6503e20a90dca7/e9ff0/image6.png 180w,\n/static/7a5f34d06a1b00fa8a6503e20a90dca7/f21e7/image6.png 360w,\n/static/7a5f34d06a1b00fa8a6503e20a90dca7/37523/image6.png 720w,\n/static/7a5f34d06a1b00fa8a6503e20a90dca7/612f7/image6.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Locker</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToOne</span><span class=\"token punctuation\">(</span>mappedBy<span class=\"token operator\">=</span><span class=\"token string\">\"locker\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"4-다대다\" style=\"position:relative;\"><a href=\"#4-%EB%8B%A4%EB%8C%80%EB%8B%A4\" aria-label=\"4 다대다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 다대다</h3>\n<p>실무에서 안 쓴다. 왜?</p>\n<p>일단 JPA에서 ManyToMany를 지원하는 이유는 객체에서는 테이블과 달리 별도의 클래스 없이도 Member에서 Product List를 가질 수 있고, Product에서도 Member List를 가질 수 있는 다대다 관계가 가능하기 때문이다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQoz61RyYqDUBB8//9JYg4iHkwu8SCKHqIkuCEumM21QvXwhswwM6dpKHzdbW9VCgC2beMH0zShaRpUVSXoug5t22IcRzweD/H7vpdcXdfiM/feQ707z+cTWZbhdDoJ8jyXAYwTfBdFgSRJkKap5DnoS0M+tLOuK67XK+73u2AYBmzrR04XMcbc7XaTN2t0jlD4Z1OcMM+z8Keh7XucZy/L8rkRY+RQf5lTJD0IAux2OxyPR5zPZzmbpPu+D8uy4DgObNtGFEXIslxEuVwuwqPrujgcDsI9RVIk2TAMaeh5HuI4Fo7KsoRpmtJsv99LIQdQLG7K/1gThqEMIriE4ppUiiDR76rR1wJoEdiMxjotHsGrePqPomjVf7O/8i99u7G5wF54hgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image7\"\n        title=\"image7\"\n        src=\"/static/d55ae87c7c4eacbab0162f8b3500242f/37523/image7.png\"\n        srcset=\"/static/d55ae87c7c4eacbab0162f8b3500242f/e9ff0/image7.png 180w,\n/static/d55ae87c7c4eacbab0162f8b3500242f/f21e7/image7.png 360w,\n/static/d55ae87c7c4eacbab0162f8b3500242f/37523/image7.png 720w,\n/static/d55ae87c7c4eacbab0162f8b3500242f/612f7/image7.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그러나 실무에서는 쓰이지 않는데 연결 테이블이 연결만 하고 끝나지 않기 때문이다.</p>\n<p>아래 Member_Product 테이블과 같이 다른 속성이 포함되기 때문이다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVQY03VQyYqDUBD0/3/Eu0xEEDwpggpRQRQmRoLgguK+4II1dIO3TMG7dC1UPWGeZzRNi6ZpMAwDzvMEYd93jOPI97Zt+RF/XRfz67pimiZUVYW+71l7HAcEx3Ggqip0Xcfr94WyLNn4fLp4/DwgSRJkWYaiKHi/E2RZxnwQBHBdl32e5/GdygmGYcCyLERRhDiO0XUdNzBNE6IocpCmaQjDEGmachtq6fs+bNvmoM/ngyRJsCwLBDKTgKZS5XtSnufcgoKKouBJdV1j2zbcIC19Dflur4AvuEP/u33jb/wBxEN2gUznYOwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image8\"\n        title=\"image8\"\n        src=\"/static/d263928e906db5042f27105fd5e01c01/37523/image8.png\"\n        srcset=\"/static/d263928e906db5042f27105fd5e01c01/e9ff0/image8.png 180w,\n/static/d263928e906db5042f27105fd5e01c01/f21e7/image8.png 360w,\n/static/d263928e906db5042f27105fd5e01c01/37523/image8.png 720w,\n/static/d263928e906db5042f27105fd5e01c01/612f7/image8.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>따라서 실무에서는 다대다를 다대일 관계로 풀어내야 한다. 아래와 같이 Member_Product 연결 테이블을 Entity로 승격시키는 것이다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQY03VPyYqEUAz0/7/GphsX8KLjHDyoF1EUFaVpxeXgirjWkIBzmikoQvKq8irCOI4oyxJFUaDve0zTBALNPc9DkiSQJAnP5wvv9xtZlqFtW9Ysy4J5ntn/+XwwDAMEy7LYoKoqgiBAmqZomgZRFOHxeEAURZjmNzRNY2PXdfxGS33fh+u6MAwDuq6zXyAhDRzHQRzHnGDbNlRVBVmWoSgKTNOEYXxxGkJd19j3nReTPwxD5HnOvXCeJ4jHcbCIKoFOt22bP6IUdBKlulMSrutiko9CUBXwB24hLb+5rusvKcB/+AG6cHD+PJEUZQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image9\"\n        title=\"image9\"\n        src=\"/static/9a909feb23b653a1f8b107a77de49336/37523/image9.png\"\n        srcset=\"/static/9a909feb23b653a1f8b107a77de49336/e9ff0/image9.png 180w,\n/static/9a909feb23b653a1f8b107a77de49336/f21e7/image9.png 360w,\n/static/9a909feb23b653a1f8b107a77de49336/37523/image9.png 720w,\n/static/9a909feb23b653a1f8b107a77de49336/612f7/image9.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<p>참고자료</p>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>","frontmatter":{"date":"March 16, 2022","title":"[JPA] 6. 다양한 연관관계 매핑","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa6/"}},"site":{"siteMetadata":{"siteUrl":"https://steadyandslow.com","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/jpa8/","nextSlug":"/jpa5/","prevSlug":"/jpa6/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}