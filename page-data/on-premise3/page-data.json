{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/on-premise3/",
    "result": {"data":{"cur":{"id":"0c2b0a8f-e1ce-5168-9bb0-52991a15f6a9","html":"<h2 id=\"무작위-접속-시도-차단을-위한-ipban-적용\" style=\"position:relative;\"><a href=\"#%EB%AC%B4%EC%9E%91%EC%9C%84-%EC%A0%91%EC%86%8D-%EC%8B%9C%EB%8F%84-%EC%B0%A8%EB%8B%A8%EC%9D%84-%EC%9C%84%ED%95%9C-ipban-%EC%A0%81%EC%9A%A9\" aria-label=\"무작위 접속 시도 차단을 위한 ipban 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>무작위 접속 시도 차단을 위한 ipban 적용</h2>\n<p>github에서 <a href=\"https://github.com/DigitalRuby/IPBan/releases\">https://github.com/DigitalRuby/IPBan/releases</a> url로 ipban을 다운로드 한다.</p>\n<ul>\n<li>\n<p>로그인/로그오프 기록을 로깅하여 ‘이벤트뷰어’-’보안’ 에서 확인하도록 하기</p>\n<p><code class=\"language-text\">auditpol.exe /set /category:\"{69979850-797A-11D9-BED3-505054503030}\" /success:enable /failure:enable</code></p>\n</li>\n<li>\n<p>서비스등록</p>\n<p><code class=\"language-text\">sc.exe create IPBAN type= own start= delayed-auto binPath= C:\\IPBan\\DigitalRuby.IPBan.exe DisplayName= IPBAN</code></p>\n<p><code class=\"language-text\">sc.exe description IPBAN \"Automatically builds firewall rules for abusive login attempts:https://github.com/DigitalRuby/IPBan\"</code></p>\n<p><code class=\"language-text\">sc.exe failure IPBAN reset= 9999 actions= \"restart/60000/restart/60000/restart/60000\"</code></p>\n<p><code class=\"language-text\">sc.exe start IPBAN</code></p>\n</li>\n<li>\n<p>ipban.config 수정 후 서비스 재기동하기</p>\n<ul>\n<li>로그인 5회 실패시 등록</li>\n</ul>\n  <add key=\"FailedLoginAttemptsBeforeBan\" value=\"5\"/>\n  - ipban 시간 15일로 수정\n  <add key=\"BanTime\" value=\"15:00:00:00\"/>\n  - 차단후 제거 기준일 15일로 수정\n  <add key=\"ExpireTime\" value=\"15:00:00:00\"/>\n</li>\n</ul>\n<h2 id=\"이벤트-뷰어-보는-법\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%B7%B0%EC%96%B4-%EB%B3%B4%EB%8A%94-%EB%B2%95\" aria-label=\"이벤트 뷰어 보는 법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이벤트 뷰어 보는 법</h2>\n<p>[실행창] - “eventvwr” 입력하면 된다.\n생각보다 호스트 서버에 무작위로 접속 시도하는 경우가 많아서 윈도우 서버의 경우 이벤트 뷰어에 들어가서 누가 언제 호스트 서버에 접속했는지 확인할 수 있다.\n접속 시도와 관련된 이벤트 id 및 로그온 유형은 다음과 같다.</p>\n<ul>\n<li>\n<p>Event ID</p>\n<ul>\n<li>4624\n<ul>\n<li>성공적인 로그인을 뜻한다. 따라서 관리자가 접속한 시간이 아닌 경우에 4624가 발생했다면 외부 공격을 의심해야 한다.</li>\n</ul>\n</li>\n<li>4625\n<ul>\n<li>계정 로그온 실패로 분류되며, 나의 경우에는 이벤트 뷰어에서 4624 이벤트가 초 단위로 쌓였었다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>로그온 유형</p>\n<ul>\n<li>로컬 로그온 (Logon Type 2): 사용자가 직접 컴퓨터의 키보드 또는 마우스를 사용하여 로그인하는 경우이다.</li>\n<li>원격 데스크톱 로그온 (Logon Type 10): 원격 데스크톱 연결(RDP)를 통해 원격으로 로그인하는 경우이다.</li>\n<li>네트워크 로그온 (Logon Type 3): 파일 공유 등의 네트워크 리소스에 접근하기 위해 로그인하는 경우이다. 예를 들어, 파일 공유에 접근하거나 인터넷 공유 서비스를 사용하는 경우가 이에 해당한다.</li>\n<li>서비스 로그온 (Logon Type 5): 시스템 서비스가 실행되기 위해 로그인하는 경우이다. 일부 백그라운드 서비스나 시스템 프로세스가 로그인하여 작동하는 경우가 이에 해당한다.</li>\n<li>일정 작업 로그온 (Logon Type 7): 예약된 작업이 실행되기 위해 로그인하는 경우이다. 일정에 따라 백그라운드 작업이 실행되도록 예약한 경우가 이에 해당한다.</li>\n</ul>\n<p>type3과 type10이 외부에서의 공격이 있을 때 빈번하게 나타난다고 한다.</p>\n</li>\n</ul>","excerpt":"무작위 접속 시도 차단을 위한 ipban 적용 github에서 https://github.com/DigitalRuby/IPBan/releases url로 ipban을 다운로드 한다. 로그인/로그오프 기록을 로깅하여 ‘이벤트뷰어’-’보안’ 에서 확인하도록 하기  서비스등록     ipban.config 수정 후 서비스 재기동하기 로그인 5회 실패시 등록 이벤트 뷰어 보는 법 [실행창] - “eventvwr” 입력하면 된다.\n생각보다 호스트 서버에 무작위로 접속 시도하는 경우가 많아서 윈도우 서버의 경우 이벤트 뷰어에 들어가서 누가 언제 호스트 서버에 접속했는지 확인할 수 있다.\n접속 시도와 관련된 이벤트 id 및 로그온 유형은 다음과 같다. Event ID 4624 성공적인 로그인을 뜻한다. 따라서 관리자가 접속한 시간이 아닌 경우에 4624가 발생했다면 외부 공격을 의심해야 한다. 4625 계정 로그온 실패로 분류되며, 나의 경우에는 이벤트 뷰어에서 4624 이벤트가 초 단위로 쌓…","frontmatter":{"date":"July 02, 2023","title":"On-premise 서버 구축하기 3. 호스트 서버 보안","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/on-premise3/"}},"next":{"id":"83fbc418-ebe7-5158-a8e0-5f8d2d000eb0","html":"<h2 id=\"1-사전-설정\" style=\"position:relative;\"><a href=\"#1-%EC%82%AC%EC%A0%84-%EC%84%A4%EC%A0%95\" aria-label=\"1 사전 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 사전 설정</h2>\n<p>: 사전 설정은 모든 노드에서 실행해주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -fsSL <span class=\"token punctuation\">[</span>https://get.docker.com<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>https://get.docker.com/<span class=\"token punctuation\">)</span> -o <span class=\"token punctuation\">[</span>get-docker.sh<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>http://get-docker.sh/<span class=\"token punctuation\">)</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> <span class=\"token punctuation\">[</span>get-docker.sh<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>http://get-docker.sh/<span class=\"token punctuation\">)</span>\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> --now docker <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> systemctl status docker --no-pager\n<span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> -aG docker onyouadmin\n<span class=\"token function\">sudo</span> docker container <span class=\"token function\">ls</span></code></pre></div>\n<h3 id=\"cri-docker-install\" style=\"position:relative;\"><a href=\"#cri-docker-install\" aria-label=\"cri docker install permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cri-docker Install</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">VER</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> -s <span class=\"token punctuation\">[</span>https://api.github.com/repos/Mirantis/cri-dockerd/releases/latest<span class=\"token operator\">|</span>grep<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>https://api.github.com/repos/Mirantis/cri-dockerd/releases/latest%7Cgrep<span class=\"token punctuation\">)</span> tag_name <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">'\"'</span> -f <span class=\"token number\">4</span><span class=\"token operator\">|</span><span class=\"token function\">sed</span> <span class=\"token string\">'s/v//g'</span><span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$VER</span>\n<span class=\"token function\">wget</span> <span class=\"token punctuation\">[</span>https://github.com/Mirantis/cri-dockerd/releases/download/v<span class=\"token variable\">${VER}</span>/cri-dockerd-<span class=\"token variable\">${VER}</span>.amd64.tgz<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>https://github.com/Mirantis/cri-dockerd/releases/download/v$%7BVER%7D/cri-dockerd-$%7BVER%7D.amd64.tgz<span class=\"token punctuation\">)</span>\n<span class=\"token function\">tar</span> xvf cri-dockerd-<span class=\"token variable\">${VER}</span>.amd64.tgz\n<span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> cri-dockerd/cri-dockerd /usr/local/bin/</code></pre></div>\n<h3 id=\"cri-docker-version-check\" style=\"position:relative;\"><a href=\"#cri-docker-version-check\" aria-label=\"cri docker version check permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cri-docker Version Check</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">cri-dockerd --version\n\n<span class=\"token function\">wget</span> https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.service\n<span class=\"token function\">wget</span> https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.socket\n<span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> cri-docker.socket cri-docker.service /etc/systemd/system/\n<span class=\"token function\">sudo</span> <span class=\"token function\">sed</span> -i -e <span class=\"token string\">'s,/usr/bin/cri-dockerd,/usr/local/bin/cri-dockerd,'</span> /etc/systemd/system/cri-docker.service\n\n<span class=\"token function\">sudo</span> systemctl daemon-reload\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> cri-docker.service\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> --now cri-docker.socket</code></pre></div>\n<h3 id=\"cri-docker-active-check\" style=\"position:relative;\"><a href=\"#cri-docker-active-check\" aria-label=\"cri docker active check permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cri-docker Active Check</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart docker <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> systemctl restart cri-docker\n<span class=\"token function\">sudo</span> systemctl status cri-docker.socket --no-pager</code></pre></div>\n<h3 id=\"docker-cgroup-change-require-to-systemd\" style=\"position:relative;\"><a href=\"#docker-cgroup-change-require-to-systemd\" aria-label=\"docker cgroup change require to systemd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker cgroup Change Require to Systemd</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> /etc/docker\n<span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/docker/daemon.json</span>\n{\n\"exec-opts\": [\"native.cgroupdriver=systemd\"],\n\"log-driver\": \"json-file\",\n\"log-opts\": {\n\"max-size\": \"100m\"\n},\n\"storage-driver\": \"overlay2\"\n}\nEOF</span>\n``<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">bash</span>\n\n<span class=\"token variable\">`</span></span>``bash\n<span class=\"token function\">sudo</span> systemctl restart docker <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> systemctl restart cri-docker\n<span class=\"token function\">sudo</span> docker info <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> Cgroup</code></pre></div>\n<h2 id=\"2--패키지-설치--kubeadm-kubectl-kubelet\" style=\"position:relative;\"><a href=\"#2--%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%84%A4%EC%B9%98--kubeadm-kubectl-kubelet\" aria-label=\"2  패키지 설치  kubeadm kubectl kubelet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.  패키지 설치 : kubeadm, kubectl, kubelet</h2>\n<p>패키지 설치도 모든 노드에서 실행 해준다.</p>\n<ol>\n<li>\n<p>Swap disable 처리</p>\n<p><code class=\"language-text\">swapoff -a &amp;&amp; sed -i '/swap/s/^/#/' /etc/fstab</code></p>\n</li>\n<li>\n<p>iptable이 bridged traffic 을 바라볼 수 있도록 설정.</p>\n<p><code class=\"language-text\">cat &lt;&lt;EOF > /etc/sysctl.d/k8s.conf</code></p>\n<p><code class=\"language-text\">net.bridge.bridge-nf-call-ip6tables = 1\n net.bridge.bridge-nf-call-iptables = 1\n EOF</code></p>\n<ul>\n<li>컨테이너는 가상화된 네트워크 인터페이스를 사용하므로, 컨테이너 간의 통신 및 네트워크 기능을 지원하기 위해 호스트 단에서 커널 parameter를 위와 같이 변경하는 것이다.\n<ol>\n<li>net.bridge.bridge-nf-call-ip6tables = 1: 이 설정은 IPv6 네트워크 트래픽이 브리지로 전달되어 IP 테이블에서 필터링될 수 있도록 한다.</li>\n<li>net.bridge.bridge-nf-call-iptables = 1: 이 설정은 IPv4 네트워크 트래픽이 브리지로 전달되어 IP 테이블에서 필터링될 수 있도록 한다.</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>방화벽 해제</p>\n<p><code class=\"language-text\">systemctl stop firewalld</code></p>\n<p><code class=\"language-text\">systemctl disable firewalld</code></p>\n</li>\n<li>\n<p>SELinux를 permissive mode로 설정</p>\n<p><code class=\"language-text\">setenforce 0</code></p>\n<p><code class=\"language-text\">sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config</code></p>\n</li>\n<li>\n<p>kubeadm, kubelet, kubectl 설치</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> /etc/yum.repos.d/kubernetes.repo</span>\n\n[kubernetes]\nname=Kubernetes\nbaseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg\nexclude=kubelet kubeadm kubectl\nEOF</span>\n\nyum <span class=\"token function\">install</span> -y kubelet kubeadm kubectl --disableexcludes<span class=\"token operator\">=</span>kubernetes\n\nsystemctl start kubelet <span class=\"token operator\">&amp;&amp;</span> systemctl <span class=\"token builtin class-name\">enable</span> kubelet</code></pre></div>\n</li>\n</ol>\n<h2 id=\"3-마스터-노드-설정\" style=\"position:relative;\"><a href=\"#3-%EB%A7%88%EC%8A%A4%ED%84%B0-%EB%85%B8%EB%93%9C-%EC%84%A4%EC%A0%95\" aria-label=\"3 마스터 노드 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 마스터 노드 설정</h2>\n<h3 id=\"controller-node\" style=\"position:relative;\"><a href=\"#controller-node\" aria-label=\"controller node permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Controller Node</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> kubeadm config images pull --cri-socket unix:///run/cri-dockerd.sock\n\n<span class=\"token function\">sudo</span> kubeadm init --ignore-preflight-errors<span class=\"token operator\">=</span>all --pod-network-cidr<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.0.0/16 --apiserver-advertise-address<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>마스터노드 IP<span class=\"token punctuation\">}</span> --cri-socket /var/run/cri-dockerd.sock</code></pre></div>\n<h3 id=\"설치-시-출력되는-join-command-를-복사해둔다\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98-%EC%8B%9C-%EC%B6%9C%EB%A0%A5%EB%90%98%EB%8A%94-join-command-%EB%A5%BC-%EB%B3%B5%EC%82%AC%ED%95%B4%EB%91%94%EB%8B%A4\" aria-label=\"설치 시 출력되는 join command 를 복사해둔다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치 시 출력되는 join Command 를 복사해둔다.</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubeadm <span class=\"token function\">join</span> <span class=\"token punctuation\">{</span>마스터노드IP<span class=\"token punctuation\">}</span>:6443 --token r8gfco.6s7f60dns4vgwcc0 <span class=\"token punctuation\">\\</span>\n--discovery-token-ca-cert-hash sha256:7b0f82be076748e67f8615eab0b86a61317bac397f94b2921810231ab14afdcc</code></pre></div>\n<h3 id=\"kubeadm-을-root-처럼-사용하기-위한-추가-설정\" style=\"position:relative;\"><a href=\"#kubeadm-%EC%9D%84-root-%EC%B2%98%EB%9F%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%B6%94%EA%B0%80-%EC%84%A4%EC%A0%95\" aria-label=\"kubeadm 을 root 처럼 사용하기 위한 추가 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubeadm 을 root 처럼 사용하기 위한 추가 설정</h3>\n<div class=\"gatsby-highlight\" data-language=\"basn\"><pre class=\"language-basn\"><code class=\"language-basn\">mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config</code></pre></div>\n<h3 id=\"서비스-확인--ready--running-\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%99%95%EC%9D%B8--ready--running-\" aria-label=\"서비스 확인  ready  running  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서비스 확인 ( Ready , Running )</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get nodes -o wide\nkubectl get pod -A</code></pre></div>\n<h2 id=\"4-워커-노드-설정\" style=\"position:relative;\"><a href=\"#4-%EC%9B%8C%EC%BB%A4-%EB%85%B8%EB%93%9C-%EC%84%A4%EC%A0%95\" aria-label=\"4 워커 노드 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 워커 노드 설정</h2>\n<h3 id=\"클러스터-join\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-join\" aria-label=\"클러스터 join permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클러스터 join</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubeadm <span class=\"token function\">join</span> <span class=\"token number\">172.17</span>.255.172:6443 --token te423w.tkhwpeau43rwafdg <span class=\"token punctuation\">\\</span>\n--discovery-token-ca-cert-hash sha256:6ec04d16b4695af8407ca7d0ac8dc0b88655b431156e2189da118d8a74e07778 --cri-socket /var/run/cri-dockerd.sock</code></pre></div>\n<h3 id=\"check\" style=\"position:relative;\"><a href=\"#check\" aria-label=\"check permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Check</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">systemctl status kubelet</code></pre></div>\n<h3 id=\"worker-계정에-kubectl-사용-환경변수-추가\" style=\"position:relative;\"><a href=\"#worker-%EA%B3%84%EC%A0%95%EC%97%90-kubectl-%EC%82%AC%EC%9A%A9-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%B6%94%EA%B0%80\" aria-label=\"worker 계정에 kubectl 사용 환경변수 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>worker 계정에 kubectl 사용 환경변수 추가</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> ~\n<span class=\"token function\">mkdir</span> -p <span class=\"token environment constant\">$HOME</span>/.kube\n<span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> -i  /etc/kubernetes/admin.conf <span class=\"token environment constant\">$HOME</span>/.kube/config\n<span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> -u<span class=\"token variable\">)</span></span><span class=\"token builtin class-name\">:</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> -g<span class=\"token variable\">)</span></span> <span class=\"token environment constant\">$HOME</span>/.kube/config</code></pre></div>\n<p>여기까지 하면 기본적으로 master 노드와 worker 노드 셋팅이 완료된 것이지만, 서로 다른 노드들이 pod간 통신하기 위해 CNI를 설치 해주어야한다.\nCNI 설치를 완료하면 coredns가 pending -> running상태로 변경되게 될 것이다.</p>\n<h2 id=\"5-cni-설치\" style=\"position:relative;\"><a href=\"#5-cni-%EC%84%A4%EC%B9%98\" aria-label=\"5 cni 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. CNI 설치</h2>\n<ul>\n<li>Calico 설치\n: <a href=\"https://docs.tigera.io/calico/latest/getting-started/kubernetes/self-managed-onprem/onpremises\">https://docs.tigera.io/calico/latest/getting-started/kubernetes/self-managed-onprem/onpremises</a>\n<ul>\n<li>manifest 방법으로 설치해주면 되며, 192.168 대역이 아닌 다른 대역을 pod의 대역으로 사용했다면 가이드에 따라서 수정 필요한 부분 적용해주면 된다.</li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"July 01, 2023","title":"On-premise 서버 구축하기 2. K8S 클러스터 설치","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/on-premise2/"}},"prev":{"id":"5ddab0e0-9d57-5cdc-bf2f-23512b7453bb","html":"","frontmatter":{"date":"July 02, 2023","title":"On-premise 서버 구축하기 5. 네트워크 설정","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/on-premise5/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/on-premise3/","nextSlug":"/on-premise2/","prevSlug":"/on-premise5/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}