{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/jpa7/",
    "result": {"data":{"cur":{"id":"fbbc48e9-077f-59a4-9a56-994f882876d3","html":"<p>JPA에서 엔티티 간에 다양한 연관관계를 매핑하는 방법에 대해서 알아보았다.</p>\n<p>이제는 조금 더 나아가 단순히 다대다, 다대일만의 관계가 아니라 JPA에서 상속관계를 어떻게 매핑하는 지에 대해서 알아보고자 한다.</p>\n<p>그런데 생각해보면 관계형 데이터베이스에는 ‘상속’이라는 개념이 객체지향과는 달리 존재하지 않는다.</p>\n<p>그렇지만 이와 유사한 <strong>슈퍼타입, 서브타입 모델링 기법</strong>이 있는데, JPA에서는 이를 사용해서 객체의 상속관계를 DB의 슈퍼타입/서브타입 관계로 매핑시켜준다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 662px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABUklEQVQ4y52Si4rCQAxF5/+/rkhBUKjSl22tWrX1UW2znCwRLcMuuwMhmUwmubmJk8kZx1GFU5alVFWlstlsZLfbSZZlcr1eX7HT435KWNe16qIoJAgCtc/ns3Rd97+EJAIl6NI01QLoPyF8DxyGQTWImqb58PmSfSS0AENod9BE0UoWi4Vy6OvkPbmbJnh/7PtesiyX5XIps9lMkiSRw+HgpcjE+aA/n0+53+/yeDyUvyiKZLvdqgYxfsRHlTPDuOEDq3E8HpU3BJvpnk4nbRsfq0QR49X+OwhnkkyQdrDX67W0bat3/PjyPJf9fq+JeENDAQWIITna4aBFThiG0rXfO8Zn20OC5/P5a+Ikt5ZZLVsjbAcKqqHjONaKJECDzFCxf7TOJ+4Us9aNBqhy9E4FhKnebje5XC6KgDs2A8IPh2j7wxt3s4n3LrbvQAsJfztf7zjxxyAVshUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/6727abfa6693af002f8f1cf9f6478f3a/be86f/image1.png\"\n        srcset=\"/static/6727abfa6693af002f8f1cf9f6478f3a/e9ff0/image1.png 180w,\n/static/6727abfa6693af002f8f1cf9f6478f3a/f21e7/image1.png 360w,\n/static/6727abfa6693af002f8f1cf9f6478f3a/be86f/image1.png 662w\"\n        sizes=\"(max-width: 662px) 100vw, 662px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>그리고 관계형 DB에서 슈퍼타입/서브타입 논리 모델링을 물리 모델링하고자 할 때 구현하는 방법은 크게 3가지이며\n이 3가지 방식 중 어떤 방식을 선택해도 JPA에서 연관관계 매핑을 지원한다.</p>\n<br>\n<h2 id=\"1-조인-전략\" style=\"position:relative;\"><a href=\"#1-%EC%A1%B0%EC%9D%B8-%EC%A0%84%EB%9E%B5\" aria-label=\"1 조인 전략 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 조인 전략</h2>\n<p>앨범 데이터 INSERT시 ITEM, ALBUM 테이블 각각에 데이터를 넣고 조회 시는 ITEM_ID로 ITEM, ALBUM을 조인해서 가져오는 방식이다.</p>\n<p>이 때 ITEM 테이블에 어떤 서브타입인지를 구분하는 DTYPE 과 같은 컬럼이 필요하다.\n<br></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABiklEQVQoz51TZ4vCUBDM//8vfhBEuEMlYi+IWHMaxa6xYO9ljhmIiKd+uIXlhd19s7szLwZe2O12wyf7lDeeC93iy+UiPx6POBwOOJ/POJ1OuF6vH0HfAnY6HXk+n4fX60Wz2cRoNMJkMvkfYLlchs/nQzQaRTabRbVaxXA4FOhHQDfhgrkr1et1RCIRgTzabDb70/zx23jXjRN9fX0jnU5jOp1qVfp8PserrVy/T0jC1+s1NpsNttutLpdKJYzHYzTshia2LAur1Uo1rKVYz6B3DgeDAZbLpYp2u51OqkwjKM1V3M232+17zZ1DBguFgpQMhULo9XoC4Nnv98Wjx+ORSOSTOarPvN/vRyAQ0DdjbGSEw2EpmUqlpCbX4rRclzkCBoNB5HI5rc0mmUwGsVgMpmkikUigWCzqWZEKwzTDSCaTCnS7XZ2cpFKpqDsvtFotcbdYLNQsHo+rUa1WE00EcpyxagyKwb9gv9/LOTafDt8blWYDx3EExOl4ybZtWNaP1mecziGI9QuZ+IpP3kqYqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/fc0a48a1115c1097c46c85a38b8c6ba4/37523/image2.png\"\n        srcset=\"/static/fc0a48a1115c1097c46c85a38b8c6ba4/e9ff0/image2.png 180w,\n/static/fc0a48a1115c1097c46c85a38b8c6ba4/f21e7/image2.png 360w,\n/static/fc0a48a1115c1097c46c85a38b8c6ba4/37523/image2.png 720w,\n/static/fc0a48a1115c1097c46c85a38b8c6ba4/612f7/image2.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>JPA에서 연관관계를 매핑하려면 아래와 같이 하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Inheritance</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Strategy</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">InheritanceType</span><span class=\"token punctuation\">.</span>JOINED<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@DiscriminatorColumn</span> \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> price<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@DiscriminatorValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Album</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> director<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> artist<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그냥 위와 같이 매핑하여 실행하게 되면 JPA에서는 조인전략 매핑을 사용하여 테이블을 생성하게 되고 @Inheritance 어노테이션이 없다면 2번전략인 단일 테이블 전략을 디폴트로 해서 Item 테이블 하나만 만들어 버린다.</p>\n<p>이렇게하면 이제 Album만 persist 해줘도 Item, Album 모두에 INSERT가 실행되고 Album만 조회해도 Item, Album을 조인해서 데이터를 불러오는 것을 SQL 실행문을 통해서 확인할 수 있다.</p>\n<p>@DiscriminatorColumn 어노테이션을 Item 엔티티에 추가하게 되면 Item 테이블에 자동으로 DTYPE이라는 컬럼을 추가해주고, 디폴트로는 컬럼명을 ‘DTYPE’, 값은 하위 엔티티명을 값으로 가지게 된다.</p>\n<p>이걸 변경해주고 싶으면 컬럼명은 @DiscriminatorColumn(name=“abc”) 이런 식으로 변경하면 되고</p>\n<p>값은 하위 엔티티 클래스에서 @DiscriminatorValue를 써서 값을 설정해주면 된다.</p>\n<p>위와 같이 설정할 경우 Item 테이블에 DTYPE 컬럼이 있고, Album일 경우에 컬럼값은 ‘A’ 가 된다.</p>\n<h3 id=\"장점\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EC%A0%90\" aria-label=\"장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장점</h3>\n<ul>\n<li>정규화가 되어 있음</li>\n<li>FK 참조 무결성 제약조건 활용 가능하다. 다른 테이블 입장에서도 album, movie, book과 같은 엔티티를 바라 볼 필요 없이 Item 엔티티만 바라보면 되기 때문에 좋다.</li>\n<li>정규화가 되어 있기 때문에 DB 저장공간의 중복 데이터 없이 효율적으로 저장된다.</li>\n</ul>\n<h3 id=\"단점\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%A0%90\" aria-label=\"단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단점</h3>\n<ul>\n<li>조회 시 조인을 사용한다는 것</li>\n<li>조회 쿼리가 복잡해진다.</li>\n<li>INSERT를 2번 수행해야 한다.</li>\n</ul>\n<p>조인 전략이 정규화도 되고 설계가 깔끔하며 객체지향과도 잘 맞기 때문에 정석으로 보면 된다.</p>\n<p>단, 단일 테이블 전략과 비교했을 때는 성능이 약간 안나올 수도 있음</p>\n<h2 id=\"2-단일-테이블-전략\" style=\"position:relative;\"><a href=\"#2-%EB%8B%A8%EC%9D%BC-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%A0%84%EB%9E%B5\" aria-label=\"2 단일 테이블 전략 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 단일 테이블 전략</h2>\n<p>하나의 테이블로 합치고 DTYPE으로만 구분해주는 방식이다.\n자식 테이블 각각의 특성에 해당하는 컬럼들을 한 테이블로 합쳤기 때문에 데이터가 null인 컬럼이 다수 발생하게 된다.</p>\n<br>\n![image3](./image3.png)\n<p>JPA에서 연관관계를 매핑하려면 아래와 같이,</p>\n<p>@Inheritence 어노에티이션을 사용하지 않거나 SINGLE_TABLE로 설정해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Inheritance</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Strategy</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">InheritanceType</span><span class=\"token punctuation\">.</span>SINGLE_TABLE<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@DiscriminatorColumn</span> \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> price<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>성능관점에서 INSERT, SELECT를 그냥 단순히 한 테이블로부터 해오면 되기 때문에 좋다.</p>\n<h3 id=\"장점-1\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EC%A0%90-1\" aria-label=\"장점 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>​장점</h3>\n<ul>\n<li>조인이 필요없어서 조회가 빠르다</li>\n<li>조회 쿼리가 단순하다</li>\n</ul>\n<h3 id=\"단점-1\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%A0%90-1\" aria-label=\"단점 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단점</h3>\n<ul>\n<li>자식 엔티티가 매핑한 컬럼은 모두 nullable이어야 한다.</li>\n<li>테이블이 비대해질 수 있고, 그에 따라 조회 성능이 잘 안나올 수도 있다.</li>\n</ul>\n<h2 id=\"3-구현-클래스마다-테이블을-두는-전략\" style=\"position:relative;\"><a href=\"#3-%EA%B5%AC%ED%98%84-%ED%81%B4%EB%9E%98%EC%8A%A4%EB%A7%88%EB%8B%A4-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EB%91%90%EB%8A%94-%EC%A0%84%EB%9E%B5\" aria-label=\"3 구현 클래스마다 테이블을 두는 전략 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 구현 클래스마다 테이블을 두는 전략</h2>\n<p>공통적인 컬럼도 각 테이블에 모두 두어 테이블을 각각 분리하는 방식이다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVQoz5VRXauCQBDd//9XesiHGwXhUxgVYgoFaZRaamrfpUJRncsZ2Mvlvt2Bw7KzM3POnFXX6xVFUWC9XiOOY5zPZ9zv9x+kaYogCFCWJS6XC6qqwu12E7Cefew5nU54PB5Q8/kctm3DMAz0ej3s93tkWYbVaoXFYgHLstBqtaTmeDwiSRIsl0v4vg/TNNFutxFFkfRwsOr3+xgOh9hsNthutzgcDsjzXBq63a4Mojq+kYxv0+kUna+O1HADDiO4gRoMBlLwer2gg0xUOB6P5azrWvLv91tWo3ISkUSHtkKNRiM4jiNesIC+UAXvHOi6ruSfz6eAG8xmM0wmE8lrMv4FoTTD5/MRUAVjt8tBf7kWG2lJGIainqfneeIn8xQRhhGapoHSg37H3/t/4huqRwXcoDjU5wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/30e1652127c8e9432c912928e33f170c/37523/image4.png\"\n        srcset=\"/static/30e1652127c8e9432c912928e33f170c/e9ff0/image4.png 180w,\n/static/30e1652127c8e9432c912928e33f170c/f21e7/image4.png 360w,\n/static/30e1652127c8e9432c912928e33f170c/37523/image4.png 720w,\n/static/30e1652127c8e9432c912928e33f170c/612f7/image4.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>JPA에서 구현하려면 @Inheritance strategy를 TABLE_PER_CLASS로 설정한다.</p>\n<p>이렇게 하면 Item 테이블은 생성하지 않고 하위 엔티티들에 대해서만(구현 클래스에 대해서만) 테이블을 생성한다.</p>\n<p>Item 테이블이 없기 때문에 DTYPE처럼 구분자가 필요없고, 따라서 @DiscriminatorColumn 어노테이션은 쓰지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Inheritance</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Strategy</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">InheritanceType</span><span class=\"token punctuation\">.</span>TABLE_PER_CLASS<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> price<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Album</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> director<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> artist<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>언뜻 보기에는 좋은 전략같지만 데이터를 조회해올 때 굉장히 비효율적으로 동작한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Item</span> findItem <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> movie<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Album, Book, Movie 3개의 테이블에 대해서 UNION ALL하여 select를 수행해오기 때문에 이 전략은 실무에서 쓰면 안되는 전략이다.</p>\n<h3 id=\"장점-2\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EC%A0%90-2\" aria-label=\"장점 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장점</h3>\n<ul>\n<li>\n<p>서브 타입 명확하게 구분해서 처리할 때 효과적</p>\n</li>\n<li>\n<p>Not null 사용 가능</p>\n</li>\n</ul>\n<h3 id=\"단점-2\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%A0%90-2\" aria-label=\"단점 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단점</h3>\n<ul>\n<li>\n<p>여러 자식 테이블 함께 조회해야 할 때 성능 느림 ( UNION ALL 사용 )</p>\n</li>\n<li>\n<p>자식 테이블을 통합해서 쿼리하기 어려움.</p>\n</li>\n<li>\n<p>변경의 관점에서 새로운 타입이 추가 될 때 많은 변경이 필요함.</p>\n</li>\n</ul>\n<p>​정리하자면 상속관계가 단순하고 확장성이 없다고 본다면 ‘단일 테이블 전략’을 그 외에는 조인 전략을 사용하도록 하자.</p>\n<hr>\n<h3 id=\"mappedsuperclass-어노테이션-활용하기\" style=\"position:relative;\"><a href=\"#mappedsuperclass-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"mappedsuperclass 어노테이션 활용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@MappedSuperClass 어노테이션 활용하기</h3>\n<p>Item - Album, Book, Movie 와 같이 비즈니스적인 상속관계가 아니라, 엔티티 클래스의 공통속성만 모아서 처리하고 싶을 때 사용한다.</p>\n<p>가령 데이터의 생성일자와 생상자에 대한 속성을 공통처리하고 싶을 때 아래와 같이 BaseEntity를 만들고, 각 엔티티에서는 BaseEntity를 상속해주면 된다.</p>\n<hr>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>","excerpt":"JPA에서 엔티티 간에 다양한 연관관계를 매핑하는 방법에 대해서 알아보았다. 이제는 조금 더 나아가 단순히 다대다, 다대일만의 관계가 아니라 JPA에서 상속관계를 어떻게 매핑하는 지에 대해서 알아보고자 한다. 그런데 생각해보면 관계형 데이터베이스에는 ‘상속’이라는 개념이 객체지향과는 달리 존재하지 않는다. 그렇지만 이와 유사한 슈퍼타입, 서브타입 모델링 기법이 있는데, JPA에서는 이를 사용해서 객체의 상속관계를 DB의 슈퍼타입/서브타입 관계로 매핑시켜준다. \n 그리고 관계형 DB에서 슈퍼타입/서브타입 논리 모델링을 물리 모델링하고자 할 때 구현하는 방법은 크게 3가지이며\n이 3가지 방식 중 어떤 방식을 선택해도 JPA에서 연관관계 매핑을 지원한다. 1. 조인 전략 앨범 데이터 INSERT시 ITEM, ALBUM 테이블 각각에 데이터를 넣고 조회 시는 ITEM_ID로 ITEM, ALBUM을 조인해서 가져오는 방식이다. 이 때 ITEM 테이블에 어떤 서브타입인지를 구분하는 DTYPE…","frontmatter":{"date":"March 20, 2022","title":"[JPA] 7. 상속관계 매핑 전략 (슈퍼타입, 서브타입)","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa7/"}},"next":{"id":"63bd45bc-1012-5983-9b4c-f4c1913af714","html":"<p>JPA에서 제공하는 다양한 연관관계 매핑하는 방법에 대해서 알아보기에 앞서,\n연관관계를 매핑할 때 고려해야 할 요소는 3가지임을 기억하자.</p>\n<ol>\n<li>다중성</li>\n</ol>\n<ul>\n<li>@ManyToOne -> 제일 많이 사용된다.</li>\n<li>@OneToMany -> 사용할 수는 있지만 ManyToOne의 양방향으로 커버 가능하다.</li>\n<li>@OneToOne -> 가끔</li>\n<li>@ManyToMany ->실무에서 안 씀</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>단방향인가 양방향인가</p>\n</li>\n<li>\n<p>연관관계의 주인이 어느 쪽인가</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"1-다대일-manytoone-\" style=\"position:relative;\"><a href=\"#1-%EB%8B%A4%EB%8C%80%EC%9D%BC-manytoone-\" aria-label=\"1 다대일 manytoone  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 다대일( ManyToOne )</h2>\n<p>다대일 관계는 가장 많이 사용되는 관계이다. 사실 상 거의 이것으로만 설계할 수 있다.</p>\n<p>다대일 관계의 특징은 FK를 ‘다’ 쪽에서 관리하는 것이고, 연관관계의 주인도 ‘다’ 쪽이라는 것이다.</p>\n<h3 id=\"1-단방향\" style=\"position:relative;\"><a href=\"#1-%EB%8B%A8%EB%B0%A9%ED%96%A5\" aria-label=\"1 단방향 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 단방향</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVQoz4VT2YrCUBTz/z9HfBDcQBAXWpX64NpRW3HfWpfWNUMidZxhnLlw8NabJjk5t7H7/Y6/1mAwgG3b6Pf76HQ68DzvLZZcMW7O5zNWqxWGwyFM04RlWZhOpxiPx9hutzpbLBbP3+isVqvBcRw9X69XkcYulwuWyyVarRZGo5HI2u22nLiui91uh9PpJNHj8Qjf92FZDWG73a7eJXkYhA9C3/OlWq1WUa/XYRqmSLj4/+12+9YSFwXpbjabqdgZjYkwssqMms2mwFSnKsHvsqIQXZMoElWG5XIZ+XwelUoFpVJJbUSLYKo7jqvigBjDq+tX5yJkVpvNRu3RXTabVfvz+Vz5rNdr7TkQFrERnjiKMNcwDL+Gst/vYRgGMpkMEokEkskkisWiIqAqY2GuQRA8idgR8YVCQUai3OWQKul0GvF4XA5zuZxe5P1ji7w6JKM4J86BpFKp580g7nA4PAijrHq9nhw1rAZs+0N3azKZ/DoUklKAJCzuoxxj/30pPP9Zf30pn+k8PP3fdzUnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/e1fa8c7612c32aaee92ab56fd1c6c340/37523/image1.png\"\n        srcset=\"/static/e1fa8c7612c32aaee92ab56fd1c6c340/e9ff0/image1.png 180w,\n/static/e1fa8c7612c32aaee92ab56fd1c6c340/f21e7/image1.png 360w,\n/static/e1fa8c7612c32aaee92ab56fd1c6c340/37523/image1.png 720w,\n/static/e1fa8c7612c32aaee92ab56fd1c6c340/612f7/image1.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"2-양방향\" style=\"position:relative;\"><a href=\"#2-%EC%96%91%EB%B0%A9%ED%96%A5\" aria-label=\"2 양방향 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 양방향</h3>\n<p>설계는 다대일 단방향에서 끝났지만 만약에 Team 에서도 Member에 대한 조회를 하고 싶다면 OneToMany를 ‘일’ 쪽인 Team에 추가하여 매핑해주면 된다. 연관관계의 주인은 Member이므로 조회만 된다는 점에 유의하자.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.55555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQoz4VT2W7CMBDk/3+HCKUK5RTlASFxCJpAuMV9JUACKcegWRS3IKCWLDv27OzMehMBgMvlglfDdV30+330ej1ZZ7MZXsXwLBJeBMGPBA+HQ5imicFgAMd1sVgssFwuZW232ygWi5jP54JtNptqfzwehUcRMohEnU4HhUIBrVYLq9UKtm1jNBphPB7D8zwhrlQqkrhcLguO+/1+fyM8HA4SOJ1OkUqlRAGBPN9ut7AsS8ho1fd9UWKaFnK5nCis1+uSNAiCGyFBDOQBg2u1mgCZgMpI/DjEzbcpypiI2NPpdCOkjWQyifxXHqVSCZlM5o6EFhuNBrrdriihxVDN00ehdyrc7XaiiPXT9Q9ZqYCETMp7x3Gw2WyUetpmPVmSX8ueL8DJZIJ4PI5YLAbDMJD4TKhHYlJi/j5KNptFOp2WxNVqVbmK0DsDqCYajULTNOi6LkAmoUUSMSDsCLYU1bHe3N89Suj/fD5LgTlJxN5ar9eq2GGN3v0EqrHfgZ4Rhd+P866xX4Ee7/8jvAI0W4tP60jqrAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/bb687090b89642bddc93ca50b45018f8/37523/image2.png\"\n        srcset=\"/static/bb687090b89642bddc93ca50b45018f8/e9ff0/image2.png 180w,\n/static/bb687090b89642bddc93ca50b45018f8/f21e7/image2.png 360w,\n/static/bb687090b89642bddc93ca50b45018f8/37523/image2.png 720w,\n/static/bb687090b89642bddc93ca50b45018f8/612f7/image2.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-일대다-onetomany-\" style=\"position:relative;\"><a href=\"#2-%EC%9D%BC%EB%8C%80%EB%8B%A4-onetomany-\" aria-label=\"2 일대다 onetomany  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 일대다( OneToMany )</h2>\n<p>일대다는 이제껏 봤던 ManyToOne 중심의 모델링과는 달리 실무에서 거의 쓰이지 않는다.</p>\n<ul>\n<li>외래키를 반대 테이블에서 관리하고,</li>\n<li>연관관계를 위해 추가적은 update문 실행이 필요하기 때문.</li>\n</ul>\n<h3 id=\"1-단방향-1\" style=\"position:relative;\"><a href=\"#1-%EB%8B%A8%EB%B0%A9%ED%96%A5-1\" aria-label=\"1 단방향 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 단방향</h3>\n<p>일대다 단방향에서 ‘One’ 쪽이 연관관계의 주인이 된다. 그런데 FK를 ‘다’ 쪽에서 관리하는 것은 다대일 관계와 같다. 이것은 db테이블 구조 상 변경 불가능한 것이기 때문임.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQoz32TWYsqUQyE/f//RtCHuaJzHxRFQYVR3HBfWm1t932p4YscGbzeCYRj5+RUUpUYkqT7/a53dj6f1W631ev17BwOh/rNwAk5sN1up8VioUajIc/ztFwutdlsdLlcFAQL5fN5FYtFuyNOgXq9rul0arnkYU/AwWCgfr+vZrOp+XxuTvLhcNB2u7Viq9XKCgJWLpdVKBQ0mUw0Go203+8fgA652+0qmUyq0+kYKOCAvRqFstmsSqWS5Xre2M7T6fQApPpsNrMgtDKZjFGj6v+0dXrdbrd/ckKOBo7oUHcPGAoOi58nnTsgYnR3PB4fQyFwvV61Xq/l+zPTBrGDIDD/+irZd61WU6VSsYlDm7xcLmd68s17gJ9DQTMSEomE0um0gbRaLfm+b/SZJF0AkEqlFI1GFQ6H9fn5V9Vq1QbHfQgd3JQ/Pv5YF1AHjKpuH5EGUPSNRCKKxWKKx+OmPQVpCKxnhzxiF9kxgPj9bum5hz4OC/ZyPB6bbDaU3/4pxF/9nUHVLfY3NwFAMKpB5nAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/77efbaf770cc8da924e8fa65fb18a715/37523/image3.png\"\n        srcset=\"/static/77efbaf770cc8da924e8fa65fb18a715/e9ff0/image3.png 180w,\n/static/77efbaf770cc8da924e8fa65fb18a715/f21e7/image3.png 360w,\n/static/77efbaf770cc8da924e8fa65fb18a715/37523/image3.png 720w,\n/static/77efbaf770cc8da924e8fa65fb18a715/612f7/image3.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>‘일’ 쪽인 Team 클래스에서 JoinColumn을 team_id로 설정하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Team</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@OneToMany</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"team_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> <span class=\"token comment\">//이걸 반드시 해줘야 함. 아니면 조인테이블 방식을 사용함.  </span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> members <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 아래와 같이 실행해주면 team, member 테이블 모두에 잘 등록된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Team</span> team <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Team</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nteam<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"teamA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nteam<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//update 쿼리가 한 번 더 나감</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그러나 실무에서 테이블 수십개가 엮여서 돌아가는 상황에서 ManyToOne 단방향과 OneToMany 단방향을 혼용하는 것은 혼란스러울 수 있다. 그렇기 때문에 ‘다’ 쪽을 연관관계의 주인으로 가져가고</p>\n<p><strong>필요시에만 ManyToOne 양방향을 사용하는 방식</strong>으로 설계를 하는 것이 좋다.</p>\n<h3 id=\"2-양방향-1\" style=\"position:relative;\"><a href=\"#2-%EC%96%91%EB%B0%A9%ED%96%A5-1\" aria-label=\"2 양방향 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 양방향</h3>\n<p>공식스펙상에서는 없는 설계이지만,</p>\n<p>@JoinColumn의 옵션을 사용해서 설정가능하다. 그러나, 역시.. 다대일 양방향을 사용하자는 것이 결론이다.\n​\n<br></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdElEQVQoz3VSy46CQBDk/7+Gg/HgwYMnFQ6gUR5qggqKb9DwUNDaVCfjstGdpBOY7q6urhrt9Xrh23k8HoiiCIfDAdvtFmVZfq1jfzM09fF8PlEUBbIsQ13XuN/vOJ1OWK/XcB0Xx+NR6pi/3W6SZ53qZQggp1RVhTAM4Xs+HMfBbrdDHMcyIEkS+Q+CAMtgCc/zMBgMsFqtsN/vPxi/AV3XQxAscblcBMD3fZzP53dhnucwTROj0UhYs4fg0+lU7kzDRBRG0K7pVdjMZjPYtg3HcaWBYGTI1RgEXCwWsCwb4/FY8uyjFNQ4TVOp15iYz+eyMtdgIw/1oREEU8DN09SNBv5ZWRnAFYbDoUzkADLhHdlTAjIyDAPdbheTyUSkUSYpxzXFhoXtdlsEtyxL2GZZLquxYbPZoNPpQNd1tFot9Pt9kYBEkiT9BVTPhqzoJAGoC4eoIhpAtzms1+sJGAfynXJdrv4B+N+j/aYbg0MUULP2B4ly9ZA/UqPwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/8637766bc83a546101992b997aaf0321/37523/image4.png\"\n        srcset=\"/static/8637766bc83a546101992b997aaf0321/e9ff0/image4.png 180w,\n/static/8637766bc83a546101992b997aaf0321/f21e7/image4.png 360w,\n/static/8637766bc83a546101992b997aaf0321/37523/image4.png 720w,\n/static/8637766bc83a546101992b997aaf0321/612f7/image4.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"team_id\"</span><span class=\"token punctuation\">,</span> insertable<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> updatable<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Team</span> team<span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"3-일대일onetoone\" style=\"position:relative;\"><a href=\"#3-%EC%9D%BC%EB%8C%80%EC%9D%BConetoone\" aria-label=\"3 일대일onetoone permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 일대일(OneToOne)</h3>\n<p>일대일 관계에서 FK는 양쪽 어디에 있어도 상관없지만 ‘주 테이블’을 정해서 그쪽에 FK를 두면 된다.</p>\n<p>Member Locker의 경우 Memberrk 주테이블이 된다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABkUlEQVQoz41Ta4/BUBS8///H8E1tCBtBP6gIImg9Wm9atKhnmM0caSMbsnuSk/vouTNn5t6qx+MB5qfY7/fodDoYj8ewLEvGT0EcFYHx4Hq9RrfbRb1eR6vVwmw2w2q1gud5Mi4WC5kvl0tZs6bdbsv6cAgFR93vd9xuNziOg+FwCNO0YBiGAG+3W4xGIyE7nU4IwzDumN0SrN/vY7PZCIEABkEgRQTUdV3AGo0GXNfD5XKRjl4lMXi4Wq0KGb9PJhP4vv8EjCZkJzOTrJQxnU5l/11Eyq7Xq4yxh2RoNpswTRO2bYuM16CvlBdZ0uv1sNvt3l5I3CH94UEm2y+Xy5IEcV0Xg8EAtMb3g9gv2kSiYrEoTdBvEilO2D79yOe/kU5/IZXSkEwmUSgU4NiOAFN6RMzbrVQqyGazUlMqlWCZlhCp4/EohrJI0zQkEglkMhnUajVhph0kez6Ng8iaz+fI5XJSw6dFVVRBMhV5wGJK4IXQTxZSLt8eZf6+EL6A8/ksnbMpJvfVX3/Kq+n/qf0B/5w5z6jaPPMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/4007557c9861fbbef71de9607e6bf53f/37523/image5.png\"\n        srcset=\"/static/4007557c9861fbbef71de9607e6bf53f/e9ff0/image5.png 180w,\n/static/4007557c9861fbbef71de9607e6bf53f/f21e7/image5.png 360w,\n/static/4007557c9861fbbef71de9607e6bf53f/37523/image5.png 720w,\n/static/4007557c9861fbbef71de9607e6bf53f/8ae3e/image5.png 756w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>다대일 단방향과 아주 유사하다. 아래처럼 설정해주면 끝.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"locker_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Locker</span> locker<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>만약 Locker도 member를 참조하고 싶다면, (양방향이라면) 아래와 같이 하면 된다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQoz4VTa4uCUBT0//+QfkDQh4iKih5GQRqk5ZLmI+2hPbQ3Ncucxd0PS7sH5F6545yZOVcFAF6vF97V4/HAYrHAcrmE53kIwwh/lZKT3W43ZFmG1WoF27YRBAHSNEUcJ/BcD1EUwbI+oKoqwjAU7Ha7heM4su73e+FQcubdbieHJOt2uxiNRgKkuvP5jMvlIiRJksCyLFHL5v1+X9RzTw6FQG7YlUSDwQDj8Ri+70sjgqn0+XyKfa5xHAuWxKfTSZq4ros0zaCw6/V6xf1+x2QygaZp0DQdju2IbSr+yi4USyzaa7fbaLVaUNU+Op0Oer2ekAuhYZjSjfZM0xSLefF8Pp9LHLRF5cfj8f1QyMqOtM3gqWo4HIp1NiDJdDqVlQ8xm81GYqByYg3DkO8Ph8OPZb6QhNmUy2UUi0XUajX4fiD5sBhLrpjRNBoNVCoV1Ot1cUgxCsmokKBSqYRCoSCEzWZTJs0pMgYqowoOkftqtSqEdMGcvwlz7wx8NpuJPV3XJTNa4zDW6/WvrIinmPxKcaUDudh//Sl55bj/sJ9X+zWGAJwvqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/7a5f34d06a1b00fa8a6503e20a90dca7/37523/image6.png\"\n        srcset=\"/static/7a5f34d06a1b00fa8a6503e20a90dca7/e9ff0/image6.png 180w,\n/static/7a5f34d06a1b00fa8a6503e20a90dca7/f21e7/image6.png 360w,\n/static/7a5f34d06a1b00fa8a6503e20a90dca7/37523/image6.png 720w,\n/static/7a5f34d06a1b00fa8a6503e20a90dca7/612f7/image6.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Locker</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToOne</span><span class=\"token punctuation\">(</span>mappedBy<span class=\"token operator\">=</span><span class=\"token string\">\"locker\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"4-다대다\" style=\"position:relative;\"><a href=\"#4-%EB%8B%A4%EB%8C%80%EB%8B%A4\" aria-label=\"4 다대다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 다대다</h3>\n<p>실무에서 안 쓴다. 왜?</p>\n<p>일단 JPA에서 ManyToMany를 지원하는 이유는 객체에서는 테이블과 달리 별도의 클래스 없이도 Member에서 Product List를 가질 수 있고, Product에서도 Member List를 가질 수 있는 다대다 관계가 가능하기 때문이다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQoz61RyYqDUBB8//9JYg4iHkwu8SCKHqIkuCEumM21QvXwhswwM6dpKHzdbW9VCgC2beMH0zShaRpUVSXoug5t22IcRzweD/H7vpdcXdfiM/feQ707z+cTWZbhdDoJ8jyXAYwTfBdFgSRJkKap5DnoS0M+tLOuK67XK+73u2AYBmzrR04XMcbc7XaTN2t0jlD4Z1OcMM+z8Keh7XucZy/L8rkRY+RQf5lTJD0IAux2OxyPR5zPZzmbpPu+D8uy4DgObNtGFEXIslxEuVwuwqPrujgcDsI9RVIk2TAMaeh5HuI4Fo7KsoRpmtJsv99LIQdQLG7K/1gThqEMIriE4ppUiiDR76rR1wJoEdiMxjotHsGrePqPomjVf7O/8i99u7G5wF54hgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image7\"\n        title=\"image7\"\n        src=\"/static/d55ae87c7c4eacbab0162f8b3500242f/37523/image7.png\"\n        srcset=\"/static/d55ae87c7c4eacbab0162f8b3500242f/e9ff0/image7.png 180w,\n/static/d55ae87c7c4eacbab0162f8b3500242f/f21e7/image7.png 360w,\n/static/d55ae87c7c4eacbab0162f8b3500242f/37523/image7.png 720w,\n/static/d55ae87c7c4eacbab0162f8b3500242f/612f7/image7.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그러나 실무에서는 쓰이지 않는데 연결 테이블이 연결만 하고 끝나지 않기 때문이다.</p>\n<p>아래 Member_Product 테이블과 같이 다른 속성이 포함되기 때문이다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVQY03VQyYqDUBD0/3/Eu0xEEDwpggpRQRQmRoLgguK+4II1dIO3TMG7dC1UPWGeZzRNi6ZpMAwDzvMEYd93jOPI97Zt+RF/XRfz67pimiZUVYW+71l7HAcEx3Ggqip0Xcfr94WyLNn4fLp4/DwgSRJkWYaiKHi/E2RZxnwQBHBdl32e5/GdygmGYcCyLERRhDiO0XUdNzBNE6IocpCmaQjDEGmachtq6fs+bNvmoM/ngyRJsCwLBDKTgKZS5XtSnufcgoKKouBJdV1j2zbcIC19Dflur4AvuEP/u33jb/wBxEN2gUznYOwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image8\"\n        title=\"image8\"\n        src=\"/static/d263928e906db5042f27105fd5e01c01/37523/image8.png\"\n        srcset=\"/static/d263928e906db5042f27105fd5e01c01/e9ff0/image8.png 180w,\n/static/d263928e906db5042f27105fd5e01c01/f21e7/image8.png 360w,\n/static/d263928e906db5042f27105fd5e01c01/37523/image8.png 720w,\n/static/d263928e906db5042f27105fd5e01c01/612f7/image8.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<p>따라서 실무에서는 다대다를 다대일 관계로 풀어내야 한다. 아래와 같이 Member_Product 연결 테이블을 Entity로 승격시키는 것이다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQY03VPyYqEUAz0/7/GphsX8KLjHDyoF1EUFaVpxeXgirjWkIBzmikoQvKq8irCOI4oyxJFUaDve0zTBALNPc9DkiSQJAnP5wvv9xtZlqFtW9Ysy4J5ntn/+XwwDAMEy7LYoKoqgiBAmqZomgZRFOHxeEAURZjmNzRNY2PXdfxGS33fh+u6MAwDuq6zXyAhDRzHQRzHnGDbNlRVBVmWoSgKTNOEYXxxGkJd19j3nReTPwxD5HnOvXCeJ4jHcbCIKoFOt22bP6IUdBKlulMSrutiko9CUBXwB24hLb+5rusvKcB/+AG6cHD+PJEUZQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image9\"\n        title=\"image9\"\n        src=\"/static/9a909feb23b653a1f8b107a77de49336/37523/image9.png\"\n        srcset=\"/static/9a909feb23b653a1f8b107a77de49336/e9ff0/image9.png 180w,\n/static/9a909feb23b653a1f8b107a77de49336/f21e7/image9.png 360w,\n/static/9a909feb23b653a1f8b107a77de49336/37523/image9.png 720w,\n/static/9a909feb23b653a1f8b107a77de49336/612f7/image9.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<p>참고자료</p>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>","frontmatter":{"date":"March 16, 2022","title":"[JPA] 6. 다양한 연관관계 매핑","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa6/"}},"prev":{"id":"0844a804-5826-55ab-b4cf-d3ace9b96070","html":"<p>Spring boot 환경에서 AWS S3를 연동해서 사용하려고 하면, application.yml 또는 application.properties에 아\n래와 같이 accessKey, secretKey값을 설정해줄 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">cloud<span class=\"token punctuation\">.</span>aws<span class=\"token punctuation\">.</span>credentials<span class=\"token punctuation\">.</span>accessKey<span class=\"token operator\">=</span>accessKey값\ncloud<span class=\"token punctuation\">.</span>aws<span class=\"token punctuation\">.</span>credentials<span class=\"token punctuation\">.</span>secretKey<span class=\"token operator\">=</span>secretKey값</code></pre></div>\n<br>\n<p>그런데 이렇게 설정을 하게 되면 AWS의 accessKey, secretKey값이 깃헙에 노출되는 문제가 발생한다.</p>\n<p>이미 나는 그걸 모르고 별일 없겠지라는 안일한 생각으로 깃헙에 코드를 푸시했다가 <strong>이틀 만에 해킹(ㅠㅠ)</strong> 당하는 일을 겪어야 했다.</p>\n<p><del>이틀 만에 80 달러 치를 썼더라 해커놈 ㅡㅡ</del></p>\n<p>그러니 반드시 Jasypt를 활용해서 AWS key값을 암호화해서 올리시길 바란다.</p>\n<h2 id=\"jasypt\" style=\"position:relative;\"><a href=\"#jasypt\" aria-label=\"jasypt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jasypt</h2>\n<p>: Java Simplified Encryption으로 암호화를 위한 Library이다. 보통 프로퍼티에 노출되는 중요 정보들을 암호화 해주는 용도로 사용한다.</p>\n<h3 id=\"1-의존성-설정--buildgradle-\" style=\"position:relative;\"><a href=\"#1-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%84%A4%EC%A0%95--buildgradle-\" aria-label=\"1 의존성 설정  buildgradle  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 의존성 설정 ( build.gradle )</h3>\n<p>나는 gradle을 사용하기 때문에 아래와 같이 간단한게 jasypt를 사용하기 위한 의존성을 설정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dependencies {\n\timplementation 'com.github.ulisesbocchio:jasypt-spring-boot-starter:3.0.3'\n}</code></pre></div>\n<h3 id=\"2-custom-vm-option에-password-설정\" style=\"position:relative;\"><a href=\"#2-custom-vm-option%EC%97%90-password-%EC%84%A4%EC%A0%95\" aria-label=\"2 custom vm option에 password 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Custom vm Option에 password 설정</h3>\n<p>jasypt를 이용해서 encrypt, decrypt를 실행 시 반드시 password를 설정해야 되는데, 이 password는 다른 사람이 알게되면\n결국 jasypt를 이용해서 복호화가 가능하므로 절대 외부로 노출되서는 안된다.</p>\n<p><strong>따라서 jvm option에 추가 해준다.</strong> Intellij에서는 [Help]-[Edit custom VM Options] 에 아래행을 추가해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token operator\">-</span><span class=\"token class-name\">Djasypt_password</span><span class=\"token operator\">=</span>password값</code></pre></div>\n<br>\n<h3 id=\"3-config-클래스-설정\" style=\"position:relative;\"><a href=\"#3-config-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%84%A4%EC%A0%95\" aria-label=\"3 config 클래스 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Config 클래스 설정</h3>\n<p>의존성과 vm option 설정이 끝났다면 이제 코드를 작성해보자.</p>\n<ul>\n<li>\n<p>JasyptConfig 클래스를 @Configuration 로 만들어주고, Bean을 등록해준다.</p>\n</li>\n<li>\n<p>bean name을 설정해서 jasypt가 application.properties 파일에서 bean을 참조할 수 있도록  설정한다.</p>\n</li>\n<li>\n<p>jvm option에서 설정한 jasypt_password값을 System.getProperty(“jasypt_password”) 명령을 통해 가져와서 password로 설정한다.</p>\n</li>\n</ul>\n<br>\n<p>JasyptConfig.java</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JasyptConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> encryptKey<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"stgOnyouEncryptor\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//원하는 이름 아무거나</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">StringEncryptor</span> <span class=\"token function\">stringEncryptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">PooledPBEStringEncryptor</span> encryptor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PooledPBEStringEncryptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">SimpleStringPBEConfig</span> config <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleStringPBEConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> jasyptPassword <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jasypt_password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        config<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>jasyptPassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        config<span class=\"token punctuation\">.</span><span class=\"token function\">setAlgorithm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PBEWithMD5AndDES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        config<span class=\"token punctuation\">.</span><span class=\"token function\">setPoolSize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        config<span class=\"token punctuation\">.</span><span class=\"token function\">setSaltGeneratorClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"org.jasypt.salt.RandomSaltGenerator\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        config<span class=\"token punctuation\">.</span><span class=\"token function\">setStringOutputType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"base64\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        encryptor<span class=\"token punctuation\">.</span><span class=\"token function\">setConfig</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> encryptor<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>application.properties</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">jasypt<span class=\"token punctuation\">.</span>encryptor<span class=\"token punctuation\">.</span>bean <span class=\"token operator\">=</span> stgOnyouEncryptor <span class=\"token comment\">// JasyptConfig의 bean name과 일치해야함</span></code></pre></div>\n<p>이렇게 하면 jasypt를 위한 암호화 설정은 끝났다.</p>\n<h3 id=\"4-테스트-코드를-통해-암호화된-key값-얻기\" style=\"position:relative;\"><a href=\"#4-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C%EB%A5%BC-%ED%86%B5%ED%95%B4-%EC%95%94%ED%98%B8%ED%99%94%EB%90%9C-key%EA%B0%92-%EC%96%BB%EA%B8%B0\" aria-label=\"4 테스트 코드를 통해 암호화된 key값 얻기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 테스트 코드를 통해 암호화된 key값 얻기</h3>\n<p>아래와 같이 테스트 코드를 작성 후 실행하면 accessKey, secretKey에 대해서 ‘jasypt_password’ 값으로 암호화 한 key값을 각각 얻을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JasyptConfigTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">jasyptTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//given</span>\n        <span class=\"token class-name\">String</span> accessKey <span class=\"token operator\">=</span> <span class=\"token string\">\"accessKey값\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> secretKey <span class=\"token operator\">=</span> <span class=\"token string\">\"secretKey값\"</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">StandardPBEStringEncryptor</span> jasypt <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StandardPBEStringEncryptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> jasyptPassword <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jasypt_password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>jasyptPassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">setAlgorithm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PBEWithMD5AndDES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> encryptedAccessKey <span class=\"token operator\">=</span> jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span>accessKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accessKey 암호화 내용: \"</span> <span class=\"token operator\">+</span> encryptedAccessKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> decryptedAccessKey <span class=\"token operator\">=</span>  jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>encryptedAccessKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accessKey 복호화 내용: \"</span> <span class=\"token operator\">+</span> decryptedAccessKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> encryptedSecretKey <span class=\"token operator\">=</span> jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span>secretKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secretKey 암호화 내용: \"</span> <span class=\"token operator\">+</span> encryptedSecretKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> decryptSecretKey <span class=\"token operator\">=</span>  jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>encryptedSecretKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accessKey 복호화 내용: \"</span> <span class=\"token operator\">+</span> decryptSecretKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>accessKey<span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token function\">equalTo</span><span class=\"token punctuation\">(</span>decryptedAccessKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>secretKey<span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token function\">equalTo</span><span class=\"token punctuation\">(</span>decryptSecretKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>System.out.println 해서 암호화된 key값을 얻은 뒤에 application.properties에 암호화된 값으로 설정하면 된다.\n이 값을 ENC로 감싸주면 알아서 jasypt가 알아서 복호화를 시켜준다고 하는데,(예를 들어 ENC(암호화값) 이런식으로..)\n나는 그게 잘 안되서 그냥 암호화된 값을 application.properties에 입력하고, awsConfig 클래스에서 직접 복호화했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">cloud<span class=\"token punctuation\">.</span>aws<span class=\"token punctuation\">.</span>credentials<span class=\"token punctuation\">.</span>accessKey<span class=\"token operator\">=</span>암호화된accessKey값\ncloud<span class=\"token punctuation\">.</span>aws<span class=\"token punctuation\">.</span>credentials<span class=\"token punctuation\">.</span>secretKey<span class=\"token operator\">=</span>암호화된secretKey값</code></pre></div>\n<br>\n<h3 id=\"5-aws-config-클래스에서-적용\" style=\"position:relative;\"><a href=\"#5-aws-config-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%97%90%EC%84%9C-%EC%A0%81%EC%9A%A9\" aria-label=\"5 aws config 클래스에서 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. AWS config 클래스에서 적용</h3>\n<p>나는 아래와 같이 AWS access, secret Key를 사용하는 쪽 코드에서 직접 복호화 해주었다.\n만약에 ENC()로 감싸는 방법이 잘 적용된다면 ‘여기서부터’ ~ ‘여기까지’ 코드는 필요없이 jasypt에서\naccessKey, secretKey 값을 불러올 때 알아서 복호화된 값으로 불러와서 변수에 저장해줄 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AwsS3Config</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${cloud.aws.credentials.accesskey}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> accessKey<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${cloud.aws.credentials.secretkey}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> secretKey<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${cloud.aws.region.static}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> region<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AmazonS3Client</span> <span class=\"token function\">amazonS3Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">//여기서부터 </span>\n        <span class=\"token class-name\">StandardPBEStringEncryptor</span> jasypt <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StandardPBEStringEncryptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> jasyptPassword <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jasypt_password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>jasyptPassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">setAlgorithm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PBEWithMD5AndDES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> decryptAccessKey <span class=\"token operator\">=</span> jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>accessKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> decryptSecretKey <span class=\"token operator\">=</span> jasypt<span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>secretKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//여기까지 </span>\n        <span class=\"token class-name\">BasicAWSCredentials</span> awsCreds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicAWSCredentials</span><span class=\"token punctuation\">(</span>decryptAccessKey<span class=\"token punctuation\">,</span> decryptSecretKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AmazonS3Client</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">AmazonS3ClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">standard</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withRegion</span><span class=\"token punctuation\">(</span>region<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withCredentials</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AWSStaticCredentialsProvider</span><span class=\"token punctuation\">(</span>awsCreds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<br>\n<h3 id=\"6-빌드-시-옵션-추가\" style=\"position:relative;\"><a href=\"#6-%EB%B9%8C%EB%93%9C-%EC%8B%9C-%EC%98%B5%EC%85%98-%EC%B6%94%EA%B0%80\" aria-label=\"6 빌드 시 옵션 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 빌드 시 옵션 추가</h3>\n<p>5번까지 진행하면 로컬에서 jasypt를 사용하기 위한 환경설정은 끝난다.\n그러나 빌드 하여 배포를 하려면 Intellij run시 jvm option 추가 해줬던 것처럼 아래와 같이 jasypt_password 환경변수를 추가해주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">java -jar -Djasypt_password<span class=\"token operator\">=</span>password값 app.jar </code></pre></div>\n<br>\n<p>나는 github에 푸시하면 Github action이 Dockerfile 읽어서 자동으로 빌드하게 설정해두었기 때문에 아래와 같이 dockerfile에 추가해주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">FROM openjdk:11-jdk\nARG <span class=\"token assign-left variable\">JAR_FILE</span><span class=\"token operator\">=</span>build/libs/onyou-0.0.1-SNAPSHOT.jar\nCOPY <span class=\"token variable\">${JAR_FILE}</span> app.jar\nENTRYPOINT <span class=\"token punctuation\">[</span><span class=\"token string\">\"java\"</span>,<span class=\"token string\">\"-jar\"</span>,<span class=\"token string\">\"-Djasypt_password=password값\"</span>,<span class=\"token string\">\"/app.jar\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<hr>\n<p>지금까지 jasypt를 이용해서 소중한 aws key값을 보호하는 방법을 알아보았다.\n비단 aws key값 뿐만 아니라 DB 정보를 암호화하는데도 사용할 수 있을 것이다.</p>\n<hr>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<ul>\n<li><a href=\"https://velog.io/@znftm97/Jasypt-%EC%82%AC%EC%9A%A9%EB%B2%95-%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0-%ED%8C%8C%EC%9D%BC-%EC%95%94%ED%98%B8%ED%99%94\">https://velog.io/@znftm97/Jasypt-%EC%82%AC%EC%9A%A9%EB%B2%95-%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0-%ED%8C%8C%EC%9D%BC-%EC%95%94%ED%98%B8%ED%99%94</a></li>\n<li><a href=\"https://junyharang.tistory.com/m/191\">https://junyharang.tistory.com/m/191</a></li>\n<li><a href=\"https://blusky10.tistory.com/404\">https://blusky10.tistory.com/404</a></li>\n<li><a href=\"https://kim-jong-hyun.tistory.com/50\">https://kim-jong-hyun.tistory.com/50</a></li>\n</ul>","frontmatter":{"date":"April 15, 2022","title":"[AWS] AWS key값을 Jasypt를 이용해서 보호하자","categories":"AWS","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/aws_jasypt/"}},"site":{"siteMetadata":{"siteUrl":"https://steadyandslow.com","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/jpa7/","nextSlug":"/jpa6/","prevSlug":"/aws_jasypt/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}