{"componentChunkName":"component---src-templates-blog-template-js","path":"/etl1/","result":{"data":{"cur":{"id":"a7c839c3-ea66-5eaf-982b-81c4c148d570","html":"<h2 id=\"powercenter-개요\" style=\"position:relative;\"><a href=\"#powercenter-%EA%B0%9C%EC%9A%94\" aria-label=\"powercenter 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PowerCenter 개요</h2>","excerpt":"PowerCenter 개요","frontmatter":{"date":"October 19, 2023","title":"Informatica 1","categories":"Data","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/etl1/"}},"next":{"id":"b5ffbc57-d21e-5c4e-a23c-22ca63df3658","html":"<h3 id=\"security-context\" style=\"position:relative;\"><a href=\"#security-context\" aria-label=\"security context permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Security context</h3>\n<ul>\n<li>\n<p>컨테이너를 실행할 때 하기와 같이 어떤 유저로 실행할지, 어떤 capability를 추가하거나 뺼 지 등 보안 설정을 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker run --user=1001 ubuntu sleep 100\ndocker run --cap-add MAC_ADMIN ubuntu</code></pre></div>\n</li>\n<li>\n<p>이는 k8s pod definition에서도 Security context 절을 통해 설정할 수 있는데, pod 레벨에서 설정하면 pod 내의 모든 컨테이너에 적용되고 컨테이너 레벨에서 설정을 하면 그 설정으로 override된다.</p>\n</li>\n<li>\n<p>Pod 레벨 예시\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpklEQVQ4y42U627bMAyF/TatJJK62ZJvSYMuadEW69oOw97/Sc4geQkSDEv8g5AEE58OySM325bwfWS8j4LXgfGcCI8dwVlBbBOICMaY1dEU4M+N4JAMoveYxwld8DBag5lrktZ6dTT7zPjaSFV5yIJd8hWilIJS9zXpCF2lUMhgDoTfDwVKSN6iHya0bULKA0KIFX4Ncn5p09nSw9I/QbQGmhg+tLAuwPkIFntT5QUwO8JTZrQFpg2ENMQosFEgvazG6NXQRmmNp0x46QmvA9VJ/5gYLz3jcxZ8bByik3pZAd9UWDZkDPZpGc7XbKuFypCcEEKXa0/lrPSrCv/9cH6+tMT/Sr5QWAD3SuNO6boe41avripMjjB4QnLmFMVOVZlSS6xU2ZT+PSbCIRP2WfDcC94nxq5dnpy1rgaLrDL4Rcl3mtBawudcJi2IYtCPG8ybXTV5AV97dn9LXjZFabFQMffbyPV9P0SD4D3GaYvc9wgxLrm8qGemumfh+hM52eZIr0Ax1TK/toyPmfGtKwCB8xYuCGLnYb0Fs8B6gW8dfHAn9X8AlN/OV+VyK4YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/ad136c4da4381b5c89167a699212d00a/37523/image1.png\"\n        srcset=\"/static/ad136c4da4381b5c89167a699212d00a/e9ff0/image1.png 180w,\n/static/ad136c4da4381b5c89167a699212d00a/f21e7/image1.png 360w,\n/static/ad136c4da4381b5c89167a699212d00a/37523/image1.png 720w,\n/static/ad136c4da4381b5c89167a699212d00a/302a4/image1.png 1080w,\n/static/ad136c4da4381b5c89167a699212d00a/d7e70/image1.png 1286w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p>Container 레벨 예시\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/0lEQVQoz1WRX0/TUByG+y1IhnC9tqdd25XBhA2qEaIxoh/KC+IMyA0fwHu/gIm3xhuvJAFB+edStrbr6Vm3gbt4TAsu4STP7XN+7/tqb561ebUZsPVknY2NgFarRbvdnhEEAbVajYODA4qXpilKKWQ0QPZihlFCEkbIeIDMMrTtps7TpoctTHRdp1qtPsA0Tebm5uh0OndCKVGJLAXdWPL9rE+SSpLrGDlI0TaXBb5jY7s+Xt1HCFFK/lNcNz8/z+7ubinMsgwVp6RSkcoRhxeSfJgTFRf2E7TAF6x6FmueQAjzgazAtm0qlcpMqIaKfJCRpIrLuMtlfMZVHJIkGTJK0CzTwHcsXqwIGq5NvdHE9Xx03cAwjJlwb2+vFA7zIaNsSJpIPh1+Zv/rR76cfGMYKdIiclXXEabJ6zWbl48tGn6d5YaP61gIy8KruywuLsyEeZ4znozJU8VtOmEqbxjFiixJyZRCK4awhEmwZPF8xaLodN0XNJc8TCHuO6zwYX+/FE5uJkynU27/3jIej8oP8tEdmcrQDEOnqhs0HJPtVZutFYv1JYu669wL7XKU9zudct1eN+T6T0gU9omv+/TDHuFVl6QXM1Z5ITTK8ovYy46g5Vt4bg3Hsag5dhn50eIC797u0LsIOflxXHJ+9Ivz498lp4c/uTq9IDzv8g/SVdU92A1u1QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/7e11f9fff65e88b6472bd21cf3fc2002/37523/image2.png\"\n        srcset=\"/static/7e11f9fff65e88b6472bd21cf3fc2002/e9ff0/image2.png 180w,\n/static/7e11f9fff65e88b6472bd21cf3fc2002/f21e7/image2.png 360w,\n/static/7e11f9fff65e88b6472bd21cf3fc2002/37523/image2.png 720w,\n/static/7e11f9fff65e88b6472bd21cf3fc2002/302a4/image2.png 1080w,\n/static/7e11f9fff65e88b6472bd21cf3fc2002/07a9c/image2.png 1440w,\n/static/7e11f9fff65e88b6472bd21cf3fc2002/59058/image2.png 2376w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><code class=\"language-text\">kubectl exec &lt;pod명> -- whoami</code> 명령을 통해 특정 pod를 실행시키고 있는 user가 무엇인지 알 수 있다.</p>\n</li>\n</ul>\n<h3 id=\"admission-controller\" style=\"position:relative;\"><a href=\"#admission-controller\" aria-label=\"admission controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Admission controller</h3>\n<p>admission controller는 authentication/authorization 단계에서 수행할 수 없는 보안조치를 위한 부가적인 기능들을 제공한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDUlEQVQoz12SvU9TYRSH77/h5D8gaggCGlETw8CAxMlFVxc3F02gKGEx6iodSBEWY1ggSJSYAkqLvdx+AKUlxQI20Es/7vveL6q29KaP6dXJkzw5OcnJ7yQnj+I4DpZlYRgGQgiElEgpMU3zH5bf/R0heRc7YGZ9n+lInplonlKlihAGVcPwM5RwOEwqlaRWq/lBjm3hOjaOY2PZNqeuw6nj8OvUpVgRnB9bo+OVyuXXKueerbF/XMK1TKSQmEKiDA4OMTwcoHnW8C/oFYFekRjS9MMqwuTEsDBth+OKZHQ2QXBhw2fkfZzDYhkhqxyVihTLOsrdgSfcGwqwuKgxrR3RP5GgP5hi+MMeWwWDO5Mp+ifiDAQ1ZtUDQqtZYjs51tM5QitZFhMHPA2/5P7CYx4sPEaJRDTabGibrKd2WIpt8Sm2yVoyw/bunj8n80VyuiSnCx69WCIwNs/I8zkejn8kUyiT1/fZLmTZKmRQOi90cKPnKn1dPfR1XuF27zVudXVzs7uX61099F68ROTLKu3Shc34VJTQ1DKht8uMTUb4UTJo1H7iWi6u5aBEv0ZQv8XYiKnEVQ1N1UjGEz6pRNKnaghanseJcBidT/Pmc5pgOENgLs2hXvV/3bajbYlSb9RpNBo0m02anker1eL/8jyPs7MGv+t1ot/LLO+WCGdOWMkWsWznrxGW5VvyB8y6FiCBDH8kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/67e87f7d610c9155e62460adccf2f041/37523/image3.png\"\n        srcset=\"/static/67e87f7d610c9155e62460adccf2f041/e9ff0/image3.png 180w,\n/static/67e87f7d610c9155e62460adccf2f041/f21e7/image3.png 360w,\n/static/67e87f7d610c9155e62460adccf2f041/37523/image3.png 720w,\n/static/67e87f7d610c9155e62460adccf2f041/302a4/image3.png 1080w,\n/static/67e87f7d610c9155e62460adccf2f041/07a9c/image3.png 1440w,\n/static/67e87f7d610c9155e62460adccf2f041/49832/image3.png 2374w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>NamespaceExists와 같은 모듈은 디폴트로 적용되어 있어서 pod가 생성될 namespace가 실제 존재하는지 체크하고, NamespaceAutoProvision과 같은 모듈을 Enable하면 namespace가 존재하지 않는다면 생성하도록 설정된다.\n아래 명령을 통해 디폴트로 어떤 admission controller가 적용되어 있는 지 확인 할 수 있다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABj0lEQVQY0zXKW2/SABjG8SZcuHgxFncqbS0WmI7BgHn4AGpSmCsJ8Uq9MG60wLolJkBH0C9hOixNDyYu4XBj5pVe+dn+xhIvnvze580jtN69pvmqSdNoctw4xjgxMAyDul6n1Wqh13XG40/c/rxlNp+zWC6ZLxYr//XfS+Z/Fsx+zbj5cYNQfFtC+1hAu9hDPlfRLguo5xq7ZxJqVyNzpqB1C2TNHFlLQ2lnkU4VHlh55LaK2JaRTZX1lxsI6wLC0zfPqFg1auYTiu/LHHwoUzFrlE+r7OkPOaxXKOmH7D8vUtbLVBtVao0jDl6UODp5TK6SJ5/Lk95Kk0qlEPZzj8jJGvdFFfGeiLiZSe7MZgZ5W165o6DsKEhbUvLbuJtG2paSvbQrs3ZnDUEQVhl/HuM4DkPHYTQa0e/36Q8Gif/7YDDEubpKNsOhQ6/Xw76wsW2bbrdLp9PBsixM00KYfg9wv7hcT66ZTCZ4Xz08z8Of+onT6RTf95PE8TeiMCIIAuIoIo7ixDAMCYMQ13X5C/2875CIzBGdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/0fff33b867d286b96ef2059744dadf47/37523/image4.png\"\n        srcset=\"/static/0fff33b867d286b96ef2059744dadf47/e9ff0/image4.png 180w,\n/static/0fff33b867d286b96ef2059744dadf47/f21e7/image4.png 360w,\n/static/0fff33b867d286b96ef2059744dadf47/37523/image4.png 720w,\n/static/0fff33b867d286b96ef2059744dadf47/302a4/image4.png 1080w,\n/static/0fff33b867d286b96ef2059744dadf47/07a9c/image4.png 1440w,\n/static/0fff33b867d286b96ef2059744dadf47/63908/image4.png 2410w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>admission controller를 추가/제거 하기 위해서는 아래와 같이 kube-apiserver의 yaml파일에 작성해주면 된다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABp0lEQVQoz3XPy2oaARTG8VE7gs1CjRohULWjndHOJfEeTZBm1V26aHERNfYBuujK26ozLpJFKX0Bl7powI3iJSQ+QPNALQr5FxWELHrgx9l93zlCu92m2WzSaDTodDoMBgOGwyH9fn/n1+0tP398p2t+w+p2MU0Ly7IwTXOj1WrR6/WYz+cIXq+XcDhMJBIhFArh8Xiw2WwIgrDjeCFSymgUDBk1LqPIb4jGYkSj0R1JkjaEYDCIcWSgahpSVGJd4BSd2O12HA7HJtDj3ee8mOX9iU4xlyaXzaLrBqqqomnaM8KBL4CqqCTkBKHDV/i8+7jdbkRR3F26Link0pQyBqlkEk0z0HV9G/pW3VK3WxDdTgLxA3wxPz7Zj/8wwN7LvWcvu1wukqkUyXSG07MShdMz8oUi2Vyeo+PjzWXrAk3TET5++UTl5opLq0LlusbV1zq1yxr1z3XK5TIXHy6oVqvkTjK8zgeRzuWN8LsYsayCqhrE4wkUJY4sKwjLv0tWf1Y8LZ9gxX/n8fE3i7s5i4cF9/cPzGd3zKYzptMpk8mE8XjMaDTiH3IoDfs4O1p+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/4e09a8246fc8797bf889a5594d662eb8/37523/image5.png\"\n        srcset=\"/static/4e09a8246fc8797bf889a5594d662eb8/e9ff0/image5.png 180w,\n/static/4e09a8246fc8797bf889a5594d662eb8/f21e7/image5.png 360w,\n/static/4e09a8246fc8797bf889a5594d662eb8/37523/image5.png 720w,\n/static/4e09a8246fc8797bf889a5594d662eb8/302a4/image5.png 1080w,\n/static/4e09a8246fc8797bf889a5594d662eb8/07a9c/image5.png 1440w,\n/static/4e09a8246fc8797bf889a5594d662eb8/91a65/image5.png 2476w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>NamespaceAutoProvision, NamespaceExists 는 deprecated되었고 NamespaceLifecycle 로 대체되었다. 이는 존재하지 않는 ns 에 대한 request는 reject하고 default로 설정되는 ns는 삭제 되지 않도록 해준다.</p>\n<h4 id=\"admission-controller의-종류\" style=\"position:relative;\"><a href=\"#admission-controller%EC%9D%98-%EC%A2%85%EB%A5%98\" aria-label=\"admission controller의 종류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Admission controller의 종류</h4>\n<ul>\n<li>Validating Admission controller : NamespaceExists와 같이 request에 대한 유효성을 검사하는 admission controller</li>\n<li>Mutating Admission controller : defaultStorageClass와 같이 request를 조작하여 default storageclass 등을 부여하는 admission controller</li>\n<li>검증/조작 둘다 하는 것들도 있다.</li>\n</ul>\n<h4 id=\"admission-webhook\" style=\"position:relative;\"><a href=\"#admission-webhook\" aria-label=\"admission webhook permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Admission webhook</h4>\n<p><a href=\"https://coffeewhale.com/kubernetes/admission-control/2021/04/28/opa1/\">https://coffeewhale.com/kubernetes/admission-control/2021/04/28/opa1/</a></p>\n<ul>\n<li>webhook 서버 ( Dynamic admissoin controller ) 만들기\n<ul>\n<li>webhook 서버를 위한 tls type의 secret 만들기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl -n webhook-demo create secret tls webhook-server-tls \\\n    --cert \"/root/keys/webhook-server-tls.crt\" \\\n    --key \"/root/keys/webhook-server-tls.key\"</code></pre></div>\n</li>\n</ul>\n</li>\n<li>validatingWebHookConfiguration은 api-server로 들어오는 요청을 webhook service로 전달해주기 위한 역할을 하며 어떤 request에 대해 webhook 서버로 보낼지에 대한 설정을 한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACb0lEQVQoz12SzUtUcRSG518IQp2smRLmfvzux3hnRgMLI0RomwsXIWQxc6c2/QtBNc64aNUuiJBaRAStojYSLURFaiGRyowJQqjzce+dOx9qpk/MnVrUgZdzVg/vy3tCu3tlOqpVyjjVMuVyhb1yhZ3dPZqtNi/mnjM1eZ3s7Ztk0mmy2TvYto2dtcnYmUDpdJqpqSlmC7OEOrB23eHtyhb3Xq/iey7Vao1ypcL+4RGFh/cxo6cZScUx4yZWMsGgNUh8MB5swzSQJIlwOMz09C1C1VqNys4PXs2vMPNmka2tLTzXxanVODz6RWEmR0rqZyRlIgsVoSmoQkHo3VtWZGRZJhqNcveOTchxanzb3MaeW+bakwXerRTx6x6O43B0fEIul0OcDzOcMIibAi0AdaVqagCTJJmBCxHGJ2xChw2Xpx/XiOUXkWeXmXz2mZ8tH8f1OD6Bh49yRPv7GE1qXLJUhCIHEf8662xJlokNRFCv2oSadZdPX7dJPl6i/8ECsx82+Nlu4tXrdKbj8NTpHi4nNMZSgqSlY6VMrKE4pqVjxDU0XXA+GmHiRoZQpVKlVCzyfmmVl/NfWC+W8Lw6jUbjD3CGC2f7uDKkk9QVVE1gmBq6IQJ3iiqjGxqRSJS72Uy3lLX1DUob62x/L1IqbeI3mtT9LnAmn+fcmV7GLxqMJhQShgiaVlWFWCwWSJZkIpEImYxNyPM8XMeh5ji4rkfDb3BwcEC73Q6A+XyBcG8PY8M6owmVQUOQHE6QHLYQQgRARfkP6Ps+zWaTVqvF/v7+P8BCoUBvTw8jloaudgvpRDbiOkKoSB2HchfYefjf0xHrqx3XSEkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/f4ba1290f2f09e6008124538cef5c78b/37523/image6.png\"\n        srcset=\"/static/f4ba1290f2f09e6008124538cef5c78b/e9ff0/image6.png 180w,\n/static/f4ba1290f2f09e6008124538cef5c78b/f21e7/image6.png 360w,\n/static/f4ba1290f2f09e6008124538cef5c78b/37523/image6.png 720w,\n/static/f4ba1290f2f09e6008124538cef5c78b/302a4/image6.png 1080w,\n/static/f4ba1290f2f09e6008124538cef5c78b/07a9c/image6.png 1440w,\n/static/f4ba1290f2f09e6008124538cef5c78b/a5120/image6.png 2380w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li><code class=\"language-text\">AdmissionReview</code> 라는 json 객체를 통해 webhook server 와 통신하게 되며 Validating admission에서는 response.allowed값만 설정해주면 되고 mutating admission에서는 response.patch값을 설정해주어야 한다.</li>\n</ul>\n<h3 id=\"pod-security-policy\" style=\"position:relative;\"><a href=\"#pod-security-policy\" aria-label=\"pod security policy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pod Security policy</h3>\n<ul>\n<li>admission controller 중 <code class=\"language-text\">PodSecurityPolicy</code>라는게 있고 이건 default가 아니여서 enable해줘야 한다. 그러면 아래와 같은 취약한 SecurityContext와 같은 설정에 대해서 admission controller 레벨에서 요청을 차단하게 된다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACY0lEQVQoz13Sy0vUURTA8d+/EQYtbBzJeTjO1JS56aFBOzdhy8BFO0HUTYQSFUjRwk1hSFFbKaqFG0VnfhbMTJamOeNYqeVrfu/nPEz9xvyGorpwOFw458M5lysoisrM9Ay7uwUURfFClmUKkoSqql4UChKKqmLqGuOpVcaSOZ69zTOWyLGxvYuq1nqqIaxvrNFxqZ3M+zTFoouqyBhatVnHMHRMQ8cydHRNY8/WOT8yy5GhKUL3ROqGplj4+gNb05AlBVVWEAYHRrl4ppue7vu8+/SN/hcfufokxbXnGRKfvzM8sejdu56mebWwxeCbZQbG57n5coH+F0tMft7hbmqEPvEWPckhhA+ZZT6kV5hLZ9ktSGS+bDO59INkdhNJ1VlcL5BY2eF1Ksuj0cdcvzHMld47dPXe8fLwgxEm5iaZ207zUEwh2LaJ41oUSw6maVJxbQ7KLgflIq7jUCk6wCFr+Swd8QDxYAMnGv34ffU0+uo5WleHOD0LhweI8xaCLCvew2ua7oGmaWFaNpZt47outu3wc3+fpeUs7W1x2qIhotEYTcEQgUAQv9/PTCKB6zps7hQQqpiu1zDLsrBtG8dxKBaLlEolL1dPLpcjfjJGx8km2uIxoi3NBEM1MJlMenWyLCFomoZhGB74P1YulymXSh6Yz+eJRWO0Rk5w+VSY1pYIzYEwjccbEJOiVy9JMoLufQ/jz3TVNX9je3t7VCqV2oSrK1yInOX2sU46I6cJRwKEQiFvwipYrddVpQb+va7r1qarQv+CedpjrfT5LnEuGKepOUwwGMTn8yGKNTC3VeAXSHZ8jPvqfcAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image7\"\n        title=\"image7\"\n        src=\"/static/d8eacf3e1617aca0d1c94210720ece3b/37523/image7.png\"\n        srcset=\"/static/d8eacf3e1617aca0d1c94210720ece3b/e9ff0/image7.png 180w,\n/static/d8eacf3e1617aca0d1c94210720ece3b/f21e7/image7.png 360w,\n/static/d8eacf3e1617aca0d1c94210720ece3b/37523/image7.png 720w,\n/static/d8eacf3e1617aca0d1c94210720ece3b/302a4/image7.png 1080w,\n/static/d8eacf3e1617aca0d1c94210720ece3b/07a9c/image7.png 1440w,\n/static/d8eacf3e1617aca0d1c94210720ece3b/cc40b/image7.png 2394w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>policy를 커스텀하여 아래와 같이 생성할 수도 있으며 이를 위해서는 RBAC를 통해 serviceaacount가 pod security policy에 접근가능하도록 설정이 필요하다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACdklEQVQoz1WSy07bQBRA/Q9VVxAoGNtJ/BiPYweICQ9FaqWu+wVUCBEK9KVKXZQNG/JA6g66a/sR8AUIUokdn5FCSIGEJHAqD6VVr3SkmdHM0b13rra1tUWtVuXw8JDj42PF0dERp6ennJ2d0Ww2Fcn64GCfzc1PfP/2lR+NBo1GQ909OTlhf/+A3d0vaM9ncszlBUEQIIRA+j4TExOUy2W63a6S/Ww26d70+FyrkLdGWSjkKcYFZmfnmJ2boxDHuJ6n3mtPCwFT0kUIH9dxcGyb0ZERlpeX6fV6KrOEXr/PTnWb0EoRRxIhAzzhYTu2SkDXdYU2HeV4lreZyoc4idR1GRsfY2VlhX6/z/n5uWJwe0u9WsEeG0HaDoHrIj2BcDxM0/yLFkhJKXQoRT5xKMn5En1cV8LbwS2tVouLVgu4Y7tSwRpNUcq5xMLGdwW+JzENA8M0ME0DTQjJvBC8mAooBQGTXog5qlNeKXN3d0e73VYkUalUeZIaohQ5zEQ+peI0hVBgmQaG8Uc4FYXM5wTFMCAfBERBjrRhsr66piSXl5eKJKrV2j9h6BFFIb5wMS3znqRkJ5MmzkwgzDRpI0NaN3n86DGLiy+V5Orqiuvra7Wu1WroQ8OUpCD2HCaFy6TvMS0Fec8ja6bRXq2t82FjlY/vXvPm7Xs2NjZYWlpib29PSTqdjiKJer2OPpyimPOZCTzmk777DvlsBpnOkjXSaEk591l01NwlozIYDBj0B9zc3Kh9cv4gNFIpFkKfWLoUpEtkZ5GWhWNkyBgWWjJj6icvLmi3f6l+JSV2O/fy/4Q7O4wNJ3MokNLF9mycB+wslmHyG4CBCLvQouqnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image8\"\n        title=\"image8\"\n        src=\"/static/63418250401790b9de9ceab821d4a943/37523/image8.png\"\n        srcset=\"/static/63418250401790b9de9ceab821d4a943/e9ff0/image8.png 180w,\n/static/63418250401790b9de9ceab821d4a943/f21e7/image8.png 360w,\n/static/63418250401790b9de9ceab821d4a943/37523/image8.png 720w,\n/static/63418250401790b9de9ceab821d4a943/302a4/image8.png 1080w,\n/static/63418250401790b9de9ceab821d4a943/07a9c/image8.png 1440w,\n/static/63418250401790b9de9ceab821d4a943/82747/image8.png 2232w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n<h3 id=\"opa--open-policy-agent-\" style=\"position:relative;\"><a href=\"#opa--open-policy-agent-\" aria-label=\"opa  open policy agent  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OPA ( Open policy agent )</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAklEQVQoz22Sy0pbURSGz1toj1ZzYs5t7+PJSaJYTSuoldZIO+gTBDrpVBxklPeokBAQkqiF9jVSL4M60gcwKV4SA5qr8SvZQaG0Cz7Whs3/r/0vtnbbaNBs3tJoNLi8vOTq6uqZm5sb6vU69XqD6+trar+r1Go1qtWq4uLi4h+0X6enHB0dc35+TqvV4v7+nna7TafTodlsKtNut8eP799YW07wMbVKamOdN8vLLC0tKRYXF5/RvnxO8+H9Oul0mmw2SyaTYWtri+3tbc7Ozri7u+Ph4YHd3V3ChkEiESeIRnFdges6RMwI4XAYwzAU2ru1FRxzBiklodA0E7rO+Pg4uq5TqVTodrvKsFgsKsH8wjyxRIyo72PbNpZlqf6E9mnjLVFhE5+bx/OjSG8Wx3EQQnBycky/32dYpVJJDRneOa6NlALbtjBN8y+01OamEkvpIaRUPBkeHp/Q6fUYPEKpXGYmHCYeTxALYnieh+OOzIfdFY5agbayuorjCoQrCRnTTIVeMjY2ivzz8Ihuf0DvEYqlPczpSV6/WiCZTBLEAoR0kZ7ElS62Y2PZFlq5XGbn6w65fJ5cLkc+n1cUCgX1RXq9UeS9/X2mJl4w5wuCwMcPZvF8qdY0fOFwlyryk+B/NRgM6LTb6rx/cEBoUseTYhTVsVQyy7YxIxFMy1KmfwAY/K0ID11QtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image9\"\n        title=\"image9\"\n        src=\"/static/0e532a20b6bdb55c5a07bc141a3ab1fe/37523/image9.png\"\n        srcset=\"/static/0e532a20b6bdb55c5a07bc141a3ab1fe/e9ff0/image9.png 180w,\n/static/0e532a20b6bdb55c5a07bc141a3ab1fe/f21e7/image9.png 360w,\n/static/0e532a20b6bdb55c5a07bc141a3ab1fe/37523/image9.png 720w,\n/static/0e532a20b6bdb55c5a07bc141a3ab1fe/302a4/image9.png 1080w,\n/static/0e532a20b6bdb55c5a07bc141a3ab1fe/07a9c/image9.png 1440w,\n/static/0e532a20b6bdb55c5a07bc141a3ab1fe/92345/image9.png 2398w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"opa-in-k8s\" style=\"position:relative;\"><a href=\"#opa-in-k8s\" aria-label=\"opa in k8s permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OPA in K8S</h3>\n<p>OPA를 활용하면 앞서 webhook 서버를 만들었던 것처럼 직접 서버를 구축할 필요없이, validatingWebhookConfiguration, mutatingWebhookConfiguration이 OPA service를 바라보도록 할 수 있다.\n그리고 OPA는 로직의 구현없이 정책 설정만으로 원하는 mutate/validate을 가능하게 해준다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC8ElEQVQ4y32US08TURTH5xsQSGnVBWBfzOPO9DEPnjYdCJhSWPot3Lj0KxCYAhpTlZ0u3bgxceXeR2KhwEJia4G2vKZPWBCSv7mntbEunOSXc+88fjnnnntHKJ2c4smrCt58cvE4W8WP4incyzOcnZ3h/Py8x8XFRR+Xl5d9Y9d1KQr1movsBxdP3zaQeV9Ho9FEq9VCs9mi2Gq10W5zrnpcXfXTbDbhujXUajUIpV8FfPn2He8+5vD5aw57+R3kcjns7Oxgd3eXyOfzxP7+Pg4ODvrY29vD0dERSUmYffEcc4aER6kElhdtpJaWsLKy0iO9vIxUKoV0Oo2kbcO2bSwsLGBmZgaWZSEYDGJr6xn4RSVvOGtQRr2YiquIRCJQVRWxWIzGjLFeVBQFgUAAfr+/RzgcxtDQEFZXV0nI11FwHAfx0D08nIrAMHREo1HE9Th0Q4eu65SFLMuUCRf8Db/v9Xqxvr5OQio546wjOHIX6WkVRkxD3DBhWhYMw6DIpYZpwjQ7Y2vCQlzXqRJRFDE8PNwv5BPPsBdGRIGpiYgqIjRpnMpkmgyFyZBkCUxTwDRGWYVCIYyPj0OSpK7QIWG9Xu+UzNPmLy5aMtKTMhYnGEwzjpgeBVNZ52NZhCiJNOZCzh+h42RIyDtNQp/PB1mWMB0RkYiJmIxIiEU1komiRM0I+AO0jpx/hZlMR8j3bU84E2eYNyTMGTImKTMNqtopkZfPm6UwBbIi0z0O77zH40Ems0HCdrsFgdu9vjuwogxJXYIVUcBUvoU0Wngu0zSNtpLWnXMRj/w5X67Njc2usA1hbW0Ng4ODCIdCeKAFqOQYE6EwBv/9+xgdHSVGRkYojnHGOpGXPzAwAKfbFH4MhZfZLGWQSCSwkJzFvJ2EPTdHJ2F2dva/JJNJynL79TYJr6+vIZTLZRweHqJQKOBnoYBCoYhisYhSqURn9Pj4BCcnZZTLFVQqVVSrHU6rp/RHqlQqaDQauL29xc3NDX4DeFTB5A51w3EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image10\"\n        title=\"image10\"\n        src=\"/static/596ae37818365532de7cf1eb4ca9ec90/37523/image10.png\"\n        srcset=\"/static/596ae37818365532de7cf1eb4ca9ec90/e9ff0/image10.png 180w,\n/static/596ae37818365532de7cf1eb4ca9ec90/f21e7/image10.png 360w,\n/static/596ae37818365532de7cf1eb4ca9ec90/37523/image10.png 720w,\n/static/596ae37818365532de7cf1eb4ca9ec90/302a4/image10.png 1080w,\n/static/596ae37818365532de7cf1eb4ca9ec90/07a9c/image10.png 1440w,\n/static/596ae37818365532de7cf1eb4ca9ec90/891d5/image10.png 1520w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\nOPA는 webhook과 마찬가지로 AdmissionReview json객체를 통해 통신되며 .rego파일에 정책을 설정할 수 있다. 그리고 <code class=\"language-text\">import data.kubernetes.pods</code> 와 같이 클러스터의 object 정보들을 가져와서 validating에 활용할 수 있다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz1WSu47aQBSG/TawXVg8d3t8YW1sgzYKtCmyaVLxAJsi2NwaEElol03FW3AVL/ZHMwhCik9HGs385z//GaeTd5EXOfIiQ97JkGVtpGmKdruNJEnw9vaGavgD319fMZ/PcT6fcTqdcDgcLPv9/j8cLUNoLwBlBC5x0Ww273BRVSVaWqEVR9A6gNYa2tcghNzuue61unCU9BD6EaQSYIyC0n9wzjEsS6RZjjwvrOuL8ydEtoFGEATwfd9WIQQcJTzE+glSKlBGbWcjZipjDKPRCGmSWKFOpwOpOCgnYJzaqQglIMy8IZBSwjEuYt2CUgpc8JugodFoYLPZYP3+B6vVCuv1Gsfj0WZ1n+Fut8N2u7XVoYTCVxq+1Nby1Z2pLiH4/esnvr18xteXLxgMBlgul1gsFphMJta9oaoqlGWJ4XAIxwRphAIvtDmakbhgF5eMYTYeQTcb0FLB4xLksQny4REP9QfUarUb9XrdYgWlkNAqgJDcYrKzGVKK6XSKJG0jyzJEYYgojBCGITxf2ZhM9pcq7TvHPBRCwpP+TdA4vC5lPB7bZfT7fXzq9ZDnOXr9Hp4/PqPb7dhlmbOiKGwjRwhut2v+oBG5x4w9m83sRUMcx1C+gud7FhORaW40zBcKowh/AZRYgbPR87HPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image11\"\n        title=\"image11\"\n        src=\"/static/d52d0dc8e54e9a84023c119b17b64895/37523/image11.png\"\n        srcset=\"/static/d52d0dc8e54e9a84023c119b17b64895/e9ff0/image11.png 180w,\n/static/d52d0dc8e54e9a84023c119b17b64895/f21e7/image11.png 360w,\n/static/d52d0dc8e54e9a84023c119b17b64895/37523/image11.png 720w,\n/static/d52d0dc8e54e9a84023c119b17b64895/302a4/image11.png 1080w,\n/static/d52d0dc8e54e9a84023c119b17b64895/07a9c/image11.png 1440w,\n/static/d52d0dc8e54e9a84023c119b17b64895/8c5dc/image11.png 2384w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\nOPA는 어떻게 k8s 리소스를 알 수 있는가? <code class=\"language-text\">kube-mgmt</code>를 통해서다. kube-mgmt는 사이드카 컨테이너로서 OPA pod에 함께 존재하며 2가지 역할을 한다.</p>\n<ul>\n<li>OPA에게 k8s 리소스에 대한 정보를 제공</li>\n<li>configmap과 같은 K8s 리소스를 활용하여 OPA에 policy를 로드하는 역할\n<ul>\n<li>원래는 .rego파일을 작성한 후에 <code class=\"language-text\">curl -X PUT --data-binary @kubernetes.rego http://localhost:8181/v1/policies/exmple1</code> 과 같이 OPA에 policy를 등록해줬어야 하지만 kube-mgmt는 아래와 같이 configmap에 rego 소스를 가져옴으로써 configmap으로 등록해서 사용하게 해준다.</li>\n<li><code class=\"language-text\">k create configmap untrusted-registry --from-file=/root/untrusted-registry.rego</code> 와 같이 ‘—from-file’ 옵션을 활용하여 쉽게 configmap을 .rego파일로부터 생성할 수 있다.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8ElEQVQozz3QvU7bUBjGcV9IpSRS7NiOHduxje0Yg40JCSIUWlVVJdSx99GJCVQSvjY2ogr1JugEC1vbpYRWpa3ER5KylO1f+Qwdfnqfc5b3OUfa2tpic3OT7e1tPp6ecnZ29t/5+blQ5IuLC25vbxmPx9zf33N3dycUd4WbmxtB6sQukWthOw66XscwDDRNQ9d1oV6vI8syaZry4/qav4+PPDw8CNM/U6bTKZPCZMJ4MkbKoiZJU8NtOjRMQ1AUhaosU61WkRWZUqlEkiS8Hw75cHLC8HjIl0+f+f3zF9+vvnE1GnF1OWL09RIpjTwCS8M1dey6im2oNEwTtaZSUxQxy+Uyi/kir9ZWiX2HLFug2+nQ6/XI85z5uXnS+VSQWjM+VsPCsmxsy8axHXRVQ5FlVKWGVlOplMpk7ZwXL58zl8RkWUYcx7RaLVzXxXFsHMcRJM/z8XxPHMyGiVm0U1Xx7OLvipZPKiVe+x3eLr9h+ekqz9bW6Xa79HqrrKysiNxuL7G01EHymi5hFJFmKWEYiq2zSUIQhmJ7EATopsFGe42NzjozYUi+sEgYhURxRDwbi+z6Lp7nInmuh+XYzAQBvu+LWTQusmXbGKZJpVIhzRc4OjricO+Aw/0DDvb22RvsstsfsNvvM9jp03+3wz+zAlVKkIS9yQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image12\"\n        title=\"image12\"\n        src=\"/static/4fc62512b9702c9421f78efa879770b8/37523/image12.png\"\n        srcset=\"/static/4fc62512b9702c9421f78efa879770b8/e9ff0/image12.png 180w,\n/static/4fc62512b9702c9421f78efa879770b8/f21e7/image12.png 360w,\n/static/4fc62512b9702c9421f78efa879770b8/37523/image12.png 720w,\n/static/4fc62512b9702c9421f78efa879770b8/302a4/image12.png 1080w,\n/static/4fc62512b9702c9421f78efa879770b8/07a9c/image12.png 1440w,\n/static/4fc62512b9702c9421f78efa879770b8/18d55/image12.png 2470w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>아래는 k8s와 OPA가 어떻게 integrate 되는 지에 대한 전체 그림이다. 새로운 버전에서는 OPA gatekeeper을 통해서 k8s 와 OPA과 연동된다는 것도 참고하면 좋다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACTklEQVQozz2SS2tTURSF738QxaqgAx9pmzRxYEHFpgpWanUi6F8QVJwp1bFQLbUooqiDOnGg4JtSFEEKCr7wgY2NtU3amJr7POee+2pyU+WTXMUNi71Zg8Xaey/Nsixsy0I3LO5OGrz4YCKFTYt3HAchBLYj/nfDcjBtB9200U2Ln4ZFqVKlXKkmsyakpB55vP8mGbytGLqnsIRHFIV4no+ULq7r4ikX6bpYQiRz5EsCT0Ic8ujJE55OjMPyElp5rkSxUGC6UOTGvWkePv/Gwtws34sz1KqL+L6P4bjowkN3XFzlYguX+68cXk7pjL2a4+L4Ry5NfOL65CzaucFB9mzvZqB/P4cO9jOwby+9PXm6OtNcHr3Mr9+waAksv4EhPYJAUbEa3Hnwmslnj+m7OcWRsY8cvvWJ3Vfeop06cZzclvVkczky2Syd6TRdXV2salvDhaFhWiWEw9ev0wjpovwA5fsJV9VrVE2BkoKGLxNoJ4+fpH3jenq3ZchtzdLR0U4mk2b12nWMDo8kgq3btR4XBAGuH+IoD+F56EIl7ks1G92yqeom2omjx0htaGNHrp0tqRSbNm0m1dHJipWrGDn/12EQhvxaXqbeaOBHEY36EouOR8lUlA1JoSowbIGUAu3s6TPs7N7Kgb497OrJs3NXD/l8L+l0mutXryWCYbREs9kkjmPCpToqjFh0FAumpGIKyrrND+NvnLRKaZ7iuylmXn5m9s0Uc+8KlN8UmP8yg7RF4qwRN4mb/xDHWCqkJnzmTTdZOwx8lFK0IvgHaExJhq9Mn8EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image13\"\n        title=\"image13\"\n        src=\"/static/e5daeba71fa248a7b57956498331f44e/37523/image13.png\"\n        srcset=\"/static/e5daeba71fa248a7b57956498331f44e/e9ff0/image13.png 180w,\n/static/e5daeba71fa248a7b57956498331f44e/f21e7/image13.png 360w,\n/static/e5daeba71fa248a7b57956498331f44e/37523/image13.png 720w,\n/static/e5daeba71fa248a7b57956498331f44e/302a4/image13.png 1080w,\n/static/e5daeba71fa248a7b57956498331f44e/07a9c/image13.png 1440w,\n/static/e5daeba71fa248a7b57956498331f44e/d5ef8/image13.png 2462w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"secret-관리하기\" style=\"position:relative;\"><a href=\"#secret-%EA%B4%80%EB%A6%AC%ED%95%98%EA%B8%B0\" aria-label=\"secret 관리하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Secret 관리하기</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADc0lEQVQ4y1XT20+bdRzH8YebXfgPGAeFlj6H9mmfPnQLBx06HFBKoWSLp+jCRjjbtVZd6EHjvDAyigsjc5sZUUzQMB1FqFMxuGWbQQHngWNbpDPbnHN6s/gXvA0PiHrxyie/m2++3983X+FE35vEwgHiR8McCYYIBEOEgkGCwSCh0IbQ/4RDL9AVDjD11GnueJOse0e5Uf8RudpRbrZfRKj31CIX5bNHk6jURCocVkSrFeuW4uJizGazwWKwYDIXMpLXRU44zuKOBMt5fSwJx8iYTiPUeup4KL8AUZLYpUrodhHFrqLY7Cg2G7KsGEX/y2KxMJoXYE3oZeGBBEs7EiwIx0gXvo3wWjzG4YPP0tnaQuvhQ7S1HKK9tYX2jg46Ojro3NDZua27s4uW7ja+9A7yZ/nH3Cwb4XbFh9za/QF3nk4hrN27z8rd+6R/35S59xfpX/8gnV5lNZ1mJZ0mvSWTyRiy2Swr2TSL2RWW1lYNC5llMrk1BP+732Dpncbefwlb3zS2gRnU0CAVTgm3046uKtjtKqrqwOFwGmw2G4qsYJMVI+02O+YiM3WeOoT9w7PsGrhK1ZkZKk9d47Fz87ii76M6NSp3aXjKXewtc/NI6W50vYSSEjdOpxNVVXE4HIaNtyiK+Hw+hAPDs5QOXsFzbobqs1+zb2gOPT6CquloTgePl+k07dGpf1inpsJNaYkLzeVC0zSj0AbNpSHJEg2NDQiN781R1HsZpf8Kct9l5JOzKMFTiBYzxaKEqkg8qitoDgcl7n+73BjVailGLLYiWSUK8guoqa5B+OLHdc5/myY5lyU5lyF5fZ3kte8Zu3CBsbEkE+NJLk6OMzExwcTEJKlUyjD5eYrJqU2pqU8Z/+wTpq9+hfDS8+08U19F834vfq+Hpg0+L01NTdsa/X78/2jy0+Dx0TYeInz3dQI/xzmSe4XuXIw3bg0iNDY2stclUlvmRC9xb/6dS9/eqMulI8sysiRt5paqET9PLndw8HqA1p9epH7+OdoXjyLsq66maOeDlDusuBWzQbQUIUoyVlHEKkrG2ZlMJgoLCw2mnSYqhjz4Vprxf9fMgR9aqZp/gpbFMEIi0U84HCYe7SEe6eHVaA+xSIRYLE4sFjNEo1EikYiR0ViUyMs9HL80wMnfhngrd5YTv7xD4sYZhm+f52+FNmG0G0UmOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image14\"\n        title=\"image14\"\n        src=\"/static/a691b277867ef619f7f6eca1b0cdc3b3/37523/image14.png\"\n        srcset=\"/static/a691b277867ef619f7f6eca1b0cdc3b3/e9ff0/image14.png 180w,\n/static/a691b277867ef619f7f6eca1b0cdc3b3/f21e7/image14.png 360w,\n/static/a691b277867ef619f7f6eca1b0cdc3b3/37523/image14.png 720w,\n/static/a691b277867ef619f7f6eca1b0cdc3b3/302a4/image14.png 1080w,\n/static/a691b277867ef619f7f6eca1b0cdc3b3/07a9c/image14.png 1440w,\n/static/a691b277867ef619f7f6eca1b0cdc3b3/7be33/image14.png 1558w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>RBAC를 사용하여 secret에는 최소한의 접근 권한만 부여하기</li>\n<li>secret을 ETCD에 저장하지 않고 클라우드 환경에서는 AWS Provider, Azure provider에 별도 저장하기</li>\n<li>Encrypting secret data at rest : secret 데이터를 etcd에 암호화해서 저장하는 방법 ( <a href=\"https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/\">https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/</a> )\n<ul>\n<li>EncryptionConfiguration object</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"gvisor\" style=\"position:relative;\"><a href=\"#gvisor\" aria-label=\"gvisor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gVisor</h3>\n<p>Seccomp, AppArmor 와 함께 container sandboxing을 위해 쓰이는 솔루션이다. syscall과 Linux kernel 사이에 gVisor를 두어 container sandboxing을 강화한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC2klEQVQ4y02TXW8bRRSGfcE1P4b7ij8AN6jQVrmoKAKBEJUACQmo+GpF6jZJEyQchbYqqKVqJFT6kcRVm6SR2nwYN4mUqCiJW+IE2etsdm3vzs7srm3yoJn1Wrl49syZec97ZndnMuVyGcuyqFarBj1OqGLt2Vh1ieWKJDp+Mt/TWL1aHXd2dsjoJAgCfN83CCEQOqqYwHqByn+FnO1HPvgStXTZzItUJ0SvTkpJpVIhox96otls4nleImg28KMDxMYs6swryJ9fQ559FTV2BD/s4HsNfN8zeo2u1XU9w7RT2lUIHyFDhFMhfPYb9vwVGotjyM2HBCpK1j0vQZvpKERiePiVU0OTC8FBK2Zwdp++Gy85Nb5LqdamJX18KQkA0ekgAE8qAiHMtzSG+v1TIz02KGW6n5r5lddvj3DkzyEGVu+hVJvd53+z/sVpnv9whrVPP+LfuRmCuEVV71D/nUBKsyMRSALdTSpj2Gg0+WzlCicWBjm2dJFvV29h7XlsFYusvHucwscfUOx7i+38JEGrjZUatiPFf7HiIA45aGkiaEfQCvnw+jp9V1c5OrbCuYkSdAJaWg+4UYsOEMchsZJULYuMa9d4+KLJpcI+o8sOuWcOueWE0WWX9+9v8969fzh55yWn87tcXq0nmr9sfirskSvaDBdsliuCul0j07BrDBY93rjrcGLK4Z3JhGOTDm9POHz+pMnXCx7fLHl8Mtfg6ESylmqOTzm8edfhj02B79TIuPs2i6Uq159uMF4oMb601aVk8t8XNrkxv2G4ubjV1SS6W12tXtuoOGivjFuvc//Obc6f/Y7hgSyXLvR3Oc9Q9kdyI0Nc+2WUq2M5RgYuMJTtP6TpZ/hiluy57yksLpgDnnFdl7W1dabyeR5Nz/BoerobEx7PzfHk6bxhZvbxobXpnnYq/4Dtcpm66ybnML2LmjAMe0RRZEjzOI4Nh+eUUgZ9BfWJ+R9KUsy5SuU6kgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image15\"\n        title=\"image15\"\n        src=\"/static/7aaedaf31ed5669ac5004df2aac74768/37523/image15.png\"\n        srcset=\"/static/7aaedaf31ed5669ac5004df2aac74768/e9ff0/image15.png 180w,\n/static/7aaedaf31ed5669ac5004df2aac74768/f21e7/image15.png 360w,\n/static/7aaedaf31ed5669ac5004df2aac74768/37523/image15.png 720w,\n/static/7aaedaf31ed5669ac5004df2aac74768/302a4/image15.png 1080w,\n/static/7aaedaf31ed5669ac5004df2aac74768/07a9c/image15.png 1440w,\n/static/7aaedaf31ed5669ac5004df2aac74768/5dded/image15.png 1588w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\ngVisor는 2개의 컴포넌트로 이루어진다.</p>\n<ul>\n<li>Sentry\n<ul>\n<li>독립적인 application 레벨의 커널이며 linux kernel에 비해 훨씬 적은 function을 가지기 때문에 활용할 수 있는 container 앱이 활용할 수 있는 syscall의 개수도 줄어든다.</li>\n</ul>\n</li>\n<li>Gofer\n<ul>\n<li>Sentry는 직접적으로 linux kernel에 파일에 대한 요청을 하지 못하고 Gofer를 활용한다. Gofer을 Linux kernel에 대한 file proxy이다.</li>\n</ul>\n</li>\n<li>gVisor network stack\n<ul>\n<li>Gofer와 마찬가지로 gVisor는 network stack을 proxy로 제공하여 app이 직접 Linux kernel의 network code를 건들지 않도록 한다.</li>\n</ul>\n</li>\n<li>gVisor 활용 시의 단점 : 모든 app이 gVisor 기반으로 동작하지는 않는다, 더 많은 instruction을 수행해야 하므로 app이 살짝 느려질 수 있다.</li>\n</ul>\n<h3 id=\"kata-container\" style=\"position:relative;\"><a href=\"#kata-container\" aria-label=\"kata container permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kata container</h3>\n<p>gVisor와 달리 가벼운 kernel을 컨테이너에 포함시킴으로써 sandboxing을 하는 방법이지만 일반적인 컨테이너 앱에 비해 더 많은 리소스를 필요로 한다.</p>\n<h3 id=\"runtime-classes\" style=\"position:relative;\"><a href=\"#runtime-classes\" aria-label=\"runtime classes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Runtime classes</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACPklEQVQoz1WR20tUURSH51/rqZcgeimol3yLogKzsOwCWUFBUClBWZhCkNJFozQLMwTDyrExnfJMZU5q3mbO3vvs2zmj+cUZcaqHj7X32vCtH3tlbt1vo6nxJKcPHqfpUAPnjpyk8UA9x+rryWazxHGMlJIoimoIKUiSCgOvBzh1uIHmhjNcPHGOs0cbySyKFQo978nuaGOs7j7ZPR3k9nZSDGYIpUBrXZVs1SpSYdY9P3s/MrbtJuO7OxjfeZfs9ltkzO+Y1aFvfN/1gOn9vXzd94TZuqfYssZ6WxUZY2qk96o8rSrCKc2vYAm5LNChIiOVoDxTZHn4E/MDoywNvqc0+pmotIq1Fmcdzv0l7aVsJTbOUAx+EZYFSqdCISjnevG5TpJcB2sT7ZgPt1GFEXyyjncO7/1/bImNNlhr+BksIsqCKFJkQiEJQ8HbYIGHH2boGZ8lmC9tpvO+upSUJElq53+lzlvmCqlQEumIjJCKkpS8/jJPz0SRx7kik6kwTRPHVCqVvyRJjTjelPrYM1dYQgq1KVQqohxKjIwIVxRGWpx2RNrhnUcrg4ks3sXVAZF1hJHBpG/aopVmcXaV0mK5mjKjlEIJxUjXJP0t7+i7/o7g7RwbG2sMv8hz79ogHTeGGH4+RbAsuPIqz9XBPK1vppHaMP4soL91lL6WUXIvC2Ri75gq/KC5rYvW7j4utz/iwu0uFpZLVOIKVnuc8SQ+obK2hvUx2rrqF4zlv3K+rZvW7n4u3e3m7J1H/AGwqcfjX6lpvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image16\"\n        title=\"image16\"\n        src=\"/static/9b0cf7f1d3c0fdf8c9535fa5bda72e01/37523/image16.png\"\n        srcset=\"/static/9b0cf7f1d3c0fdf8c9535fa5bda72e01/e9ff0/image16.png 180w,\n/static/9b0cf7f1d3c0fdf8c9535fa5bda72e01/f21e7/image16.png 360w,\n/static/9b0cf7f1d3c0fdf8c9535fa5bda72e01/37523/image16.png 720w,\n/static/9b0cf7f1d3c0fdf8c9535fa5bda72e01/302a4/image16.png 1080w,\n/static/9b0cf7f1d3c0fdf8c9535fa5bda72e01/07a9c/image16.png 1440w,\n/static/9b0cf7f1d3c0fdf8c9535fa5bda72e01/daf70/image16.png 2464w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>아래와 같이 runtimeclass 생성가\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: node.k8s.io/v1\nkind: RuntimeClass\nmetadata:\n    name: secure-runtime\nhandler: runsc</code></pre></div>\n</li>\n<li>그리고 아래와 같이 pod에 적용 가능\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: v1\nkind: Pod\nmetadata:\n    name: simple-webapp-1\n    labels:\n        name: simple-webapp\nspec:\n  runtimeClassName: secure-runtime\n  containers:\n    - name: simple-webapp\n      image: kodekloud/webapp-delayed-start\n      ports:\n        - containerPort: 8080</code></pre></div>\n</li>\n</ul>\n<h3 id=\"mutual-sslmtls\" style=\"position:relative;\"><a href=\"#mutual-sslmtls\" aria-label=\"mutual sslmtls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mutual SSL(mTLS)</h3>\n<p><img src=\"./image17.png\" alt=\"image17\"></p>\n<h4 id=\"pod-간의-통신의-보안에서-사용되는-mtls\" style=\"position:relative;\"><a href=\"#pod-%EA%B0%84%EC%9D%98-%ED%86%B5%EC%8B%A0%EC%9D%98-%EB%B3%B4%EC%95%88%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%EB%90%98%EB%8A%94-mtls\" aria-label=\"pod 간의 통신의 보안에서 사용되는 mtls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pod 간의 통신의 보안에서 사용되는 mTLS</h4>\n<ul>\n<li>istio\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVQoz42PzWoUQRRG6w18A5/EV3Dv3n0ewAERXLgRjGhwbdCF4Ca6CYouEnARkoASo0awmWnU6a5013/1Tyae0KUDZkbFxaHgUt+53xWVUjgTOA2nWOPQxmCt/S/mf+kCwVkqpRGFtGx9ecft3Ue8zTOK43nApdc5d47fhbLW7GdTRs8PePk+p6xqRFbkXH5yn4t3b3B1Yx2pdJJ57xMhhCWGubGOWluuPNznwrUXXFrd5uhriTj8ljF6/YDR5hp3dh6TlxLz65TFdosts6nk+tNtVta3GD074HBSIJTyvBnvcGvvHh/Lz1TK47wnhkCM8Y/Mm+aV4tP4iJsbe7z68D0VEUWlOIktP9oZfdsxVYYYG9q2/SexaSi1o+96mHXM2sDgEsdKY6xlIuu0vdSWpvkp7LpuibmwadokbJvIRGq0dQwuMa00tXGMS431gULbv8oWxYV2+BBTdnAUtUZIZSiVpbYeaTzGx3PBvu+XSPOuw4WYMmrIaodUljMSW6A62SchKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image18\"\n        title=\"image18\"\n        src=\"/static/1dad1d455c54514edfdb9c05f9652c46/37523/image18.png\"\n        srcset=\"/static/1dad1d455c54514edfdb9c05f9652c46/e9ff0/image18.png 180w,\n/static/1dad1d455c54514edfdb9c05f9652c46/f21e7/image18.png 360w,\n/static/1dad1d455c54514edfdb9c05f9652c46/37523/image18.png 720w,\n/static/1dad1d455c54514edfdb9c05f9652c46/302a4/image18.png 1080w,\n/static/1dad1d455c54514edfdb9c05f9652c46/07a9c/image18.png 1440w,\n/static/1dad1d455c54514edfdb9c05f9652c46/80cfc/image18.png 1844w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<ul>\n<li>sidecar에서 encrypt해서 메시지를 다른 pod로 보내고 받는 pod에서도 istio sidecar에서 decrypt해서 application container로 메시지 전달</li>\n<li>permissive / opportunistic 모드 : istio sidecar 컨테이너가 없는 외부 앱의 Plain text 통신도 허용</li>\n<li>enforced / strict 모드 : mTLS 통신 만을 허용</li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"October 15, 2023","title":"[CKS] Microservice 취약성","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks5/"}},"prev":{"id":"ef53088b-f9cf-5722-8183-1a6391e2a5e5","html":"<h3 id=\"base-image-footpring-최소화하기\" style=\"position:relative;\"><a href=\"#base-image-footpring-%EC%B5%9C%EC%86%8C%ED%99%94%ED%95%98%EA%B8%B0\" aria-label=\"base image footpring 최소화하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Base image footpring 최소화하기</h3>\n<ul>\n<li>base image란 무엇인가? dockerfile의 <code class=\"language-text\">FROM</code> 절에서 명시하는 이미지는 parent 이미지이다. 가령 아래 예시에서 보는 것처럼 httpd 이미지는 debian이라는 이미지를 parent로 가진다. 그리고 debian 이미지는 <code class=\"language-text\">FROM scratch</code> 로 부터 생성되는데, 이렇게 scratch로 부터 생성되는 이미지를 base 이미지라고 하는데, parent 이미지라는 의미로 혼용되기도 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACj0lEQVQoz4WSW0tUURiG929S8ELEs3kospk9mjqKlEnEiJOmUkGQZXdKmWWamlrjMJVTeddNgdWdN4lTIHTQ0dTZe88+zklNn5hFBnXTgoe1btbD+718km7ofFh8z+TYOLNT00xPTDEz+Ui8J8YfMjc3R2QlwvLyMtFoFF3X0TTtL1T16FaRVC3O7N1hPCUFNNU1IJ+o5fixKipLyikvKqWwsJCKigry8/MJhUJkMhnxOR6PC45EiqKgKgqSYzm8fvmSm9euMHBrgBv9/fRf7+fq5Sv09fX9obOzkzdv3pJOp0VKwzCI63FUTWV7Z5u16Jq4JV3V+PrlGx9XVljJEokQ+fSJRDLBvyebzjJNLMvCMEy2YhsomsJ2TOVbdJ0dRUVKJVK8ehyks+0MvRcv0eXzC0ZvjzAxOsbQ0BDDd4YZHBxkaWlJSG3bFik3N38Qj+2gb66jf19D21hD0uI60/fvUVtWive0l0ZPPfWnZFzZLqtqqK6uFuTk5BAKPeXw8FAkdGwLJ/MT5/M7koHzJOZ7STztQko6KaZGhnFXFuBtasDb3Iy32UtjUxMutwu3201NTQ15eXnMP58Xo2cTOo6DbTtYpo6pbmMoW+ixH0i76QxPZmZpbqyn7ewZ2trO0d7eTmtrKy0tLfj9fnp6evD5OlhcXBTCRCIhEFLHwbIdDMtGN0ykdDLNi+AzfOcvcMnfzcUOPz6fT9Dd1U0gECAcDhMMBlldXeXg4IBUKiU4kmYrME1T9Crt7u7xeHSMkyWFNMh1nKw6TmX5McrKygTFxcWC3NxcwvNhkTAry65PMpn8PbothNlVkvb295l8+IDK0iI8njpktxvZLYvuZFnG4/HgcrnEgi8sLPxX+AvWCKLPlKLDXwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/b5a20678429702cc3b1acaaf391979d6/37523/image1.png\"\n        srcset=\"/static/b5a20678429702cc3b1acaaf391979d6/e9ff0/image1.png 180w,\n/static/b5a20678429702cc3b1acaaf391979d6/f21e7/image1.png 360w,\n/static/b5a20678429702cc3b1acaaf391979d6/37523/image1.png 720w,\n/static/b5a20678429702cc3b1acaaf391979d6/302a4/image1.png 1080w,\n/static/b5a20678429702cc3b1acaaf391979d6/07a9c/image1.png 1440w,\n/static/b5a20678429702cc3b1acaaf391979d6/ad1ae/image1.png 2270w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Modularize : 각각의 이미지는 여러 기능을 하지않고 1개의 주요 역할만 하도록 모듈화되어야 한다.</li>\n<li>Persist state : 데이터/state을 컨테이너내에 보관하지 않는다.</li>\n<li>‘Official image’ 사용하기</li>\n<li>이미지를 최소화하기\n<ul>\n<li>yum, wget, curl 과 같이 공격자가 활용할 수 있는 명령어들을 image에 포함시키지 않아야 한다.</li>\n<li>production 이미지와 dev/stg 이미지는 분리되어야 한다.</li>\n<li>결국, 이미지에는 application + runtime dependency만 존재해야 한다.</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"vulnerability-scanning\" style=\"position:relative;\"><a href=\"#vulnerability-scanning\" aria-label=\"vulnerability scanning permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability scanning</h4>\n<ul>\n<li>trivy 툴을 활용해서 이미지의 vulnerability를 측정할 수 있다.</li>\n<li>alpine과 같이 image 내에 패키지가 적은 것은 vulnerability가 매우 적게 측정된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">trivy image httpd # 124개 취약점 존재\ntrivy image httpd:alpine # 0개 취약점 존재 </code></pre></div>\n<h3 id=\"image-보안\" style=\"position:relative;\"><a href=\"#image-%EB%B3%B4%EC%95%88\" aria-label=\"image 보안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>image 보안</h3>\n<ul>\n<li>image 이름 규칙</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNElEQVQoz11Sy46DMAzk//9rD9tbhUor9SFUIATEq4QklKqa1ZimXfUwjGM7Yxsn6mqFTmfoawUzDmjaFnVdQ+sKbdtiGAZ0XSe+sixRVZUwkec5lFLim6YJ4zgiqtM9ivgHZfKLsatRKIU0TXG5XJBlGZqmeQtprd9CtMlFkaPUWgSNMYgm52HnBdbPcM4LxPYzLG05+4/tPO73O+Z5jRvrYKz9CBozgrB2gnNOYK0V4ck5uei9F2aRz9nDs/DrbF+iET+rwCrGIPlwOCDZ7WTEx+Mh1ZMkQXa9YlkWyTkej9hsNpITREXwvxjHIegn6Hs+n7IgFjmfzyLIZW23W8RxjNPp9L4fhe7CWNwUuwlbI263m1QPYwV/yGW87/u1w+/uWJkJZHbFJ/MNxhnj5skB/Id/D+JgDTgWT7AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/0dde4d9803111fc4bdc455ea132c9b96/37523/image2.png\"\n        srcset=\"/static/0dde4d9803111fc4bdc455ea132c9b96/e9ff0/image2.png 180w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/f21e7/image2.png 360w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/37523/image2.png 720w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/302a4/image2.png 1080w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/07a9c/image2.png 1440w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/ddc6c/image2.png 1534w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>private registry\n<ul>\n<li>‘docker-registry’ 타입의 secret으로 private registry에 대한 credential 정보를 보관.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4klEQVQoz32R22oaURSG50XsxVjq1NFmMqlECmmrQ0Kv+wzpjVc+gga8EWdGSLRaj6WOh9ImUC+KpxtlWkHqe6QXOup4Pvxl7xygoXTBx1p7bfbiX/9mvny/ROwihmQyiUQiQUmn04hGo+h0OiCx2WxgmiZSifc4jyqIXZxD13+g3/+FXq/3F8zPfhe1Wg31eh3NZpPSarXQaDTQbrfR7XYpuq7jzZELov0xbDYbheO425q77zHfalWkPqSQyWSQzWaRy+XuyefztEfuCpqGt8dHeHXgwIEowul8BrvdDp7nab6DWcwWWK/XdC3CdrvFbrfDw5iYJqTXLyG5HHhx6IKwvw9BELC3J0AQbmoCMxgMQBgOhzCGBkajEcbjMWUymVDm8zmur3/j8LkIN/cIIs/B+fQJWNYKlmVhtVop5MwsFjcK71T+Sx2J1WqFq6tLVMolVCqfUS6XUSqVUCwWoWkaCoUChfn49RNCoRBkWYYciUCOyJBlBaqiQlVVKIqCYDBIP+l/QYQQu5jTd6fgeQdOjk/g8XggSRIkrwSv1wuPxwu32w2LxYJwOEwfTqdTasFsNqM1sYTYYxgGhYnH4/D7/QgGzxAIBChntzVRTrLP50O1WqUDl8slXZ9kYtfDwX8AtbsMfVNpFC8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/b71e38be4e50ee55a8731dc5d2b0a732/37523/image3.png\"\n        srcset=\"/static/b71e38be4e50ee55a8731dc5d2b0a732/e9ff0/image3.png 180w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/f21e7/image3.png 360w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/37523/image3.png 720w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/302a4/image3.png 1080w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/07a9c/image3.png 1440w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/fc477/image3.png 2426w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"registry에-대한-whitelist-등록하기\" style=\"position:relative;\"><a href=\"#registry%EC%97%90-%EB%8C%80%ED%95%9C-whitelist-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0\" aria-label=\"registry에 대한 whitelist 등록하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Registry에 대한 whitelist 등록하기</h4>\n<ul>\n<li>앞서 보았듯, ValidatingAdmissionWebhook을 webhook 서버 또는 OPA와 연동하여 registry 이름에 대한 검증을 할 수 있었다.</li>\n<li>여기서는 ImagePolicyWebhook을 사용하는 방법을 추가로 알아본다.</li>\n<li><code class=\"language-text\">/etc/kuberenetes/admission-config.yaml</code> 경로에 아래와 같이 AdmissionConfiguration 파일을 생성하여 ImagePolicyWebhook plugin을 명시하고, kubeconfig 에 대한 경로를 작성해줘야 한다. 그리고 kubeconfig 파일에서는 registry를 검증해주는 api 서버에 대한 정보와 인증서 정보를 포함한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVQY0yXQS47aQBSFYS+Lhx9FvcvgssF00y1QsoBAoigSCbQSKcNmB20YM2CTfwsz+CZHutI5N/mx+8bP71t2ux3b7ZbT6cTlcqH7+ODcdQ/nM13X8f/fX477Xxz//Ob49sbhcGC/3/P+fuJ2u3G9XklcMaRWI4zRCCEQoiDPM8REkKYpWZ4xHA4ZDAa0fkI0GdYanA/48KC1ZjweMxqPSCaTCa0vWARJXVoWU0sz88S6ppk31E1DFSu0MbQx8FQKmjilmpX4siSUoS9SFEUvcUrgtUArhbEOYy3OO4wxPW00VhucNpQ+8GQLvpYFqyAJSva5N7YXrCMJMqUyeX9stcRoiVKKvLhPz3tZmiJzgTUOLzKeXco8aII1KCnRUj0KKU1SzWZsFtPeyyKyXrW8vr6w3mx4Xq1YLpeP6XVNbBrq0vClsawbTzuPVDH2/78vu5f6BEiI6pt1OEagAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/0253b7967bc1799559a35eb29c47054a/37523/image4.png\"\n        srcset=\"/static/0253b7967bc1799559a35eb29c47054a/e9ff0/image4.png 180w,\n/static/0253b7967bc1799559a35eb29c47054a/f21e7/image4.png 360w,\n/static/0253b7967bc1799559a35eb29c47054a/37523/image4.png 720w,\n/static/0253b7967bc1799559a35eb29c47054a/302a4/image4.png 1080w,\n/static/0253b7967bc1799559a35eb29c47054a/07a9c/image4.png 1440w,\n/static/0253b7967bc1799559a35eb29c47054a/20a65/image4.png 2490w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>그리고 kube-apiserver에서 아래와 같이 설정해줘야 한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVQoz22PzYsSARTABxETylaQKWnze3RmnNFx/G6LdqFD9Y9IoOKyFy8Kay4k2y2ctbsfYKx1aLuLXjy2t+0Piehj+8UMbRT04Pfeu7zfe0/odDp0u13a7TaWZbHZbFiv16xWK6cul0s+np/z4eyM+rMaB/v7NJpNmr9pNBrU63VqtRqtVgshlUohyzKqqpJMJgmHI4iiiMfjcRAEATNf4PXwFff1KEVDR1VkFFnGnr2at1EUBcFOtsyuwWAQj+eaI/kbXc9gDYfsGhKPdvLs3itTrVTQMxk0TfsHQUkrZI0syVSSO9vb+Hw+vF4vLpfLwRYahsGJZVHVJfbKWTRdJ61pqGmVdDqNZnMllMISSlwhfjdG6HYIMSASCAScd91utyPMm3mGQ4tUQuJh9QHV0g7lQoWiWaKQKzqX2mIb4WbBjy+3xXXjBoGCiBi6hX/L/0dmI0kSI+uEiBYj+6SA+biI+bSEYfd7RUrFCjnTxDByCL1Zn97kuUN/ekR/dMTgxYDj45cMBgMOD3tMJhMsa0Qw5CdZihI240TMGOF8lFhWQpFVUrJMIiEh/Pj8ncsvl/AV+Ab85L9xcfGJ09mU96dvWbx5x2K+YD6dM5vMmE6nztLxeMwvwTk3QlhCsN4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/daa78a4d67226b238d52a14e145d2bca/37523/image5.png\"\n        srcset=\"/static/daa78a4d67226b238d52a14e145d2bca/e9ff0/image5.png 180w,\n/static/daa78a4d67226b238d52a14e145d2bca/f21e7/image5.png 360w,\n/static/daa78a4d67226b238d52a14e145d2bca/37523/image5.png 720w,\n/static/daa78a4d67226b238d52a14e145d2bca/302a4/image5.png 1080w,\n/static/daa78a4d67226b238d52a14e145d2bca/07a9c/image5.png 1440w,\n/static/daa78a4d67226b238d52a14e145d2bca/92a6b/image5.png 2334w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li><code class=\"language-text\">k describe po &lt;pod-name> | grep --registry-whitelist</code> 명령을 하면</li>\n</ul>\n<h3 id=\"kubesec을-활용한-resource-definition-정적-분석\" style=\"position:relative;\"><a href=\"#kubesec%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-resource-definition-%EC%A0%95%EC%A0%81-%EB%B6%84%EC%84%9D\" aria-label=\"kubesec을 활용한 resource definition 정적 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubesec을 활용한 resource-definition 정적 분석</h3>\n<ul>\n<li><code class=\"language-text\">kubesec scan pod.yaml</code> 과 같이 하여 report를 받아볼 수 있다.</li>\n<li>문제\n<ul>\n<li><code class=\"language-text\">/root/node.yaml</code>를 스캔하고 그 결과를 <code class=\"language-text\">/root/kubesec_report.json</code> 에 저장하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  kubesec scan /root/node.yaml > /root/kubesec_report.json</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"image-scan\" style=\"position:relative;\"><a href=\"#image-scan\" aria-label=\"image scan permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image scan</h3>\n<ul>\n<li>CVE ( Common vulnerability and exposures ) : 알려져있는 보안 취약점들을 CVE에서 등록하고 관리한다.\n<ul>\n<li>CVE serverity scores\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACVElEQVQoz3WRPWjUcBjGM+rk2MlNRxdBBydBkS4VcVGhIArqUHGwuAgKImgdBBEEBxEUpRRErNVSlCJFtO31Wkux9uPS9preJZdcvj8uubvc/eQfabkOvvDkn+R98jzv80aaXv3N96U8U8t5ZlZmmFudYaGQY7GQY0WeRpan2FibRFn/gSL/RFmdQlnKoSzm2VyYpfhrjuLsPBu5Bdbyf5DOD/Vx8tVRLr49Qv/gIQaGDvLy3X5G3ncx+WEf8sge/FGJ9JNEOriX9HkX6aMDNG8fptF3nKS3h9rpXuJjV9novo90b+wx/cNXefD5Gs9GL/FmrJePX84x8fUs8+M9rH/rpjpxAnv8FNbwGazBC5gvLmM+vY7x8Bb6nbtoNweoXHnC8o3XSKpawdAtDMOmWnVQNRPLCdGrbnZWrQBVd6g6EeWKjelG6LaH4fiUDQvNtFEqOppts761hWTbNq7j4PseURSSxDFhEOy88zyXehJnaNQTAt/D9zw818nOJK4RhQGe6+LYNpLjOAhEUUSbNo1GHdOssrlZZLNYRJYLhGFAq9UiSWIqmkqpVEIuFDJOkiS00hRXCDoOkrgRqNVqiDIMHcuyiOMYXdcxTZNyuUQYhiiKgu/72WSGYWR9raKRpime52U6uwTFFNslnDtLrENwms0mQRDs6onvhJEQlcRFQAjU6/UsRi2KsqlEhO0SHE1TiWs1VFX9Z9hu0263/y+Ypk0sy9yJ0DmJWLqqljNTYdaZQAgK7o6gUO+MLFw7yeJZRBU/TpgJbqPZyHoC22sQOn8BXsIXcyvPAmcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/fdb70620644711278fedc05d76554eae/37523/image6.png\"\n        srcset=\"/static/fdb70620644711278fedc05d76554eae/e9ff0/image6.png 180w,\n/static/fdb70620644711278fedc05d76554eae/f21e7/image6.png 360w,\n/static/fdb70620644711278fedc05d76554eae/37523/image6.png 720w,\n/static/fdb70620644711278fedc05d76554eae/302a4/image6.png 1080w,\n/static/fdb70620644711278fedc05d76554eae/07a9c/image6.png 1440w,\n/static/fdb70620644711278fedc05d76554eae/09262/image6.png 1896w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>CVE Scanner : Trivy</li>\n</ul>\n</li>\n<li>Trivy\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">trivy image nginx:1.18.0\ntrivy image --serverity CRITICAL,HIGH nginx:1.18.0 # CRITICAL, HIGH 구분의 CVE만 조회 \ntrivy image --ignore-unfixed nginx:1.18.0 # s/w package upgrade 로 해결할 수 있는 CVE만 조회</code></pre></div>\n<ul>\n<li>Docker save 명령으로 저장된 .tar 파일도 검증할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">trivy image --input archive.tar</code></pre></div>\n<ul>\n<li>문제\n<ul>\n<li><code class=\"language-text\">python:3.10.0a4-alpine</code> image를 pull받은 후에 trivy로 해당 이미지를 스캔하고 그 결과를 <code class=\"language-text\">/root/python_alpine.txt</code> 에 저장하라\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  crictl pull python:3.10.0a4-alpine\n  trivy image --output /root/python_alpine.txt python:3.10.0a4-alpine</code></pre></div>\n</li>\n<li><code class=\"language-text\">python:3.6.12-alpine3.11</code> image를 스캔하고 HIGH vulnerability에 대한 결과만 <code class=\"language-text\">/root/python.txt</code>에 저장하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  trivy image --severity HIGH --output /root/python.txt </code></pre></div>\n</li>\n<li>trivy image —input /root/alpine.tar —format json —output /root/alpine.json</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"best-practice\" style=\"position:relative;\"><a href=\"#best-practice\" aria-label=\"best practice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Best practice</h4>\n<ul>\n<li>추가적인 vulnerability가 report될 수 있으므로 지속적으로 image를 스캔하기</li>\n<li>admission controller를 활용하여 deploy될 때 scan단계를 추가하기</li>\n<li>하지만 deploy 속도에 영향이 있을 수 있으므로 별도의 image repository를 활용하여 pre-scanned image만 사용하도록 하기</li>\n<li>CI/CD 단계에서 image scan 단계 추가하기</li>\n</ul>","frontmatter":{"date":"October 31, 2023","title":"[CKS] Supply chain 보안","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks6/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/etl1/","nextSlug":"/cks5/","prevSlug":"/cks6/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}