{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/jpa2/",
    "result": {"data":{"cur":{"id":"cf7c4b45-6af5-5d3a-8a18-4dfd633f5624","html":"<h2 id=\"jpa-구동-방식\" style=\"position:relative;\"><a href=\"#jpa-%EA%B5%AC%EB%8F%99-%EB%B0%A9%EC%8B%9D\" aria-label=\"jpa 구동 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPA 구동 방식</h2>\n<p><strong>JPA는 아래와 같은 방식을 통해 동작한다.</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQoz42TW4+CQAyF+f//jDdfDEEB0SAIKN7AC4jdfN3MZMK6m52kmTLtnJ7TKd77/ZbX6yXjOKrhczZd0zw3HzM5Xt/3Upal7HY7u5/PZ+H8eDzK4XCQYRg0VlWV5HkuRVHoN35d19I0jTyfTwX1cABZr9eSpqnuXOy6Tvb7vcau16ueA0ROHMcSRZH6WZYp6OPx+AY0Uu73u140sj5Jhin77XazAJyZcwUEAEZBEMhqtZLNZqNSDIgxdyERhm3b/ijqGYeKMMQ3DF0g16dN9PZT3KPK5XJRZvSJ6gDzKC5LFn3lwejZdrvVe6fTSSVbhgTDMBTf92U2m8l8PlfJXHYr0xpYJUmi+bRouVzqowFqAWFDIiMCO4L4blUDSpzcxWKhBjBMmQYrWf5YJsmVjCIUwBSGjA2FeHk7Nr/ZlCGPRd/MfGLMJoB2DuWfywWd/oLur/cFY5yf+g3mBGIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1.png\"\n        title=\"image1.png\"\n        src=\"/static/809af4da9a8eb1ff0b1bdee779887e14/37523/image1.png\"\n        srcset=\"/static/809af4da9a8eb1ff0b1bdee779887e14/e9ff0/image1.png 180w,\n/static/809af4da9a8eb1ff0b1bdee779887e14/f21e7/image1.png 360w,\n/static/809af4da9a8eb1ff0b1bdee779887e14/37523/image1.png 720w,\n/static/809af4da9a8eb1ff0b1bdee779887e14/612f7/image1.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>EntityMangerFactory는 하나만 사용해서 앱 전체에서 공유해서 사용하며</p>\n<p>EntityManager는 thread간에 공유해서는 안된다.</p>\n<p><strong>그리고 JPA의 모든 데이터 변경은 트랜잭션 안에서 실행해야 한다.</strong></p>\n<p>​\n<br>\n순수 JPA만 설정했을 때 어떤 식으로 프로그래밍을 하게 되는 지 아래 코드를 통해서 살펴보자.</p>\n<p>EntityManagerFactory를 생성하고, 이를 통해 EntityManager도 생성한다.</p>\n<p>JPA의 모든 데이터 변경은 트랜잭션 안에서 실행되야 하기 때문에 EntityTransaction 객체를 생성하여 tranasaction의 begin, end를 관리해주어야 한다.</p>\n<p>​<br>\n아래 코드에서 순수 Jpa 프로그래밍을 어떻게 하는 지 알 수 있다.</p>\n<p>특히 jpa에서 제공하는 수정 기능을 보면 jpa를 사용하면 정말 객체지향적으로 프로그래밍할 수 있음을 알 수 있다.</p>\n<p>setName 메소드를 통해서 Entity객체를 수정했을 뿐인데, jpa가 entity가 변경됐는지를 transaction commit할 때 체크해서 변경됐으면 알아서 update문 날려준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> hellojpa <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">EntityManagerFactory</span> emf <span class=\"token operator\">=</span> <span class=\"token class-name\">Persistence</span><span class=\"token punctuation\">.</span><span class=\"token function\">createEntityManagerFactory</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">EntityManager</span> em <span class=\"token operator\">=</span> emf<span class=\"token punctuation\">.</span><span class=\"token function\">createEntityManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">EntityTransaction</span> tx <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//생성</span>\n            <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            member<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token number\">2L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            member<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            em<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//실제는 이 4줄만 작성해주면 됨 나머지는 spring이 해줌.</span>\n\n            <span class=\"token comment\">//수정</span>\n            <span class=\"token class-name\">Member</span> findMember <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            findMember<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Steady and Slow\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">/</span>자바 컬렉션처럼<span class=\"token punctuation\">.</span> 별도의 jpa 메소드 호출<span class=\"token class-name\">X</span>\n\n            tx<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            tx<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            em<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        emf<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2 id=\"jpql\" style=\"position:relative;\"><a href=\"#jpql\" aria-label=\"jpql permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPQL</h2>\n<p>객체를 대상으로 하는 객체지향 쿼리 언어이며, JPA의 자체 문법을 따르고 각 DB에 맞게 dialect만 설정 변경해주면 JPA가 알아서 각 DB에 맞게 SQL을 생성하여 실행시켜 준다.</p>\n<p>JPA를 사용하면 엔티티 객체를 중심으로 개발하게 되는데 검색 쿼리와 같이 SQL을 안 쓸 수는 없는 상황이 있는데 이 때 JPQL을 사용하는 것이다. JPQL이 일반 SQL과 다른 점은 테이블이 아닌 엔티티 객체를 대상으로 쿼리를 날린다는 것이다.</p>\n<p>SQL문법과 유사하여 SELECT, FROM, WHERE,GROUP BY, HAVING, JOIN 등을 지원한다.</p>\n<p>JPQL을 사용하면 아래와 같이 Member 엔티티를 대상으로 한 쿼리를 짤 수 있으며, dialect에 따라 limit을 쓸 것인지 rownum을 쓸 것인지 따위를 jpa가 알아서 SQL을 생성하여 DB에 요청하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">EntityManagerFactory</span> emf <span class=\"token operator\">=</span> <span class=\"token class-name\">Persistence</span><span class=\"token punctuation\">.</span><span class=\"token function\">createEntityManagerFactory</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">EntityManager</span> em <span class=\"token operator\">=</span> emf<span class=\"token punctuation\">.</span><span class=\"token function\">createEntityManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">EntityTransaction</span> tx <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//JPQL</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> result <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">createQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select m from Member as m\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">setFirstResult</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">setMaxResult</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getResultList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            tx<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            tx<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            em<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        emf<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>JPQL을 구체적으로 어떻게 활용해야 하는 지에 대한 내용은 별도로 공부해야 하긴 하지만, SQL을 작성할 줄 아는 개발자라면 배우기 어렵지 않다.</p>\n<hr>\n<p>참고자료</p>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>","excerpt":"JPA 구동 방식 JPA는 아래와 같은 방식을 통해 동작한다.  EntityMangerFactory는 하나만 사용해서 앱 전체에서 공유해서 사용하며 EntityManager는 thread간에 공유해서는 안된다. 그리고 JPA의 모든 데이터 변경은 트랜잭션 안에서 실행해야 한다. ​\n\n순수 JPA만 설정했을 때 어떤 식으로 프로그래밍을 하게 되는 지 아래 코드를 통해서 살펴보자. EntityManagerFactory를 생성하고, 이를 통해 EntityManager도 생성한다. JPA의 모든 데이터 변경은 트랜잭션 안에서 실행되야 하기 때문에 EntityTransaction 객체를 생성하여 tranasaction의 begin, end를 관리해주어야 한다. ​\n아래 코드에서 순수 Jpa 프로그래밍을 어떻게 하는 지 알 수 있다. 특히 jpa에서 제공하는 수정 기능을 보면 jpa를 사용하면 정말 객체지향적으로 프로그래밍할 수 있음을 알 수 있다. setName 메소드를 통해서 Entity…","frontmatter":{"date":"February 25, 2022","title":"[JPA] 2. JPA 구동방식과 JPQL의 개념","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa2/"}},"next":{"id":"1efc6b11-8b4b-513b-8a7e-5acd2c7ee5b3","html":"<p>오늘 날 DB를 사용한다고 할 때 아직까지 대부분은 NoSQL보다는 RDB라고 불리는 관계형 데이터베이스를 사용한다.\n즉, 개발자는 프로그래밍을 할 때 객체를 DB에 저장하는 작업, 반대로 DB를 객체로 불러오는 작업을 반복해야 만 했다.\n개발자가 사실 상 SQL mapper 역할을 했어야만 했다는 것을 말한다.</p>\n<p>실제 국내에서는 수 많은 개발업체들과 SI업계에서는 여전히 Mybatis를 사용하며 SQL에 대부분의 비즈니스 로직이 녹아 있다.</p>\n<p>그렇다면 이러한 SQL 중심적 개발에는 어떤 문제가 있을까?\n쉽게 생각할 수 있는 것은 SQL을 직접 짜는 것이 매우 귀찮은 반복적 작업이라는 것.\n예컨대 필드가 추가 되면 INSERT, UPDATE, SELECT등 모든 SQL에 해당 필드가 들어가야 하는 곳을 찾아서 추가해주어야 할 것이다.</p>\n<p>그러나 무엇보다도 RDB(관계형 데이터베이스)와 OOP(객체지향 프로그래밍)의 패러다임 불일치에서 오는 문제들이다.</p>\n<h2 id=\"패러다임의-불일치\" style=\"position:relative;\"><a href=\"#%ED%8C%A8%EB%9F%AC%EB%8B%A4%EC%9E%84%EC%9D%98-%EB%B6%88%EC%9D%BC%EC%B9%98\" aria-label=\"패러다임의 불일치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>패러다임의 불일치</h2>\n<p>관계형 DB가 나온 사상과 객체가 나온 사상이 다르기 때문에 발생하는 문제이다.</p>\n<h3 id=\"1-상속\" style=\"position:relative;\"><a href=\"#1-%EC%83%81%EC%86%8D\" aria-label=\"1 상속 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 상속</h3>\n<p>RDB와 OOP의 상속의 개념이 다르다. 정확히는 RDB에는 상속 개념이 없다. 유사한 개념이 아래와 같이 있긴하다.</p>\n<p>하지만 데이터를 조회,저장한다고 할 때 처리하는 방식에서 매우 다른 것을 알 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVQY03VR2aqDUAz0//9JX4oUCj6IYMG649oWF+qC61wmYLEPNzCYk8yZTDzKvu8gGMMw4PV6oW1bTNMktXP/+M7zLLymabCu609PYbJtmxwejwdM00RRFCJ6iB048wzDQFmW6LruZ7CCU0RRhPv9jiRJRPC/8H1fQA63OocILsvynUQXXPcAzwQvep6H5/OJz+eDIAgQhqHkaZoiyzLRUThJ0zS4rgvHcaCqqrjM8xy6ruN2u+H9fsOyLFyvV1nXtm1cLhcR5T1yWCNPoTP+XDrgFBLYYI2O4jhG3/fyEHRAt1VVyaOwXtf1Nx/HEX+SC8dN/wqSeQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/db60e83db27c55c66bb1e42fd10bded4/37523/image1.png\"\n        srcset=\"/static/db60e83db27c55c66bb1e42fd10bded4/e9ff0/image1.png 180w,\n/static/db60e83db27c55c66bb1e42fd10bded4/f21e7/image1.png 360w,\n/static/db60e83db27c55c66bb1e42fd10bded4/37523/image1.png 720w,\n/static/db60e83db27c55c66bb1e42fd10bded4/612f7/image1.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n그 후 command + space 하여 ‘keychain Access’ 를 열어서 아래와 같이 깃헙의 주소와 나의 깃헙 계정명을 적은 후 암호 란에 토큰 값을 복붙해주면 된다.</p>\n<p>가령 Album을 저장한다고 해보자 아래와 같이 매우 귀찮다.</p>\n<p>a. 객체 분해</p>\n<p>b. INSERT INTO ITEM…</p>\n<p>c. INSERT INTO ALBUM …</p>\n<p>​</p>\n<p>Album을 조회한다고 해보자 마찬가지로 귀찮다.</p>\n<ul>\n<li>\n<p>Album과 Item을 join하는 SQL작성 ( 다른 MOVIE를 조회한다고 해도 마찬가지..)</p>\n</li>\n<li>\n<p>각각의 객체 생성</p>\n</li>\n</ul>\n<p>하지만 OOP, 즉 만약에 자바 컬렉션에서 조회한다고 가정하면? 간단하다. 이와 같이 객체지향적인 모델링을 SQL로 직접 짜려고 하면 매우 귀찮고 비효율적임을 알 수 있다. 이게 다 패러다임이 불일치해서 그런 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Album</span> album <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>albumId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Item</span> item <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>albumId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<h3 id=\"2-연관관계\" style=\"position:relative;\"><a href=\"#2-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84\" aria-label=\"2 연관관계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 연관관계</h3>\n<p>RDB와 OOP는 데이터 간에 연관관계를 맺는 방법도 아래와 같이 다르다.</p>\n<ul>\n<li>\n<p>객체는 참조를 사용한다. ( member.getTeam() )</p>\n</li>\n<li>\n<p>테이블은 외래키(FK)를 사용한다 ( join on member.team_id = team.team_id )</p>\n</li>\n</ul>\n<p>그리고 아래와 같이 객체는 Member는 Team을 참조할 수 있고, 그 반대는 불가능하지만</p>\n<p>RDB에서는 TEAM_ID를 통해 MEMBER가 TEAM을, TEAM이 MEMBER를 참조할 수 있다는 차이가 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABqElEQVQoz5WS14qqQRCE//d/Ge/EC3NOrJgV0xrXnHOq5WtQzsUinIFy/Gemu7q62tGHtd/vFQ6HlcvllEqlFI1Glc/nP4XIuV6vFrhYLNTr9TQYDDSfz+2MvVqtqtPpqFarqVKpqNVqabPZaLfbaTabqd/va71e29ntdpMzmUzUbrctyOfzye/3q1wuazqdWjCEl8vFdkAQyXlPnNfrtSK+v7+13W7lwMIHjIfDQefz+V3+crn8UxZqMpmMKOZ4POp0Ounn58dyOK/LeDyuSCSier1uiSAaDod6PB5v3O/3d29512g07M1oNLIqUeLwAxMYj8cmlWTsMP/vcj5dkpSeJpNJpdNpUxAMBs081vP5fL9FgSWkb7jU7XaVzWYtGDk0GBmcs6OAHRUoIAaHIYKAb3KZy8ViUbFYTC6XS26326poNpvWm9eiNThMG3C4VCrp6+tLHo9HiUTCHMcPB1kMLSgUCja4VMglAVRIRavVyhzFECoKBAIG/gMSMrfmMsmoCoRCIZMGEQ7+tRgtZhG8WkJSCB1GgTGhB4BKAESvmaT5/+KTy7/baoE08D02lwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/a45b81f1ad37e735059c5e04bcd30e09/37523/image2.png\"\n        srcset=\"/static/a45b81f1ad37e735059c5e04bcd30e09/e9ff0/image2.png 180w,\n/static/a45b81f1ad37e735059c5e04bcd30e09/f21e7/image2.png 360w,\n/static/a45b81f1ad37e735059c5e04bcd30e09/37523/image2.png 720w,\n/static/a45b81f1ad37e735059c5e04bcd30e09/612f7/image2.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>객체는 자유롭게 객체 그래프를 탐색할 수 있어야 한다.\nmember.getTeam()처럼.\n그런데 SQL을 직접 짜게 되면 Member.getOrder().getDelivery() 이런식으로 탐색을 할 수가 없다.</p>\n<p>정확히 말하면 못한다기 보다는 처음 실행하는 SQL에 따라 탐색 범위가 결정되는데, 처음에 Member, Order, Delivery,…등 모든 데이터를 불러와두지 않았다고 하면 객체 그래프 탐색이 불가능하다는 것이다.</p>\n<p>그리고 이는 Entity에 대한 신뢰 문제를 발생시킨다.</p>\n<ul>\n<li>개발자가 눈으로 초기 SQL을 까보지 않고서는 객체 그래프 탐색이 가능한지 신뢰할 수 없다는 것이다. 그렇다고 모든 객체를 메모리에 불러와둘 수도 없는 노릇이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQoz51S2YrCQBCc//8ViQ+CLxFcISQRRBdMfIioIcbEoCLed6ylmo1msweLBcMcNV3dU9NquVxiMpkgjmPMZjNst1tcLhdcr1ccDgesVitEUSTcZrMRjiA/n88lNkkSWZNTvV4PlUoFmqahXq8jCAKs12sJZpJ+vw9d11Gr1TAYDCQhcTwe0el0UC6XUSqVYBiGcIqZbrcbWCkzpGmKPBhInve4vt/vcs6ZdynC5LzDvcoCefgKmOR0Oj32arfbYTweo9vtik/7/V6q4SDHZ3qeJzPv8Sxf2XA4hO/7YhPF1WKxQKvVQrVaheM4Ipp5SLPpDf2jv6ZpYjqdiii50WiEZrMJy7Ie/ip6cT6fQeHsB/Ngpawo8zEPxmUdwWdT65uHPMyPIv7ixMMwDGHbNhqNBthC/O2fhItCv3GKjdlut6WnXNf9Ivg/PJO8Oy5Use9eQfop+GZa+ACk4EkgAf8zyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/90a67c05761439ec710242a49a946701/37523/image3.png\"\n        srcset=\"/static/90a67c05761439ec710242a49a946701/e9ff0/image3.png 180w,\n/static/90a67c05761439ec710242a49a946701/f21e7/image3.png 360w,\n/static/90a67c05761439ec710242a49a946701/37523/image3.png 720w,\n/static/90a67c05761439ec710242a49a946701/612f7/image3.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>또한, RDB로 부터 SQL을 직접짜서 객체를 불러온다면 같은 식별자 값으로 데이터를 불러와도 생성되는 인스턴스는 서로 다를 것이고, 자바 컬렉션에서 객체를 하나 get한다면 동일한 id값이라면 동일한 인스턴스를 불러올 것이다. 즉 개발자가 객체답게 모델링을 할 수록 맵핑작업만 늘어나고 힘들어지는 구조이다.</p>\n<br>\n<h3 id=\"3-데이터-타입\" style=\"position:relative;\"><a href=\"#3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%80%EC%9E%85\" aria-label=\"3 데이터 타입 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 데이터 타입</h3>\n<p>: RDB에서 데이터를 저장하는 목적으로 만든 자료형과 프로그래밍 언어에서 사용하는 자료형이 다르다.</p>\n<br>\n<h3 id=\"4-데이터-식별방법\" style=\"position:relative;\"><a href=\"#4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%8B%9D%EB%B3%84%EB%B0%A9%EB%B2%95\" aria-label=\"4 데이터 식별방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 데이터 식별방법</h3>\n<p>: RDB에서는 PK를 기준으로 데이터를 식별하지만, OOP에서는 객체의 참조값을 기준으로 데이터를 식별한다.</p>\n<hr>\n<h2 id=\"jpa\" style=\"position:relative;\"><a href=\"#jpa\" aria-label=\"jpa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPA</h2>\n<p>위에서 언급한 패러다임의 불일치를 해소하기 위해 등장한 것이 ORM이며, 자바에서 사용하는 ORM 표준이 JPA이다. JPA는 아래 그림처럼 동작한다. JPA를 사용하면 생산성이 매우 높아진다. JPA를 사용하면 DB에 데이터를 넣고 빼는 것을 마치 자바 컬렉션에 데이터를 넣고 빼는 것처럼 사용할 수 있게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQoz4WTy26DQAxF+fAu811dZJlFQYrEEokE0RAI5AWEp6tj1RGTVq0ly+N5XPvaHu9yucj9fle93W6Ocna9XlXP57Mqe9i2bQWZ51mW4vV9r5vTNDmHrHlUFIUCdF2nfl3X6hPQ7i3VI2LTNHqZTMZx1IvDMMjj8dDHZI8ACuDxeHQAnQyrqno6APCgLEuHlgk+gfI8fwJacJhifwDih2EoSZJovbBpmuqZMSFD2Ox2Ow1OALPe6XTSOmVZJofDQUH2+70eArTZbMT3fQmCQIHiOJYoinSN2huYURInQzIgdaMBLTLhDkpgy9AoA0JSWMrkAFqNEIBfa8gjmrasIU0hqO15Vnzr8n+Af3VZx4ZiL7tkF1jbSAFiFiAo2ijZ/DmD/ZuQHZ2zoTfFJxjgyPQN9pll8r5ei/f63Uyhj7VvuVT2oa+A06T2Y7uVt9VKvgB16J/ygvRmYgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/1e5898c76d3d9c1e613f103583078b15/37523/image4.png\"\n        srcset=\"/static/1e5898c76d3d9c1e613f103583078b15/e9ff0/image4.png 180w,\n/static/1e5898c76d3d9c1e613f103583078b15/f21e7/image4.png 360w,\n/static/1e5898c76d3d9c1e613f103583078b15/37523/image4.png 720w,\n/static/1e5898c76d3d9c1e613f103583078b15/612f7/image4.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"1-jpa의-상속-문제-해결\" style=\"position:relative;\"><a href=\"#1-jpa%EC%9D%98-%EC%83%81%EC%86%8D-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"1 jpa의 상속 문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JPA의 상속 문제 해결</h3>\n<p>JPA는 위에서 언급했던 상속의 문제를 아주 간단히 해결한다. 직접 SQL을 2번 짜줄 필요가 없다.</p>\n<ul>\n<li>저장</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">jpa<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>album<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//개발자가 이것만 하면!!</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n<span class=\"token comment\">//JPA는 아래 2개 쿼리를 알아서 수행시킨다.</span>\nINSERT INTO ITEM <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nINSERT INTO ALBUM <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<ul>\n<li>조회</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">jpa<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>albumId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//개발자가 이것만 하면!!</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n<span class=\"token comment\">//JPA는 아래 쿼리를 알아서 수행시킨다.</span>\nSELECT <span class=\"token class-name\">I</span><span class=\"token punctuation\">.</span>*<span class=\"token punctuation\">,</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span>*\n    FROM ITEM <span class=\"token class-name\">I</span>\n    JOIN ALBUM <span class=\"token class-name\">A</span> ON <span class=\"token class-name\">I</span><span class=\"token punctuation\">.</span>ITEM_ID <span class=\"token operator\">=</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span>ITEM_ID</code></pre></div>\n<br>\n<h3 id=\"2-jpa의-연관관계-문제-해결\" style=\"position:relative;\"><a href=\"#2-jpa%EC%9D%98-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"2 jpa의 연관관계 문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. JPA의 연관관계 문제 해결</h3>\n<p>JPA는 연관관계 문제를 해결함으로써 Entity에 대한 신뢰 문제를 해결시켜준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">//즉,SQL을 직접 확인해보지 않아도 아래와 같은 작업이 가능함을 보장한다</span>\n<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> jpa<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">getTeam</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDelivery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 이게 가능!</span></code></pre></div>\n<br>\n<h3 id=\"3-jpa-데이터-식별\" style=\"position:relative;\"><a href=\"#3-jpa-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%8B%9D%EB%B3%84\" aria-label=\"3 jpa 데이터 식별 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. JPA 데이터 식별</h3>\n<p>동일한 트랜잭션에서 조회한 엔티티가 같음을 보장한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member1 <span class=\"token operator\">=</span> jpa<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Member</span> member2 <span class=\"token operator\">=</span> jpa<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmember1 <span class=\"token operator\">==</span> member2 <span class=\"token comment\">//true !</span></code></pre></div>\n<br>\n<h3 id=\"4-jpa의-성능-최적화\" style=\"position:relative;\"><a href=\"#4-jpa%EC%9D%98-%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94\" aria-label=\"4 jpa의 성능 최적화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. JPA의 성능 최적화</h3>\n<p>JPA를 쓰더라도 성능 최적화를 통해 우수한 성능을 보장받을 수 있다.</p>\n<br>\n<ol>\n<li>1차 캐시와 동일성 보장</li>\n</ol>\n<ul>\n<li>\n<p>같은 transaction에서 같은 Enitty를 반환\n: 캐싱을 통해 약간의 조회향상을 기대할 수 있다.</p>\n</li>\n<li>\n<p>DB isolation level이 “Read commit”이어도 앱 레벨에서 “Repeatable read”를 보장한다.</p>\n</li>\n</ul>\n<br>\n<ol start=\"2\">\n<li>transaction을 지원하는 쓰기 지연</li>\n</ol>\n<ul>\n<li>\n<p>jdbc batch sql 을 옵션을 통해 사용해서 한번에 SQL 전송.</p>\n</li>\n<li>\n<p>update/delete로 인한 row 락 시간 최소화하여 비즈니스 로직에 영향주지 않게 쓰기 지연하는 옵션 설정 가능. 마찬가지로 jdbc batch sql 이용.</p>\n</li>\n</ul>\n<br>\n<ol start=\"3\">\n<li>지연 로딩과 즉시 로딩</li>\n</ol>\n<ul>\n<li>\n<p>지연로딩(LAZY LOADING) : 객체가 실제 코드 상에서 쓰일 때 로딩하는 것</p>\n</li>\n<li>\n<p>즉시로딩(EAGER LOADING) : 연관된 객체까지 JOIN을 통해 모두 로딩해두는 것</p>\n<br>\n</li>\n</ul>\n<p>만약 99% member를 사용할 때 team을 참조한다면, 즉시로딩으로 설정해주는 것이 좋으며 기본적으로는 LAZY LOADING으로 설정한다.</p>\n<hr>\n<p>참고자료</p>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>","frontmatter":{"date":"February 24, 2022","title":"[JPA] 1. SQL 중심적 개발의 문제와 JPA","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa1/"}},"prev":{"id":"594c5566-4632-5c70-9fdd-731673898ad2","html":"<blockquote>\n<p>지난 글에서는 JPA 프로그래밍시, EntityManager를 생성하여 persist, set 등의 CRUD 작업을 수행하는 것을 알아보았다.\n지난 글에선 설명하지 않았지만 EntityManager가 데이터를 persist 하게 되면 데이터는 ‘영속성 컨텍스트’에 저장되게 된다.\nJPA에서 가장 중요한 것은</p>\n<ol>\n<li>객체와 관계형 DB의 맵핑 문제,</li>\n<li>그리고 <strong>영속성 컨텍스트</strong>이다.</li>\n</ol>\n</blockquote>\n<h2 id=\"영속성-컨텍스트란\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EB%9E%80\" aria-label=\"영속성 컨텍스트란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영속성 컨텍스트란?</h2>\n<p>영속성 컨텍스트를 이해하기에 앞서, EntityManager(이하 EM)와 EntityManagerFactory(이하 EMF)가 동작하는 방식에 대해서 먼저 이해해야 한다.</p>\n<p>EMF는 고객의 요청이 올 때 마다 EM을 생성하고 EM은 내부적으로 DB 커넥션을 사용해서 DB를 사용한며, 이를 도식화하면 아래와 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVQoz22Ty27CQAxF8/+f0lXVbrroHolGilgQlPAIgfAMhKdAUUJcHauepqIjWR7P2NfX9ozXNI2wDoeDbDYb2e/3stvtnEynUxkOh6qx8UOKolB7u93K4/FQDLA8A8QBx8vlIufzWYV9HMcSBIEMBgPJskxlPp/Ler3W+zzPpa7r/wERgE6nk5Pb7SZVVcnxeNTgbrcrvu+7ap4A5WdxaYBthpzBivJMW8kkfAK83+/Kgkscr9er26Mnk4mMRiMNBIwkbaGHfwAJgj4B9AUHepSmqcxmM0mSxA0I1jBbrVbqi825DYXl4bBcLvUCRzRg4/FYJ7tYLFSsp/hwD3PiACYGUtgKiEGpNB6NlGXp+kfJ1lNaYewB7fV6qjkH3LM+WAb2MIuiSPr9vivZyoQ5jGmL+RsGBDymyyWGHeIIAwIBITtAgCJhGOq7pKJ2Dztfvng2VQO0n4Bz+1e0bQgYCRIwZSb88vr++w4JMEbGxKR9xp72kByb16Gfo2nk7eNTvgEG0YbuhAZ9SwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/235f571f658ac98a2d5eb5d301054e55/37523/image1.png\"\n        srcset=\"/static/235f571f658ac98a2d5eb5d301054e55/e9ff0/image1.png 180w,\n/static/235f571f658ac98a2d5eb5d301054e55/f21e7/image1.png 360w,\n/static/235f571f658ac98a2d5eb5d301054e55/37523/image1.png 720w,\n/static/235f571f658ac98a2d5eb5d301054e55/612f7/image1.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그렇다면 영속성 컨텍스트란 무엇인가?</p>\n<p>“Entity를 영구 저장하는 환경”이라는 뜻이다.\n영속성 컨텍스트는 논리적인 개념이며 또한 EM과 1대1로 대응하고, EM을 통해 접근/관리 한다.</p>\n<p>우리가 앞서 JPA에서 아래와 같이 실행하면 JPA에서 DB에 객체를 저장한다 정도로 이해했지만</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">em<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>정확히는, ‘EM을 통해 Entity를 영속성 컨텍스트에 저장한다’ 는 것을 의미한다.\n그리고 추후에 공부하겠지만 Spring에서는 EM과 영속성 컨텍스트가 아래와 같이 N:1로 생성된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXUlEQVQ4y6VUyY7aQBDl/z+EMxeQOCAkQOwJYRix2GDAwzpgG9vYZjG86NWkDeQQjZSSSk23q14tr4rU/X4HlcLzer0ijmM5b7cb2u028vk8qtUq0uk0xuOx2Co72jxjpBQQ5Xw+o9vtYj6fYzAYwDAMATBNU+7T6RTD4VBO6mazged5UEKclAJTDyqiEt6ZCd8ulwvCMITjOHBdF1EUIQpDAWUyLxn6vg/bthM9nU5iREAqnQhAIAIeDgdRvlO3n58PQGZgfnygP+hLaf1+H8Z0ir1lYbffYW6aGGm6BGUbdF2XVvC3pmkShEkIoGooywnCELZjIwgCufOdmTKjOL6KI7Nm2cfjMcnOsqwHIP5T/u55ivT3ej00Gg2JxHLK5bKUzZEpFosolUqo1WqYzWaoVCpi32w2USgUxI6TwdEi8wI4Go2kd8vlUuaNADzplM1mkcvlBLjVaiGTyaDT6UgAAhKMfazX61itVq8ls2+LxQIH18V+v39hnTNHVvm+2+2SHpL5Z0lYJqPb7VZOOtGQAb4jz/ObAK7Xa9kCNTbsB4GZFb8rAsg6WWZAMq5UTUuyKewly7BsWxzUOwNNDEPmlDZhFMHzfByDANGf4WeLSGhSMg3pQHLIMrPk/rJ89o5DXqnWJOBkMhESONhU+hzcg9i+ZMisuD5kmk3nEDMQhfe39/dkoF3Xk++yhskK+vjx6+0rQ/aG20BSSD3LpCNVEUQbAqoefrHsC9O240h25XrzAbhcrTDSNGi6LmXzL4xl8Nt3pdb6+fr3dY1jBEGYlPo8Fv9SFbRSb+E3lShVQm2ypHgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/97bb47b20fe5870806a368b0f256624d/37523/image2.png\"\n        srcset=\"/static/97bb47b20fe5870806a368b0f256624d/e9ff0/image2.png 180w,\n/static/97bb47b20fe5870806a368b0f256624d/f21e7/image2.png 360w,\n/static/97bb47b20fe5870806a368b0f256624d/37523/image2.png 720w,\n/static/97bb47b20fe5870806a368b0f256624d/612f7/image2.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"영속성-컨텍스트에서-엔티티의-생명주기\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%97%90%EC%84%9C-%EC%97%94%ED%8B%B0%ED%8B%B0%EC%9D%98-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0\" aria-label=\"영속성 컨텍스트에서 엔티티의 생명주기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영속성 컨텍스트에서 엔티티의 생명주기</h2>\n<p>영속성 컨텍스트 내에서 Entity의 생명주기를 도식화하면 아래와 같다.\nnew, managed, detached, removed 의 4가지 상태가 존재한다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYUlEQVQ4y42TW6+CQAyE+f9/jJj46IuXKAqIF1AQ5ar25GtSwlE0NtnsLnSnM9NdRwbi+Xzq/Hg85HQ6SRiGEkWRHA4HaZrmX85rON8AmdM0leVyKYvFQrbbrdR13f0bAv0KCBsG7AAdynkDtEr9gVQCuaPRSFarlcRxrPv9ft/977O0eZChxe12E9d1xff9DnC3272B9Nk69/tdyrJUb6qq0upJkuiwuFwuMpvN5JM9/eGQTPc8z5M8z3WNRPZ4R4dpCB7ClMYQSB+Px29eOkVRdN4ADkurjOTz+SxBEMhkMpHj8ajFKMo3ihGcAQelHz3sV6bTsLNo21bB1+u1KpnP5+otRQa7bGBZlilzpHOA2SSbPdPpVEGv16uqcV6N7bMjCTtIBJBGUcRkmkXGjoI/SQbQLja3AiBrFnuLumm+vxR7yzQCDwFhbxcbMNaWX9X1b4CbzUYBkURDXhXYGoZ/Y0E+cAKlVagAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/ea9a8f912b7dcdce56c8a18ed2be51a1/37523/image3.png\"\n        srcset=\"/static/ea9a8f912b7dcdce56c8a18ed2be51a1/e9ff0/image3.png 180w,\n/static/ea9a8f912b7dcdce56c8a18ed2be51a1/f21e7/image3.png 360w,\n/static/ea9a8f912b7dcdce56c8a18ed2be51a1/37523/image3.png 720w,\n/static/ea9a8f912b7dcdce56c8a18ed2be51a1/612f7/image3.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"1-비영속--new--transient-\" style=\"position:relative;\"><a href=\"#1-%EB%B9%84%EC%98%81%EC%86%8D--new--transient-\" aria-label=\"1 비영속  new  transient  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 비영속 ( New / transient )</h3>\n<p>: Entity가 영속성 컨텍스트와 전혀 관계없는 상태를 말한다. 아래와 같은 코드에서는\nEM을 통해 Entity에 아무런 조작도 하지 않은 상태이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 객체 생성한 상태 </span>\n<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"2-영속--managed-\" style=\"position:relative;\"><a href=\"#2-%EC%98%81%EC%86%8D--managed-\" aria-label=\"2 영속  managed  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 영속 ( managed )</h3>\n<p>: 영속성 컨텍스트에 의해 관리되는 상태이며, persist 명령어를 통해 new -> managed 상태로 변경된다.\npersist를 할 때 Entity가 영속성 컨텍스트에 저장되는 것이지, DB에 저장되는 것은 아님에 유의하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 객체를 저장한 상태 (영속) 이 때 DB에 저장되는 것은 아니다. </span></code></pre></div>\n<h3 id=\"3-준영속--detached-\" style=\"position:relative;\"><a href=\"#3-%EC%A4%80%EC%98%81%EC%86%8D--detached-\" aria-label=\"3 준영속  detached  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 준영속 ( detached )</h3>\n<p>: 영속성 컨텍스트에 저장되었다가 분리된 상태를 말한다.\n준영속 상태로 만드는 방법은 detach, clear, close가 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">//준영속 상태로 만드는 법 3가지</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//특정 entity만 준영속 상태로 전환</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">-</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//영속성 컨텍스트 전체를 초기화</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">-</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//영속성 컨텍스트를 종료</span></code></pre></div>\n<h3 id=\"4-삭제--removed-\" style=\"position:relative;\"><a href=\"#4-%EC%82%AD%EC%A0%9C--removed-\" aria-label=\"4 삭제  removed  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 삭제 ( removed )</h3>\n<p>: 영속성 컨텍스트에서 삭제된 상태를 말한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">em<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<h2 id=\"어플리케이션과-db사이에-영속성-컨텍스트를-두는-이유\" style=\"position:relative;\"><a href=\"#%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EA%B3%BC-db%EC%82%AC%EC%9D%B4%EC%97%90-%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EB%A5%BC-%EB%91%90%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"어플리케이션과 db사이에 영속성 컨텍스트를 두는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어플리케이션과 DB사이에 영속성 컨텍스트를 두는 이유</h2>\n<p>그렇다면 왜 Application과 DB사이에 영속성 컨텍스트라는 중간 계층을 두는 것일까?\n바로 다음과 같은 이점이 있기 때문이다.</p>\n<h3 id=\"1-1차-캐시\" style=\"position:relative;\"><a href=\"#1-1%EC%B0%A8-%EC%BA%90%EC%8B%9C\" aria-label=\"1 1차 캐시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 1차 캐시</h3>\n<p>영속성 컨텍스트 내부에 존재하는 캐시를 의미하는데, 영속성 컨텍스트 내부에 존재하는 모든 Entity는 Map(key, value) 형태로 1차 캐시에 저장된다.\n여기서 key는 @Id로 매핑한 식별자이고 value는 Entity 객체이다.</p>\n<p>(1) 아래의 코드에서 처음 id=1인 Member Entity를 persist시에 Entity는 1차 캐시에 저장되게 되고,\n만약에 그 후에 id=1인 Member를 find하게 되면 DB가 아닌 영속성 컨텍스트의 1차 캐시로부터 조회해오게 된다.\n즉, 이 과정에서 DB에 대한 접근은 전혀 없다.</p>\n<p>(2) 또는, id=1인 Member Entity가 DB에 저장되어 있는 상태에서 이를 소스 상에서 불러오고 싶을 때,\n처음 불러올 때는 DB로부터 조회해와서 1차 캐시에 Entity로 저장하게 되고, 2번 째 동일한 Entity를 불러오게 되면\nDB접근 없이 1차캐시로부터 조회해온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// (1) </span>\n<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//1차 캐시에 저장됨</span>\n<span class=\"token class-name\">Member</span> findMember <span class=\"token operator\">=</span> \bem<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 1차 캐시로부터 조회함(DB 접근 X)</span>\n\n<span class=\"token comment\">// (2) </span>\n<span class=\"token class-name\">Member</span> findMember1 <span class=\"token operator\">=</span> \bem<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// DB로부터 조회 (SQL 날림)</span>\n<span class=\"token class-name\">Member</span> findMember2 <span class=\"token operator\">=</span> \bem<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1차캐시로 부터 조회</span></code></pre></div>\n<br>\n<p>이처럼 동일한 transaction안에서는 캐싱을 해주는 이점이 있으나, 말 그대로 개별 transaction안에서만 캐싱이 되고, transaction이 끝나면 영속성 컨텍스트를 지우기 때문에 엄청난 성능 이점이 있는 것은 아니다. 그러나 비즈니스 로직이 굉장히 복잡한 경우에 도움이 될 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWklEQVQoz2WS246CUAxF+f+vMj4z6IMJ3hAFvAOCQIxC6GTVqaPxJM0px3a1u9Xp+144l8tF0jSVPM/Vj+NYlsul2mq1evnr9VqyLNM47Hw+S9u2yoDlGBAYoOv1KnVda6Lv+zKdThU0n89lNptJEARSluUrDuD9fv8Hyt8pikKDmqaRqqr0vt1u6vPOjQHhNugXkHYJQlYURSr1eDxqt0mSqIVhKJPJRA6Hg8YgmQYAfwG7rlN5g8HgZQBI5t3zPC2w3+/FdV0ZDodalBGZ5MfjYUKfkoG+Dx1bLBba9Xa71Q4A8k2x3W73AWQ5vKHiY4YE2NwA8IZ0kpBqywFswNPppEDmWZaFOMihI7a32Wy0El3xPRqNdMsA7W/EpoHyO2MxeNPUEsWJOFYZiTb88XisYIrRAd2yHKAYvskklhwKuD/eUzIzIpFAgjB8itnmDfQOxihmJ81y+QWxr+j1wZRJYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/a4e7e683cc034c586d47610f6f465132/37523/image4.png\"\n        srcset=\"/static/a4e7e683cc034c586d47610f6f465132/e9ff0/image4.png 180w,\n/static/a4e7e683cc034c586d47610f6f465132/f21e7/image4.png 360w,\n/static/a4e7e683cc034c586d47610f6f465132/37523/image4.png 720w,\n/static/a4e7e683cc034c586d47610f6f465132/612f7/image4.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h3 id=\"2-동일성-보장\" style=\"position:relative;\"><a href=\"#2-%EB%8F%99%EC%9D%BC%EC%84%B1-%EB%B3%B4%EC%9E%A5\" aria-label=\"2 동일성 보장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 동일성 보장</h3>\n<p>영속성 컨텍스트를 쓰게 되면 영속된 Entity의 동일성을 보장한다.</p>\n<p>마치 자바 컬렉션에서 객체를 꺼내온 것처럼. 이게 가능한 이유가 1차 캐시 덕분이다.\n즉 1차 캐시를 통해 repeatable read 등급의 트랜잭션 격리 수준을 DB가 아닌 애플리케이션 차원에서 제공한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member1 <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// DB로부터 조회</span>\n<span class=\"token class-name\">Member</span> member2 <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1차 캐시에서 꺼내오는 동일한 Entity</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>member1 <span class=\"token operator\">==</span> member2<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre></div>\n<h3 id=\"3-transactional-write-behind--트랜잭션-쓰기-지연-\" style=\"position:relative;\"><a href=\"#3-transactional-write-behind--%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%93%B0%EA%B8%B0-%EC%A7%80%EC%97%B0-\" aria-label=\"3 transactional write behind  트랜잭션 쓰기 지연  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Transactional write-behind ( 트랜잭션 쓰기 지연 )</h3>\n<p>persist를 하게 되면 바로 SQL을 DB로 날리는 것이 아니라, 2가지 동작을 하게 된다.</p>\n<p>(1) INSERT SQL을 생성하여 ‘쓰기 지연 SQL 저장소’에 저장한다.\n(2) 1차 캐시에 저장한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB00lEQVQ4y42T2Y6qQBRF+f+v88GBgAwi4AQqDlEc2J112rK9pmPfSrZVYrHOtPWu16vattW5bdVeWp1OJ9PlchFrvV6rrmttNhsVRaEwDBXHse2LxcJ+r6pKTdPYfa+uKsVhqDSKlKWpAt+XPxiqyHN1XWcvcHm/32u1Wmk+n2s2mxkcEIEc2ID22enXtdvtNBwO5fu+8jxXmqZPAcqyTEmSGJDvBiQLeLa/iHW73ewy4mWyIgjZsgOjfCogezL23kHvUCLzMgIYBIGm06miKDJRAc+4B9j7rdRXIL3Zbrd22Q2IHk4mEzsD7ff7dv4p+UOGQFyZ6HA4WDY44Xg82nee/zuUD4u+MFn66Pq0XC7tWVmWJlpBFQZsz2cdiPzQrmnUbLYWlUUpgNgZDBPHg+xAeU6Apw/Xda1kHCqLExXZVFEQKBz5mpWlTRmY8yIAskFkBozMAD5t86lcLg8GA5skPiRDdkTp2IbfgD8zpPn3+10depzvj7OzjTMxIAbEMMgOgwPk7KbvdY8/yre5v+Ws46ZM9FcfAsLQWIdeIoLS9z996AwLkDMBKBEg/R2NRur1ej8+/AtIr4AAo6fIDQcrjcdjgwL/LyAg5793vfrS2ewLHozEJ6UNdy8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/5b0439356719f16bb64421babcf95c96/37523/image5.png\"\n        srcset=\"/static/5b0439356719f16bb64421babcf95c96/e9ff0/image5.png 180w,\n/static/5b0439356719f16bb64421babcf95c96/f21e7/image5.png 360w,\n/static/5b0439356719f16bb64421babcf95c96/37523/image5.png 720w,\n/static/5b0439356719f16bb64421babcf95c96/612f7/image5.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이렇게 쓰기 지연 SQL 저장소에 SQL을 계속 모아두다가 transaction.commit()을 하는 순간,</p>\n<p>‘쓰기 지연 SQL 저장소’에 있던 쿼리들이 flush가 되면서 DB에 날라가고 커밋된다.</p>\n<blockquote>\n<p>flush()는 영속성 컨텍스트의 변경 내용을 데이터베이스에 동기화하는 작업으로 등록, 수정, 삭제한 Entity 를 데이터베이스에 반영한다.</p>\n</blockquote>\n<p>이렇듯 버퍼링을 모아서 write하기 때문에 <strong>지연 쓰기를 통해 배치 쿼리를 짜는 경우에 이점</strong>을 얻을 수 있다.</p>\n<h3 id=\"4-dirty-checking-변경-감지\" style=\"position:relative;\"><a href=\"#4-dirty-checking-%EB%B3%80%EA%B2%BD-%EA%B0%90%EC%A7%80\" aria-label=\"4 dirty checking 변경 감지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Dirty Checking (변경 감지)</h3>\n<p>영속성 컨텍스트에는 이전 flush 때의 Entity 상태를 복사해서 저장해둔 스냅샷이 존재하며,\nflush 시점에 이전에 저장해둔 스냅샷과 Entity를 비교해 변경된 Entity를 찾는다.</p>\n<p>그리고 변경된 Entity를 찾아 각 Entity 객체에 대한 update SQL을 생성하여 ‘쓰기 지연 SQL 저장소’에 저장하고,\n한 꺼번에 DB로 쿼리를 날리면서 transaction을 커밋한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmebmer<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"modified\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//이렇게만 해도 커밋 시 UPDATE문이 날라간다. </span></code></pre></div>\n<br>\n<blockquote>\n<h2 id=\"flush-란\" style=\"position:relative;\"><a href=\"#flush-%EB%9E%80\" aria-label=\"flush 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>flush 란?</h2>\n<p>영속성 컨텍스트가 변경사항을 DB에 동기화하는 작업을 말하며 다음과 같은 경우에 flush가 발생한다.</p>\n<ol>\n<li>transaction commit 될 때</li>\n<li>EntityManager가 직접 flush() 호출할 때</li>\n<li>JPQL 쿼리가 실행될 때</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqklEQVQ4y22T147CQAxF8/+/xVsUJIroHQKEThI6Il6dKzlitTuSNSWe42uPE7zfb9vtdnY8Hu1wOMhms5mNx2ObTqeyyWSiGb/T6STf/X5veZ4boygK8xE8n0/bbrd2uVzser1qHo1G1uv1rN/vCzwYDKzT6QiWZZlAaZoK/Af4er0UDWWLxcLiOJYSgnC2Xq/LNWCg7PE5n8+/gMwCzudzqUKRGwpJFchqtZK1222BfY9KHw4NSLHRaFi321UKj8fDbrebZtTc73edkzrq8WMGCJySUSrG5/OxgAvL5VI1qtfrUoVaZtIFSgCMi15nvvF4w+FQawTAUcpeEyJzSGo4+msCpV6k6K/MjD/nBOcO4gRMkkTyqRv1xIHoYRgqVRRQy2q1qlT9tTebjfatVstqtZpaS0AuYDwGUVECOIoiAVHdbDatUqmoEwgOEBj3AKGUdanQP3qaqCQy9QTOYxCAy/gQ1Nvme5RAlOEMlHoCAoKhkk5AIecAUUjq3jJuAqKOegDmgYByRh1JF0MxcNakDPT7Tyn7kN4B5Bf/M29kD8QZGXn/ff96P43hy55L507OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/2dd945ba9e5a5cd17e843887eb00b5d1/37523/image6.png\"\n        srcset=\"/static/2dd945ba9e5a5cd17e843887eb00b5d1/e9ff0/image6.png 180w,\n/static/2dd945ba9e5a5cd17e843887eb00b5d1/f21e7/image6.png 360w,\n/static/2dd945ba9e5a5cd17e843887eb00b5d1/37523/image6.png 720w,\n/static/2dd945ba9e5a5cd17e843887eb00b5d1/612f7/image6.png 773w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</blockquote>\n<h3 id=\"5-lazy-loading--지연-로딩-\" style=\"position:relative;\"><a href=\"#5-lazy-loading--%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9-\" aria-label=\"5 lazy loading  지연 로딩  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Lazy Loading ( 지연 로딩 )</h3>\n<p>Lazy Loading이란 실제 객체 대신 프록시 객체를 로딩해두고 해당 객체를 실제 사용할 때 영속성 컨텍스트를 통해 데이터를 불러오는 방법이다.\nLazy Loading을 통해 자바의 컬렉션처럼 DB를 사용하면서도 필요한 만큼의 데이터만 DB로부터 불러오도록 할 수 있다.</p>\n<p>이에 대해선 추후에 더 알아보도록 하자.</p>\n<hr>\n<p>참고자료</p>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/ORM-JPA-Basic\">https://www.inflearn.com/course/ORM-JPA-Basic</a></li>\n</ul>","frontmatter":{"date":"February 27, 2022","title":"[JPA] 3. JPA 내부동장 방식 : 영속성 관리","categories":"Spring","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/jpa3/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/jpa2/","nextSlug":"/jpa1/","prevSlug":"/jpa3/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}