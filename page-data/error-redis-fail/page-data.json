{"componentChunkName":"component---src-templates-blog-template-js","path":"/error-redis-fail/","result":{"data":{"cur":{"id":"ab4f7141-fb9a-569f-9981-99fdf7a64004","html":"<p>VM이 갑자기 재기동 되어 k8s 클러스터를 복구하였으나, redis가 재기동되지 않아서 <code class=\"language-text\">journalctl -xe</code> 명령으로 로그를 확인해보니</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">type=1400 audit(1700663555.037:17): avc:  denied ....</code></pre></div>\n<p>와 같은 오류가 출력되었다. 이는 SELinux의 audit 정책과 관련된 이슈이고, SELinux 정책을 off했다가 redis 재기동 후 on을 하는 방식으로 해결하였다.</p>\n<ul>\n<li>정책 off</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo setenforce 0</code></pre></div>\n<ul>\n<li>정책 on</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo setenforce 1</code></pre></div>","excerpt":"VM이 갑자기 재기동 되어 k8s 클러스터를 복구하였으나, redis가 재기동되지 않아서  명령으로 로그를 확인해보니 와 같은 오류가 출력되었다. 이는 SELinux의 audit 정책과 관련된 이슈이고, SELinux 정책을 off했다가 redis 재기동 후 on을 하는 방식으로 해결하였다. 정책 off 정책 on","frontmatter":{"date":"November 22, 2023","title":"[Error] Redis 기동 실패 : SELinux","categories":"Error","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/error-redis-fail/"}},"next":{"id":"bcc63adf-b4d9-519f-aae1-8b10b94a775a","html":"<h2 id=\"제어문\" style=\"position:relative;\"><a href=\"#%EC%A0%9C%EC%96%B4%EB%AC%B8\" aria-label=\"제어문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>제어문</h2>\n<h3 id=\"if문-expression-과-statement\" style=\"position:relative;\"><a href=\"#if%EB%AC%B8-expression-%EA%B3%BC-statement\" aria-label=\"if문 expression 과 statement permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>If문, Expression 과 Statement</h3>\n<ul>\n<li>기본적인 if-else의 문법은 동일하다.</li>\n<li>Java에서 if-else는 Statement이지만 Kotlin에서는 expression이다. 즉 삼항연산자 처럼 값을 리턴할 수 있다.\n<ul>\n<li>따라서 삼항연산자가 없음</li>\n</ul>\n</li>\n<li>in 연산자를 활용 가능\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">example</span><span class=\"token punctuation\">(</span>score<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> score <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token operator\">..</span><span class=\"token number\">100</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<h3 id=\"switch-와-when\" style=\"position:relative;\"><a href=\"#switch-%EC%99%80-when\" aria-label=\"switch 와 when permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>switch 와 when</h3>\n<ul>\n<li>switch case 문 대신에 when으로 kotlin에서는 대체되었으며 조건부를 다양하게 사용할 수 있다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoUlEQVQoz2WRW27iMBiFswxeCkhD4iS+3xInQKcK4hWEphtEYgdIEB7bjZ3KZoYOqqVPvh0dn/93FjRF6xycb9C2LZzzsNal2ViL6XSK0+mEOG7jFZ6TpPNJH5LOOQdrbTrLpJRYrn6jaTu0oQelDFVVoa5rcMYwnb48DK/XK7iQeH0bkta3XdL900cyrRT61mPdd2iMhBIc2lgIIaCMxa9F8TAcbzcIxvC66rBe9nCKQ/7VS6XAOUfGaI3WCDRaYOk4rJJoQgdtDLR1yEn5nXAcURULvHmOxmr0XiOEDv1qDef93TDGZMpAagtpVIpdlmWaWSz55bvkcRxRFDmClbBhBR3WUNpBaQ7KKOqqRkZjr4SC0gZKSzBGQemd+OJsNns2zHMEI2B8gAs9jGugjATn7N5Dylgqt7cCSmsoo1KySOzjfD5/NiQEayfQOQUV2/KfPobI4g+VhIDkC+R5/gQhBJPJBMfjMRleLpdkSOsKVUnSfVEUibiOZH/e37Hb7bDf739wOByw3W5xPp+T4cfHJ4ZhwLDZ3BkGbDabB3H/BSXNS9uGFC5LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/c514709058c724e35d5d0ec30a77cabb/37523/image1.png\"\n        srcset=\"/static/c514709058c724e35d5d0ec30a77cabb/e9ff0/image1.png 180w,\n/static/c514709058c724e35d5d0ec30a77cabb/f21e7/image1.png 360w,\n/static/c514709058c724e35d5d0ec30a77cabb/37523/image1.png 720w,\n/static/c514709058c724e35d5d0ec30a77cabb/302a4/image1.png 1080w,\n/static/c514709058c724e35d5d0ec30a77cabb/07a9c/image1.png 1440w,\n/static/c514709058c724e35d5d0ec30a77cabb/8bb81/image1.png 1602w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<ul>\n<li>is 문, ..문 등 사용</li>\n<li><code class=\"language-text\">-1,0,1 -> println(\"-1 또는 0또는 1입니다\")</code>와 같이도 쓸 수 있음</li>\n<li>when뒤에 소괄호없이 바로 조건부와 결과로만 when절을 구성할 수도 있다.\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">when{\n  number == 0 -> println(\"test\")\n  else -> println(\"else\")\n  )\n}</code></pre></div>\n</li>\n</ul>\n</li>\n<li>Enum 클래스, Sealed 클래스와 함께 사용할 경우 더욱 진가가 발휘된다.</li>\n</ul>\n<h2 id=\"반복문\" style=\"position:relative;\"><a href=\"#%EB%B0%98%EB%B3%B5%EB%AC%B8\" aria-label=\"반복문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>반복문</h2>\n<h3 id=\"for-each-문--향상된-for문-\" style=\"position:relative;\"><a href=\"#for-each-%EB%AC%B8--%ED%96%A5%EC%83%81%EB%90%9C-for%EB%AC%B8-\" aria-label=\"for each 문  향상된 for문  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>for-each 문 ( 향상된 for문 )</h3>\n<ul>\n<li>’:’ 대신 ‘in’을 쓰는 정도만 다르다.</li>\n</ul>\n<h3 id=\"전통적인-for문\" style=\"position:relative;\"><a href=\"#%EC%A0%84%ED%86%B5%EC%A0%81%EC%9D%B8-for%EB%AC%B8\" aria-label=\"전통적인 for문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>전통적인 for문</h3>\n<ul>\n<li>in을 사용한여 범위를 표현한다.</li>\n<li>progression, range를 활용한 등차수열을 쓴다.\n<ul>\n<li>downTo, step 등의 표현</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"예외\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%99%B8\" aria-label=\"예외 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외</h2>\n<h3 id=\"try-catch-finally-구문\" style=\"position:relative;\"><a href=\"#try-catch-finally-%EA%B5%AC%EB%AC%B8\" aria-label=\"try catch finally 구문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>try catch finally 구문</h3>\n<ul>\n<li>자바와 기본적으로 동일</li>\n</ul>\n<h3 id=\"checked-unchecked-exception울-구분하지-않는다\" style=\"position:relative;\"><a href=\"#checked-unchecked-exception%EC%9A%B8-%EA%B5%AC%EB%B6%84%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94%EB%8B%A4\" aria-label=\"checked unchecked exception울 구분하지 않는다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Checked, Unchecked exception울 구분하지 않는다.</h3>\n<ul>\n<li>즉, 모두가 unchecked 이므로 throw를 쓸 일이 없다.</li>\n</ul>\n<h3 id=\"try-with-resources\" style=\"position:relative;\"><a href=\"#try-with-resources\" aria-label=\"try with resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>try with resources</h3>\n<ul>\n<li>try with resources 사라짐</li>\n<li>use문을 대신 사용한다.</li>\n</ul>\n<h2 id=\"함수\" style=\"position:relative;\"><a href=\"#%ED%95%A8%EC%88%98\" aria-label=\"함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>함수</h2>\n<h3 id=\"함수-선언-문법\" style=\"position:relative;\"><a href=\"#%ED%95%A8%EC%88%98-%EC%84%A0%EC%96%B8-%EB%AC%B8%EB%B2%95\" aria-label=\"함수 선언 문법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>함수 선언 문법</h3>\n<ul>\n<li>public은 생략 가능 디폴트가 public이다.</li>\n<li>Unit도 생략 가능</li>\n<li>if else가 expression인 것과 함수가 하나의 결과 값이라면 아래와 같이 괄호 대신 =를 함수에 쓸 수 있다.\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span> b<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Int <span class=\"token operator\">=</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> a <span class=\"token operator\">></span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    a\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    b\n  <span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>한 줄로 변경가능, 자동 type 추론과 block이 없음을 활용하면 아래와 같이 더 간결해질 수 있다.\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span> b<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> a <span class=\"token operator\">></span> b <span class=\"token punctuation\">)</span> a <span class=\"token keyword\">else</span> b</code></pre></div>\n</li>\n</ul>\n<h3 id=\"디폴트-파라미터\" style=\"position:relative;\"><a href=\"#%EB%94%94%ED%8F%B4%ED%8A%B8-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0\" aria-label=\"디폴트 파라미터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디폴트 파라미터</h3>\n<h3 id=\"named-argument\" style=\"position:relative;\"><a href=\"#named-argument\" aria-label=\"named argument permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>named argument</h3>\n<ul>\n<li>빌더를 직접 만들지 않고도 빌더의 장점을 지니게 된다.</li>\n</ul>\n<h3 id=\"같은-타입의-여러-파라미터-받기--가변인자-\" style=\"position:relative;\"><a href=\"#%EA%B0%99%EC%9D%80-%ED%83%80%EC%9E%85%EC%9D%98-%EC%97%AC%EB%9F%AC-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EB%B0%9B%EA%B8%B0--%EA%B0%80%EB%B3%80%EC%9D%B8%EC%9E%90-\" aria-label=\"같은 타입의 여러 파라미터 받기  가변인자  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>같은 타입의 여러 파라미터 받기 ( 가변인자 )</h3>\n<ul>\n<li>vararg 키워드 사용해야 하고 가변인자 함수를 배열과 함께 호출할 때는 ’*’  ( 스프레드 연산자 )를 붙여줘야 한다.\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token function\">printAll</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>arrays<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/lecture?courseSlug=java-to-kotlin\">https://www.inflearn.com/course/lecture?courseSlug=java-to-kotlin</a></li>\n<li><a href=\"https://github.com/lannstark/java-to-kotlin-starter-guide\">https://github.com/lannstark/java-to-kotlin-starter-guide</a></li>\n</ul>","frontmatter":{"date":"November 18, 2023","title":"[Kotlin] 코드 제어하는 방법","categories":"Java/Kotlin","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/kotlin2/"}},"prev":{"id":"24dcb914-b2ff-506d-813e-ffdeeee12a65","html":"<h2 id=\"1-kube-bench-문제\" style=\"position:relative;\"><a href=\"#1-kube-bench-%EB%AC%B8%EC%A0%9C\" aria-label=\"1 kube bench 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Kube-bench 문제</h2>\n<p>문제에서 kube-bench를 실행 후 도출되는 아래 취약점에 대해서 조치하라는 문제</p>\n<ul>\n<li>kube api server 취약점\n<ul>\n<li>Ensure —authorization-mode argument is not set to AlwaysAllow</li>\n<li>Ensure —authorization-mode includes Node, RBAC</li>\n<li>Ensure —insecure-bind-address argument is not set</li>\n</ul>\n</li>\n<li>kubelet 취약점\n<ul>\n<li>Ensure anonymous-auth argument is set to false</li>\n<li>Ensure —authorization-mode argument is not set to AlwaysAllow</li>\n</ul>\n</li>\n<li>etcd 취약점\n<ul>\n<li>Ensure —client-cert-auth argument is set to true</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"정답\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5\" aria-label=\"정답 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>kube api server 조치\n<ul>\n<li><code class=\"language-text\">--authorization-mode=Node,RBAC</code> 로 설정</li>\n<li><code class=\"language-text\">--insecure-bind-address=0.0.0.0</code> 로 되어 있는 행 삭제</li>\n</ul>\n</li>\n<li>kubelet 조치\n<ul>\n<li>/var/lib/kubelet/config.yaml 파일에서 아래와 같이 설정\n<ul>\n<li>anonymous-auth false로 설정\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">authentication:\n  anonymous:\n    enabled: false</code></pre></div>\n</li>\n<li>authorization-mode Webhook으로 설정\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  authorization:\n    mode: Webhook</code></pre></div>\n</li>\n</ul>\n</li>\n<li><code class=\"language-text\">systemctl daemon-reload</code>, <code class=\"language-text\">systemctl restart</code> 해주기</li>\n</ul>\n</li>\n<li>etcd 조치\n<ul>\n<li>/etc/kubernetes/manifests/etcd.yaml에서 아래와 같이 설정\n<ul>\n<li><code class=\"language-text\">--client-cert-auth=true</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-serviceaccount-문제\" style=\"position:relative;\"><a href=\"#2-serviceaccount-%EB%AC%B8%EC%A0%9C\" aria-label=\"2 serviceaccount 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. ServiceAccount 문제</h2>\n<p>Your organization’s security policies include:</p>\n<ul>\n<li>serviceaccount does not automatically mount API credentials</li>\n<li>serviceaccount name must end with “-sa”</li>\n</ul>\n<p>Listing file <code class=\"language-text\">/cs/sa/pod1.yaml</code>. The pod specified in yaml cannot be scheduled due to an error specified in serviceaccount.</p>\n<p>Please complete the project:</p>\n<ul>\n<li>\n<ol>\n<li>Create new serviceaccount named <code class=\"language-text\">backend-sa</code> in the existing namespace <code class=\"language-text\">qa</code> to ensure that this serviceaccount does not automatically mount API credentials.</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>Use <code class=\"language-text\">/cs/sa/pod1.yaml</code> to create a pod</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>Finally, clean up any unused serviceaccounts in namespace <code class=\"language-text\">qa</code></li>\n</ol>\n</li>\n</ul>\n<h3 id=\"정답-1\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-1\" aria-label=\"정답 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>\n<ol>\n<li><code class=\"language-text\">k create sa backend-sa -n qa --dry-run=client -o yaml > 2.yaml</code></li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>2.yaml에 아래와 같이 automountServiceAccountToken만 추가해주고 apply</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: backend-sa\n  namespace: qa\nautomountServiceAccountToken: false </code></pre></div>\n</li>\n<li>\n<ol start=\"3\">\n<li>/cs/sa/pod1.yaml을 vi로 열고 serviceAccountName만 backend-sa로 수정 후 apply</li>\n</ol>\n</li>\n<li>\n<ol start=\"4\">\n<li>k get pod -o yaml -n qa | grep “serviceAccount:” 를 해서 조회되지 않는 serviceaccount 인 test01을 삭제한다.</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"3-network-policy\" style=\"position:relative;\"><a href=\"#3-network-policy\" aria-label=\"3 network policy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Network Policy</h2>\n<p>A default-deny network policy avoids accidentally exposing a pod in a namespace that does not define any other Networkpolicy.\n<br>\nCreate a new default DenyPolicy named <code class=\"language-text\">denypolicy</code> in namespace <code class=\"language-text\">testing</code> for all traffic of type ingress+Egress.</p>\n<ul>\n<li>This new NP must deny all Ingress+Egress traffic in namespace <code class=\"language-text\">testing</code>.</li>\n<li>The newly created default Deny network policy application is matched to all pods running in namespace testing.</li>\n</ul>\n<h3 id=\"정답-2\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-2\" aria-label=\"정답 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>기본 NP 만들기\n<ul>\n<li>공식 doc에서 default deny에 대한 템플릿 가져와서 name과 namespace 만 지정해주면됨\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  apiVersion: networking.k8s.io/v1\n  kind: NetworkPolicy\n  metadata:\n    name: denypolicy\n    namespace: testing\n  spec:\n    podSelector: {}\n    policyTypes:\n    - Ingress\n    - Egress</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-rbac\" style=\"position:relative;\"><a href=\"#4-rbac\" aria-label=\"4 rbac permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. RBAC</h2>\n<p>The role bound to the pod’s serviceaccount grants over-loose permission. Complete the following item to reduce the permission set.</p>\n<p>An existing Pod named <code class=\"language-text\">web-pod</code> is already running in namespace <code class=\"language-text\">db</code>.\nEdit the existing Role bound to the serviceaccount <code class=\"language-text\">service-account-web</code> to allow only get operations on resource type of services.\nCreate a role <code class=\"language-text\">role-2</code> in namespace <code class=\"language-text\">db</code> and only allow new role to perform delete operations on resource type of namespaces.\nCreate a new RoleBinding named <code class=\"language-text\">role-2-binding</code>. Bind the newly created Role to the Pod’s serviceaccount</p>\n<p>Note: Do not delete existing rolebinding</p>\n<h3 id=\"정답-3\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-3\" aria-label=\"정답 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li><code class=\"language-text\">service-account-web</code>과 bound되어 있는 <code class=\"language-text\">role-1</code>을 services 만 get할 수 있도록 수정한다. ( k edit role )</li>\n<li><code class=\"language-text\">db</code> namespace에 <code class=\"language-text\">role-2</code>를 생성하고 namepsaces만 delete할 수 있도록 생성한다.</li>\n<li><code class=\"language-text\">role-2-binding</code>이라는 새로운 rolebinding을 생성하여 <code class=\"language-text\">role-2</code>와 <code class=\"language-text\">service-account-web</code>을 연결시킨다.\n<ul>\n<li><code class=\"language-text\">k create rolebinding role-2-binding --role=role-2 --serviceaccount=service-account-web -n d</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"5-k8s-audit\" style=\"position:relative;\"><a href=\"#5-k8s-audit\" aria-label=\"5 k8s audit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. K8S audit</h2>\n<p>Enable audit logging in cluster. To do this, enable the log backend and ensure that:</p>\n<ul>\n<li>The logs are stored in /var/log/kubernetes/audit-logs.txt</li>\n<li>Logs file can be retained for 10days</li>\n<li>Retain up to 2 old audit log files</li>\n</ul>\n<p>/etc/kubernetes/logpolicy/sampolepolicy.yaml provides the basic strategy. It specifies only what is not recorded.\nNote: The base policy is located on the master node of the cluster.</p>\n<p>Edit and expand basic strategies to record:</p>\n<ul>\n<li>RequestResponse level, persistentvolumes change</li>\n<li>configmaps change to request body in namespace <code class=\"language-text\">front-apps</code></li>\n<li>Changes to configmap and secret in all namespaces at the metadata level</li>\n</ul>\n<p>In addition, add a comprehensive rule to record all other requests at the Metadata level.\nNote: Dont’ forget to apply the modified policy.</p>\n<h3 id=\"정답-4\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-4\" aria-label=\"정답 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>\n<p>kube-apiserver의 yaml파일을 백업해두고 audit enable 및 설정을 문제대로 진행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>audit<span class=\"token punctuation\">-</span>policy<span class=\"token punctuation\">-</span>file=/etc/kubernetes/logpolicy/samplepolicy.yaml\n  <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>audit<span class=\"token punctuation\">-</span>log<span class=\"token punctuation\">-</span>path=/var/log/kubernetes/audit<span class=\"token punctuation\">-</span>logs.txt\n  <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>audit<span class=\"token punctuation\">-</span>log<span class=\"token punctuation\">-</span>maxage=10\n  <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>audit<span class=\"token punctuation\">-</span>log<span class=\"token punctuation\">-</span>maxbackup=2</code></pre></div>\n</li>\n<li>\n<p>kube-apiserver yaml파일에서 volumes과 volumeMount를 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/kubernetes/logpolicy/samplepolicy.yaml\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit\n    <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /var/log/kubernetes/\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit<span class=\"token punctuation\">-</span>log\n    <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit\n  <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /etc/kubernetes/logpolicy/samplepolicy.yaml\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> File\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit<span class=\"token punctuation\">-</span>log\n  <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /var/log/kubernetes/\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> DirectoryOrCreate</code></pre></div>\n</li>\n<li>\n<p>이와 같이 설정 후 kube-apiserver가 안 뜰 수 있음 <code class=\"language-text\">systemctl daemon-reload</code>, <code class=\"language-text\">sytemctl restart kubelet</code>를 해주어야 함</p>\n</li>\n<li>\n<p>마지막으로 <code class=\"language-text\">tail /var/log/kubernetes/audit-logs.txt</code> 명령으로 정상적 auditing되는 지 검증한다.</p>\n</li>\n<li>\n<p>basic strategy로 주어진 yaml 파일에 3가지 record 요구조건에 해당 하는 정책들을 doc을 참고하여 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">level</span><span class=\"token punctuation\">:</span> RequestResponse\n      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"persistentvolumes\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">level</span><span class=\"token punctuation\">:</span> Metadata\n      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span> <span class=\"token comment\"># core API group</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"secrets\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"configmaps\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">level</span><span class=\"token punctuation\">:</span> Request\n      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span> <span class=\"token comment\"># core API group</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"configmaps\"</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">namespaces</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"kube-system\"</span><span class=\"token punctuation\">]</span>\n</code></pre></div>\n<ul>\n<li>단, 마지막에 catch-all rule까지 추가해주어야 정답이다.\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># A catch-all rule to log all other requests at the Metadata level.</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">level</span><span class=\"token punctuation\">:</span> Metadata\n  <span class=\"token comment\"># Long-running requests like watches that fall under this rule will not</span>\n  <span class=\"token comment\"># generate an audit event in RequestReceived.</span>\n  <span class=\"token key atrule\">omitStages</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"RequestReceived\"</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"6-create-a-secret\" style=\"position:relative;\"><a href=\"#6-create-a-secret\" aria-label=\"6 create a secret permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. Create a Secret</h2>\n<p>Get the contents of an existing secret named <code class=\"language-text\">db1-test</code> in namespace <code class=\"language-text\">istio-system</code>\nStore the username field in the name <code class=\"language-text\">/cs/sec/user.txt</code> file and store the password in <code class=\"language-text\">/cs/sec/pass.txt</code> file.</p>\n<p>Note : Do not use or modify created files in the following steps, you can create new temporary files if needed.</p>\n<p>Create a new secret named <code class=\"language-text\">db2-test</code> in <code class=\"language-text\">istio-system</code> namespace as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">username: production-instance\npassword: KvLftKgs4aVH</code></pre></div>\n<p>Finally, create a new pod, it can access secret <code class=\"language-text\">db2-test</code> via volume</p>\n<ul>\n<li>name : <code class=\"language-text\">secret-pod</code></li>\n<li>namespace: <code class=\"language-text\">istio-system</code></li>\n<li>container name: <code class=\"language-text\">dev-container</code></li>\n<li>image : <code class=\"language-text\">nginx</code></li>\n<li>volume name: <code class=\"language-text\">secret-volume</code></li>\n<li>mounting path: <code class=\"language-text\">/etc/secret</code></li>\n</ul>\n<h3 id=\"정답-5\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-5\" aria-label=\"정답 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li><code class=\"language-text\">db1-test1</code> secret에서 username, password를 추출 후 base64로 디코딩된 결과를 각각의 파일에 저장한다.\n<ul>\n<li><code class=\"language-text\">k get secret db1-test -n istio-system -o=jsonpath='{.data.username}' | base64 -d > /cs/sec/user.txt</code></li>\n<li><code class=\"language-text\">k get secret db1-test -n istio-system -o=jsonpath='{.data.password}' | base64 -d > /cs/sec/pass.txt</code></li>\n</ul>\n</li>\n<li><code class=\"language-text\">db2-test</code> secret 생성하기\n<ul>\n<li><code class=\"language-text\">kubectl create secret generic db2-test -n istio-system --from-literal=username=production-instance --from-literal=password=KvLftKgs4aVH</code></li>\n</ul>\n</li>\n<li>pod에 <code class=\"language-text\">db2-test</code> 을 secret 문제의 조건대로 volume mount하여 생성하기\n<ul>\n<li>아래와 같이 작성 후 apply</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n  <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>pod\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>system\n  <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>container\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>volume\n        <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/etc/secret\"</span>\n        <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>volume\n      <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> db2<span class=\"token punctuation\">-</span>test</code></pre></div>\n</li>\n</ul>\n<h2 id=\"7-dockerfile\" style=\"position:relative;\"><a href=\"#7-dockerfile\" aria-label=\"7 dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. Dockerfile</h2>\n<ul>\n<li>\n<p>Analyze and edit the given Dockerfile <code class=\"language-text\">/cks/docker/dockerfile</code> ( based on ubuntu: 16.04 image ), and fix two instructions that have prominent security/best practices issues in the file</p>\n</li>\n<li>\n<p>Analyze and edit the given manifest file <code class=\"language-text\">/cs/docker/deployment.yaml</code>\nand fix two fields that have prominent security/best practices issues in the file</p>\n<blockquote>\n<p>Note: Do not add or remove configuration settings. simply modify the existing configuration settings so that there is no more secruity/best real money problem with both of the above existing settings.</p>\n</blockquote>\n<blockquote>\n<p>Note: If you need a non-privileged user to exeute any project, please use the user <code class=\"language-text\">nobody</code> with user ID <code class=\"language-text\">65535</code>, just modify it, no need to create it.</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"정답-6\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-6\" aria-label=\"정답 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>\n<ol>\n<li>/cks/docker/dockerfile 부터 살펴보기</li>\n</ol>\n<ul>\n<li><code class=\"language-text\">FROM ubuntu:latest</code> -> <code class=\"language-text\">FROM ubuntu:16.04</code>로 수정</li>\n<li>2번째 USER 를 root -> nobody로 변경</li>\n<li><code class=\"language-text\">sudo docker build .</code></li>\n</ul>\n</li>\n<li>\n<ol start=\"2\">\n<li>/cs/docker/deployment.yaml 살펴보기</li>\n</ol>\n<ul>\n<li>pod쪽의 label을 deployment의 selector.matchLabels에 맞게 수정\n<ul>\n<li>run: couchdb -> app: couchdb로 수정</li>\n</ul>\n</li>\n<li>securityContext의 capability 내역 중 ‘CAP_SYS_ADMIN’을 삭제</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"8-gvisor\" style=\"position:relative;\"><a href=\"#8-gvisor\" aria-label=\"8 gvisor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. gVisor</h2>\n<p>The cluster uses containerd as the CRI runtime. containerd’s default runtime handler is runc.\ncontainer is ready to support additional runtime handler runsc <code class=\"language-text\">gVisor</code></p>\n<ul>\n<li>Create a RuntimeClass named <code class=\"language-text\">untrusted</code> using an existing runtime handler named <code class=\"language-text\">runsc</code>.</li>\n</ul>\n<p>Update all pods in namespace <code class=\"language-text\">server</code> to run on gVisor.\n<br>\nYou can do this at /cks/gVisor/rc. Find a list of templates in yaml</p>\n<h3 id=\"정답-7\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-7\" aria-label=\"정답 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>runtimeclass 생성\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> node.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RuntimeClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> untrusted\n<span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> runsc</code></pre></div>\n</li>\n<li><code class=\"language-text\">server</code> namespace 내에 모든 deployment을 edit하여 runtimeclass 설정\n<ul>\n<li>spec.template.spec.runtimeClassName을 설정</li>\n<li>k edit deploy busybox-run -n server\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runtimeClassName</span><span class=\"token punctuation\">:</span> untrusted <span class=\"token comment\">## 이행 추가</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"9-container-security\" style=\"position:relative;\"><a href=\"#9-container-security\" aria-label=\"9 container security permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. Container security</h2>\n<h3 id=\"9-1\" style=\"position:relative;\"><a href=\"#9-1\" aria-label=\"9 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9-1.</h3>\n<p>Best practice is to design containers as stateless and immutable.</p>\n<ul>\n<li>Check the pods running in namespace <code class=\"language-text\">production</code> and remove any non-stateless or immutable pods.</li>\n<li>Use the following strict interpretations of statelessness and immutability.\n<ul>\n<li>A container of pods capable of storing data within a container must be considered stateless.</li>\n<li>Privileged pods configured to be of any kind must be considered stateless and immutable.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"정답-8\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-8\" aria-label=\"정답 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>privileged : true로 설정된 pod와 hostPath로 volume이 잡힌 pod를 모두 삭제한다.</li>\n</ul>\n<h3 id=\"9-2\" style=\"position:relative;\"><a href=\"#9-2\" aria-label=\"9 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9-2.</h3>\n<p>Modify the deployment <code class=\"language-text\">secdep</code> in the <code class=\"language-text\">sec-ns</code> namespace as follows:</p>\n<ul>\n<li>First, start the container with a user id of 30000</li>\n<li>Second, do not allow a process to get privileges beyond its parent process ( allowPrivilegeEscalation is prohibited )</li>\n<li>Third, load the container’s root file system in a read-only manner( read-only permission to the root file )</li>\n</ul>\n<h3 id=\"정답-9\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-9\" aria-label=\"정답 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>k edit deploy secdep -n sec-ns 를 해서\n<ul>\n<li>pod레벨에서 설정 :  <code class=\"language-text\">spec.securityContext.runAsUser: 30000</code>으로 설정</li>\n<li>존재하는 모든 컨테이너에 대해 아래 내용 설정\n<ul>\n<li>컨테이너 레벨에서 설정 :  <code class=\"language-text\">spec.containers.securityContext.allowPrivilegeEscalation: false</code> 로 설정</li>\n<li>컨테이너 레벨에서 설정 :  <code class=\"language-text\">spec.containers.securityContext.readOnlyRootFilesystem: true</code>로 설정</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"10-network-policy\" style=\"position:relative;\"><a href=\"#10-network-policy\" aria-label=\"10 network policy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. Network policy</h2>\n<p>Create a NetworkPolicy called <code class=\"language-text\">pod-restriction</code> to restrict access to pod <code class=\"language-text\">product-service</code> running in namepsace <code class=\"language-text\">dev-team</code>.\nAllow only the following pods to connect to <code class=\"language-text\">product-service</code> pod</p>\n<ul>\n<li>All pod from namespace <code class=\"language-text\">qaqa</code></li>\n<li>pod with label <code class=\"language-text\">environment:testing</code> located in any namespace</li>\n</ul>\n<h3 id=\"정답-10\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-10\" aria-label=\"정답 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<p>아래와 같이 구성하면 된다. from 절이 2개 있으면 2개 조건이 or 되고, from절 하나에 2개의 조건이 들어가면 조건이 서로 and처리되는 것으로 이해하면 됨.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> NetworkPolicy\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pod<span class=\"token punctuation\">-</span>restriction\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>team\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">podSelector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span> testing\n  <span class=\"token key atrule\">policyTypes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> Ingress\n  <span class=\"token key atrule\">ingress</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">namespaceSelector</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> qaqa\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span>\n       <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">namespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n         <span class=\"token key atrule\">podSelector</span><span class=\"token punctuation\">:</span>\n           <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n             <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span> testing</code></pre></div>\n<h2 id=\"11-trivy\" style=\"position:relative;\"><a href=\"#11-trivy\" aria-label=\"11 trivy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>11. Trivy</h2>\n<p>Detect severely vulnerable images used by pods in namespace <code class=\"language-text\">kamino</code> using the Trivy open source container scanner\nFind images with High and Critical serverity vulnerabilities and remove pods that use these images</p>\n<ul>\n<li>Note: Trivy is installed only on the master node of the cluster and is not available on the working node.</li>\n</ul>\n<p>You have to switch to the master node of the cluster to use Trivy.</p>\n<h3 id=\"정답-11\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-11\" aria-label=\"정답 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>kamino namespace에 존재하는 모든 pod의 Image 리스트 추출</li>\n<li><code class=\"language-text\">trivy image --severity HIGH,CRITICAL {이미지명}</code> 으로 vulnerable한 이미지 찾아서 해당 pod 삭제</li>\n</ul>\n<h2 id=\"12-apparmor\" style=\"position:relative;\"><a href=\"#12-apparmor\" aria-label=\"12 apparmor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>12. Apparmor</h2>\n<p>Apparmor is enabled on <code class=\"language-text\">node02</code> of the cluster’s working node. The platform apparmor configuration file already exists, but has not been implemented.\n<br>\nOn <code class=\"language-text\">node02</code> of the cluster, implementation is located in /etc/apparmor.d/nginx_apparmor is existing Apparmor configuration file.</p>\n<ul>\n<li>Edit in <code class=\"language-text\">/cs/KSSH00401/nginx-deploy.yaml</code> file to apply the apparmor configuration file.</li>\n<li>Finally, apply the mmanifest file and create the pod specified it.</li>\n</ul>\n<br>\n<blockquote>\n<p>Please note that during the test, apparmor is indicated on the working node, so you need to ssh to the working node written at the beginning.\nIn an analog environment, you need ssh to node02 to work.</p>\n</blockquote>\n<h3 id=\"정답-12\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-12\" aria-label=\"정답 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>\n<ol>\n<li>ssh to node02</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li><code class=\"language-text\">apparmor_parser -q /etc/apparmor.d/nginx_apparmor</code></li>\n</ol>\n<ul>\n<li>profile명 알아내고 aa-status로 해당 profile 잘 로드되었는지 확인</li>\n</ul>\n</li>\n<li>\n<ol start=\"3\">\n<li><code class=\"language-text\">/cs/KSSH00401/nginx-deploy.yaml</code>의 deployment definition 파일에서 pod의 annotation에 <code class=\"language-text\">container.apparmor.security.beta.kubernetes.io/&lt;container_name>: &lt;profile_ref></code> 내용 추가</li>\n</ol>\n</li>\n<li>\n<ol start=\"4\">\n<li>k apply -f /cs/KSSH00401/nginx-deploy.yaml</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"13-falco--sysdig\" style=\"position:relative;\"><a href=\"#13-falco--sysdig\" aria-label=\"13 falco  sysdig permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>13. Falco &#x26; sysdig</h2>\n<p>Use the runtime detction tool to detect frequency generation and execution exception selections in a single pod <code class=\"language-text\">tomcat123</code> container.\n<br>\nUse the tool to analyze for at least 30 seconds. Use the filter to check the generated and executed process, write the event to the <code class=\"language-text\">/opt/KSR00101/incidents/summary</code> file, which contains the detected events, in the following format: <code class=\"language-text\">timestamp.uid,username,processName</code>.</p>\n<h3 id=\"정답-13\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-13\" aria-label=\"정답 13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>Sysdig 사용 권장\n<ul>\n<li>sysdig -l | grep {time, user, proc, name} 등의 명령으로 output 시 사용할 변수명을 파악할 수 있음</li>\n<li>crictl info | grep sock 명령으로 containerEndpoint가 <code class=\"language-text\">/run/containerd/containerd.sock</code> 임을 확인할 수 있음</li>\n<li>sysdig -M 30 -p ‘%evt.time, %user.name, %proc.name’ —cri /run/containerd/containerd.sock container.name=tomcat123 >> 주어진 파일 경로</li>\n</ul>\n</li>\n<li>Falco\n<ul>\n<li>kubectl describe tomcat123으로 container id 알아내기</li>\n<li>/etc/faloco/falco.yaml에서 <code class=\"language-text\">file_output.enabled: true</code>, <code class=\"language-text\">file_output.filename</code>의 경로를 확인하기\n<ul>\n<li>여기서 수정이 발생하면 <code class=\"language-text\">daemon-reload</code>, <code class=\"language-text\">systemctl restart falco</code>를 수행해준다.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">%evt.time,%user.uid,%proc.name</code></li>\n<li>결과를 output으로 임의의 node02 의 특정 경로에 출력한 후 해당 로그를 local의 <code class=\"language-text\">/opt/KSR00101/incidents/summary</code>에 붙여넣어야 할 듯하다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"14-tls\" style=\"position:relative;\"><a href=\"#14-tls\" aria-label=\"14 tls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>14. TLS</h2>\n<p>strengthen kube-apiserver security configuration through TLS, requirements:</p>\n<ul>\n<li>kube-apiserver is not allowed except version TLS13 and above.</li>\n<li>Cipher suite is <code class=\"language-text\">TLS_AES_128_GC_SHA256</code></li>\n</ul>\n<p>Enhance ETCD security configuration with TLS, requirements:</p>\n<ul>\n<li>cipher suite <code class=\"language-text\">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code></li>\n</ul>\n<h3 id=\"정답-14\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-14\" aria-label=\"정답 14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>kube-apiserver 강화\n<ul>\n<li>kube-apiserver.yaml파일의 command에 아래 내용 2개 추가\n<ul>\n<li><code class=\"language-text\">- --tls-min-version=VersionTLS13</code></li>\n<li><code class=\"language-text\">- --tls-cipher-suites=TLS_AES_128_GC_SHA256</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>etcd 강화\n<ul>\n<li>etcd.yaml파일의 command에 <code class=\"language-text\">- --ciper-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code>행 추가\n<ul>\n<li>kube-apiserver와 달리 ‘tls-‘가 없음에 주의</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><code class=\"language-text\">systemctl daemon-reload</code>, <code class=\"language-text\">systemctl restart kubelet</code></li>\n</ul>\n<h2 id=\"15-enabling-api-server-authentication\" style=\"position:relative;\"><a href=\"#15-enabling-api-server-authentication\" aria-label=\"15 enabling api server authentication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>15. Enabling API SERVER authentication</h2>\n<p>Kubernetes API server for cluster created by kubeadm. For testing purposes, temporary configuration allows unauthenticated and unauthorized access, granting anonymnous user <code class=\"language-text\">cluster-admin</code> access.\n<br>\nReconfigure the kubernetes API server for cluster. Ensure that only authenticated  and authorized REST requests are allowed.</p>\n<ul>\n<li>Use authorization mode ‘Node, RBAC’ and Access Controller ‘NodeRestriction’.</li>\n<li>Delete the <code class=\"language-text\">system:anonymous</code> Clusterrolebinding to clean up.</li>\n</ul>\n<br>\n<blockquote>\n<p>Note : all kubectl configuration environments/files are also configured to use unauthenticated and unauthorized access. You don’t have to change it. Note,  however, that once the cluster is secured, the configuration of kubectl will not work. You can use the cluster’s original kubectl configuration file <code class=\"language-text\">/etc/ kubernetes/admin.conf</code> on the master node of the cluster. Ensure that authenticated authorization reqeusts are still allowed.</p>\n</blockquote>\n<p>In the simulation environment, the script to initialize this problem is b.sh</p>\n<h3 id=\"정답-15\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-15\" aria-label=\"정답 15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<ul>\n<li>kube-apiserver.yaml 파일 수정하기\n<ul>\n<li><code class=\"language-text\">- --authorization-mode=Node,RBAC</code> 로 수정</li>\n<li><code class=\"language-text\">- --enable-admission-plugins=NodeRestriction</code>으로 수정</li>\n</ul>\n</li>\n<li><code class=\"language-text\">system:anonymous</code> clusterrolbinding 삭제하기</li>\n<li>위 작업이 끝난 뒤, 그냥 k get pod시엔 제한되고, master노드에서 <code class=\"language-text\">k get pod -A --kubeconfig /etc/kubernetes/admin.conf</code>를 실행했을 때 정상적으로 pod가 조회되면 성공</li>\n</ul>\n<h2 id=\"16-imagepolicywebhook--container-image-scanning\" style=\"position:relative;\"><a href=\"#16-imagepolicywebhook--container-image-scanning\" aria-label=\"16 imagepolicywebhook  container image scanning permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>16. ImagePolicyWebhook : container image scanning</h2>\n<p>The container mirroring scanner is set up on the cluster, but it is not fully integrated into the cluster’s configuration.\nAfter completion, the container mirror scanner should scan and reject the use of vulnerable mirrors.\n<br></p>\n<blockquote>\n<p>Note: You must complete the entire test on the matser node of the cluster, and all services and files are ready and places on that node.</p>\n</blockquote>\n<br>\nGiven an incomplete configuration in directory `/etc/kubernetes/epconfig`, as well as `https://image-bouncer-webhook.default.svc:1323/image_policy` functional container image scanner.\n<br>\n<ul>\n<li>\n<ol>\n<li>Enable the necessary plugins to create mirror policies.</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>Verify the control configuration and change it to implicit deny.</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>Edit the configuration to correctly point to the provided HTTPS endpoint last, by trying to deploy vulnerable resources <code class=\"language-text\">/cks/img/web1/yaml</code> to test if the configuration is valid.</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"정답-16\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%8B%B5-16\" aria-label=\"정답 16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정답</h3>\n<p>처음에 <code class=\"language-text\">k apply /cks/img/web1/yaml</code>를 실행해보면 pod가 정상적으로 생성되는 걸 확인할 수 있다. 이걸 막고 싶은게 우리의 목적이다. 테스트 한 뒤엔 다시 삭제해주자.</p>\n<ul>\n<li><code class=\"language-text\">epconfig</code> 디렉토리 하위에 보면 여러 파일들이 있는데 그 중에 <code class=\"language-text\">admission_configuration.json</code>파일에서 <code class=\"language-text\">imagePolicy.defaultAllow: true</code> 에서 <code class=\"language-text\">imagePolicy.defaultAllow: false</code>로 수정하기 ( 2번 요구사항 )</li>\n<li><code class=\"language-text\">epconfig</code> 디렉토리 하위의 kubeconfig.yaml파일에서 <code class=\"language-text\">clusters.cluster.server</code>의 값이 문제에 따르면 <code class=\"language-text\">https://image-bouncer-webhook.default.svc:1323/image_policy</code>여야 하는데 설정이 안되어 있으므로 추가 설정해주기. (3번 요구사항)</li>\n<li>kube-apiserver 설정하기\n<ul>\n<li><code class=\"language-text\">- --enable-admission-plugins=ImagePolciyWebhook</code>을 추가해주기</li>\n<li><code class=\"language-text\">- --admission-control-config-file=/etc/kubernetes/epconfig/admission_configuration.json</code>을 설정해준다.\n<ul>\n<li>그런데 kube-apiserver pod에서 이 json파일을 런타임시 사용하기 위해서는 volumem으로 마운트해줘야 하기에 volumes, volumeMount 설정을 추가해준다.\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/kubernetes/epconfig\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> epconfig\n  <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n.\n.\n.\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /etc/kubernetes/epconfig\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> DirectoryOrCreate\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> epconfig</code></pre></div>\n</li>\n</ul>\n</li>\n<li><code class=\"language-text\">systemctl daemon-reload</code>, <code class=\"language-text\">systemctl restart kubelet</code></li>\n</ul>\n</li>\n<li>마지막으로 <code class=\"language-text\">k apply /cks/img/web1/yaml</code> 명령이 실행 안되는 것으로 테스트 완료</li>\n</ul>","frontmatter":{"date":"November 24, 2023","title":"[CKS] 실제 기출","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks-chinaexam/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/error-redis-fail/","nextSlug":"/kotlin2/","prevSlug":"/cks-chinaexam/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}