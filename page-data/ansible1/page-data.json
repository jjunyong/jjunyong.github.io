{"componentChunkName":"component---src-templates-blog-template-js","path":"/ansible1/","result":{"data":{"cur":{"id":"83b292de-808a-5f49-8884-5c21a31ca3d7","html":"<h2 id=\"1-ansible-설치\" style=\"position:relative;\"><a href=\"#1-ansible-%EC%84%A4%EC%B9%98\" aria-label=\"1 ansible 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Ansible 설치</h2>\n<ul>\n<li>‘Community Ansible’을 많이들 쓰지만 시험은 컨테이너 기반의 <code class=\"language-text\">Red hat Ansible Automatin Platform</code>을 사용한다.\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dnf <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> ansible-*  <span class=\"token comment\"># ansible-navigator를 설치하기 위함 </span>\n<span class=\"token function\">podman</span> login utility.lab.example.com\nansible-navigator images <span class=\"token comment\"># 실행환경 컨테이너 이미지 다운로드</span></code></pre></div>\n</li>\n</ul>\n<h2 id=\"2-인벤토리\" style=\"position:relative;\"><a href=\"#2-%EC%9D%B8%EB%B2%A4%ED%86%A0%EB%A6%AC\" aria-label=\"2 인벤토리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 인벤토리</h2>\n<ul>\n<li>인벤토리를 통해 관리 대상 호스트를 지정한다.</li>\n<li>정적 인벤토리 : 직접 ip, hostname 등록</li>\n<li>동적 인벤토리 : 직접 만들지 않고 Inventory Provider에게 질의를 통해 파악한다.\n<ul>\n<li>ex) vsphere(linux), AD(windows)에 ansible이 물어봐서 호스트를 지정함</li>\n</ul>\n</li>\n<li>대괄호를 통해 인벤토리 그룹을 묶는다.\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>webservers<span class=\"token punctuation\">]</span>\nweb1.example.com\nweb2.example.com\n<span class=\"token number\">192.0</span>.2.42\n<span class=\"token punctuation\">[</span>db-servers<span class=\"token punctuation\">]</span>\ndb1.example.com\ndb2.example.com</code></pre></div>\n</li>\n<li>중첩그룹 : 그룹을 묶은 그룹 ( children keyword )\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>usa<span class=\"token punctuation\">]</span>\nwashington1.example.com\nwashington2.example.com\n<span class=\"token punctuation\">[</span>canada<span class=\"token punctuation\">]</span>\nontario01.example.com\nontario02.example.com\n<span class=\"token punctuation\">[</span>north-america:children<span class=\"token punctuation\">]</span>\ncanada\nusa</code></pre></div>\n</li>\n<li>범위를 사용한 간소화\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>usa<span class=\"token punctuation\">]</span>\nwashington<span class=\"token punctuation\">[</span><span class=\"token number\">1</span>:2<span class=\"token punctuation\">]</span>.example.com\n\n<span class=\"token punctuation\">[</span>canada<span class=\"token punctuation\">]</span>\nontario<span class=\"token punctuation\">[</span>01:02<span class=\"token punctuation\">]</span>.example.com\n\n<span class=\"token punctuation\">[</span>korea<span class=\"token punctuation\">]</span>\n<span class=\"token number\">192.168</span>.<span class=\"token punctuation\">[</span><span class=\"token number\">4</span>:7<span class=\"token punctuation\">]</span>.<span class=\"token punctuation\">[</span><span class=\"token number\">0</span>:255<span class=\"token punctuation\">]</span> <span class=\"token comment\"># 192.168.4.0~192.168.7.255</span></code></pre></div>\n</li>\n<li>인벤토리는 반드시 등록 후 확인하여야 한다.\n<ul>\n<li>ansible 명령을 사용하는 방식 (구버전)\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ansible <span class=\"token parameter variable\">-i</span> inventory<span class=\"token punctuation\">(</span>inventory <span class=\"token function\">file</span> name<span class=\"token punctuation\">)</span> --list-hosts web </code></pre></div>\n</li>\n<li>all 그룹, ungrouped 그룹이라는 기본 그룹이 존재한다.</li>\n<li>ansible-navigator를 사용하는 방식\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">alias</span> <span class=\"token operator\">=</span> <span class=\"token string\">'ansible-navigator inventory -m stdout'</span>  <span class=\"token comment\"># ani alias 만들어 두어야 편하다. </span>\nani <span class=\"token parameter variable\">-i</span> inventory<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span> <span class=\"token parameter variable\">--graph</span> canada</code></pre></div>\n</li>\n</ul>\n</li>\n<li>ansible- 로 시작하는 여러 명령어가 많이 있었는데( ex. ansible-playbook. ansible-doc, ansible-inventory … ) 그걸 통일하기 위해 ansible-navigator 도입했으나, 실상 또 그 뒤에 한 번더 configre, playbook, inventory 등을 붙여줘야 됨</li>\n</ul>\n<h2 id=\"3-ansible-구성-파일-관리\" style=\"position:relative;\"><a href=\"#3-ansible-%EA%B5%AC%EC%84%B1-%ED%8C%8C%EC%9D%BC-%EA%B4%80%EB%A6%AC\" aria-label=\"3 ansible 구성 파일 관리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Ansible 구성 파일 관리</h2>\n<h3 id=\"ansiblecfg\" style=\"position:relative;\"><a href=\"#ansiblecfg\" aria-label=\"ansiblecfg permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ansible.cfg</h3>\n<ul>\n<li>4군데의 위치에 존재할 수 있으며 어떤 경로의 ansible.cfg를 현재 ansible core에서 참조하고 있는 지는 <code class=\"language-text\">ansible --version</code> 명령으로 확인 가능\n<ul>\n<li>그중 /etc/ansible/ansible.cfg -> 제일 낮은 우선순위</li>\n<li>touch ~/.ansible.cfg 를 한 이후에 <code class=\"language-text\">ansible --version</code>를 해보면 config file을 ~/ 경로에서 찾음을 알 수 있음</li>\n<li>touch ansible.cfg 를 현재 디렉토리에서 한 이후에 <code class=\"language-text\">ansible --version</code>을 해보면 ansible.cfg를 현재 디렉토리에서 찾음을 알 수 있음</li>\n<li>환경 변수 설정이 가장 우선순위가 높다 ( ex. ANSIBLE_CONFIG=/tmp/ansible.cfg &#x26;&#x26; export ANSIBLE_CONFIG )</li>\n</ul>\n</li>\n<li>기본적으로 작성할 수 있어야 한다. 아래는 예시이다.\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">[</span>defaults<span class=\"token punctuation\">]</span>\ninventory = ./inventory  <span class=\"token comment\"># 이 설정을 해주게 되면 이제 ani -i inventory 와 같이 직접 inventory 파일 설정 안해줘도 됨 </span>\nremote_user = user <span class=\"token comment\"># ssh 일반 user </span>\nask_pass = false <span class=\"token comment\"># 시험은 true 라고 해야 함. false는 공개키 설정을 했을 때만 가능 </span>\n\n<span class=\"token punctuation\">[</span>privilege_escalation<span class=\"token punctuation\">]</span>\nbecome = true <span class=\"token comment\"># 권한상승 여부</span>\nbecome_method = sudo <span class=\"token comment\"># sudo로 권한상승 할 것임</span>\nbecome_user = root \nbecome_ask_pass = false <span class=\"token comment\"># sudoers 파일에 NOPASSWD 설정이 wheel group에 되어 있을 때만 false </span></code></pre></div>\n</li>\n</ul>\n<blockquote>\n<p>참고 1 : wheel group</p>\n<ul>\n<li>관리자 계정</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>참고 2: Ansible ad-hoc</p>\n<ul>\n<li>playbook 없이도 단순 작업을 할 수 있게 해줌</li>\n<li>ad-hoc을 문서화한게 playbook으로 이해햐면 됨. 아래와 같은 m(모듈)과 a(명령어)를 정리한 것</li>\n</ul>\n<p>ex ) ansible lunch -m command -a ‘df -h’</p>\n</blockquote>\n<h3 id=\"ansible-navigatoryaml\" style=\"position:relative;\"><a href=\"#ansible-navigatoryaml\" aria-label=\"ansible navigatoryaml permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ansible-navigator.yaml</h3>\n<ul>\n<li>3군데에 존재할 수 있다.\n<ul>\n<li>ANSIBLE_NAVIGATOR_CONFIG 환경 변수</li>\n<li>현재 디렉토리의 ansible-navigator.yaml</li>\n<li>홈 디렉토리의 .ansible-navigator.yaml</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>참고 3 : VI editor tab 설정\n$HOME/.vimrc 파일에 <code class=\"language-text\">autocmd FileType yaml setlocal ai ts=2 sw=2 et sts=2 cuc</code>, <code class=\"language-text\">set nu</code> 행 추가\n<code class=\"language-text\">set cc=</code>를 vi 에디터 사용 중에 입력하면 빨간 라인 사라짐</p>\n</blockquote>\n<h2 id=\"4-playbook\" style=\"position:relative;\"><a href=\"#4-playbook\" aria-label=\"4 playbook permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Playbook</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> playbook 전체 에 대한 간단한 설명\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> inventory에 등록한 그룹<span class=\"token punctuation\">,</span> host명\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 작업(모듈) 1에 대한 설명\n      <span class=\"token key atrule\">모듈명(FQDN형식으로 적어야함)</span><span class=\"token punctuation\">:</span> \n        <span class=\"token key atrule\">argument1</span><span class=\"token punctuation\">:</span> 값\n        <span class=\"token key atrule\">argument2</span><span class=\"token punctuation\">:</span> 값 \n    \n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 작업(모듈) 2에 대한 설명\n      <span class=\"token key atrule\">모듈명</span><span class=\"token punctuation\">:</span> \n        <span class=\"token key atrule\">argument1</span><span class=\"token punctuation\">:</span> 값\n        <span class=\"token key atrule\">argument2</span><span class=\"token punctuation\">:</span> 값 </code></pre></div>\n<ul>\n<li><code class=\"language-text\">ansible-navigator doc -m stdout dnf</code> -> <code class=\"language-text\">/EXAMPLE</code> 와 같이 모듈의 사용법 알아내기</li>\n<li>playbook을 실행하기 전 문제가 없는지 테스트를 해야 한다.\n<ul>\n<li>구문 체크 : <code class=\"language-text\">ansible-navigator run -m stdout webserver.yml --syntax-check</code> or <code class=\"language-text\">ansible-playbook --syntax-check webserver.yaml</code></li>\n<li>-C : <code class=\"language-text\">ansible-navigator run -C -m stdout last.yaml</code></li>\n</ul>\n</li>\n<li>멱등성이 있기 때문에 playbook은 1번만 실행하지 않고 2번 이상 실행을 통해서 changed의 상태 값을 체크한다.</li>\n</ul>\n<h3 id=\"다중-플레이북\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%A4%91-%ED%94%8C%EB%A0%88%EC%9D%B4%EB%B6%81\" aria-label=\"다중 플레이북 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다중 플레이북</h3>\n<ul>\n<li>service 모듈\n<ul>\n<li>서비스의 중지 기동과 관련된 모듈</li>\n<li>list사용이 안되기 때문에 반복문을 사용하여 작성한다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 인트라넷 서비스 구성하기 \n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> servera.lab.example.com\n  <span class=\"token key atrule\">become</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd firewalld 설치 \n      <span class=\"token key atrule\">ansible.builtin.dnf</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> httpd\n          <span class=\"token punctuation\">-</span> firewalld\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> latest\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Test html 페이지 설정\n      <span class=\"token key atrule\">ansible.builtin.copy</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Welcome to the example.com intranet!\\n\"</span>\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /var/www/html/index.html\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Firewall 실행\n      <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> firewalld\n        <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> started\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Firewall http 설정 \n      <span class=\"token key atrule\">ansible.posix.firewalld</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> http\n        <span class=\"token key atrule\">permanent</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> enabled\n        <span class=\"token key atrule\">immediate</span><span class=\"token punctuation\">:</span> yes\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd 실행 \n      <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd\n        <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> started\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 웹서버 구성 test \n      <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> localhost\n      <span class=\"token key atrule\">become</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n      <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Connect to intranet web server\n      <span class=\"token key atrule\">ansible.builtin.uri</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//servera.lab.example.com\n        <span class=\"token key atrule\">return_content</span><span class=\"token punctuation\">:</span> yes\n        <span class=\"token key atrule\">status_code</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>\n</code></pre></div>\n<h2 id=\"5-변수-및-팩트\" style=\"position:relative;\"><a href=\"#5-%EB%B3%80%EC%88%98-%EB%B0%8F-%ED%8C%A9%ED%8A%B8\" aria-label=\"5 변수 및 팩트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 변수 및 팩트</h2>\n<ul>\n<li>\n<p>변수의 우선 순위 gruop_vars &#x3C; host_vars &#x3C; playbook 선언(직접 &#x3C; 파일) &#x3C; CLI 명령 이다.</p>\n</li>\n<li>\n<p>group_vars, host_vars를 사용하여 호스트와 그룹 별로 변수를 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">group_vars/\n├── webservers/      <span class=\"token comment\"># webservers 그룹용 디렉토리</span>\n│   ├── apache.yml\n│   └── php.yml\n└── dbservers/       <span class=\"token comment\"># dbservers 그룹용 디렉토리</span>\n    ├── mysql.yml\n    └── backup.yml\n\nhost_vars/\n├── web01/           <span class=\"token comment\"># web01 호스트용 디렉토리</span>\n│   ├── main.yml\n│   └── ssl.yml\n└── db01/            <span class=\"token comment\"># db01 호스트용 디렉토리</span>\n    ├── main.yml\n    └── backup.yml</code></pre></div>\n</li>\n<li>\n<p>플레이북에서의 변수 사용\n: 직접 선언 또는 파일 선언</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> vars demo\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>   <span class=\"token comment\"># 직접 선언</span>\n    <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> joe\n    <span class=\"token key atrule\">my_color</span><span class=\"token punctuation\">:</span> black\n  \n  <span class=\"token key atrule\">vars_files</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 파일 선언</span>\n    <span class=\"token punctuation\">-</span> myvar.yaml\n\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># This line will read: Creates the user joe</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Creates the user <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># This line will create the user named Joe</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ user }}\"</span></code></pre></div>\n</li>\n<li>\n<p>명령어에서의 사용</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">an run myvar.yaml <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">package</span><span class=\"token operator\">=</span>apache </code></pre></div>\n</li>\n</ul>\n<h3 id=\"vault\" style=\"position:relative;\"><a href=\"#vault\" aria-label=\"vault permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault</h3>\n<p>: Ansible에서 secret으로 변수를 관리할 때 사용하기 위한 개념이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ansible-vault create secret.yaml  <span class=\"token comment\"># 비밀번호 설정</span>\nansible-vault view secret.yaml <span class=\"token comment\"># 비밀번호 입력 </span>\nansible-vault view --vault-password-file my.key secret.yaml <span class=\"token comment\"># key 파일로 관리 </span></code></pre></div>\n<ul>\n<li>보통은 vault 키 파일은 ansible.cfg에 경로를 설정한다.\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>defaults<span class=\"token punctuation\">]</span>\ninventory <span class=\"token operator\">=</span> ./inventory\nremote_user <span class=\"token operator\">=</span> devops\nvault_password_file <span class=\"token operator\">=</span> ./my.key</code></pre></div>\n</li>\n<li>vault를 활용한 user 생성 playbook\n<ul>\n<li>node의 /etc/login.defs의 ENCRYPT_METHOD의 알고리즘이 무엇인지 확인 후 password에 알고리즘을 설정해주어야 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> create user by ansible vault\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> serverd.lab.example.com\n  <span class=\"token key atrule\">vars_files</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> secret.yaml \n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> create new user\n      <span class=\"token key atrule\">ansible.builtin.user</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{id}}\"</span>\n        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> wheel\n        <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ password | password_hash('sha512') }}\"</span></code></pre></div>\n</li>\n</ul>\n<h3 id=\"팩트\" style=\"position:relative;\"><a href=\"#%ED%8C%A9%ED%8A%B8\" aria-label=\"팩트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>팩트</h3>\n<p>: 관리 대상 node의 시스템 정보를 자동으로 수집하는 변수</p>\n<ul>\n<li>\n<p>fact 확인하기</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> collect fact\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> serverd.lab.example.com\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> show me fact\n      <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">var</span><span class=\"token punctuation\">:</span> ansible_facts</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> show some facts \n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Prints various Ansible facts\n    <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span> <span class=\"token comment\"># '>'이면 미개행(한줄처리)  '|' 이면 여러 줄 쓰면 여러줄 대로 처리 </span>\n        The default IPv4 address of <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> ansible_facts.fqdn <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        is <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> ansible_facts.default_ipv4.address <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>많이 활용되는 Facts</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 1. OS 배포판 및 버전 확인</span>\n<span class=\"token comment\"># 예: Ubuntu 20.04, RHEL 8.4</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'distribution'</span><span class=\"token punctuation\">]</span>         <span class=\"token comment\"># Ubuntu</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'distribution_version'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 20.04</span>\n\n<span class=\"token comment\"># 2. 호스트명 확인</span>\n<span class=\"token comment\"># 시스템의 현재 호스트명</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'hostname'</span><span class=\"token punctuation\">]</span>            <span class=\"token comment\"># webserver01</span>\n\n<span class=\"token comment\"># 3. IP 주소 확인</span>\n<span class=\"token comment\"># 시스템의 기본 IPv4 주소</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'default_ipv4'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'address'</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># 192.168.1.100</span>\n\n<span class=\"token comment\"># 4. 메모리 정보 확인</span>\n<span class=\"token comment\"># 전체 및 가용 메모리 (MB)</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'memtotal_mb'</span><span class=\"token punctuation\">]</span>             <span class=\"token comment\"># 16384</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'memfree_mb'</span><span class=\"token punctuation\">]</span>              <span class=\"token comment\"># 8192</span>\n\n<span class=\"token comment\"># 5. CPU 정보</span>\n<span class=\"token comment\"># CPU 개수 및 코어 수</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'processor_count'</span><span class=\"token punctuation\">]</span>         <span class=\"token comment\"># 2</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'processor_cores'</span><span class=\"token punctuation\">]</span>         <span class=\"token comment\"># 4</span>\n\n<span class=\"token comment\"># 6. OS 계열</span>\n<span class=\"token comment\"># RedHat/Debian 계열 구분</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'os_family'</span><span class=\"token punctuation\">]</span>              <span class=\"token comment\"># RedHat</span>\n\n<span class=\"token comment\"># 7. 디스크 마운트 정보</span>\n<span class=\"token comment\"># 루트 파티션 정보</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'mounts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'mount'</span><span class=\"token punctuation\">]</span>      <span class=\"token comment\"># \"/\"</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'mounts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'size_total'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 107374182400</span>\n\n<span class=\"token comment\"># 8. 모든 네트워크 인터페이스</span>\n<span class=\"token comment\"># 시스템의 네트워크 인터페이스 목록</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'interfaces'</span><span class=\"token punctuation\">]</span>              <span class=\"token comment\"># [\"eth0\", \"lo\"]</span>\n\n<span class=\"token comment\"># 9. 커널 버전</span>\n<span class=\"token comment\"># 현재 실행 중인 커널 버전</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'kernel'</span><span class=\"token punctuation\">]</span>                  <span class=\"token comment\"># \"4.18.0-305.el8.x86_64\"</span>\n\n<span class=\"token comment\"># 10. 시스템 아키텍처</span>\n<span class=\"token comment\"># x86_64, aarch64 등</span>\nansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'architecture'</span><span class=\"token punctuation\">]</span>            <span class=\"token comment\"># \"x86_64\"</span></code></pre></div>\n</li>\n<li>\n<p>Facts의 활용 예시</p>\n<ul>\n<li>OS 별 패키지 설치\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> OS별 웹 서버 설치\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> webservers\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> RHEL/CentOS에 Apache 설치\n      <span class=\"token key atrule\">yum</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'os_family'</span><span class=\"token punctuation\">]</span> == \"RedHat\"\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Ubuntu에 Apache 설치\n      <span class=\"token key atrule\">apt</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> apache2\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'os_family'</span><span class=\"token punctuation\">]</span> == \"Debian\"</code></pre></div>\n</li>\n<li>메모리에 따른 Heap 메모리 설정\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Java 설정\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> application_servers\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Java 힙 크기 설정\n      <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> java.conf.j2\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/java/java.conf\n      <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">heap_size</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ (ansible_facts['memtotal_mb'] * 0.6) | round | int }}\"</span></code></pre></div>\n</li>\n<li>CPU 코어 수에 따른 웹 서버 설정\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Nginx 워커 프로세스 설정\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> webservers\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Nginx 설정 파일 생성\n      <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> nginx.conf.j2\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/nginx/nginx.conf\n      <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">worker_processes</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ ansible_facts['processor_cores'] }}\"</span>\n        <span class=\"token key atrule\">worker_connections</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ ansible_facts['processor_cores'] * 1024 }}\"</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>fact를 playbook에서 사용하지 않는 다면 fact수집을 비활성화 할 수 있다. playbook 안에서 <code class=\"language-text\">gather_facts: no</code>를 설정 해주면 됨.</p>\n</li>\n</ul>\n<h2 id=\"6-작업-제어\" style=\"position:relative;\"><a href=\"#6-%EC%9E%91%EC%97%85-%EC%A0%9C%EC%96%B4\" aria-label=\"6 작업 제어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 작업 제어</h2>\n<h3 id=\"반복문\" style=\"position:relative;\"><a href=\"#%EB%B0%98%EB%B3%B5%EB%AC%B8\" aria-label=\"반복문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>반복문</h3>\n<p>: 앞서 service 모듈에 대해서는 list를 쓰는게 안되서 task를 각각 생성해줘야 했다. 이런 경우 반복문이 필요하다.\n반복문을 사용할 때는 **<u>loop 키워드를 각 task 별로 지정</u>**해주게 되고, 보통은 loop에 쓰이는 배열을 아래와 같이 변수로 설정하여서 사용한다.\n꼭 playbook 내가 아닌 group_vars, host_vars에서 설정해도 됨.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># variables.yaml</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">my_services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> postfix\n  <span class=\"token punctuation\">-</span> dovecot\n  <span class=\"token punctuation\">-</span> httpd\n\n<span class=\"token comment\"># playbook</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">vars_files</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> vars/variables.yaml\n\n<span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> services are running\n    <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ item }}\"</span>\n      <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> started\n    <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ my_services }}\"</span></code></pre></div>\n<h3 id=\"조건문--when-\" style=\"position:relative;\"><a href=\"#%EC%A1%B0%EA%B1%B4%EB%AC%B8--when-\" aria-label=\"조건문  when  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>조건문 ( when )</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Simple Boolean Task Demo\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">run_my_task</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd package is installed\n      <span class=\"token key atrule\">ansible.builtin.dnf</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> run_my_task</code></pre></div>\n<ul>\n<li>조건문을 위한 연산자\n<ul>\n<li>&#x3C;, >, &#x3C;=, >=, !=, <code class=\"language-text\">is defined</code>, <code class=\"language-text\">is not defined</code>, <code class=\"language-text\">not</code>, <code class=\"language-text\">in</code>, <code class=\"language-text\">and</code>, <code class=\"language-text\">or</code></li>\n<li>in의 예시 조건문\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Demonstrate the \"in\" keyword\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">supported_distros</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> RedHat\n      <span class=\"token punctuation\">-</span> Fedora\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install httpd using dnf<span class=\"token punctuation\">,</span> where supported\n      <span class=\"token key atrule\">ansible.builtin.dnf</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'distribution'</span><span class=\"token punctuation\">]</span> in supported_distros and ansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'architecture'</span><span class=\"token punctuation\">]</span> == \"x86_64\"</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2가지-이상의-조건들-처리\" style=\"position:relative;\"><a href=\"#2%EA%B0%80%EC%A7%80-%EC%9D%B4%EC%83%81%EC%9D%98-%EC%A1%B0%EA%B1%B4%EB%93%A4-%EC%B2%98%EB%A6%AC\" aria-label=\"2가지 이상의 조건들 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2가지 이상의 조건들 처리</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># and 조건만 여러 개일 때는 - 로 나열할 수 있음</span>\n<span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'distribution_version'</span><span class=\"token punctuation\">]</span> == \"9.0\"\n  <span class=\"token punctuation\">-</span> ansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'kernel'</span><span class=\"token punctuation\">]</span> == \"5.14.0<span class=\"token punctuation\">-</span>70.13.1.el9_0.x86_64\"\n\n<span class=\"token comment\"># 2개 이상의 and 조건을 or로 묶을 때는 ( ) 사용</span>\n<span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span><span class=\"token scalar string\">\n  ( ansible_facts['distribution'] == \"RedHat\" and\n    ansible_facts['distribution_major_version'] == \"9\" )\n  or\n  ( ansible_facts['distribution'] == \"Fedora\" and\n  ansible_facts['distribution_major_version'] == \"34\" )</span></code></pre></div>\n<ul>\n<li>패키지 그룹으로 설치 (디스크 용량 고려)\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example \n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> database_dev\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> when test \n      <span class=\"token key atrule\">dnf</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'@Container Management'</span>\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> ansible_facts.mounts.0.mount == \"/\"\n        <span class=\"token punctuation\">-</span> ansible_facts<span class=\"token punctuation\">[</span><span class=\"token string\">'mount'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'size_available'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">></span>= 1000000000</code></pre></div>\n</li>\n</ul>\n<h3 id=\"register-변수를-활용한-분기\" style=\"position:relative;\"><a href=\"#register-%EB%B3%80%EC%88%98%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EB%B6%84%EA%B8%B0\" aria-label=\"register 변수를 활용한 분기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Register 변수를 활용한 분기</h3>\n<p>: task의 실행 결과를 변수에 저장하기 위함. 그리고 그 결과에 따라 playbook 내에서 분기하기 위하여 사용됨</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> register demo\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> localhost\n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> \n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> using command module\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> date \n      <span class=\"token key atrule\">register</span><span class=\"token punctuation\">:</span> aaa\n\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> print aaa value\n      <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">var</span><span class=\"token punctuation\">:</span> aaa</code></pre></div>\n<ul>\n<li>register 변수를 위와 같이 출력했을 때, 아래와 같이 나오며 보통 결과의 성공 여부를 판단할 때 rc값을 기준으로 한다.\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">TASK <span class=\"token punctuation\">[</span>print aaa value<span class=\"token punctuation\">]</span> **********************************************\nok: <span class=\"token punctuation\">[</span>localhost<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"aaa\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> true,\n        <span class=\"token string\">\"msg\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"All items completed\"</span>,\n        <span class=\"token string\">\"results\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n          <span class=\"token string\">\"ansible_loop_var\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"item\"</span>,\n          <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> true,\n          <span class=\"token string\">\"cmd\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"echo This is my item: one\"</span>, <span class=\"token string\">\"delta\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"0:00:00.004519\"</span>,\n          <span class=\"token string\">\"end\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2022-06-29 17:32:54.065165\"</span>, <span class=\"token string\">\"failed\"</span><span class=\"token builtin class-name\">:</span> false,\n          <span class=\"token punctuation\">..</span>.output omitted<span class=\"token punctuation\">..</span>.\n          <span class=\"token string\">\"item\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"one\"</span>,\n          <span class=\"token string\">\"msg\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,\n          <span class=\"token string\">\"rc\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,\n          <span class=\"token string\">\"start\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2022-06-29 17:32:54.060646\"</span>, <span class=\"token string\">\"stderr\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,\n          <span class=\"token string\">\"stderr_lines\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>,\n          <span class=\"token string\">\"stdout\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"This is my item: one\"</span>, <span class=\"token string\">\"stdout_lines\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n                              <span class=\"token string\">\"This is my item: one\"</span>\n                          <span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># register를 통한 분기 예시</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Restart HTTPD if Postfix is Running\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Get Postfix server status\n      <span class=\"token key atrule\">ansible.builtin.command</span><span class=\"token punctuation\">:</span> /usr/bin/systemctl is<span class=\"token punctuation\">-</span>active postfix\n      <span class=\"token key atrule\">register</span><span class=\"token punctuation\">:</span> result\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Restart Apache HTTPD based on Postfix status\n      <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> restarted\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> result.rc == 0</code></pre></div>\n</li>\n</ul>\n<h3 id=\"조건문과-반복문의-결합\" style=\"position:relative;\"><a href=\"#%EC%A1%B0%EA%B1%B4%EB%AC%B8%EA%B3%BC-%EB%B0%98%EB%B3%B5%EB%AC%B8%EC%9D%98-%EA%B2%B0%ED%95%A9\" aria-label=\"조건문과 반복문의 결합 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>조건문과 반복문의 결합</h3>\n<p>: 사용 가능한 공간이 300MiB 이상인 /에 마운트된 파일 시스템이 있는 경우, ansible.builtin.dnf 모듈에서 mariadb-server 패키지를 설치하는 예시</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> install mariadb<span class=\"token punctuation\">-</span>server if enough space on root\n  <span class=\"token key atrule\">ansible.builtin.dnf</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>server\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> latest\n  <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ ansible_facts['mounts'] }}\"</span>\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">'mount'</span><span class=\"token punctuation\">]</span> == \"/\" and item<span class=\"token punctuation\">[</span><span class=\"token string\">'size_available'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">></span> 300000000</code></pre></div>\n<h3 id=\"핸들러\" style=\"position:relative;\"><a href=\"#%ED%95%B8%EB%93%A4%EB%9F%AC\" aria-label=\"핸들러 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>핸들러</h3>\n<ul>\n<li>다른 작업에서 트리거한 알림에 응답하는 작업이다.</li>\n<li>일반적으로 주요 설정이 변경됐을 때 핸들러 호출을 통해 node 재부팅 및 서비스 재시작에 사용된다.</li>\n<li>tasks가 모두 끝난 뒤에 핸들러의 작업이 실행된다.</li>\n<li>handlers 사용 예시\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> copy demo.example.conf configuration template\n      <span class=\"token key atrule\">ansible.builtin.template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> /var/lib/templates/demo.example.conf.template\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/httpd/conf.d/demo.example.conf\n      <span class=\"token key atrule\">notify</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> restart mysql\n        <span class=\"token punctuation\">-</span> restart apache\n  <span class=\"token key atrule\">handlers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> restart mysql\n      <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> restarted\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> restart apache\n      <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> restarted</code></pre></div>\n</li>\n<li>handler는 호출 순이 아니라 handlers에 선언된 순서로 실행된다.</li>\n</ul>\n<h3 id=\"작업-오류-처리\" style=\"position:relative;\"><a href=\"#%EC%9E%91%EC%97%85-%EC%98%A4%EB%A5%98-%EC%B2%98%EB%A6%AC\" aria-label=\"작업 오류 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>작업 오류 처리</h3>\n<p>작업의 실패하는 것에 대해서 어떻게 제어할 것인가.</p>\n<ul>\n<li>\n<p>작업 실패 무시</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Latest version of notapkg is installed\n<span class=\"token key atrule\">ansible.builtin.dnf</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> notapkg\n  <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> latest\n<span class=\"token key atrule\">ignore_errors</span><span class=\"token punctuation\">:</span> yes</code></pre></div>\n</li>\n<li>\n<p>작업 실행 후 핸들러 강제 실행</p>\n<ul>\n<li>아래 예시에서 notapkg의 설치는 존재하지 않는 패키지이므로 실패하여서, 원래라면 <code class=\"language-text\">notify handler</code> task로 인한 handler가 실행되지 않아야 하지만, <code class=\"language-text\">force_handlers:yes</code>를 설정함으로써 restart db 핸들러가 실행되게 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"> <span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">force_handlers</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> notify handler\n      <span class=\"token key atrule\">ansible.builtin.command</span><span class=\"token punctuation\">:</span> /bin/true\n      <span class=\"token key atrule\">notify</span><span class=\"token punctuation\">:</span> restart db\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> a task which fails because the package doesn't exist\n      <span class=\"token key atrule\">ansible.builtin.dnf</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> notapkg\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> latest\n\n  <span class=\"token key atrule\">handlers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> restart db\n      <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> restarted</code></pre></div>\n</li>\n<li>\n<p>failed_when</p>\n<ul>\n<li>사용자가 직접 어떤 경우에 실패인지를 관리하기 위한 구문</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run user creation script\n      <span class=\"token key atrule\">ansible.builtin.shell</span><span class=\"token punctuation\">:</span> /usr/local/bin/create_users.sh\n      <span class=\"token key atrule\">register</span><span class=\"token punctuation\">:</span> command_result\n      <span class=\"token key atrule\">failed_when</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"'Password missing' in command_result.stdout\"</span></code></pre></div>\n</li>\n<li>\n<p>fail 모듈</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run user creation script\n      <span class=\"token key atrule\">ansible.builtin.shell</span><span class=\"token punctuation\">:</span> /usr/local/bin/create_users.sh\n      <span class=\"token key atrule\">register</span><span class=\"token punctuation\">:</span> command_result\n      <span class=\"token key atrule\">ignore_errors</span><span class=\"token punctuation\">:</span> yes\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Report script failure\n      <span class=\"token key atrule\">ansible.builtin.fail</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"The password is missing in the output\"</span>\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"'Password missing' in command_result.stdout\"</span></code></pre></div>\n</li>\n<li>\n<p>changed_when</p>\n<ul>\n<li>changed_when 구문은 명시적으로 task가 change되었음을 표시하기 위함</li>\n<li>실제 조치가 필요한 변화가 node에서 있는 경우, 이를 추적하기 위한 중요한 도구\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">ansible.builtin.shell</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">cmd</span><span class=\"token punctuation\">:</span> /usr/local/bin/upgrade<span class=\"token punctuation\">-</span>database\n      <span class=\"token key atrule\">register</span><span class=\"token punctuation\">:</span> command_result\n      <span class=\"token key atrule\">changed_when</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"'Success' in command_result.stdout\"</span>\n      <span class=\"token key atrule\">notify</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> restart_database\n  <span class=\"token key atrule\">handlers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> restart_database\n      <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> restarted</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>block 구문</p>\n<ul>\n<li>block내에 task 여러개를 하나의 task로 묶을 수 있고, 따라서 이를 묶어서 분기 처리 등을 할 수 있다. ( block문에 when을 적용 )</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> block example\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> installing and configuring DNF versionlock plugin\n      <span class=\"token key atrule\">block</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> package needed by dnf\n        <span class=\"token key atrule\">ansible.builtin.dnf</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> python3<span class=\"token punctuation\">-</span>dnf<span class=\"token punctuation\">-</span>plugin<span class=\"token punctuation\">-</span>versionlock\n          <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lock version of tzdata\n        <span class=\"token key atrule\">ansible.builtin.lineinfile</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/yum/pluginconf.d/versionlock.list\n          <span class=\"token key atrule\">line</span><span class=\"token punctuation\">:</span> tzdata<span class=\"token punctuation\">-</span>2016j<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_distribution == \"RedHat\"</code></pre></div>\n<ul>\n<li>rescue, always와 함께 block문 사용하기\n<ul>\n<li>rescue는 block문이 실패했을 때 실행되고, always는 항상 실행된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upgrade DB\n    <span class=\"token key atrule\">block</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> upgrade the database\n        <span class=\"token key atrule\">ansible.builtin.shell</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">cmd</span><span class=\"token punctuation\">:</span> /usr/local/lib/upgrade<span class=\"token punctuation\">-</span>database\n    <span class=\"token key atrule\">rescue</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> revert the database upgrade\n        <span class=\"token key atrule\">ansible.builtin.shell</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">cmd</span><span class=\"token punctuation\">:</span> /usr/local/lib/revert<span class=\"token punctuation\">-</span>database\n    <span class=\"token key atrule\">always</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> always restart the database\n        <span class=\"token key atrule\">ansible.builtin.service</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb\n          <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> restarted</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p>시험</p>\n<ul>\n<li>실습 익숙해지고 9장의 문제를 잘 보면 됨.</li>\n</ul>","excerpt":"1. Ansible 설치 ‘Community Ansible’을 많이들 쓰지만 시험은 컨테이너 기반의 을 사용한다. 2. 인벤토리 인벤토리를 통해 관리 대상 호스트를 지정한다. 정적 인벤토리 : 직접 ip, hostname 등록 동적 인벤토리 : 직접 만들지 않고 Inventory Provider에게 질의를 통해 파악한다. ex) vsphere(linux), AD(windows)에 ansible이 물어봐서 호스트를 지정함 대괄호를 통해 인벤토리 그룹을 묶는다. 중첩그룹 : 그룹을 묶은 그룹 ( children keyword ) 범위를 사용한 간소화 인벤토리는 반드시 등록 후 확인하여야 한다. ansible 명령을 사용하는 방식 (구버전) all 그룹, ungrouped 그룹이라는 기본 그룹이 존재한다. ansible-navigator를 사용하는 방식 ansible- 로 시작하는 여러 명령어가 많이 있었는데( ex. ansible-playbook. ansible-doc, ansible…","frontmatter":{"date":"November 11, 2024","title":"Ansible 자동화","categories":"Linux DevOps","author":"jjunyong","emoji":"😌"},"fields":{"slug":"/ansible1/"}},"next":{"id":"385f5e04-75dc-546b-bf37-19032cb99613","html":"<blockquote>\n<p>AEM 을 소개함에 있어 해당 과정은 Udemy의 <a href=\"https://www.udemy.com/course/adobe-experience-manager-63\">https://www.udemy.com/course/adobe-experience-manager-63</a> 과정을\n영어가 어려운 사람들을 위해 한국어로 정리하는 데 목적이 있음을 밝힌다. AEM 관련해서 체계적으로 정리해둔 블로그를 찾지 못했기 때문이기도 하다.</p>\n</blockquote>\n<br>\n<h2 id=\"aem-소개\" style=\"position:relative;\"><a href=\"#aem-%EC%86%8C%EA%B0%9C\" aria-label=\"aem 소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AEM 소개</h2>\n<ul>\n<li>AEM은 ‘Adobe Experience Manager’ 의 약어이며, 어도비 사에서 만든 Java 기반의 CMS 솔루션이다.\nAEM은 상용 웹 사이트를 만드는 데 많이 사용되며 웹 사이트의 콘텐츠와 asset 들을 관리하기에 용이하며 배포까지 지원한다.</li>\n</ul>\n<br>\n<blockquote>\n<h3 id=\"웹사이트와-cms\" style=\"position:relative;\"><a href=\"#%EC%9B%B9%EC%82%AC%EC%9D%B4%ED%8A%B8%EC%99%80-cms\" aria-label=\"웹사이트와 cms permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>웹사이트와 CMS</h3>\n<p>웹 사이트에는 3가지 종류가 있다.</p>\n<ol>\n<li>Static 웹 사이트\n: 정적 리소스로만 이루어진 웹 사이트이다.</li>\n<li>Dynamic 웹 사이트\n: 클라이언트/서버의 스크립트를 통해 동적으로 웹 사이트의 콘텐츠를 관리하는 웹 사이트이다.</li>\n<li>CMS</li>\n</ol>\n<ul>\n<li>template을 생성할 수 있다</li>\n<li>재사용 가능한 Component를 생성하고 publish할 수 있다.\nAEM은 CMS의 한 종류이며 아래와 같은 구조를 통해 페이지를 구성한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACT0lEQVQoz22SS08TYRSGu/cGBS1VoEpbXJhojAoBKaALBDsirbTzzTedCuUSVIRw6Uyk1piQGLeEmOhClBDQICz8FwIuuIYoIPGXPGZGKCSweHOS93nPm7M4rkZhYEVqGIjWMxStYzhae6BICFNrxDSasZItpFvvOt7hjL1j76ajIWq1Llyp2AO+K2eZUS4wqZQwofj4tK9wCVP6TeaeNvCtT+Fz9LLj7XM7O6UU81U5z7ziIaIKXAHdpFSkKdZMFL0dQ8aRUuRkiFZqtG7CIomhxXK+JgVJGade76FIWPi0YewuV9Cw8OkmvmSWubYKduInWBOFbIgCZ+6KU7zujjPfUcUf9WSOrYpC/mqnedvZTL7M4k+YBBMWrmDC5KJM4zMyTLdVsy7PsSC8LKkeZ64LN5nOONOpEBvSw4JaxJLw8EP1sqkVMpp6iFu+xK+n9wstfNLEZ4wwkwrxq/8Wq5kway8aWR4JszVURSb1iC/dd/jdd+OAZRR2BisZ7ThSuHdhMsP040rWYmdYFF5+iiIWVQ8b8bz/F7ZXs36ILcQ9bAr3MRcaFqW6RWkyy2x7FVuam2XpZVV6WJFetmU+r7pUZjtusy3drMgih9mZXb2AN50t5MksZbpJwC4s14cJiAHKtEHqRIomVXJPTeTUpOpUaE+OsAaHSSq1HnxiyOko19O49FgLk+ES3itljIcDjCnBPZUzdt/PeOt1JnojfHweZTx61fEctpd7F/bzQbnk/KSi6riuyX7nw+1fs+exMp5Rl+yl9phM6NDuFX2AfzwwzD/XmbJ/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/5d1403cb60cf09bf19fc144ed762f88d/37523/image2.png\"\n        srcset=\"/static/5d1403cb60cf09bf19fc144ed762f88d/e9ff0/image2.png 180w,\n/static/5d1403cb60cf09bf19fc144ed762f88d/f21e7/image2.png 360w,\n/static/5d1403cb60cf09bf19fc144ed762f88d/37523/image2.png 720w,\n/static/5d1403cb60cf09bf19fc144ed762f88d/302a4/image2.png 1080w,\n/static/5d1403cb60cf09bf19fc144ed762f88d/07a9c/image2.png 1440w,\n/static/5d1403cb60cf09bf19fc144ed762f88d/ce0a7/image2.png 1590w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</blockquote>\n<br>\n<h3 id=\"1-aem의-컨셉\" style=\"position:relative;\"><a href=\"#1-aem%EC%9D%98-%EC%BB%A8%EC%85%89\" aria-label=\"1 aem의 컨셉 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. AEM의 컨셉</h3>\n<ul>\n<li>파일 시스템과 유사한 JCR repository라는 곳에 모든 것을 저장하는데 이게 무엇인 지는 이후에 살펴보자.</li>\n<li>2가지 방식의 UI가 있고 주로 Touch UI 방식을 사용한다.\n<ul>\n<li>Touch UI\n<ul>\n<li>디폴트 UI이며 반응형 기능을 제공한다.</li>\n</ul>\n</li>\n<li>Classic UI\n<ul>\n<li>반응형이지 않고 Desktop 페이지만을 지원한다 .</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>OSGI, JCR, Apache Sling 을 기반으로 한다.</li>\n</ul>\n<h3 id=\"2-author와-publish\" style=\"position:relative;\"><a href=\"#2-author%EC%99%80-publish\" aria-label=\"2 author와 publish permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Author와 Publish</h3>\n<ul>\n<li>\n<p>Author</p>\n<ul>\n<li>콘텐츠와 페이지를 CRUD할 수 있으며 해당 작업이 Publish에 <strong>Activate</strong> 하기 전에는 웹 사이트에 연동되지 않는다.</li>\n</ul>\n</li>\n<li>\n<p>Publish</p>\n<ul>\n<li>Public에 공개된 was로 보면 되며, publish에 반영된 내용은 웹 사이트에서 바로 반영된다.</li>\n<li>Author의 내용은 activate을 통해 publish에 반영되고 deactivate을 통해 삭제된다.</li>\n</ul>\n</li>\n<li>\n<p>Replication</p>\n<ul>\n<li>Content를 Author -> Publisher 로 복사하는 것인데 개념 상 Activate을 통해서 replication을 구현 한다고 보면 될 것 같다.</li>\n<li>Publihser -> Author로 복사하는 것은 Reverse replication이라고 한다.</li>\n<li>Replication Agent\n<ul>\n<li>replication을 자동화 하기 위한 기능인 것 같다. Author에서 Activate을 하면 Replication queue에 쌓이고 publish는 queue에 있는 변경사항을 가져와서 반영한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"3-sling이란\" style=\"position:relative;\"><a href=\"#3-sling%EC%9D%B4%EB%9E%80\" aria-label=\"3 sling이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Sling이란?</h3>\n<p>AEM에서 콘텐츠의 저장소로 사용되는 JCR을 이해하기에 앞서 Apache Sling(줄여서 그냥 Sling)이 무엇인지 알아야 한다.\nSling의 목표는 콘텐츠 저장소의 콘텐츠를 HTTP 리소스로 나타내 RESTful한 애플리케이션을 개발하는 것이다.\nAEM에서 JCR은 Sling을 통해 Web에 노출된다고 이해할 수 있다.</p>\n<p>URL로 AEM에 요청이 들어오면, ( ex. req: /content/corporate/jobs/developer.html)</p>\n<ol>\n<li>가장 먼저 JCR의 node를 찾고,</li>\n<li>해당 node의 sling:resourceType 값을 통해 렌더링 시 사용할 스크립트를 찾는다.</li>\n<li>찾은 스크립트의 실행을 거쳐 콘텐츠를 화면에 렌더링한다.</li>\n</ol>\n<ul>\n<li>모든 Sling 스크립트는 /apps 또는 /libs 하위 폴더에 저장한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAADAklEQVQoz12S3U9bBRiH+0945ZVeaLzwT/DCG5f4ETXGuGQXJmZmLm5zbtmiA2EXOpNZpFtjHC1DQbBA1A4LlBkwOGQdDVAKbra083BK6Wl7Sjk9p6c9n31Mi8bF9+q9evL83t/r8Q5FuOQd5lP/93xxY4JrN38kMBpheDLK5M8LTM3dYWFplTuxBLH4BllhF9elM61Wi/+PJydVSGVFcqUDippNQWlSUBoUlQYlRaes6FTUBlW1gVxVyTzcoVAsIysartvCcRy+Dt2myzfOyK1FPLRANy3MfBp5IURz41daqRhOZhV3ZxM3n6ZVEqBaALWCWpaoSbsc3I93DE3L4sjxz3nsufc5dsGPxzAtVN3AkPdID14m0/Uqsu8EtW+70X7wUo8G0X6bRF/7hWY6jiPncKW/MJKLnYimafLm2X6efuki7/UG8ZiWg6rV+ecs7MyFyP4URIx8gxAdo7A0jZFZx8ylsEoitiLjaAdY5d12OEzb4fXTfTx55DzHu28cArW6Tst1OkADKMRukxzp40F4COXeLGZqBUvYwpYe4ihlnJqMsZcFQ8fWVY6ev84zL1/k5OWOoY1S02g0Ddql1TWNvCiSXFsjuZ5AFARc28Y2LWzLxrZt/u1W35dZubfGmSvDvNM1QO/1cTyW7VCqHPB7QsA3Hsc7FiMQ+ZPgdJrB2W0CkRQ3ZzMMzWUIL+dY3a4gSDWKRRm9aSFK+7z1oY9nX/uYEz0BPO2mHLfVsVtPSVzyz3LKO0PP2AN6vtuiZ/Q+vaPt/Q/6b6WZjkssbeZZjG0eWjaavHHmS5544RzvfjLwKPAwSHavRp8vxGB/gAH/CBOjM0xNLROOrBCOJphZTDEfFxB28u3XRq03Oi0/9eKF/wzdR4DivkXU5+Vu1zHmPzvLRvAKyTE/29EJcnfnEdaWqcr72KaBbTtoeoNXTl7l8ec/4O2PvjoE2o6L47gdqFK32MrKbGVKbGZKJNJF1tNFNjJl0mIVUVJQdYt608IwbSzLotsX4ui5a1wNhvkbR9wyQdNn2OgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/1e12acb1d0569a4b5c10eaee0d3d8e95/37523/image4.png\"\n        srcset=\"/static/1e12acb1d0569a4b5c10eaee0d3d8e95/e9ff0/image4.png 180w,\n/static/1e12acb1d0569a4b5c10eaee0d3d8e95/f21e7/image4.png 360w,\n/static/1e12acb1d0569a4b5c10eaee0d3d8e95/37523/image4.png 720w,\n/static/1e12acb1d0569a4b5c10eaee0d3d8e95/302a4/image4.png 1080w,\n/static/1e12acb1d0569a4b5c10eaee0d3d8e95/105d8/image4.png 1170w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"4-jcr-java-content-repository-란\" style=\"position:relative;\"><a href=\"#4-jcr-java-content-repository-%EB%9E%80\" aria-label=\"4 jcr java content repository 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. JCR (Java Content Repository) 란?</h3>\n<p>JCR은 Contents를 Repository로서 사용하기 위한 Java에서 제공하는 인터페이스라고 정의할 수 있으며,\nJCR은 아래와 같은 트리구조의 저장소로서 Node와 Property로 구성된다.\n/blog/jan/31/title/ 과 같이 url로서 리소스에 접근 가능하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACbElEQVQ4y52S30sUURTH96/otf+h3oIQgiilMqKkl0DwB0S99eJDD5EUGAhlEFhawVIagRJh4VuQ/RDdfrimrkYluOvPnZ3d2dmZO/fHJ2Z229ZSIw+cOfeee+9nvufeE6NixpjIQ/MmBnFGOimO3qA42oUJStU9/7LYZqCOxs5QB9bNw1i9p8ndbkCX8rsFGqIjgUeQXyOX+QHCqYJ2BQxNLiZwPwyTG3+KmH6BUcH/AX+Va7SKkoWBi1jX9mHfPUP2+n60mysDtdqkdqsfxLZK6o1vrCdGyEy+xP8+8df6TkrLClWALtloZwPj2RQcl6IECViOh/YK6GIW7VqYwNtZYfgRqVdY3XU4j9rJdddRTAxVN4jsElbPUfLxFnI9R3BHuyrl6+2BweIkhXgrmYFL5ONtyK+vy4fC8t0szuPzOMMdFOJtlN7eryjcARiaXZLYRQ+rKKjdZjBb3KHeBKwFx7yxe9jvB3FdF7TC8zzsxDO8N/1oz6EqdRv789VjzvMrlMb6yvclRBRLE4NYw5dRuQV0sIH2V9D+6mYX6xgtwhcFIyOPgFu1QtiN6fUNgtkm5JfjyJmTyJkTNbEROVWH8lerBZhqH4bNGr5YDVRKyfpqBjF/AX+2GTHXgohiKyLVhki1R3OZ6UOtPUEt96OWH2CU91thrUqpFJn0EsFME3LuLHKhvaxq9hQydQ650Iqcby7Pw3zyEPLzQXRgbwOUZaA/VY94twfx8QD+dCN+sh4/2YCfPFYZ1yM+HUSM742i2g6otaGQt5HpXtTiVdTSLeRKHLnyMCpPVkpUy32o9B3UYidqqQetSvwEdYT0LNBCg9EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/d793f1e330910b0077d598dcca2aa1a3/37523/image3.png\"\n        srcset=\"/static/d793f1e330910b0077d598dcca2aa1a3/e9ff0/image3.png 180w,\n/static/d793f1e330910b0077d598dcca2aa1a3/f21e7/image3.png 360w,\n/static/d793f1e330910b0077d598dcca2aa1a3/37523/image3.png 720w,\n/static/d793f1e330910b0077d598dcca2aa1a3/302a4/image3.png 1080w,\n/static/d793f1e330910b0077d598dcca2aa1a3/07a9c/image3.png 1440w,\n/static/d793f1e330910b0077d598dcca2aa1a3/6568d/image3.png 1660w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>JCR의 Node와 Property는 다음과 같은 정보를 지닌다.</p>\n<ul>\n<li>node type\n<ul>\n<li>노드의 타입이 folder인지, file인지, unstructured 인지를 정의한다.</li>\n</ul>\n</li>\n<li>mixin type\n<ul>\n<li>versionable, lockable 과 같은 버전과 잠금 여부에 대한 정보</li>\n</ul>\n</li>\n<li>value property : 1개일 수도 있고 여러 개 일 수 있다.</li>\n<li>child nodes : 자식 노드에 대한 정보를 담고 있다.</li>\n</ul>\n<p>JCR은 RDBMS와 File system의 특징을 모두 가지고 있으며 다른 여러가지 기능을 지원한다.</p>\n<ul>\n<li>RDBMS의 특징인 Transaction, query, 정형 데이터 저장, 무결성</li>\n<li>File system의 특징인 계층구조, 리소스 잠금, 접근 제어</li>\n<li>뿐만 아니라 풀텍스트검색, 버져닝, 비정형데이터 저장 등을 지원한다.</li>\n</ul>\n<br>\n<h2 id=\"aem-설치\" style=\"position:relative;\"><a href=\"#aem-%EC%84%A4%EC%B9%98\" aria-label=\"aem 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AEM 설치</h2>\n<ul>\n<li>\n<p>AEM은 Author와 Publishe라는 것이 있는데, 이에 대해서는 나중에 다룰 것이다.\n지금은 Author와 Publishe는 둘다 AEM 인스턴스이지만, 역할을 나눈 것으로 이해하면 될 것 같다.</p>\n</li>\n<li>\n<p>서버에 Author, Publisher를 설치할 때\ncq-author-p4502.jar, cq-publish-p4503.jar 과 같은 /aem/author/ 또는 /aem/pubilhser 경로에 jar파일을 설치한다.\n이렇게 하면 localhost:4502 에는 Author가 실행되고, localhost:4503에는 publisher가 실행된다.</p>\n</li>\n<li>\n<p>각 인스턴스의 디렉토리에는 위의 jar파일과 함께 license.properties가 존재해야 하며, jar파일은 처음 실행될 때 crx-quickstart라는 디렉토리를 자동으로\n생성하게 된다.</p>\n</li>\n<li>\n<p>jar가 실행되고 crx-quickstart 디렉토리가 생성되었다면 localhost:4502에서 아래와 같이 확인할 수 있다.</p>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACOklEQVQoz12RXUiTYRiG368/BZMw2ydGppVrTttmlGauQZSpuECw6CCiP4jwwAgMNcs0KMJ06jeXI39CTYlCSgzppIQOg8iMbGnT0gSx6KigwO294tuGRgc3DzwHF9dzP2L203u+z8/yY2GOr9MTfPH7mJny/TM/LOVzaPcxvNenf5z5GR/f5iaZ8o3inxhD4Ekg4I5n0ROP9KrgNYTTrkJHAnSqyC4V2W2APpVgn8qf3o1w30CwfzMj9TaqTmdy/sh2XOdUhLwloF6ASyA1gXQLZLNANglkiyDoEeAVBPtNLDxystBj4XdfCr96jfi7rbzocvK0PY+hO0Ye3jAi5G0F6VKQmoJsW4m8G4v0rkVqK5A6rEPhp0cwpmXxoKOW4cEBRu6VMlCRwuNqI711e2m77qCuzERrZbYOFMjGiFWzAs1hM9mqEOiMhh7Bs/IYnA4zRYUHKT5cQJHdSF5OBtmZ6VisZkxpyayLiyHOEIeQDRGgK3K2DtMU0AQBbzR0CYYvxnCsOI+Tx0s4WmjHecjBvvwCKq/WcaWmlvKqai5V11By4iwiBGuMdNa0DNS7DGgCOgVDZWvItiaxf3cqdssmtljNpGbl8vLVGG/fjfP6zSiT/mkamlqXDUN2umVL+Dm4BYtuETIcvBDFLvN6Dlg2kJGWQpLVRkL6TvaUlGNL28aOZAOWrYmYkhP/Ay4Z6h2GQ7tgpkXheU0UTyozyD9TSlFFLTm5Nk5lxXLNsZqbuYJ6h+CyfRV/AXlbvlnap3yRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./image1\"\n        title=\"./image1\"\n        src=\"/static/d83e5f5216b453d8688952b57433b655/37523/image1.png\"\n        srcset=\"/static/d83e5f5216b453d8688952b57433b655/e9ff0/image1.png 180w,\n/static/d83e5f5216b453d8688952b57433b655/f21e7/image1.png 360w,\n/static/d83e5f5216b453d8688952b57433b655/37523/image1.png 720w,\n/static/d83e5f5216b453d8688952b57433b655/302a4/image1.png 1080w,\n/static/d83e5f5216b453d8688952b57433b655/07a9c/image1.png 1440w,\n/static/d83e5f5216b453d8688952b57433b655/90eea/image1.png 2254w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"aem-콘솔의-종류\" style=\"position:relative;\"><a href=\"#aem-%EC%BD%98%EC%86%94%EC%9D%98-%EC%A2%85%EB%A5%98\" aria-label=\"aem 콘솔의 종류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AEM 콘솔의 종류</h2>\n<p>AEM 콘솔은 5가지 종류가 있으며 각 콘솔의 경로는 <a href=\"https://localhost:4502/\">https://localhost:4502/</a> 에 각 콘솔의 경로를 추가해주면 접속할 수 있다.</p>\n<ol>\n<li>Admin 콘솔\n: /siteadmin</li>\n<li>CRX 콘솔\n: /crx/explorer/index.jsp</li>\n<li>OSGI management 콘솔\n: /system/console</li>\n<li>CRXDE Lite 콘솔\n<ul>\n<li>경로: /crx/de</li>\n<li>template, component를 생성하는 등 개발자가 사용하는 AEM의 IDE 역할을 한다.</li>\n</ul>\n</li>\n<li>Package 매니저 콘솔\n<ul>\n<li>경로 : /crx/packmgr/index.jsp</li>\n<li>배포 관련하여 패키지를 관리하는 콘솔</li>\n<li>‘Upload package’를 통해 zip파일인 패키지를 업로드할 수 있고, 업로드 되고 나면 install 버튼을 눌러 설치가능하다.</li>\n</ul>\n</li>\n</ol>","frontmatter":{"date":"October 20, 2024","title":"[AEM] Adobe Experience Manager","categories":"WEB","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/aem1/"}},"prev":{"id":"195eb76a-301b-5b0a-9f60-4929c4c30a75","html":"<h2 id=\"1-파일-배포\" style=\"position:relative;\"><a href=\"#1-%ED%8C%8C%EC%9D%BC-%EB%B0%B0%ED%8F%AC\" aria-label=\"1 파일 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 파일 배포</h2>\n<p>파일 배포와 관련된 모듈들.</p>\n<ul>\n<li>blockinfile: 여러 줄의 텍스트 블록을 삽입, 업데이트 또는 제거\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> file module demo1\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> servera.lab.example.com \n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> \n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> using blockinfile\n      <span class=\"token key atrule\">blockinfile</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/3day/lunch.txt\n        <span class=\"token key atrule\">block</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          10.1.1.1  www.google.co.kr\n          10.1.1.2  www.naver.com </span></code></pre></div>\n</li>\n<li>copy</li>\n<li>fetch\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> file module demo2\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> \n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> using fetch module\n      <span class=\"token key atrule\">fetch</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> /etc/ssh/sshd_config\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> backup</code></pre></div>\n<ul>\n<li>위 플레이북을 실행 후 <code class=\"language-text\">tree backup</code>을 해보면 backup 디렉토리가 제어 노드에 생성되고 그 하위에 노드별로 디렉토리가 생성되면서 fetch가 됨을 알 수 있다. 즉 src가 관리 node, dest가 제어 node임</li>\n</ul>\n</li>\n<li>file\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> file module demo3\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> servera.lab.example.com\n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> create Dir\n      <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/3day\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> directory\n        <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'0760'</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> create empty file\n      <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/3day/lunch.txt\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> touch\n        <span class=\"token key atrule\">owner</span><span class=\"token punctuation\">:</span> student\n        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> wheel\n        <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0606</span> </code></pre></div>\n</li>\n<li>lineinfile\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> file module demo 4\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> servera.lab.example.com\n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lineinfile test1   <span class=\"token comment\"># replace</span>\n      <span class=\"token key atrule\">lineinfile</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/3day/lunch.txt \n        <span class=\"token key atrule\">regexp</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'^10.1.1.1'</span>\n        <span class=\"token key atrule\">line</span><span class=\"token punctuation\">:</span> 10.1.1.4 www.hyundai.com\n\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lineinfile test 2 <span class=\"token comment\"># 추가 </span>\n      <span class=\"token key atrule\">lineinfile</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/3day/lunch.txt\n        <span class=\"token key atrule\">line</span><span class=\"token punctuation\">:</span> 59.29.224.9 www.hpe.co.kr\n        <span class=\"token key atrule\">satate</span><span class=\"token punctuation\">:</span> present</code></pre></div>\n</li>\n<li>stat</li>\n</ul>\n<h3 id=\"jinja2-템플릿\" style=\"position:relative;\"><a href=\"#jinja2-%ED%85%9C%ED%94%8C%EB%A6%BF\" aria-label=\"jinja2 템플릿 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jinja2 템플릿</h3>\n<p>jinja2 템플릿을 사용하여 관리 node에 hosts파일 셋팅하기</p>\n<ul>\n<li>network_data 변수 파일 설정\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">network_data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">sname</span><span class=\"token punctuation\">:</span> servera\n    <span class=\"token key atrule\">lname</span><span class=\"token punctuation\">:</span> servera.lab.example.com\n    <span class=\"token key atrule\">ipv4</span><span class=\"token punctuation\">:</span> 172.25.250.10\n    <span class=\"token key atrule\">subnet</span><span class=\"token punctuation\">:</span> 255.255.255.0\n    <span class=\"token key atrule\">gw4</span><span class=\"token punctuation\">:</span> 172.25.250.254\n    <span class=\"token key atrule\">dns</span><span class=\"token punctuation\">:</span> 8.8.8.8\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">sname</span><span class=\"token punctuation\">:</span> serverb\n    <span class=\"token key atrule\">lname</span><span class=\"token punctuation\">:</span> serverb.lab.example.com\n    <span class=\"token key atrule\">ipv4</span><span class=\"token punctuation\">:</span> 172.25.250.20\n    <span class=\"token key atrule\">subnet</span><span class=\"token punctuation\">:</span> 255.255.255.0\n    <span class=\"token key atrule\">gw4</span><span class=\"token punctuation\">:</span> 172.25.250.1\n    <span class=\"token key atrule\">dns</span><span class=\"token punctuation\">:</span> 8.8.8.8</code></pre></div>\n</li>\n<li>jinja2 template 작성\n<div class=\"gatsby-highlight\" data-language=\"jinja2\"><pre class=\"language-jinja2\"><code class=\"language-jinja2\"># host.j2 template file 작성\n<span class=\"token jinja2 language-jinja2\"><span class=\"token delimiter punctuation\">{%</span> <span class=\"token tag keyword\">for</span> <span class=\"token variable\">host</span> <span class=\"token keyword\">in</span> <span class=\"token variable\">network_data</span> <span class=\"token delimiter punctuation\">%}</span></span>\n  <span class=\"token jinja2 language-jinja2\"><span class=\"token delimiter punctuation\">{{</span> <span class=\"token variable\">host</span><span class=\"token punctuation\">.</span><span class=\"token variable\">ipv4</span> <span class=\"token delimiter punctuation\">}}</span></span> <span class=\"token jinja2 language-jinja2\"><span class=\"token delimiter punctuation\">{{</span> <span class=\"token variable\">host</span><span class=\"token punctuation\">.</span><span class=\"token variable\">lname</span> <span class=\"token delimiter punctuation\">}}</span></span>  <span class=\"token jinja2 language-jinja2\"><span class=\"token delimiter punctuation\">{{</span> <span class=\"token variable\">host</span><span class=\"token punctuation\">.</span><span class=\"token variable\">sname</span> <span class=\"token delimiter punctuation\">}}</span></span>\n<span class=\"token jinja2 language-jinja2\"><span class=\"token delimiter punctuation\">{%</span> <span class=\"token tag keyword\">endfor</span> <span class=\"token delimiter punctuation\">%}</span></span></code></pre></div>\n</li>\n<li>template 활용한 playbook 작성\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> using jinja2\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">vars_files</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> network_vars.yaml\n\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> create /etc/hosts\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span> \n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span>  ./host.j2\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/hosts</code></pre></div>\n</li>\n</ul>\n<h3 id=\"jinja의-실제-사용-예시\" style=\"position:relative;\"><a href=\"#jinja%EC%9D%98-%EC%8B%A4%EC%A0%9C-%EC%82%AC%EC%9A%A9-%EC%98%88%EC%8B%9C\" aria-label=\"jinja의 실제 사용 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jinja의 실제 사용 예시</h3>\n<ul>\n<li>Jinja는 보통 미들웨어(nginx, redis, db, kafka, LB, )의 conf파일과 같은 것들을 변수/팩트에 따라 동적으로 관리하기 위해서 사용된다.</li>\n</ul>\n<p>Jinja를 쓰지 않으면 정적으로 파일을 copy하거나 blockinfile 등을 통해 직접 작성해주어야 한다.</p>\n<hr>\n<h4 id=\"파일-관련-wrapup-예시\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EA%B4%80%EB%A0%A8-wrapup-%EC%98%88%EC%8B%9C\" aria-label=\"파일 관련 wrapup 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 관련 wrapup 예시</h4>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure system\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">remote_user</span><span class=\"token punctuation\">:</span> devops\n  <span class=\"token key atrule\">become</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure a custom /etc/motd\n      <span class=\"token key atrule\">ansible.builtin.template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> templates/motd.j2\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/motd\n        <span class=\"token key atrule\">owner</span><span class=\"token punctuation\">:</span> root\n        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> root\n        <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0644</span>\n        \n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Check file exists\n      <span class=\"token key atrule\">ansible.builtin.stat</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /etc/motd\n      <span class=\"token key atrule\">register</span><span class=\"token punctuation\">:</span> motd\n\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Display stat results\n      <span class=\"token key atrule\">ansible.builtin.debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">var</span><span class=\"token punctuation\">:</span> motd\n\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Copy custom /etc/issue file\n      <span class=\"token key atrule\">ansible.builtin.copy</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> files/issue\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/issue\n        <span class=\"token key atrule\">owner</span><span class=\"token punctuation\">:</span> root\n        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> root\n        <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0644</span>\n\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Ensure /etc/issue.net is a symlink to /etc/issue\n      <span class=\"token key atrule\">ansible.builtin.file</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> /etc/issue\n        <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /etc/issue.net\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> link\n        <span class=\"token key atrule\">owner</span><span class=\"token punctuation\">:</span> root\n        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> root\n        <span class=\"token key atrule\">force</span><span class=\"token punctuation\">:</span> yes</code></pre></div>\n<h2 id=\"2-복잡한-플레이-및-플레이북-관리\" style=\"position:relative;\"><a href=\"#2-%EB%B3%B5%EC%9E%A1%ED%95%9C-%ED%94%8C%EB%A0%88%EC%9D%B4-%EB%B0%8F-%ED%94%8C%EB%A0%88%EC%9D%B4%EB%B6%81-%EA%B4%80%EB%A6%AC\" aria-label=\"2 복잡한 플레이 및 플레이북 관리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 복잡한 플레이 및 플레이북 관리</h2>\n<h3 id=\"인벤토리-호스트-패턴\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EB%B2%A4%ED%86%A0%EB%A6%AC-%ED%98%B8%EC%8A%A4%ED%8A%B8-%ED%8C%A8%ED%84%B4\" aria-label=\"인벤토리 호스트 패턴 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인벤토리 호스트 패턴</h3>\n<ul>\n<li>\n<p>명령어에서는 아래와 같이 hosts를 다양하게 지정할 수 있음</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ansible <span class=\"token parameter variable\">-i</span> inventory1 --list-hosts <span class=\"token string\">'*.example.com, !*.lab.example.com'</span>  \nansible <span class=\"token parameter variable\">-i</span> inventory1 --list-hosts <span class=\"token string\">'db, &amp;london'</span> <span class=\"token comment\"># db, london 그룹의 교집합에 해당하는 host</span></code></pre></div>\n</li>\n<li>\n<p>플레이북에서는 아래와 같이 hosts를 다중 지정할 수 있음</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> host example\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> db\n    <span class=\"token punctuation\">-</span> lb\n    <span class=\"token punctuation\">-</span> db<span class=\"token punctuation\">,</span> <span class=\"token important\">&amp;london</span></code></pre></div>\n</li>\n</ul>\n<h3 id=\"파일-포함하기-가져오기\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%ED%8F%AC%ED%95%A8%ED%95%98%EA%B8%B0-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"파일 포함하기 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 포함하기, 가져오기</h3>\n<ul>\n<li>\n<p>import_playbook</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Play 1\n<span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> localhost\n<span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span> <span class=\"token punctuation\">:</span> task1\n    <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> Play 1\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Import Playbook\n    <span class=\"token key atrule\">import_playbook</span><span class=\"token punctuation\">:</span> play2.yml</code></pre></div>\n</li>\n<li>\n<p>import_tasks : task를 playbook에 정적으로 삽입함</p>\n<ul>\n<li>import_tasks 사용시 when과 같은 조건문을 같이 쓰게 되면 조건문이 가져온 모든 tasks에 각각 적용됨</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># main.yml</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure system\n  <span class=\"token key atrule\">import_tasks</span><span class=\"token punctuation\">:</span> ubuntu.yml\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_distribution == 'Ubuntu'\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure system\n  <span class=\"token key atrule\">import_tasks</span><span class=\"token punctuation\">:</span> centos.yml\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_distribution == 'CentOS'\n\n<span class=\"token comment\"># ubuntu.yml</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install nginx\n  <span class=\"token key atrule\">apt</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Start nginx\n  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> started</code></pre></div>\n</li>\n<li>\n<p>include_tasks : task를 playbook에 동적으로(런타임에) 삽입함</p>\n<ul>\n<li>include_tasks 사용 시에 when을 함께 쓰게 되면 포함을 시킬지 말지에 대한 용도로서 사용되며, 보통은 when문과 함께 사용하여 조건에 맞는 경우만 가져오도록 함.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># main.yml</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Include OS specific tasks\n  <span class=\"token key atrule\">include_tasks</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"setup_{{ ansible_facts.ansible_distribution | lower }}.yml\"</span>\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_distribution in <span class=\"token punctuation\">[</span><span class=\"token string\">'Ubuntu'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CentOS'</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># setup_ubuntu.yml</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install packages\n  <span class=\"token key atrule\">apt</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ item }}\"</span>\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n  <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> nginx\n    <span class=\"token punctuation\">-</span> python3</code></pre></div>\n</li>\n</ul>\n<h2 id=\"3-역할\" style=\"position:relative;\"><a href=\"#3-%EC%97%AD%ED%95%A0\" aria-label=\"3 역할 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 역할</h2>\n<ul>\n<li>\n<p>콘텐츠를 그룹화하여 코드를 다른 사용자와 쉽게 공유할 수 있게 해주며 재사용성을 높여줌</p>\n</li>\n<li>\n<p>import_rule, include_rule 은 import_task, include_task와 문법의 거의 비슷함(조건문이 의미하는 방식 등)</p>\n</li>\n<li>\n<p><code class=\"language-text\">roles</code> section</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> A play that only has roles\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> remote.example.com\n  <span class=\"token key atrule\">roles</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> role1\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> role2</code></pre></div>\n</li>\n<li>\n<p>role의 디렉토리 구조 ( ex. my-role  )</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">├── defaults\n│ └── main.yml\n├── files\n├── handlers\n│   └── main.yml\n├── meta\n│   └── main.yml\n├── README.md\n├── tasks\n│   └── main.yml\n├── templates\n├── tests\n│   ├── inventory\n│   └── test.yml\n└── vars\n└── main.yml</code></pre></div>\n<ul>\n<li>defaults: main.yml 파일에 role이 사용될 때 덮어쓸 수 있는 role 변수의 기본값이 포함되어 있습니다. 해당 변수는 우선 순위가 낮으며 플레이에서 변경하고 사용자 지정할 수 있음</li>\n<li>files: 이 디렉터리에는 role에서 참조한 정적 파일 존재</li>\n<li>handlers: main.yml 파일에 역할의 핸들러가 정의됨</li>\n<li>meta: main.yml 파일에는 작성자, 라이센스, 플랫폼 및 옵션 role 종속성 을 포함한 role에 대한 정보가 정의됨</li>\n<li>tasks: main.yml 파일에는 role의 task가 정의됨</li>\n<li>templates: role에서 참조한 Jinja2 템플릿이 정의됨</li>\n<li>tests: role을 테스트하는 데 사용할 수 있는 인벤토리와 test.yml 플레이북이 포함될 수 있음</li>\n<li>vars: main.yml 파일은 role의 변수 값을 정의합니다. 종종 이러한 변수 는 role 내에서 내부 목적으로 사용되며 우선 순위가 매우 높음. 따라서 플레이에서 사용될 때 변경되지 않음.</li>\n</ul>\n</li>\n<li>\n<p>roles 찾는 위치와 순서</p>\n<ul>\n<li>\n<ol>\n<li>./roles</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>/usr/share/ansible/roles</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>/etc/ansible/roles</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>특수 작업 세션 : pre_tasks , post_tasks</p>\n<ul>\n<li>role의 실행 전후에 해야 할 작업을 기술하기 위함. 그러나 실제로는 잘 사용되지는 않고 여러 플레이로 나누거나 role 내부적으로 관리하는 방식이 권장된다.</li>\n<li>그런데 <strong>roles 섹션으로 role을 가져올 경우 role은 해당 play에 정의된 task보다 먼저 실행된다.</strong> roles, tasks의 정의 순서와 무관함. 따라서 아래 playbook에서 작업의 순서는 <code class=\"language-text\">pre_tasks -> roles ->  tasks -> post_tasks</code> 이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Play to illustrate order of execution\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> remote.example.com\n  <span class=\"token key atrule\">pre_tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> This task runs first\n      <span class=\"token key atrule\">ansible.builtin.debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> This task is in pre_tasks\n      <span class=\"token key atrule\">notify</span><span class=\"token punctuation\">:</span> my handler\n      <span class=\"token key atrule\">changed_when</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">roles</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> role1\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> This task runs after the roles\n      <span class=\"token key atrule\">ansible.builtin.debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> This task is in tasks\n      <span class=\"token key atrule\">notify</span><span class=\"token punctuation\">:</span> my handler\n      <span class=\"token key atrule\">changed_when</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">post_tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> This task runs last\n      <span class=\"token key atrule\">ansible.builtin.debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> This task is in post_tasks\n      <span class=\"token key atrule\">notify</span><span class=\"token punctuation\">:</span> my handler\n      <span class=\"token key atrule\">changed_when</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">handlers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my handler\n      <span class=\"token key atrule\">ansible.builtin.debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> Running my handler</code></pre></div>\n</li>\n</ul>\n<h3 id=\"role-실습\" style=\"position:relative;\"><a href=\"#role-%EC%8B%A4%EC%8A%B5\" aria-label=\"role 실습 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>role 실습</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ansible-galaxy role <span class=\"token parameter variable\">--help</span>\nansible-galaxy role list\nansible-galaxy role init httpd-role\nansible-galaxy role init firewall-role</code></pre></div>\n<p>distribution을 만족하면 apache의 설치 및 초기 설정을 하는 role과 방화벽 설정하는 role을 2가지 쓰는 시나리오 실습</p>\n<h4 id=\"httpd-role\" style=\"position:relative;\"><a href=\"#httpd-role\" aria-label=\"httpd role permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>httpd-role</h4>\n<ul>\n<li>task 작성하기\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># httpd-role/tasks/main.yml</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> install web pkg\n  <span class=\"token key atrule\">dnf</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ item }}\"</span>\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> latest\n  <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ httpd_packages }}\"</span>\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> ansible_facts.distribution in supported_dist\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> copy webpage\n  <span class=\"token key atrule\">copy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ src_file_path }}\"</span>\n    <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ dest_file_path }}\"</span>\n  <span class=\"token key atrule\">notify</span><span class=\"token punctuation\">:</span> \n    <span class=\"token punctuation\">-</span> restart_service </code></pre></div>\n</li>\n<li>files에 index.html 작성하기\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> Hello role<span class=\"token operator\">!</span> <span class=\"token operator\">></span> ./files/index.html</code></pre></div>\n</li>\n<li>vars에 변수 선언하기 (task에 작성했던 변수)\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># httpd-role/vars/main.yml</span>\n<span class=\"token key atrule\">supported_dist</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> CentOS\n  <span class=\"token punctuation\">-</span> RedHat\n<span class=\"token key atrule\">httpd_packages</span><span class=\"token punctuation\">:</span>   <span class=\"token comment\"># dnf search httpd </span>\n  <span class=\"token punctuation\">-</span> httpd\n  <span class=\"token punctuation\">-</span> httpd<span class=\"token punctuation\">-</span>manual\n  <span class=\"token punctuation\">-</span> mod_ssl\n<span class=\"token key atrule\">src_file_path</span><span class=\"token punctuation\">:</span> ../files/index.html\n<span class=\"token key atrule\">dest_file_path</span><span class=\"token punctuation\">:</span> /var/www/html/\n<span class=\"token key atrule\">service_name</span><span class=\"token punctuation\">:</span> httpd <span class=\"token comment\"># handler에서 사용 </span></code></pre></div>\n</li>\n<li>handlers 작성\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># httpd-role/handlers/main.yml</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> restart_service\n  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ service_name }}\"</span>\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> restarted </code></pre></div>\n</li>\n</ul>\n<h4 id=\"firewall-role\" style=\"position:relative;\"><a href=\"#firewall-role\" aria-label=\"firewall role permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>firewall-role</h4>\n<ul>\n<li>task 작성\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> add rule to firewalld \n  <span class=\"token key atrule\">firewalld</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ item }}\"</span>\n    <span class=\"token key atrule\">permanent</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">immediate</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> enabled \n  <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ service_port }}\"</span></code></pre></div>\n</li>\n<li>vars 작성\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">service_port</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> http\n  <span class=\"token punctuation\">-</span> https</code></pre></div>\n</li>\n</ul>\n<h3 id=\"playbook에서-role을-사용하는-방법\" style=\"position:relative;\"><a href=\"#playbook%EC%97%90%EC%84%9C-role%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"playbook에서 role을 사용하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Playbook에서 role을 사용하는 방법</h3>\n<ul>\n<li>\n<p>task로 role import/include하는 방법</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd<span class=\"token punctuation\">-</span>role demo\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> servera.lab.example.com\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dummy msg\n      <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"let's start role\"</span> \n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> import httpd<span class=\"token punctuation\">-</span>role\n      <span class=\"token key atrule\">import_role</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> httpd<span class=\"token punctuation\">-</span>role</code></pre></div>\n</li>\n<li>\n<p>roles 섹션 사용하는 방법</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> firewall<span class=\"token punctuation\">-</span>role demo\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> serverb.lab.example.com\n\n  <span class=\"token key atrule\">roles</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> httpd<span class=\"token punctuation\">-</span>role\n    <span class=\"token punctuation\">-</span> firewall<span class=\"token punctuation\">-</span>role\n  \n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> print dummy msg\n      <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Finished roles\"</span> </code></pre></div>\n</li>\n</ul>\n<h4 id=\"실제로는-어떻게-role을-사용할-것인가\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%EC%A0%9C%EB%A1%9C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-role%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%A0-%EA%B2%83%EC%9D%B8%EA%B0%80\" aria-label=\"실제로는 어떻게 role을 사용할 것인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실제로는 어떻게 role을 사용할 것인가?</h4>\n<ul>\n<li>간단하게는 roles 사용</li>\n<li>조건부 실행이 필요하거나 동적 실행이 필요하다면 roles쓰지 않고 import_role, include_role사용\n<ul>\n<li>import_roles: loop와 함께 사용할 수 없으며 조건부로 포함시키고 싶을 때 사용\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup web servers\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> web\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># 조건부 실행 예시</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Import nginx role\n      <span class=\"token key atrule\">import_role</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n      <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> enable_web_server <span class=\"token punctuation\">|</span> bool    <span class=\"token comment\"># role 전체에 조건 적용</span>\n      <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'web'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nginx'</span><span class=\"token punctuation\">]</span>           <span class=\"token comment\"># role 전체에 태그 적용</span>\n      <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">nginx_port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></code></pre></div>\n</li>\n<li>include_rules: loop 사용 및 동적 실행\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup applications\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> app_servers\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># 동적 실행 예시</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Include service roles\n      <span class=\"token key atrule\">include_role</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ item }}\"</span>\n      <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span>                           \n        <span class=\"token punctuation\">-</span> redis\n        <span class=\"token punctuation\">-</span> mongodb\n        <span class=\"token punctuation\">-</span> rabbitmq\n        \n    <span class=\"token comment\"># 동적 role 이름 예시</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Include environment specific role\n      <span class=\"token key atrule\">include_role</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ env }}_config\"</span>      <span class=\"token comment\"># 변수로 role 이름 지정</span>\n      <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ lookup('env', 'DEPLOY_ENV') }}\"</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"외부-콘텐츠-소스에서-role-배포\" style=\"position:relative;\"><a href=\"#%EC%99%B8%EB%B6%80-%EC%BD%98%ED%85%90%EC%B8%A0-%EC%86%8C%EC%8A%A4%EC%97%90%EC%84%9C-role-%EB%B0%B0%ED%8F%AC\" aria-label=\"외부 콘텐츠 소스에서 role 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>외부 콘텐츠 소스에서 role 배포</h3>\n<ul>\n<li>console.redhat.com</li>\n<li>galaxy.ansible.com</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># public role 찾기 </span>\nansible-galaxy role search <span class=\"token parameter variable\">--help</span>\nansible-galaxy role search redis <span class=\"token parameter variable\">--platforms</span> EL\nansible-galaxy role search postgres <span class=\"token parameter variable\">--platforms</span> EL\n\n<span class=\"token comment\"># 찾은 role의 정보 확인</span>\nansible-galaxy role info buluma.postgres <span class=\"token parameter variable\">--platforms</span> EL\n\n<span class=\"token comment\"># 해당 role을 제어 node에 설치 (feat. roles 디렉토리 생성)</span>\nansible-galaxy role <span class=\"token function\">install</span> buluma.postgres <span class=\"token parameter variable\">-p</span> roles </code></pre></div>\n<ul>\n<li>\n<p>roles 디렉토리를 ansible.cfg에 등록</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">[</span>defaults<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">...</span>\nroles_path = ./roles<span class=\"token punctuation\">:</span>/etc/ansible/roles <span class=\"token comment\"># ./roles와 /etc/ansible/roles 두 군데에서 role을 찾기 </span></code></pre></div>\n</li>\n<li>\n<p>role 제거</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">ansible<span class=\"token punctuation\">-</span>galaxy role remove buluma.postgres</code></pre></div>\n</li>\n<li>\n<p>system role : time sync 예제</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> time sync from system<span class=\"token punctuation\">-</span>role\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> all\n  <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">timesync_ntp_servers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hostname</span><span class=\"token punctuation\">:</span> time.bora.net\n        <span class=\"token key atrule\">iburst</span><span class=\"token punctuation\">:</span> yes\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hosname</span><span class=\"token punctuation\">:</span> time.ewha.or.kr\n        <span class=\"token key atrule\">iburst</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">roles</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> redhat.rhel<span class=\"token punctuation\">-</span>system<span class=\"token punctuation\">-</span>roles.timesync</code></pre></div>\n</li>\n</ul>\n<h2 id=\"4-컬렉션\" style=\"position:relative;\"><a href=\"#4-%EC%BB%AC%EB%A0%89%EC%85%98\" aria-label=\"4 컬렉션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 컬렉션</h2>\n<ul>\n<li>role을 다운 받는 것은 일반적이지 않고 컬렉션을 받는게 더 일반적임.</li>\n<li>role, module, lib 등이 컬렉션 안에 포함이 되어 있음</li>\n<li>삭제는 직접 rm 해줘야 함</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">ansible<span class=\"token punctuation\">-</span>galaxy collection <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>help\nansible<span class=\"token punctuation\">-</span>galaxy collection download openstack.cloud <span class=\"token punctuation\">-</span>p ./collections  <span class=\"token comment\"># tar.gz download 후 install 가능</span>\nansible<span class=\"token punctuation\">-</span>galaxy collection install openstack.cloud<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">-</span>p ./collections <span class=\"token comment\"># install</span>\nansible<span class=\"token punctuation\">-</span>galaxy collection list</code></pre></div>\n<h2 id=\"5-ansible-문제-해결\" style=\"position:relative;\"><a href=\"#5-ansible-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"5 ansible 문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Ansible 문제 해결</h2>\n<h3 id=\"플레이북-문제해결\" style=\"position:relative;\"><a href=\"#%ED%94%8C%EB%A0%88%EC%9D%B4%EB%B6%81-%EB%AC%B8%EC%A0%9C%ED%95%B4%EA%B2%B0\" aria-label=\"플레이북 문제해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>플레이북 문제해결</h3>\n<ul>\n<li>alias 사용하기 ( an )</li>\n<li>vi 에디터 환경설정</li>\n<li>playbook 실행 전에 syntax 확인하기</li>\n<li>register 키워드를 통해 실행결과를 변수에 저장하고, 그 변수의 내용을 확인하기 ( debug var 활용. rc, stdout 확인 )</li>\n<li>playbook 아티팩트(실행로그) 참조\n<ul>\n<li>아티팩트를 사용하지 않으려면 ~/.ansible-navigator.yml 설정을 아래와 같이 변경\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">ansible-navigator</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">playbook-artifact</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>ansible.cfg 에 log파일을 별도 설정\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>defaults<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">..</span>.\nlog_path <span class=\"token operator\">=</span> ./lasttime.log</code></pre></div>\n</li>\n</ul>\n<h3 id=\"관리-호스트-문제해결\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EB%A6%AC-%ED%98%B8%EC%8A%A4%ED%8A%B8-%EB%AC%B8%EC%A0%9C%ED%95%B4%EA%B2%B0\" aria-label=\"관리 호스트 문제해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관리 호스트 문제해결</h3>\n<p>대부분 인증/권한과 관련된 문제이다.</p>\n<ol>\n<li>일반 유저로 ssh 접속이 되는지</li>\n<li>유저의 인증을 패스워드 인증이 아닌 공개키 인증 설정으로 해야 함</li>\n</ol>\n<ul>\n<li>그러면 최초에 공개키를 관리 node로부터 받으려면 어떻게 해야하나?</li>\n<li>ansible.cfg에 파일에 ssh 연결에 대한 설정 필요\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>defaults<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">..</span>.\nhost_key_checking <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span></code></pre></div>\n</li>\n</ul>\n<ol start=\"4\">\n<li>sudo 를 통해 권한상승 시 암호 입력 받지 않도록 설정 필요 ( /etc/sudoers )</li>\n</ol>","frontmatter":{"date":"November 13, 2024","title":"Ansible Linux 자동화 2","categories":"Linux DevOps","author":"jjunyong","emoji":"😌"},"fields":{"slug":"/ansible2/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/ansible1/","nextSlug":"/aem1/","prevSlug":"/ansible2/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}