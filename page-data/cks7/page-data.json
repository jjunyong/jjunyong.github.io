{"componentChunkName":"component---src-templates-blog-template-js","path":"/cks7/","result":{"data":{"cur":{"id":"d9b8eb75-a284-5ed0-84aa-025d5a5700f9","html":"<h3 id=\"falco\" style=\"position:relative;\"><a href=\"#falco\" aria-label=\"falco permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Falco</h3>\n<ul>\n<li>아무리 보안이 강한 클러스터를 구축하여도 막상 공격 받았을 때는 어떻게 대처애햐 하는가? strace, Tracee 와 같은 툴로 application에서 사용된 syscall을 분석할 수 있지만 MSA 환경에서 수백개의 pod가 수만 개의 syscall을 생상하고 있는 환경에서 이를 일일히 분석하는 것은 쉬운 일이 아니다.</li>\n<li>대신 Faclo를 활용하면 /etc/shadow 에 접근한다거나 log파일을 편집/삭제 하는 등의 의심스러운 행동을 Falco가 모니터링 해준다.</li>\n<li>Falco Architecture</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACXUlEQVQoz0WSSWtTURiG8yNcu3fr0p0bQRxwqVtXLhzJwmHpRsGKkioK4kIEBSeoxtoabTVaUWtpbbFEkk6aOyR3yD1jbnKjj+Q6HXg5HwfO873feU9hLYzw4xjXcRCBj4pauXzPw/urSOGFEi/SeJ7/79xxHJIkodfr5TLGUPjgtpnccIhbLS5O1Tn8YIkz5WXascAajZICUzmLLZ/APi0iOgGJVDlISEX1zVtKpRIjIyNUq1UKn/2AmaaXdz54d4FtpXfsuP4BJ+jQNRopBHbqHFH5FHL8NCpuI0VCEodorXg2McmpkycpFouUy2UKfiehGUZ4vo/VGill7kxrnY9gjMUCCSCHSn+gBiAHYPs/qVSeMzExyeeFBUavjFLQSpJ0EmQc8GLZ5fijJcaXHMhStLF0rcXO38VUL2E/3casvkO+PI+unMWszDA7v8Tc3CzL9QZjY48pDB11koQoDHBCwdx6wPdQkvVS0l6Pbtdib+2ie2Ez6c3tpB9vkF7dSlbagpy5hupDs624M/+WQHoUlFIIIfLU0q4lSy39tPt7VGMRSiOG7xX5qE6Akoq25/B9fRXXcQmTmKDWxJkeIxbOf2CjsUa9vsHilxVqtTXWv7msbLg0mz6tdkwrSPLdddusrH7jy3Kdr18bBEGATS3GpkipKQgh6fdTXk+/Z+/OI+zbfYz9e45yoDjKpkNXufVqkeHq9/sMBhmDwSBPt9OJCcOQKIow2iClyAPNHRqjqdUaPLz3nIf3Kzx+UOHJ9ByXx2dZXPf/ADOyLMs/8BA+rId34zjGWpvXQ+Av4BzI0OlviYwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/5e6f2d41437d6f0ddd075d1d321f5c4c/37523/image1.png\"\n        srcset=\"/static/5e6f2d41437d6f0ddd075d1d321f5c4c/e9ff0/image1.png 180w,\n/static/5e6f2d41437d6f0ddd075d1d321f5c4c/f21e7/image1.png 360w,\n/static/5e6f2d41437d6f0ddd075d1d321f5c4c/37523/image1.png 720w,\n/static/5e6f2d41437d6f0ddd075d1d321f5c4c/302a4/image1.png 1080w,\n/static/5e6f2d41437d6f0ddd075d1d321f5c4c/07a9c/image1.png 1440w,\n/static/5e6f2d41437d6f0ddd075d1d321f5c4c/f291a/image1.png 2258w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Falco Kernel module을 허용하지 않는 Provider도 있어서 Aquasec tracee처럼 eBPF를 활용하기도 한다.</li>\n<li>Syscall은 Falco module에 의해 감지되고 나서 library에서 분석되고 predefined된 Falco rule을 활용하여 policy engine에 의해 의심스러운 syscall인지 필터링된다.</li>\n<li>output/alert 는 log파일이나 slack 등으로 나타난다.</li>\n</ul>\n<h4 id=\"falco-install\" style=\"position:relative;\"><a href=\"#falco-install\" aria-label=\"falco install permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Falco install</h4>\n<ul>\n<li>모든 node에 설치해야 하지만, 그게 안될경우 k8s daemonset으로 설치할 수도 있다. helm chart로 설치하는게 가장 간편하다.</li>\n</ul>\n<h4 id=\"falco-활용\" style=\"position:relative;\"><a href=\"#falco-%ED%99%9C%EC%9A%A9\" aria-label=\"falco 활용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Falco 활용</h4>\n<ul>\n<li>journalctl 을 이용해서 host OS에 설치된 falco를 모니터링하고 있는 상태에서 새로운 터미널을 열어 pod에 —exec -it로 접속하거나 /etc/shadow파일을 접근하거나 하면 falco에서 의심스러운 syscall로 보고 감지하는 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABw0lEQVQoz62QvWtaURjGD7hYr6L3Dn5/o1TxI4JaheKVCFdKOyQkg2Swgi6B0KUh4JRA0slFB/XiJ9EsldApY4buXTLm37gKDWR6wntIQk2hZOjw43l4z/M+59zL5j9v8PX8Gle/bnF/9xuatoS2XGL5gtVq9deM0DRtDdY4OoTt7QYy74soKwo2N0soFAqQZfnVFItF5HI51Go1sJ3tLTDG/guRSASsWv0MgyDAHwjA7XbD5XLB4/FwdTqd8Pl8cDgc/Iw8nT3NyRM2mw06nQ7JZBKs0Wjw5Vgshmg0ilAoBLvd/gwVUSF5Wia1Wq18hzyV0QX0wkQiAVav1yFKEsLhMC/z+/389sDjiylMM1Kv17tGMBjkWcpRYSqVAqvXqhCNb+By2GGxWCBJEkRRhNFohMFggMlk4l4QhGdoZjabodfr1/4hfQHrTL9j98sxTtt9/Li8xHx+gcFggNFohMlkgul0yvVPxuMxV8qpqorhcIher4fFYgHW7A3xbu8A+80zDNQ++qrKg91uF+12G51O51W0Wi3MZjOwb2cn2PpYxqcPZRRkGaVSCYqiIJ/PI51OI5PJ/BPKZLNZxONxVCoVPABXn3u2OIcs4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/daf3aecaff3711e16304500011bd7513/37523/image2.png\"\n        srcset=\"/static/daf3aecaff3711e16304500011bd7513/e9ff0/image2.png 180w,\n/static/daf3aecaff3711e16304500011bd7513/f21e7/image2.png 360w,\n/static/daf3aecaff3711e16304500011bd7513/37523/image2.png 720w,\n/static/daf3aecaff3711e16304500011bd7513/302a4/image2.png 1080w,\n/static/daf3aecaff3711e16304500011bd7513/07a9c/image2.png 1440w,\n/static/daf3aecaff3711e16304500011bd7513/42b11/image2.png 2364w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Falco rules\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACQ0lEQVQoz22S3UtTARiHDxIhXgUGRvRxbyBdRI4ZkQhh9nXVVKhF/Qd6uYLu9CIxkwq2AhlSEMQQ86OOOkWdmKmlRW5zc2x+zrUvPWfnY2d7woN0Ef3g4QfvxcPLyytM+WYQxc+IosjQ8DD9/f2EwmEOUizy3+TzedLpNKqq4vF4aGlpobW1FafTiXCtvp7yipOcPX2GUycqqDhezuUaKw/v23lw7y7NjY3YbHdotNlobmri9q2bPOvsNKWSJDE9Pc1rlwuX08nQ4CBCVVUVgiBwtOwYpSUllJeVUioI5uzIYf9LQ0ODueleNsuvlRW84xMm8wuLCHa7nfMXLNRcucr12jpu1NZhvWjBUl1tYrVY/nLJauVcZSUOh8MUZrJ7pLdjJFaXSISWScZCCLK0T07aR5ElZFk2URUFTVXQNBVFVVE1lbyumeiaRk5R2JckJEUlFZhn1/eB3RkPv797EXp8YTpG/Twd8RPZSRHcStIu+ukYDfD2axQKOqs7GdrFAB1jQdxfolDUKWgKSr5AfG6QsNtB2P2IDbEHYdK/Sd+3GB+X1omnssRTewwsbzCwvMnsWoJCXicj5Rjz7zD0cxuvP85iNMmP9SSSaqAEppC93UjeF0gLfQi9s2t0jwfp8gaJJTLEElm6xkO8mgzzfnEDCnmyskLvXAyXL8KbmQgvJ8P0zEZISwZa8hNq9DFq9Am5LTeClpMwVJmClkNRcubtDiQUDbN1XccwjIOvPKQAGGDoqEVQJkaQn7chdbUhe97xB7e8LileksVhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/bf9c79e0130cd50e262fd1293a7430cf/37523/image3.png\"\n        srcset=\"/static/bf9c79e0130cd50e262fd1293a7430cf/e9ff0/image3.png 180w,\n/static/bf9c79e0130cd50e262fd1293a7430cf/f21e7/image3.png 360w,\n/static/bf9c79e0130cd50e262fd1293a7430cf/37523/image3.png 720w,\n/static/bf9c79e0130cd50e262fd1293a7430cf/302a4/image3.png 1080w,\n/static/bf9c79e0130cd50e262fd1293a7430cf/07a9c/image3.png 1440w,\n/static/bf9c79e0130cd50e262fd1293a7430cf/828bd/image3.png 2310w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<ul>\n<li>container.id ~ container.image.repository는 모두 condition에서 디폴트로 사용할 수 있게 해주는 변수(?) 들이다.</li>\n</ul>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFklEQVQoz62SzU4TURTHT6Gdj37M0JlOy0ehxgXGDTsJIgkLaYIaiK61GyBaS9AYWUjConXBQyCQtNNBmrjALU/AE0BbCq/Ajl37MzMCG0yMif/kl3PPvefec27Oke3tbcrlMltbW5QrFb5sbLC5ucnn9XWq1Rq+ut0u3V6Pv+nq6gqZnZ1FUVQyQ1mMRJyBeBwzkSCm69zP5Xi1uMjCi+e8XFjg2fw8T+fmmPPJ52/J5/P47xwdHSGTk48QCWFlxzGMAcbSaQaTJmNOioxpEBYhIoKta+h9faghQQsJyvW+b01VQUTY3d1FpqamAiede0jcGkTXdBzTYCRlY8ZiJKLRANswGLItBi2LUcchk0wy6qQYsW2yaYeQCG69jkxPPw4qTA3dI5F0SCeTjGeHsU0DJRIhqmkBuqoS1VQ0VQnWN75vNVUNivI8D5mYmAic/qhFnwjxSDj4lp9R/pFqtYr8PDzk284O3sEPXNflwKvjuS7fvTqN/f1b69ZqwYVarfZH9vb2aLfbCP9RvV4POT8/5+TkhGazSfP0lFarRavdDrK1z8448+l08ONuuLi4uEOn0+Hy8hKZmXlCqF8hk3uAlcow7KQYSzsY8Rj6dUP8mfQbFA6HiUQid1CU32PTaDSQr5UKr98UKK19orj6kbfviqy9L/JhtcRqsUipWGStVGJlZYWlpSWWl5fv4J8VCgWOj4/5BXgO31Qhmc0cAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/1f8438f80fab80ce8c0ca59af2b8334b/37523/image4.png\"\n        srcset=\"/static/1f8438f80fab80ce8c0ca59af2b8334b/e9ff0/image4.png 180w,\n/static/1f8438f80fab80ce8c0ca59af2b8334b/f21e7/image4.png 360w,\n/static/1f8438f80fab80ce8c0ca59af2b8334b/37523/image4.png 720w,\n/static/1f8438f80fab80ce8c0ca59af2b8334b/302a4/image4.png 1080w,\n/static/1f8438f80fab80ce8c0ca59af2b8334b/07a9c/image4.png 1440w,\n/static/1f8438f80fab80ce8c0ca59af2b8334b/eb1d2/image4.png 1622w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<ul>\n<li>macro 라는 걸 써서 특정 조건을 다 쓰는 대신 alias로 쓸 수 있다.</li>\n</ul>\n</li>\n<li>Falco 설정 파일\n<ul>\n<li>메인 config 파일은 <code class=\"language-text\">/etc/falco/falco.yaml</code> 이다. 이 파일엔 rule파일의 경로들과 log level, priority 등의 정보를 포함한다. priority는 해당 등급 이상의 rule에 대해서만 로깅하도록 하는 것이다.</li>\n<li><code class=\"language-text\">rule_file:</code> 부분에서 가장 마지막에 오는 rule이 앞에 있는 rule을 override한다.</li>\n</ul>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQ0lEQVQ4y6WS246CMBCG205PtBQoZ40bNxujN+L7v92/obpGjSRsvPgyM2XmC1Ng0zRh5nK5pHg+Tzgej0+cTqdFXnuZtgpSE0gJCOIpXiFII0FSgDG2nsxZSCWhtErxMVd6FtLTsxltFIjovTAvPeq+QuwqVG2Jsg6pLusixSJea194hMpj7p/PfHDvhdYZKKPg8gyZt8/k9n4+v+mqlaWWKbmva26r6SuzKN2zkuuEJGj1hXPG7yz2WZujih2qIsIbg0zrhNMGJEQaFg8izliqxaKUc2zqiJ9xwGE7Yt93+B56fLUNdm0DZ/TbwUUhMY7oHPpQYCgKdCEgNxaGJLw2kFykYbrxl/Plj2JBxiWE0iCd/e9HfqVod6i3B8Rhj9BsYHz5mTDUI6rhGyH2GJsGSsrPhPPK2noQSYTMQkv6SPgLNg8tF+1QQIoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/5ba7fcad4675570689093ddc58fb5118/37523/image5.png\"\n        srcset=\"/static/5ba7fcad4675570689093ddc58fb5118/e9ff0/image5.png 180w,\n/static/5ba7fcad4675570689093ddc58fb5118/f21e7/image5.png 360w,\n/static/5ba7fcad4675570689093ddc58fb5118/37523/image5.png 720w,\n/static/5ba7fcad4675570689093ddc58fb5118/302a4/image5.png 1080w,\n/static/5ba7fcad4675570689093ddc58fb5118/07a9c/image5.png 1440w,\n/static/5ba7fcad4675570689093ddc58fb5118/94cea/image5.png 1940w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAvklEQVQoz6WRy67CMAxEE+dhp4kbaKkKiAX//5OD6l50d0iUheXxZnzGdjELdL6jTVdwUTjnfquQGO28ovYFFNLvhkQB4/KATjeMTaGlQIugFQGneIxw6BcUncClgrxHILLuDxGGiL4+Mc43qHYMzEa2UeYYMeQMydm0kYugCpuuzDa3v0RbOiMUnSDtDCKC9942vXsgb7Rv8k8VieAoJvTlgcu84jSeUGWn6HUAp0NP2sV2L/Luf1vY7/it4QsIqKZPxFwR5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/e3b10982b6c798c932ee9e5232011843/37523/image6.png\"\n        srcset=\"/static/e3b10982b6c798c932ee9e5232011843/e9ff0/image6.png 180w,\n/static/e3b10982b6c798c932ee9e5232011843/f21e7/image6.png 360w,\n/static/e3b10982b6c798c932ee9e5232011843/37523/image6.png 720w,\n/static/e3b10982b6c798c932ee9e5232011843/302a4/image6.png 1080w,\n/static/e3b10982b6c798c932ee9e5232011843/07a9c/image6.png 1440w,\n/static/e3b10982b6c798c932ee9e5232011843/9c2d2/image6.png 2226w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<ul>\n<li>rule 파일\n<ul>\n<li>Falco는 기본적으로 builtin Rule들이 존재한다. 그 파일들은 /etc/falco/falco_rules.yaml에 존재한다.</li>\n<li>custom rule들을 추가 적용하기 위해서는 위 파일이 아니라 falco_rules_local.yaml같은 걸 만들어서 추가해주는 것이 좋다.</li>\n</ul>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdUlEQVQoz41T127DMAz0kGQNa3nJSRMUaf//G68gZSd9KdKHA4fFM4+UGu0SYshYgsfkR0TnMHuPPDrYYWBopWCUgpYSjmPJqN8V27Zp0BC0HXEtV2wpIVrDhERMBaLv0XcdoyO0LWTfQ/QdRNcdfs/2SThIic9txX1dcFtmPPaCLUWMWkMJwYfZimqbs/AvWDuizCuScyz7lBqthTeGLeWyc3yGpJ9Sq2zFP6c8E87B42vf8X3Z8SgbLlMG5dYYkEZXia1hjEZzTHmnNYI1CNbymKKzPJJGa4sUM/acsYbAf/dGPyW3bcvzIVDBifaXz+ja2qGyATFOWMLI0qgDWgqh5MjWKPmS9A7U4V4u2HJmQroyVCyFqNdDSu50kOJ/hMOgcS8Ft3nCdcq84Y95YnKSTouhWVHnREzyzqvUd9UXR8yEzlgk73lmVHiSEIHTQ82buhBaAMU0Z3fgnDf5TEqSaYZzCCgpvl4EHTquw/liCO8k/wBFI/BeESRoLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image7\"\n        title=\"image7\"\n        src=\"/static/5f6db3f2846ac3c70ab6aa980aabda85/37523/image7.png\"\n        srcset=\"/static/5f6db3f2846ac3c70ab6aa980aabda85/e9ff0/image7.png 180w,\n/static/5f6db3f2846ac3c70ab6aa980aabda85/f21e7/image7.png 360w,\n/static/5f6db3f2846ac3c70ab6aa980aabda85/37523/image7.png 720w,\n/static/5f6db3f2846ac3c70ab6aa980aabda85/302a4/image7.png 1080w,\n/static/5f6db3f2846ac3c70ab6aa980aabda85/07a9c/image7.png 1440w,\n/static/5f6db3f2846ac3c70ab6aa980aabda85/37563/image7.png 2228w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>변경한 rule을 적용하려면 Falco를 재기동하여 hot reload해줘야 한다.\n<code class=\"language-text\">kill -1 $(cat /var/run/falco.pid)</code>를 하면 서비스가 자동으로 다시 재기동시키기 떄문에 hot reload가 된다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"immutable-인프라\" style=\"position:relative;\"><a href=\"#immutable-%EC%9D%B8%ED%94%84%EB%9D%BC\" aria-label=\"immutable 인프라 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Immutable 인프라</h3>\n<p>Mutable vs Immutable infrastructure</p>\n<ul>\n<li>Configuration Drift</li>\n<li>런타임에서 container의 immutable 보장\n<ul>\n<li>아래와 같은 행동을 하면 immutability가 깨진다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABLUlEQVQoz52QQWrCUBRFs4B2EKIlxqgkzooVnBoTnOgGnCYbENqpk3bUluJSWmhiErcQiiBdixpNjJJ/y38l0nbU9sHlvv8Hh8cRxrfXOCudo6npUBQFtVoNjUYD1WoVqqqedv6vaRoqlQrK5TKiKMLhcMBqtcJmszlFeLx/QPuqjV6vh263+6uYponlcon9fo/1ek2gOI4/gSxn+M8wxgjIQV8jRO9veH59QRAE8DwPvu9jNpvROwxDuK6L+XxO+89eLBZIkuQ7cHx3g5J6gdZlC3pTJ2/cEW/uVJIk6sKpLMuo1+sQRRG2beN4PGK73WK321EL06cphoMBHMfBaDRCv98nT4ZhULjbYi9iWRY6nQ4mkwkBOYyHXytkWQYGhjzPyctfh0PSNKXmwA9U/ItyMcAHywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image8\"\n        title=\"image8\"\n        src=\"/static/e3fb658cbbe5ad55aa69408b25113ae1/37523/image8.png\"\n        srcset=\"/static/e3fb658cbbe5ad55aa69408b25113ae1/e9ff0/image8.png 180w,\n/static/e3fb658cbbe5ad55aa69408b25113ae1/f21e7/image8.png 360w,\n/static/e3fb658cbbe5ad55aa69408b25113ae1/37523/image8.png 720w,\n/static/e3fb658cbbe5ad55aa69408b25113ae1/302a4/image8.png 1080w,\n/static/e3fb658cbbe5ad55aa69408b25113ae1/2cefc/image8.png 1400w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>이런 행동을 미연에 방지하기 위해서 아래와 같이 securityContext에서 <code class=\"language-text\">readOnlyRootFilesystem: true</code> 와 같은 설정을 할 수 있으나 이렇게 하면 pod가 fail한다. nginx pod는 아래 2개 디렉토리에 write하는 작업이 필요하기 때문이다. 그래서 해당 경로에는 volume을 마운트함으로써 해결한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACnklEQVQoz22Ty0tUYRjGv5k5lzkz55w5t/Fkx7SxkEqooCRIKk0ZQfLuRqjZCAqFTRs36kJJ7YL+Je7q79CNCG7ERY3iztvkwvIX5+sCZh/8eN7Fx8Pzve/7iaOjI46Pj/9SrVYvcHh4yP7+PicnJ8zNzfH8RYmRkRE+f/rExsYGq6urrK2tScSLsRLFYpHu7m66urpkHWtbWxutra2y3tzcpFr9xo/v33na9QxFNzGMDKqqouv6OcTy8jJTU1PMzMwwPT3NxMQE5XJZEteTk5Nsb2/LpGdnZ7R3FNHMgJxpIoS4yJfKFypfK1QqFXZ2ds6xu7vL3t4ecVsODg6IT1tHEaFmCD2PVCp10bDjWSeFqwWam5tpamqiUChQX19PY2MjURRJXV9f5/T0VBo+evwEoVl4QYih/Mfwzes39Pb2Mjg4KBkeHmZgYICenh6GhoZk87e2tv4atj58iBAqYRjhejUkFY1EMkUypZBIJBFTb6d59fIV5fJr2bfx8XHGxsakxoyOjlIqlejv72dpaYn29naZxAkbsLxajKyNblgoeoaUqiNu3LpJSlHJZLLo6TSKoqKomlRN0849J558Z2enrN2wgaAmotZzuBJ45DIGuqIg7t29jZfLkvdsPMekJnAI8y6+71EThlimiRlfFEKu1B9D0wnI5gJs0ySfszE0jUQigWhpvkmU1aj3LXJWGtc2cO00lpnBdV3Smob5O2FsFu+lEArB5as4loln22TSaRLJ5K+pP3hwn9rQp+FKyKVLPlFdRKFwjaiuTk7Y8zxc3yelqvT19dHScl+aK1aIrhkk/53yozu3CXWVxrzPdd8lchzsXE4aBUGA4zjk83n5K+KEKysrzM7O8uHDR969f8/i4iILCwvMz89LfgKCXL2jW6wUFQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image9\"\n        title=\"image9\"\n        src=\"/static/8fac64bc2e7f2709132e6bcedbdf6092/37523/image9.png\"\n        srcset=\"/static/8fac64bc2e7f2709132e6bcedbdf6092/e9ff0/image9.png 180w,\n/static/8fac64bc2e7f2709132e6bcedbdf6092/f21e7/image9.png 360w,\n/static/8fac64bc2e7f2709132e6bcedbdf6092/37523/image9.png 720w,\n/static/8fac64bc2e7f2709132e6bcedbdf6092/302a4/image9.png 1080w,\n/static/8fac64bc2e7f2709132e6bcedbdf6092/07a9c/image9.png 1440w,\n/static/8fac64bc2e7f2709132e6bcedbdf6092/b3608/image9.png 2160w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>결과적으로 아래와 같이 설정되어 있어야 Immutable한 것이다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVQoz22S3UtTcRjHfztnDt0EJd1m6dKLqJte/hf/CsGVURQRGEUQXeSNeWnYLruRCLtI8kIDt4vC1DJ1K6fbnLqzc3bez1HoEztqEPbA5/L58Lx8haHrWMZZGvoJjQaapuH7PplMhsHBQcbHX/J1aYlcNksulyObzf5FHCgqW1WF7b0623sKxarCzn6dhqqiaxq6rqOqKvCbkTv3EOEYfckeUok4vfFuom1thFtaiEQiAWJhrczD6WWeznzj8btVRt+uMPZxE+XnL8ziFrptowVCuH33PkKOkujoICKHEUKc5UuhytjsOpPzeSYX8kzMbfB6cQutXMHcrWBYdrBys26lbyLC7cT7LtFxrodoeyctkVZkSUYWoWPh50KVFx/WebVQYOpTgYm5TaYWi2ilElaljOk46I1GIEwPDyOkGMnEebrbY8Ra25AkGUlIhE4nnF8rM/JmmScz33n2fo0H06s8n82jbe/glHawPR/DMI6F6TQi1Epv3wA98SQhSQ5EUihE6ASxe6CyUtxno1wjX6nxo1SjUFWxDQPXNHFdF8uyAuHQ0BBCyHR1JemMRpH+d0PTMPBsE8+28BybI8/lyHdxPQ/P9/E8D9t2AuGj0VESFy5y49p1rl65zEB/P6lU6h9EMxa6YWAYZjBJs9lx3EDUzN4ph4eH2LYdxMgyzYDms5rU63UURaFWq/EHeIv4MNSfUd8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image10\"\n        title=\"image10\"\n        src=\"/static/5315928c240cff4e998db36c2dbeb403/37523/image10.png\"\n        srcset=\"/static/5315928c240cff4e998db36c2dbeb403/e9ff0/image10.png 180w,\n/static/5315928c240cff4e998db36c2dbeb403/f21e7/image10.png 360w,\n/static/5315928c240cff4e998db36c2dbeb403/37523/image10.png 720w,\n/static/5315928c240cff4e998db36c2dbeb403/302a4/image10.png 1080w,\n/static/5315928c240cff4e998db36c2dbeb403/07a9c/image10.png 1440w,\n/static/5315928c240cff4e998db36c2dbeb403/59058/image10.png 2376w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"kubernetes-auditing\" style=\"position:relative;\"><a href=\"#kubernetes-auditing\" aria-label=\"kubernetes auditing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes Auditing</h3>\n<p>k8s에서는 auditing을 지원한다. 모든 request는 kube-apiserver를 통하게 되는데 request의 lifecycle에 따라 아래와 같은 stage를 거지게 된다.</p>\n<ul>\n<li>RequestReceived stage: request가 valid한 지 여부를 떠나서 발생하는 event</li>\n<li>ResponseStarted stage: request가 authenticated, authorized, validated 되고 나면 발생하는 event\n<ul>\n<li>—watch와 같이 시간이 소요되는 request에 적용하기에 좋다.</li>\n</ul>\n</li>\n<li>ResponseComplete stage : request가 처리되고 response가 응답될 때 발생하는 event</li>\n<li>Panic stage: request가 invalid하거나 error가 있을 때 발생하는 event</li>\n</ul>\n<p>각 stage는 auditing이 enable되어 있을 때  kube-apiserver에서 의해서 기록될 수 있는 event를 발생시킨다.</p>\n<h4 id=\"auditing-rules\" style=\"position:relative;\"><a href=\"#auditing-rules\" aria-label=\"auditing rules permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>auditing Rules</h4>\n<ul>\n<li>모든 event를 로깅하게 되면 비효율적이기 때문에 아래와 같이 Rule을 만들어 관리한다. audit level은 <code class=\"language-text\">None</code>, <code class=\"language-text\">Metadata</code>, <code class=\"language-text\">RequestResponse</code>가 있으며 None은 아무것도 남기지 않고 RequestResponse는 Metadata보다 더 많은 데이터를 기록한다. 아래 rule에서 secret에 대해서는 metadata 레벨로 기록되며 따로 namespace나 verb, resourceNames 등이 설정되지 않았기 때문에 모든 secret에 대한 operation에 대해서 metadata레벨로 로깅되게 된다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACEklEQVQoz4WS3WtSARiHj87j8WPHqUfZjcjooouou/6auuiii/4CwW7qFLFugjBoTl3T3QbWnFsXxeimoEHRotrGZuGWKHo6ej6Wq7H1hGc1GiG98Ny8/Hh4f/AKhmFgmgbLH3aYf1NnaXWb+defae40WXn5guuqyuTkbW6oKlfTaYf0b1KpFKqqsrm5SbPZpNFoIAyEA7LPN8gsr3Hn2Ro3F9+zvVFnrlBgxB8mpsSR/T78oojH7UYQhBNEIhFisRiKoiDo3S6mYfBV7/J0tc6+3UNvfWG332e68IARX4igHCHg8xGVRx0kUfxHeoxhmvTNHgtva1x4+I71egOt0+Hg4JCpqSkEwU0oOk5YlglKEj6viOjxnJC4XK5jBMsw6Ni7rFerbN+6xqePa/TsXQaTzWaPKo0nkSQJ17Cr/sbuf6O5VcM6kwBBQLt8EW3vhyOczuWcUDAcRwqOEQoGCUhevB4PLtcQoWnbNLZqmOcmjoRXLqHtfXeEuVzeCQXkMJFwFGUsjBKS8Xm9uN3uE1WPK/PzkH2g9WqFdu4+hqbzZ/L5I+HoWJyAV/x/3QH5wgylYol7uQJ3i3PMFEvMzhYpP3pMJpMhqsQ4ffY8yYlTTCQSJBMJ4vH4UIRyuUylUmFxYYHFSoUnS0tUq1Vn12q1sG0b0zSxLBvbtrAsy/nbXq9Ht9tF13U0TaPT6dBut/kFJmbA0AV6nO0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image11\"\n        title=\"image11\"\n        src=\"/static/7480826ec53a58756cf690caa0852527/37523/image11.png\"\n        srcset=\"/static/7480826ec53a58756cf690caa0852527/e9ff0/image11.png 180w,\n/static/7480826ec53a58756cf690caa0852527/f21e7/image11.png 360w,\n/static/7480826ec53a58756cf690caa0852527/37523/image11.png 720w,\n/static/7480826ec53a58756cf690caa0852527/302a4/image11.png 1080w,\n/static/7480826ec53a58756cf690caa0852527/07a9c/image11.png 1440w,\n/static/7480826ec53a58756cf690caa0852527/eb645/image11.png 2500w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>audit logging을 하기 위해서는 kube-apiserver에서 enable을 해줘야 하는데 아래와 같이 yaml파일에서 관리할 수 있으며 audit log를 어디에 저장할 지, 저장 공간과 기간은 얼마로 할 지에 대한 설정을 할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB+0lEQVQoz32RuY4aQRCG52JmGY4ZzHJfw2kBjiwMXscOHJjDCTyJHVgi4ykQL0GwJNiOERmBJURijg1sWSy3HOHf6uLQ4mukTzXdXf1VVze3Wq2wXC5xioPBAMPhENvtlsb3yyWm83v6XywW/4XlcL8LW60Wms0mjderFQk/zL5ivl7jx25HhU5sNpszu93uIDxVZpHR6/XQ7/fPc/PFAp+/fceXuztMJhPMZjNiOp0SbG48HmM0Gh2EDysyTt9+vyd+7vc0fv/uLZ7nnuLm5gWe5fPI5/MoFAoUc7kcotEoarUauEajgXq9fqbdbqPb7aLT6Ry4vUX34yeUXr2EXeBgkSWIHAfuXxiGgVgshmQyiXg8jkAgAF3XL5JMsoInjxMIO1Q4NTtsNhskSaI1nufB8wJFQRDAhcNhZLNZpNNpJBIJSmaLD4VmsxlRw8C19QoOuw2CKNJmUZT+PGEwGEQmkyFhKBSCpmmwWq0wmUznJFVVEQqFwQsiXC4PnM5rwm7XIMvKpZC16Pf74fV6KTKpy+WCLMuXJ4waVISJHI5HhK47oGk6VNUCRbmCoigHYSqVojuMRCIk9Xg81LrFYqH2mdDtdpOctSlKJgiC+PdHYZvZqdjj+Hy+4yXzxzs6bGKVq9UqKpUKKpU3x1hBuVxGqVRCsVg88hq/ABVg0fW6wFxBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image12\"\n        title=\"image12\"\n        src=\"/static/48a3ac946d5d58d4ea8f40e65109112b/37523/image12.png\"\n        srcset=\"/static/48a3ac946d5d58d4ea8f40e65109112b/e9ff0/image12.png 180w,\n/static/48a3ac946d5d58d4ea8f40e65109112b/f21e7/image12.png 360w,\n/static/48a3ac946d5d58d4ea8f40e65109112b/37523/image12.png 720w,\n/static/48a3ac946d5d58d4ea8f40e65109112b/302a4/image12.png 1080w,\n/static/48a3ac946d5d58d4ea8f40e65109112b/07a9c/image12.png 1440w,\n/static/48a3ac946d5d58d4ea8f40e65109112b/5ab15/image12.png 2446w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>설정을 하고 나서 kube-apiserver에 아래와 같이 audit log와 audit rule의 yaml파일에 대해서는 아래와 같이 volumes: , volumeMounts: 설정을 <code class=\"language-text\">/etc/kubernetes/manifests/kube-apiserver.yaml</code>에 해줘야 한다.\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> \n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit\n    <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /etc/kubernetes/prod<span class=\"token punctuation\">-</span>audit.yaml\n      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> File\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit<span class=\"token punctuation\">-</span>log\n    <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /var/log/prod<span class=\"token punctuation\">-</span>secrets.log\n      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> FileOrCreate</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span> \n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/kubernetes/prod<span class=\"token punctuation\">-</span>audit.yaml\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit\n    <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /var/log/prod<span class=\"token punctuation\">-</span>secrets.log\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> audit<span class=\"token punctuation\">-</span>log\n    <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n</li>\n<li>아래 그림은 해당 rule로 설정했을 때 log파일에 어떻게 결과가 출력되는 지에 대한 예시이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxElEQVQoz4WQ2WpaURSGt8OJ5zgcJamkSiyhhCL0Ik6XgkhwCmIaetUWmpbe+TgxtoLtOWqhT9EmJL33PQTnCRSSr5wNlg4p3fCxfhZr/fx7ieVySbfb5eztO16fveHVyxc8Pz3l2ckJ5XKZSqVCoVCgWq0yHA6ZTqeMx+N/ItarFZdXV7j1B+geHw4hEPdwcHAgDWezGZPJ5Cd/Ga5WK66vr9kOhtjZDhIM+PFoGluKIlEURRrGYjFGoxHz+Vym3PCnsViv11x++4pdUfEEHhL0+3E5HThsvyeMRqNycbFYyJQW95kK64bfb27Y24vw5GmSR/uP2Y9ECIXC7O7uEg6HCQQCZLNZubBJ+GsqK7l1Dgtxe3uL9e1eryfp9/sMBgPJZmgwHDGdzfjfu7sD0Wg0aDabGIZBu93GNE06nY7UFpb+8tmk025hGKaca7Us/QnT+MiH93XqFzXqF+fUaucIp9OJ16Pidgl8bgWPaiegq2iahsul4tY0dK+K6tpC13V8Pp+sbpeNHa9gyyawC4GyuXkmk6FYLFIqlcjlcpKjoyPy+bzsW+QLRUrHx7KfTqdJpVIcHsaIx+MkEglZk0mrd8gPWn7K+FEqdRYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image13\"\n        title=\"image13\"\n        src=\"/static/92017273cffa42ed895c4740dad3e992/37523/image13.png\"\n        srcset=\"/static/92017273cffa42ed895c4740dad3e992/e9ff0/image13.png 180w,\n/static/92017273cffa42ed895c4740dad3e992/f21e7/image13.png 360w,\n/static/92017273cffa42ed895c4740dad3e992/37523/image13.png 720w,\n/static/92017273cffa42ed895c4740dad3e992/302a4/image13.png 1080w,\n/static/92017273cffa42ed895c4740dad3e992/07a9c/image13.png 1440w,\n/static/92017273cffa42ed895c4740dad3e992/36405/image13.png 2486w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","excerpt":"Falco 아무리 보안이 강한 클러스터를 구축하여도 막상 공격 받았을 때는 어떻게 대처애햐 하는가? strace, Tracee 와 같은 툴로 application에서 사용된 syscall을 분석할 수 있지만 MSA 환경에서 수백개의 pod가 수만 개의 syscall을 생상하고 있는 환경에서 이를 일일히 분석하는 것은 쉬운 일이 아니다. 대신 Faclo를 활용하면 /etc/shadow 에 접근한다거나 log파일을 편집/삭제 하는 등의 의심스러운 행동을 Falco가 모니터링 해준다. Falco Architecture  Falco Kernel module을 허용하지 않는 Provider도 있어서 Aquasec tracee처럼 eBPF를 활용하기도 한다. Syscall은 Falco module에 의해 감지되고 나서 library에서 분석되고 predefined된 Falco rule을 활용하여 policy engine에 의해 의심스러운 syscall인지 필터링된다. output/alert …","frontmatter":{"date":"November 01, 2023","title":"[CKS] 모니터링/로깅, 런타임 보안","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks7/"}},"next":{"id":"1134ca78-268e-5c4a-a31f-00bb791ab714","html":"<h2 id=\"exam-1\" style=\"position:relative;\"><a href=\"#exam-1\" aria-label=\"exam 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EXAM 1</h2>\n<h3 id=\"q1\" style=\"position:relative;\"><a href=\"#q1\" aria-label=\"q1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q1</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\nA pod has been created in the omni namespace. However, there are a couple of issues with it.\n\nThe pod has been created with more permissions than it needs.\nIt allows read access in the directory /usr/share/nginx/html/internal causing an Internal Site to be accessed publicly.\n\nTo check this, click on the button called Site (above the terminal) and add /internal/ to the end of the URL.\nUse the below recommendations to fix this.\n\nUse the AppArmor profile created at /etc/apparmor.d/frontend to restrict the internal site.\nThere are several service accounts created in the omni namespace. Apply the principle of least privilege and use the service account with the minimum privileges (excluding the default service account).\nOnce the pod is recreated with the correct service account, delete the other unused service accounts in omni namespace (excluding the default service account).\n\n\nYou can recreate the pod but do not create a new service accounts and do not use the default service account.\ncorrect service account used?\n\n- obsolete service accounts deleted?\n- internal-site restricted?\n- pod running?</code></pre></div>\n<h3 id=\"q1-answer\" style=\"position:relative;\"><a href=\"#q1-answer\" aria-label=\"q1 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q1 Answer</h3>\n<ol>\n<li>AppAromor profile 로드하기</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apparmor_parser <span class=\"token parameter variable\">-q</span> /etc/apparmor.d/frontend</code></pre></div>\n<ol start=\"2\">\n<li>profile 이름으로 정상 로드 확인하기</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aa-status <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> restricted-frontend                      </code></pre></div>\n<ol start=\"3\">\n<li>default sa를 제외하고 가장 권한이 적은 <code class=\"language-text\">frontend-default</code> sa를 frontend-site pod에서 적용하도록 설정</li>\n</ol>\n<h3 id=\"q2\" style=\"position:relative;\"><a href=\"#q2\" aria-label=\"q2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q2</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A pod has been created in the orion namespace. It uses secrets as environment variables. Extract the decoded secret for the CONNECTOR_PASSWORD and place it under /root/CKS/secrets/CONNECTOR_PASSWORD.\n\nYou are not done, instead of using secrets as an environment variable, mount the secret as a read-only volume at path /mnt/connector/password that can be then used by the application inside.</code></pre></div>\n<h3 id=\"q2-answer\" style=\"position:relative;\"><a href=\"#q2-answer\" aria-label=\"q2 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q2 Answer</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>xyz\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>xyz\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> orion\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span>\n            <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>xyz\n            <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span>\n            <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span> \n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>volume\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /mnt/connector/password\n              <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>volume\n      <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> a<span class=\"token punctuation\">-</span>safe<span class=\"token punctuation\">-</span>secret</code></pre></div>\n<h3 id=\"q3\" style=\"position:relative;\"><a href=\"#q3\" aria-label=\"q3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q3</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A number of pods have been created in the delta namespace. Using the trivy tool, which has been installed on the controlplane, identify and delete pods except the one with least number of CRITICAL level vulnerabilities.\n\nNote: Do not modify the objects in anyway other than deleting the ones that have critical vulnerabilities.</code></pre></div>\n<h3 id=\"q3-answer\" style=\"position:relative;\"><a href=\"#q3-answer\" aria-label=\"q3 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q3 Answer</h3>\n<ul>\n<li>trivy image 명령어를 이용해 실행 중인 pod 중에 가장 vulnerability가 적은 image를 실행하고 있는 pod만 남기고 모두 삭제하기</li>\n</ul>\n<h3 id=\"q4\" style=\"position:relative;\"><a href=\"#q4\" aria-label=\"q4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q4</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Create a new pod called audit-nginx in the default namespace using the nginx image. Secure the syscalls that this pod can use by using the audit.json seccomp profile in the pod's security context.\n\nThe audit.json is provided at /root/CKS directory. Make sure to move it under the profiles directory inside the default seccomp directory before creating the pod</code></pre></div>\n<h3 id=\"q4-answer\" style=\"position:relative;\"><a href=\"#q4-answer\" aria-label=\"q4 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q4 Answer</h3>\n<ul>\n<li>mv /root/CKS/audit.json /var/lib/kubelet/seccomp/profiles</li>\n<li>Seccomp 적용하여 pod replace하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  apiVersion: v1\n  kind: Pod\n  metadata:\n    labels:\n      run: nginx\n    name: audit-nginx\n  spec:\n    securityContext:\n      seccompProfile:\n        type: Localhost\n        localhostProfile: profiles/audit.json\n    containers:\n    - image: nginx\n      name: nginx</code></pre></div>\n</li>\n</ul>\n<h3 id=\"q5\" style=\"position:relative;\"><a href=\"#q5\" aria-label=\"q5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q5</h3>\n<p>The CIS Benchmark report for the Controller Manager and Scheduler is available at the tab called CIS Report 1.</p>\n<p>Report 내용:</p>\n<ul>\n<li>[FAIL] 1.1.12 Ensure that the etcd data directory ownership is set to etcd:etcd (Automated)</li>\n<li>[FAIL] 1.3.2 Ensure that the —profiling argument is set to false (Automated)</li>\n<li>[FAIL] 1.4.1 Ensure that the —profiling argument is set to false (Automated)</li>\n</ul>\n<h3 id=\"q5-answer\" style=\"position:relative;\"><a href=\"#q5-answer\" aria-label=\"q5 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q5 Answer</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">The fixes are mentioned in the same report. Update the Controller Manager and Scheduler static pod definition file as per the recommendations.\n1. Make sure that the --profiling=false parameter is set.</code></pre></div>\n<h3 id=\"q6\" style=\"position:relative;\"><a href=\"#q6\" aria-label=\"q6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q6</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">There is something suspicious happening with one of the pods running an httpd image in this cluster.\nThe Falco service shows frequent alerts that start with: File below a known binary directory opened for writing.\n\nIdentify the rule causing this alert and update it as per the below requirements:\n\nOutput should be displayed as: CRITICAL File below a known binary directory opened for writing (user_id=user_id file_updated=file_name command=command_that_was_run)\nAlerts are logged to /opt/security_incidents/alerts.log\n\nDo not update the default rules file directly. Rather use the falco_rules.local.yaml file to override.\nNote: Once the alert has been updated, you may have to wait for up to a minute for the alerts to be written to the new log location.</code></pre></div>\n<h3 id=\"q6-answer\" style=\"position:relative;\"><a href=\"#q6-answer\" aria-label=\"q6 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q6 Answer</h3>\n<ul>\n<li><code class=\"language-text\">/etc/falco/falco.yaml</code>에서 file_output을 enable 하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  file_output:\n    enabled: true\n    keep_alive: false\n    filename: /opt/security_incidents/alerts.log</code></pre></div>\n</li>\n<li><code class=\"language-text\">/etc/falco/falco_rules.local.yaml</code>에서 rule 작성하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  - rule: Write below binary dir\n    desc: an attempt to write to any file below a set of binary directories\n    condition: >\n      bin_dir and evt.dir = &lt; and open_write\n      and not package_mgmt_procs\n      and not exe_running_docker_save\n      and not python_running_get_pip\n      and not python_running_ms_oms\n      and not user_known_write_below_binary_dir_activities\n    output: >\n      File below a known binary directory opened for writing (user_id=%user.uid file_updated=%fd.name command=%proc.cmdline)\n    priority: CRITICAL\n    tags: [filesystem, mitre_persistence]</code></pre></div>\n</li>\n<li><code class=\"language-text\">kill -1 $(cat /var/run/falco.pid)</code></li>\n</ul>\n<h3 id=\"q7\" style=\"position:relative;\"><a href=\"#q7\" aria-label=\"q7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q7</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A pod called busy-rx100 has been created in the production namespace. Secure the pod by recreating it using the runtimeClass called gvisor. You may delete and recreate the pod.``</code></pre></div>\n<h3 id=\"q7-answer\" style=\"position:relative;\"><a href=\"#q7-answer\" aria-label=\"q7 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q7 Answer</h3>\n<ul>\n<li>아래 yaml파일로 gvisor runtimeClass로 pod 생성하기</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: v1\nkind: Pod\nmetadata:\n    labels:\n        run: busy-rx100\n    name: busy-rx100\n    namespace: production\nspec:\n    runtimeClassName: gvisor\n    containers:\n        -\n            image: nginx\n            name: busy-rx100</code></pre></div>\n<h3 id=\"q8\" style=\"position:relative;\"><a href=\"#q8\" aria-label=\"q8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q8</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">We need to make sure that when pods are created in this cluster, they cannot use the latest image tag, irrespective of the repository being used.\n\nTo achieve this, a simple Admission Webhook Server has been developed and deployed. A service called image-bouncer-webhook is exposed in the cluster internally. \nThis Webhook server ensures that the developers of the team cannot use the latest image tag.\nMake use of the following specs to integrate it with the cluster using an ImagePolicyWebhook:\n\nCreate a new admission configuration file at /etc/admission-controllers/admission-configuration.yaml\nThe kubeconfig file with the credentials to connect to the webhook server is located at /root/CKS/ImagePolicy/admission-kubeconfig.yaml. \n\nNote: The directory /root/CKS/ImagePolicy/ has already been mounted on the kube-apiserver at path /etc/admission-controllers so use this path to store the admission configuration.\nMake sure that if the latest tag is used, the request must be rejected at all times.\nEnable the Admission Controller.\n\nFinally, delete the existing pod in the magnum namespace that is in violation of the policy and recreate it, ensuring the same image but using the tag 1.27.\n\nNOTE: If the kube-apiserver becomes unresponsive, this can affect the validation of this exam. In such a case, please restore the kube-apiserver using the backup file created at: /root/backup/kube-apiserver.yaml, wait for the API to be available again and proceed.\n</code></pre></div>\n<h3 id=\"q8-answer\" style=\"position:relative;\"><a href=\"#q8-answer\" aria-label=\"q8 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q8 Answer</h3>\n<ul>\n<li>\n<ol>\n<li>아래와 같은 <code class=\"language-text\">admission-configuration.yaml</code> 파일을 k8s doc의 ImagePolicyWebhook plugin 예시를 참조하여 <code class=\"language-text\">/root/CKS/ImagePolicy</code> 경로에 생성한다.</li>\n</ol>\n<ul>\n<li><code class=\"language-text\">/root/CKS/ImagePolicy</code> 경로는 문제에서 kube-apiserver pod의 <code class=\"language-text\">/etc/admission-contollers</code> 경로에 마운트 된다. 따라서 kubeConfigFile의 경로 또한 <code class=\"language-text\">/root/CKS/ImagePolicy/admission-kubeconfig.yaml</code> 가 아닌 <code class=\"language-text\">/etc/admission-controllers/admission-kubeconfig.yaml</code>로 아래와 같이 설정하는 것이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apiserver.config.k8s.io/v1\nkind: AdmissionConfiguration\nplugins:\n- name: ImagePolicyWebhook\n  configuration:\n    imagePolicy:\n      kubeConfigFile: /etc/admission-controllers/admission-kubeconfig.yaml\n      allowTTL: 50\n      denyTTL: 50\n      retryBackoff: 500\n      defaultAllow: false</code></pre></div>\n<ul>\n<li>실제 kube-apiserver에서 volume mount에 대한 설정을 확인해 볼 수도 있다.</li>\n</ul>\n</li>\n<li>\n<ol start=\"2\">\n<li>kube-apiserverd에서 ImagePolicyWebhook을 enable시키고, 위에서 작성한 admission-configuration.yaml파일을 config로 사용하도록 설정한다. 여기서 유의해야 할점은 kubeConfigFile 의 경로와 마찬가지로 pod 내의 경로를 기준으로 하여 작성해야 한다는 점이다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- --admission-control-config-file=/etc/admission-controllers/admission-configuration.yaml\n- --enable-admission-plugins=NodeRestriction,ImagePolicyWebhook</code></pre></div>\n</li>\n</ul>","frontmatter":{"date":"November 01, 2023","title":"[CKS] Mockexam 1","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks-mockexam1/"}},"prev":{"id":"59c75a8b-b91f-5258-899d-586b74955d18","html":"<h2 id=\"exam-2\" style=\"position:relative;\"><a href=\"#exam-2\" aria-label=\"exam 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EXAM 2</h2>\n<h3 id=\"q1\" style=\"position:relative;\"><a href=\"#q1\" aria-label=\"q1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q1</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A pod called redis-backend has been created in the prod-x12cs namespace. \nIt has been exposed as a service of type ClusterIP. \nUsing a network policy called allow-redis-access, lock down access to this pod only to the following:\n\n1. Any pod in the same namespace with the label backend=prod-x12cs.\n2. All pods in the prod-yx13cs namespace.\n\nAll other incoming connections should be blocked.\nUse the existing labels when creating the network policy.</code></pre></div>\n<h3 id=\"q1-answer\" style=\"position:relative;\"><a href=\"#q1-answer\" aria-label=\"q1 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q1 Answer</h3>\n<ul>\n<li>namespaceSelector 에서는 metadata.namspace의 동일한 namespace에 대한 것은 설정할 필요 없고, 다른 namespace에서 접근하고자 하는 경우에만 namespaceSelector를 적용한다.</li>\n<li>namespace에 대한 selector는 label 한 쌍으로 충분하지만, podSelector에서는 pod의 모든 label에 대해서 일치하도록 규칙을 설정하여야 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-redis-access\n  namespace: prod-x12cs\nspec:\n  podSelector:\n    matchLabels:\n      run: redis-backend\n  policyTypes:\n  - Ingress\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          access: redis\n    - podSelector:\n        matchLabels:\n          backend: prod-x12cs\n    ports:\n    - protocol: TCP\n      port: 6379</code></pre></div>\n<h3 id=\"q2\" style=\"position:relative;\"><a href=\"#q2\" aria-label=\"q2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q2</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A few pods have been deployed in the apps-xyz namespace. There is a pod called redis-backend which serves as the backend for the apps app1 and app2. The pod called app3 on the other hand, does not need access to this redis-backend pod. Create a network policy called allow-app1-app2 that will only allow incoming traffic from app1 and app2 to the redis-pod.\n\nMake sure that all the available labels are used correctly to target the correct pods. Do not make any other changes to these objects.</code></pre></div>\n<h3 id=\"q2-answer\" style=\"position:relative;\"><a href=\"#q2-answer\" aria-label=\"q2 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q2 Answer</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> NetworkPolicy\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> allow<span class=\"token punctuation\">-</span>app1<span class=\"token punctuation\">-</span>app2\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> apps<span class=\"token punctuation\">-</span>xyz\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">podSelector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend\n      <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> db\n  <span class=\"token key atrule\">ingress</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">podSelector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app1\n          <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> frontend\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">podSelector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app2\n          <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> frontend</code></pre></div>\n<p>나의 답안은 아래와 같았으나 틀린 이유는 network policy에서 규칙을 정의할 때, 모든 label이 일치하도록 설정해야 하므로 위와 같이 하는 것이 옳다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> NetworkPolicy\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> allow<span class=\"token punctuation\">-</span>app1<span class=\"token punctuation\">-</span>app2\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> apps<span class=\"token punctuation\">-</span>xyz\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">podSelector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend\n      <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> db\n  <span class=\"token key atrule\">ingress</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">podSelector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> name\n          <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In\n          <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"app1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"app2\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h3 id=\"q3\" style=\"position:relative;\"><a href=\"#q3\" aria-label=\"q3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q3</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A pod has been created in the gamma namespace using a service account called cluster-view. This service account has been granted additional permissions as compared to the default service account and can view resources cluster-wide on this Kubernetes cluster. While these permissions are important for the application in this pod to work, the secret token is still mounted on this pod.\n\nSecure the pod in such a way that the secret token is no longer mounted on this pod. You may delete and recreate the pod.</code></pre></div>\n<h3 id=\"q3-answer\" style=\"position:relative;\"><a href=\"#q3-answer\" aria-label=\"q3 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q3 Answer</h3>\n<ul>\n<li>automountServiceAccountToken: false 필드를 pod에 추가\n<ul>\n<li>이 옵션을 추가해주면 serviceaccount token secret이 pod의 <code class=\"language-text\">/var/run/secrets/kubernetes.io/serviceaccount</code> 경로에 마운트 되지 않게 해준다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> apps<span class=\"token punctuation\">-</span>cluster<span class=\"token punctuation\">-</span>dash\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> apps<span class=\"token punctuation\">-</span>cluster<span class=\"token punctuation\">-</span>dash\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> gamma\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> apps<span class=\"token punctuation\">-</span>cluster<span class=\"token punctuation\">-</span>dash\n  <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> cluster<span class=\"token punctuation\">-</span>view\n  <span class=\"token key atrule\">automountServiceAccountToken</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<h3 id=\"q4\" style=\"position:relative;\"><a href=\"#q4\" aria-label=\"q4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q4</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A pod in the sahara namespace has generated alerts that a shell was opened inside the container.\nTo recognize such alerts, set the priority to ALERT and change the format of the output so that it looks like the below:\n\nALERT timestamp of the event without nanoseconds,User ID,the container id,the container image repository\nMake sure to update the rule in such a way that the changes will persists across Falco updates.\n\nYou can refer the falco documentation</code></pre></div>\n<h3 id=\"q4-answer\" style=\"position:relative;\"><a href=\"#q4-answer\" aria-label=\"q4 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q4 Answer</h3>\n<ul>\n<li>/etc/falco/falco_rules.local.yaml 에서 아래와 같이 작성한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">rule</span><span class=\"token punctuation\">:</span> Terminal shell in container\n  <span class=\"token key atrule\">desc</span><span class=\"token punctuation\">:</span> A shell was used as the entrypoint/exec point into a container with an attached terminal.\n  <span class=\"token key atrule\">condition</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span><span class=\"token scalar string\">\n    spawned_process and container\n    and shell_procs and proc.tty != 0\n    and container_entrypoint\n    and not user_expected_terminal_shell_in_container_conditions</span>\n  <span class=\"token key atrule\">output</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span><span class=\"token scalar string\">\n    %evt.time.s,%user.uid,%container.id,%container.image.repository</span>\n  <span class=\"token key atrule\">priority</span><span class=\"token punctuation\">:</span> ALERT\n  <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>container<span class=\"token punctuation\">,</span> shell<span class=\"token punctuation\">,</span> mitre_execution<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>Use the falco documentation to use the correct sysdig filters in the output.</li>\n</ul>\n<p>For example, the evt.time.s filter prints the timestamp for the event without nano seconds. This is clearly described in the falco documentation here - <a href=\"https://falco.org/docs/rules/supported-fields/#evt-field-class\">https://falco.org/docs/rules/supported-fields/#evt-field-class</a></p>\n<h3 id=\"q5\" style=\"position:relative;\"><a href=\"#q5\" aria-label=\"q5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q5</h3>\n<p>martin is a developer who needs access to work on the dev-a, dev-b and dev-z namespace. He should have the ability to carry out any operation on any pod in dev-a and dev-b namespaces. However, on the dev-z namespace, he should only have the permission to get and list the pods.</p>\n<p>The current set-up is too permissive and violates the above condition. Use the above requirement and secure martin’s access in the cluster. You may re-create objects, however, make sure to use the same name as the ones in effect currently.</p>\n<h3 id=\"q5-answer\" style=\"position:relative;\"><a href=\"#q5-answer\" aria-label=\"q5 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q5 Answer</h3>\n<ul>\n<li>role 삭제 후 아래 yaml파일로 role생성\n<ul>\n<li>k delete role dev-user-access -n dev-z</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Role\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>user<span class=\"token punctuation\">-</span>access\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>z\n<span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> pods\n    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> get\n    <span class=\"token punctuation\">-</span> list</code></pre></div>\n<h3 id=\"q6\" style=\"position:relative;\"><a href=\"#q6\" aria-label=\"q6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q6</h3>\n<p>On the controlplane node, an unknown process is bound to the port 8088. Identify the process and prevent it from running again by stopping and disabling any associated services. Finally, remove the package that was responsible for starting this process.</p>\n<h3 id=\"q6-answer\" style=\"position:relative;\"><a href=\"#q6-answer\" aria-label=\"q6 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q6 Answer</h3>\n<ul>\n<li>netstat으로 8088 포트에 해당하는 process 찾기</li>\n<li>systemctl stop lshttpd</li>\n<li>systemctl disable lshttpd</li>\n<li>동일한 이름의 패키지가 존재하는 지 확인\n<ul>\n<li>apt list —installed | grep openlitespeed</li>\n</ul>\n</li>\n<li>apt remove openlitespeed -y</li>\n</ul>\n<h3 id=\"q7\" style=\"position:relative;\"><a href=\"#q7\" aria-label=\"q7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q7</h3>\n<p>A pod has been created in the omega namespace using the pod definition file located at /root/CKS/omega-app.yaml. However, there is something wrong with it and the pod is not in a running state.</p>\n<p>We have used a custom seccomp profile located at /var/lib/kubelet/seccomp/custom-profile.json to ensure that this pod can only make use of limited syscalls to the Linux Kernel of the host operating system. However, it appears the profile does not allow the read and write syscalls. Fix this by adding it to the profile and use it to start the pod.</p>\n<h3 id=\"q7-answer\" style=\"position:relative;\"><a href=\"#q7-answer\" aria-label=\"q7 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q7 Answer</h3>\n<ul>\n<li>seccomp profile 파일의 경로를 변경\n<ul>\n<li>/var/lib/kubelet/seccomp 하위에 profiles 디렉토리 만들고 거기로 Profile 파일 이동</li>\n</ul>\n</li>\n<li>custom-profile.json에 ‘read’, ‘write’ syscall추가</li>\n<li>pod replace하기\n<ul>\n<li>kubectl replace -f /root/CKS/omega-app.yaml —force</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"q8\" style=\"position:relative;\"><a href=\"#q8\" aria-label=\"q8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q8</h3>\n<p>A pod definition file has been created at /root/CKS/simple-pod.yaml . Using the kubesec tool, generate a report for this pod definition file and fix the major issues so that the subsequent scan report no longer fails.</p>\n<p>Once done, generate the report again and save it to the file /root/CKS/kubesec-report.txt</p>\n<h3 id=\"q8-answer\" style=\"position:relative;\"><a href=\"#q8-answer\" aria-label=\"q8 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q8 Answer</h3>\n<ul>\n<li>SYS_ADMIN capability를 빼고 아래 결과 저장\n<ul>\n<li>kubesec scan /root/CKS/simple-pod.yaml > /root/CKS/kubesec-report.txt</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"q9\" style=\"position:relative;\"><a href=\"#q9\" aria-label=\"q9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q9</h3>\n<p>Create a new pod called secure-nginx-pod in the seth namespace. Use one of the images from the below which has a least number of CRITICAL vulnerabilities.</p>\n<p>nginx\nnginx:1.19\nnginx:1.17\nnginx:1.20\ngcr.io/google-containers/nginx\nbitnami/jenkins:latest</p>\n<h3 id=\"q9-answer\" style=\"position:relative;\"><a href=\"#q9-answer\" aria-label=\"q9 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q9 Answer</h3>\n<ul>\n<li>trivy image —severity CRITICAL {image명} 으로 검사해서 가장 취약점이 적은 gcr.io/google-containers/nginx 이미지로 pod 생성하기\n<ul>\n<li>kubectl -n seth run secure-nginx-pod —image gcr.io/google-containers/nginx</li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"November 11, 2023","title":"[CKS] Mockexam 2","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks-mockexam2/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/cks7/","nextSlug":"/cks-mockexam1/","prevSlug":"/cks-mockexam2/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}