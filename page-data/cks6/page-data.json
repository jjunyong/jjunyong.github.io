{"componentChunkName":"component---src-templates-blog-template-js","path":"/cks6/","result":{"data":{"cur":{"id":"ef53088b-f9cf-5722-8183-1a6391e2a5e5","html":"<h3 id=\"base-image-footpring-최소화하기\" style=\"position:relative;\"><a href=\"#base-image-footpring-%EC%B5%9C%EC%86%8C%ED%99%94%ED%95%98%EA%B8%B0\" aria-label=\"base image footpring 최소화하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Base image footpring 최소화하기</h3>\n<ul>\n<li>base image란 무엇인가? dockerfile의 <code class=\"language-text\">FROM</code> 절에서 명시하는 이미지는 parent 이미지이다. 가령 아래 예시에서 보는 것처럼 httpd 이미지는 debian이라는 이미지를 parent로 가진다. 그리고 debian 이미지는 <code class=\"language-text\">FROM scratch</code> 로 부터 생성되는데, 이렇게 scratch로 부터 생성되는 이미지를 base 이미지라고 하는데, parent 이미지라는 의미로 혼용되기도 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACj0lEQVQoz4WSW0tUURiG929S8ELEs3kospk9mjqKlEnEiJOmUkGQZXdKmWWamlrjMJVTeddNgdWdN4lTIHTQ0dTZe88+zklNn5hFBnXTgoe1btbD+718km7ofFh8z+TYOLNT00xPTDEz+Ui8J8YfMjc3R2QlwvLyMtFoFF3X0TTtL1T16FaRVC3O7N1hPCUFNNU1IJ+o5fixKipLyikvKqWwsJCKigry8/MJhUJkMhnxOR6PC45EiqKgKgqSYzm8fvmSm9euMHBrgBv9/fRf7+fq5Sv09fX9obOzkzdv3pJOp0VKwzCI63FUTWV7Z5u16Jq4JV3V+PrlGx9XVljJEokQ+fSJRDLBvyebzjJNLMvCMEy2YhsomsJ2TOVbdJ0dRUVKJVK8ehyks+0MvRcv0eXzC0ZvjzAxOsbQ0BDDd4YZHBxkaWlJSG3bFik3N38Qj+2gb66jf19D21hD0uI60/fvUVtWive0l0ZPPfWnZFzZLqtqqK6uFuTk5BAKPeXw8FAkdGwLJ/MT5/M7koHzJOZ7STztQko6KaZGhnFXFuBtasDb3Iy32UtjUxMutwu3201NTQ15eXnMP58Xo2cTOo6DbTtYpo6pbmMoW+ixH0i76QxPZmZpbqyn7ewZ2trO0d7eTmtrKy0tLfj9fnp6evD5OlhcXBTCRCIhEFLHwbIdDMtGN0ykdDLNi+AzfOcvcMnfzcUOPz6fT9Dd1U0gECAcDhMMBlldXeXg4IBUKiU4kmYrME1T9Crt7u7xeHSMkyWFNMh1nKw6TmX5McrKygTFxcWC3NxcwvNhkTAry65PMpn8PbothNlVkvb295l8+IDK0iI8njpktxvZLYvuZFnG4/HgcrnEgi8sLPxX+AvWCKLPlKLDXwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/b5a20678429702cc3b1acaaf391979d6/37523/image1.png\"\n        srcset=\"/static/b5a20678429702cc3b1acaaf391979d6/e9ff0/image1.png 180w,\n/static/b5a20678429702cc3b1acaaf391979d6/f21e7/image1.png 360w,\n/static/b5a20678429702cc3b1acaaf391979d6/37523/image1.png 720w,\n/static/b5a20678429702cc3b1acaaf391979d6/302a4/image1.png 1080w,\n/static/b5a20678429702cc3b1acaaf391979d6/07a9c/image1.png 1440w,\n/static/b5a20678429702cc3b1acaaf391979d6/ad1ae/image1.png 2270w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Modularize : 각각의 이미지는 여러 기능을 하지않고 1개의 주요 역할만 하도록 모듈화되어야 한다.</li>\n<li>Persist state : 데이터/state을 컨테이너내에 보관하지 않는다.</li>\n<li>‘Official image’ 사용하기</li>\n<li>이미지를 최소화하기\n<ul>\n<li>yum, wget, curl 과 같이 공격자가 활용할 수 있는 명령어들을 image에 포함시키지 않아야 한다.</li>\n<li>production 이미지와 dev/stg 이미지는 분리되어야 한다.</li>\n<li>결국, 이미지에는 application + runtime dependency만 존재해야 한다.</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"vulnerability-scanning\" style=\"position:relative;\"><a href=\"#vulnerability-scanning\" aria-label=\"vulnerability scanning permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability scanning</h4>\n<ul>\n<li>trivy 툴을 활용해서 이미지의 vulnerability를 측정할 수 있다.</li>\n<li>alpine과 같이 image 내에 패키지가 적은 것은 vulnerability가 매우 적게 측정된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">trivy image httpd # 124개 취약점 존재\ntrivy image httpd:alpine # 0개 취약점 존재 </code></pre></div>\n<h3 id=\"image-보안\" style=\"position:relative;\"><a href=\"#image-%EB%B3%B4%EC%95%88\" aria-label=\"image 보안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>image 보안</h3>\n<ul>\n<li>image 이름 규칙</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNElEQVQoz11Sy46DMAzk//9rD9tbhUor9SFUIATEq4QklKqa1ZimXfUwjGM7Yxsn6mqFTmfoawUzDmjaFnVdQ+sKbdtiGAZ0XSe+sixRVZUwkec5lFLim6YJ4zgiqtM9ivgHZfKLsatRKIU0TXG5XJBlGZqmeQtprd9CtMlFkaPUWgSNMYgm52HnBdbPcM4LxPYzLG05+4/tPO73O+Z5jRvrYKz9CBozgrB2gnNOYK0V4ck5uei9F2aRz9nDs/DrbF+iET+rwCrGIPlwOCDZ7WTEx+Mh1ZMkQXa9YlkWyTkej9hsNpITREXwvxjHIegn6Hs+n7IgFjmfzyLIZW23W8RxjNPp9L4fhe7CWNwUuwlbI263m1QPYwV/yGW87/u1w+/uWJkJZHbFJ/MNxhnj5skB/Id/D+JgDTgWT7AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/0dde4d9803111fc4bdc455ea132c9b96/37523/image2.png\"\n        srcset=\"/static/0dde4d9803111fc4bdc455ea132c9b96/e9ff0/image2.png 180w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/f21e7/image2.png 360w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/37523/image2.png 720w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/302a4/image2.png 1080w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/07a9c/image2.png 1440w,\n/static/0dde4d9803111fc4bdc455ea132c9b96/ddc6c/image2.png 1534w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>private registry\n<ul>\n<li>‘docker-registry’ 타입의 secret으로 private registry에 대한 credential 정보를 보관.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4klEQVQoz32R22oaURSG50XsxVjq1NFmMqlECmmrQ0Kv+wzpjVc+gga8EWdGSLRaj6WOh9ImUC+KpxtlWkHqe6QXOup4Pvxl7xygoXTBx1p7bfbiX/9mvny/ROwihmQyiUQiQUmn04hGo+h0OiCx2WxgmiZSifc4jyqIXZxD13+g3/+FXq/3F8zPfhe1Wg31eh3NZpPSarXQaDTQbrfR7XYpuq7jzZELov0xbDYbheO425q77zHfalWkPqSQyWSQzWaRy+XuyefztEfuCpqGt8dHeHXgwIEowul8BrvdDp7nab6DWcwWWK/XdC3CdrvFbrfDw5iYJqTXLyG5HHhx6IKwvw9BELC3J0AQbmoCMxgMQBgOhzCGBkajEcbjMWUymVDm8zmur3/j8LkIN/cIIs/B+fQJWNYKlmVhtVop5MwsFjcK71T+Sx2J1WqFq6tLVMolVCqfUS6XUSqVUCwWoWkaCoUChfn49RNCoRBkWYYciUCOyJBlBaqiQlVVKIqCYDBIP+l/QYQQu5jTd6fgeQdOjk/g8XggSRIkrwSv1wuPxwu32w2LxYJwOEwfTqdTasFsNqM1sYTYYxgGhYnH4/D7/QgGzxAIBChntzVRTrLP50O1WqUDl8slXZ9kYtfDwX8AtbsMfVNpFC8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/b71e38be4e50ee55a8731dc5d2b0a732/37523/image3.png\"\n        srcset=\"/static/b71e38be4e50ee55a8731dc5d2b0a732/e9ff0/image3.png 180w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/f21e7/image3.png 360w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/37523/image3.png 720w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/302a4/image3.png 1080w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/07a9c/image3.png 1440w,\n/static/b71e38be4e50ee55a8731dc5d2b0a732/fc477/image3.png 2426w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"registry에-대한-whitelist-등록하기\" style=\"position:relative;\"><a href=\"#registry%EC%97%90-%EB%8C%80%ED%95%9C-whitelist-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0\" aria-label=\"registry에 대한 whitelist 등록하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Registry에 대한 whitelist 등록하기</h4>\n<ul>\n<li>앞서 보았듯, ValidatingAdmissionWebhook을 webhook 서버 또는 OPA와 연동하여 registry 이름에 대한 검증을 할 수 있었다.</li>\n<li>여기서는 ImagePolicyWebhook을 사용하는 방법을 추가로 알아본다.</li>\n<li><code class=\"language-text\">/etc/kuberenetes/admission-config.yaml</code> 경로에 아래와 같이 AdmissionConfiguration 파일을 생성하여 ImagePolicyWebhook plugin을 명시하고, kubeconfig 에 대한 경로를 작성해줘야 한다. 그리고 kubeconfig 파일에서는 registry를 검증해주는 api 서버에 대한 정보와 인증서 정보를 포함한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVQY0yXQS47aQBSFYS+Lhx9FvcvgssF00y1QsoBAoigSCbQSKcNmB20YM2CTfwsz+CZHutI5N/mx+8bP71t2ux3b7ZbT6cTlcqH7+ODcdQ/nM13X8f/fX477Xxz//Ob49sbhcGC/3/P+fuJ2u3G9XklcMaRWI4zRCCEQoiDPM8REkKYpWZ4xHA4ZDAa0fkI0GdYanA/48KC1ZjweMxqPSCaTCa0vWARJXVoWU0sz88S6ppk31E1DFSu0MbQx8FQKmjilmpX4siSUoS9SFEUvcUrgtUArhbEOYy3OO4wxPW00VhucNpQ+8GQLvpYFqyAJSva5N7YXrCMJMqUyeX9stcRoiVKKvLhPz3tZmiJzgTUOLzKeXco8aII1KCnRUj0KKU1SzWZsFtPeyyKyXrW8vr6w3mx4Xq1YLpeP6XVNbBrq0vClsawbTzuPVDH2/78vu5f6BEiI6pt1OEagAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/0253b7967bc1799559a35eb29c47054a/37523/image4.png\"\n        srcset=\"/static/0253b7967bc1799559a35eb29c47054a/e9ff0/image4.png 180w,\n/static/0253b7967bc1799559a35eb29c47054a/f21e7/image4.png 360w,\n/static/0253b7967bc1799559a35eb29c47054a/37523/image4.png 720w,\n/static/0253b7967bc1799559a35eb29c47054a/302a4/image4.png 1080w,\n/static/0253b7967bc1799559a35eb29c47054a/07a9c/image4.png 1440w,\n/static/0253b7967bc1799559a35eb29c47054a/20a65/image4.png 2490w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>그리고 kube-apiserver에서 아래와 같이 설정해줘야 한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVQoz22PzYsSARTABxETylaQKWnze3RmnNFx/G6LdqFD9Y9IoOKyFy8Kay4k2y2ctbsfYKx1aLuLXjy2t+0Piehj+8UMbRT04Pfeu7zfe0/odDp0u13a7TaWZbHZbFiv16xWK6cul0s+np/z4eyM+rMaB/v7NJpNmr9pNBrU63VqtRqtVgshlUohyzKqqpJMJgmHI4iiiMfjcRAEATNf4PXwFff1KEVDR1VkFFnGnr2at1EUBcFOtsyuwWAQj+eaI/kbXc9gDYfsGhKPdvLs3itTrVTQMxk0TfsHQUkrZI0syVSSO9vb+Hw+vF4vLpfLwRYahsGJZVHVJfbKWTRdJ61pqGmVdDqNZnMllMISSlwhfjdG6HYIMSASCAScd91utyPMm3mGQ4tUQuJh9QHV0g7lQoWiWaKQKzqX2mIb4WbBjy+3xXXjBoGCiBi6hX/L/0dmI0kSI+uEiBYj+6SA+biI+bSEYfd7RUrFCjnTxDByCL1Zn97kuUN/ekR/dMTgxYDj45cMBgMOD3tMJhMsa0Qw5CdZihI240TMGOF8lFhWQpFVUrJMIiEh/Pj8ncsvl/AV+Ab85L9xcfGJ09mU96dvWbx5x2K+YD6dM5vMmE6nztLxeMwvwTk3QlhCsN4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/daa78a4d67226b238d52a14e145d2bca/37523/image5.png\"\n        srcset=\"/static/daa78a4d67226b238d52a14e145d2bca/e9ff0/image5.png 180w,\n/static/daa78a4d67226b238d52a14e145d2bca/f21e7/image5.png 360w,\n/static/daa78a4d67226b238d52a14e145d2bca/37523/image5.png 720w,\n/static/daa78a4d67226b238d52a14e145d2bca/302a4/image5.png 1080w,\n/static/daa78a4d67226b238d52a14e145d2bca/07a9c/image5.png 1440w,\n/static/daa78a4d67226b238d52a14e145d2bca/92a6b/image5.png 2334w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li><code class=\"language-text\">k describe po &lt;pod-name> | grep --registry-whitelist</code> 명령을 하면</li>\n</ul>\n<h3 id=\"kubesec을-활용한-resource-definition-정적-분석\" style=\"position:relative;\"><a href=\"#kubesec%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-resource-definition-%EC%A0%95%EC%A0%81-%EB%B6%84%EC%84%9D\" aria-label=\"kubesec을 활용한 resource definition 정적 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubesec을 활용한 resource-definition 정적 분석</h3>\n<ul>\n<li><code class=\"language-text\">kubesec scan pod.yaml</code> 과 같이 하여 report를 받아볼 수 있다.</li>\n<li>문제\n<ul>\n<li><code class=\"language-text\">/root/node.yaml</code>를 스캔하고 그 결과를 <code class=\"language-text\">/root/kubesec_report.json</code> 에 저장하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  kubesec scan /root/node.yaml > /root/kubesec_report.json</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"image-scan\" style=\"position:relative;\"><a href=\"#image-scan\" aria-label=\"image scan permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image scan</h3>\n<ul>\n<li>CVE ( Common vulnerability and exposures ) : 알려져있는 보안 취약점들을 CVE에서 등록하고 관리한다.\n<ul>\n<li>CVE serverity scores\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACVElEQVQoz3WRPWjUcBjGM+rk2MlNRxdBBydBkS4VcVGhIArqUHGwuAgKImgdBBEEBxEUpRRErNVSlCJFtO31Wkux9uPS9preJZdcvj8uubvc/eQfabkOvvDkn+R98jzv80aaXv3N96U8U8t5ZlZmmFudYaGQY7GQY0WeRpan2FibRFn/gSL/RFmdQlnKoSzm2VyYpfhrjuLsPBu5Bdbyf5DOD/Vx8tVRLr49Qv/gIQaGDvLy3X5G3ncx+WEf8sge/FGJ9JNEOriX9HkX6aMDNG8fptF3nKS3h9rpXuJjV9novo90b+wx/cNXefD5Gs9GL/FmrJePX84x8fUs8+M9rH/rpjpxAnv8FNbwGazBC5gvLmM+vY7x8Bb6nbtoNweoXHnC8o3XSKpawdAtDMOmWnVQNRPLCdGrbnZWrQBVd6g6EeWKjelG6LaH4fiUDQvNtFEqOppts761hWTbNq7j4PseURSSxDFhEOy88zyXehJnaNQTAt/D9zw818nOJK4RhQGe6+LYNpLjOAhEUUSbNo1GHdOssrlZZLNYRJYLhGFAq9UiSWIqmkqpVEIuFDJOkiS00hRXCDoOkrgRqNVqiDIMHcuyiOMYXdcxTZNyuUQYhiiKgu/72WSGYWR9raKRpime52U6uwTFFNslnDtLrENwms0mQRDs6onvhJEQlcRFQAjU6/UsRi2KsqlEhO0SHE1TiWs1VFX9Z9hu0263/y+Ypk0sy9yJ0DmJWLqqljNTYdaZQAgK7o6gUO+MLFw7yeJZRBU/TpgJbqPZyHoC22sQOn8BXsIXcyvPAmcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/fdb70620644711278fedc05d76554eae/37523/image6.png\"\n        srcset=\"/static/fdb70620644711278fedc05d76554eae/e9ff0/image6.png 180w,\n/static/fdb70620644711278fedc05d76554eae/f21e7/image6.png 360w,\n/static/fdb70620644711278fedc05d76554eae/37523/image6.png 720w,\n/static/fdb70620644711278fedc05d76554eae/302a4/image6.png 1080w,\n/static/fdb70620644711278fedc05d76554eae/07a9c/image6.png 1440w,\n/static/fdb70620644711278fedc05d76554eae/09262/image6.png 1896w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>CVE Scanner : Trivy</li>\n</ul>\n</li>\n<li>Trivy\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">trivy image nginx:1.18.0\ntrivy image --serverity CRITICAL,HIGH nginx:1.18.0 # CRITICAL, HIGH 구분의 CVE만 조회 \ntrivy image --ignore-unfixed nginx:1.18.0 # s/w package upgrade 로 해결할 수 있는 CVE만 조회</code></pre></div>\n<ul>\n<li>Docker save 명령으로 저장된 .tar 파일도 검증할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">trivy image --input archive.tar</code></pre></div>\n<ul>\n<li>문제\n<ul>\n<li><code class=\"language-text\">python:3.10.0a4-alpine</code> image를 pull받은 후에 trivy로 해당 이미지를 스캔하고 그 결과를 <code class=\"language-text\">/root/python_alpine.txt</code> 에 저장하라\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  crictl pull python:3.10.0a4-alpine\n  trivy image --output /root/python_alpine.txt python:3.10.0a4-alpine</code></pre></div>\n</li>\n<li><code class=\"language-text\">python:3.6.12-alpine3.11</code> image를 스캔하고 HIGH vulnerability에 대한 결과만 <code class=\"language-text\">/root/python.txt</code>에 저장하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  trivy image --severity HIGH --output /root/python.txt </code></pre></div>\n</li>\n<li>trivy image —input /root/alpine.tar —format json —output /root/alpine.json</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"best-practice\" style=\"position:relative;\"><a href=\"#best-practice\" aria-label=\"best practice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Best practice</h4>\n<ul>\n<li>추가적인 vulnerability가 report될 수 있으므로 지속적으로 image를 스캔하기</li>\n<li>admission controller를 활용하여 deploy될 때 scan단계를 추가하기</li>\n<li>하지만 deploy 속도에 영향이 있을 수 있으므로 별도의 image repository를 활용하여 pre-scanned image만 사용하도록 하기</li>\n<li>CI/CD 단계에서 image scan 단계 추가하기</li>\n</ul>","excerpt":"Base image footpring 최소화하기 base image란 무엇인가? dockerfile의  절에서 명시하는 이미지는 parent 이미지이다. 가령 아래 예시에서 보는 것처럼 httpd 이미지는 debian이라는 이미지를 parent로 가진다. 그리고 debian 이미지는  로 부터 생성되는데, 이렇게 scratch로 부터 생성되는 이미지를 base 이미지라고 하는데, parent 이미지라는 의미로 혼용되기도 한다.  Modularize : 각각의 이미지는 여러 기능을 하지않고 1개의 주요 역할만 하도록 모듈화되어야 한다. Persist state : 데이터/state을 컨테이너내에 보관하지 않는다. ‘Official image’ 사용하기 이미지를 최소화하기 yum, wget, curl 과 같이 공격자가 활용할 수 있는 명령어들을 image에 포함시키지 않아야 한다. production 이미지와 dev/stg 이미지는 분리되어야 한다. 결국, 이미지에는 applicati…","frontmatter":{"date":"October 31, 2023","title":"[CKS] Supply chain 보안","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks6/"}},"next":{"id":"a7c839c3-ea66-5eaf-982b-81c4c148d570","html":"<h2 id=\"powercenter-개요\" style=\"position:relative;\"><a href=\"#powercenter-%EA%B0%9C%EC%9A%94\" aria-label=\"powercenter 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PowerCenter 개요</h2>","frontmatter":{"date":"October 19, 2023","title":"Informatica 1","categories":"Data","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/etl1/"}},"prev":{"id":"1134ca78-268e-5c4a-a31f-00bb791ab714","html":"<h2 id=\"exam-1\" style=\"position:relative;\"><a href=\"#exam-1\" aria-label=\"exam 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EXAM 1</h2>\n<h3 id=\"q1\" style=\"position:relative;\"><a href=\"#q1\" aria-label=\"q1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q1</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\nA pod has been created in the omni namespace. However, there are a couple of issues with it.\n\nThe pod has been created with more permissions than it needs.\nIt allows read access in the directory /usr/share/nginx/html/internal causing an Internal Site to be accessed publicly.\n\nTo check this, click on the button called Site (above the terminal) and add /internal/ to the end of the URL.\nUse the below recommendations to fix this.\n\nUse the AppArmor profile created at /etc/apparmor.d/frontend to restrict the internal site.\nThere are several service accounts created in the omni namespace. Apply the principle of least privilege and use the service account with the minimum privileges (excluding the default service account).\nOnce the pod is recreated with the correct service account, delete the other unused service accounts in omni namespace (excluding the default service account).\n\n\nYou can recreate the pod but do not create a new service accounts and do not use the default service account.\ncorrect service account used?\n\n- obsolete service accounts deleted?\n- internal-site restricted?\n- pod running?</code></pre></div>\n<h3 id=\"q1-answer\" style=\"position:relative;\"><a href=\"#q1-answer\" aria-label=\"q1 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q1 Answer</h3>\n<ol>\n<li>AppAromor profile 로드하기</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apparmor_parser <span class=\"token parameter variable\">-q</span> /etc/apparmor.d/frontend</code></pre></div>\n<ol start=\"2\">\n<li>profile 이름으로 정상 로드 확인하기</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aa-status <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> restricted-frontend                      </code></pre></div>\n<ol start=\"3\">\n<li>default sa를 제외하고 가장 권한이 적은 <code class=\"language-text\">frontend-default</code> sa를 frontend-site pod에서 적용하도록 설정</li>\n</ol>\n<h3 id=\"q2\" style=\"position:relative;\"><a href=\"#q2\" aria-label=\"q2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q2</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A pod has been created in the orion namespace. It uses secrets as environment variables. Extract the decoded secret for the CONNECTOR_PASSWORD and place it under /root/CKS/secrets/CONNECTOR_PASSWORD.\n\nYou are not done, instead of using secrets as an environment variable, mount the secret as a read-only volume at path /mnt/connector/password that can be then used by the application inside.</code></pre></div>\n<h3 id=\"q2-answer\" style=\"position:relative;\"><a href=\"#q2-answer\" aria-label=\"q2 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q2 Answer</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>xyz\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>xyz\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> orion\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span>\n            <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>xyz\n            <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span>\n            <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span> \n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>volume\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /mnt/connector/password\n              <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>volume\n      <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> a<span class=\"token punctuation\">-</span>safe<span class=\"token punctuation\">-</span>secret</code></pre></div>\n<h3 id=\"q3\" style=\"position:relative;\"><a href=\"#q3\" aria-label=\"q3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q3</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A number of pods have been created in the delta namespace. Using the trivy tool, which has been installed on the controlplane, identify and delete pods except the one with least number of CRITICAL level vulnerabilities.\n\nNote: Do not modify the objects in anyway other than deleting the ones that have critical vulnerabilities.</code></pre></div>\n<h3 id=\"q3-answer\" style=\"position:relative;\"><a href=\"#q3-answer\" aria-label=\"q3 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q3 Answer</h3>\n<ul>\n<li>trivy image 명령어를 이용해 실행 중인 pod 중에 가장 vulnerability가 적은 image를 실행하고 있는 pod만 남기고 모두 삭제하기</li>\n</ul>\n<h3 id=\"q4\" style=\"position:relative;\"><a href=\"#q4\" aria-label=\"q4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q4</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Create a new pod called audit-nginx in the default namespace using the nginx image. Secure the syscalls that this pod can use by using the audit.json seccomp profile in the pod's security context.\n\nThe audit.json is provided at /root/CKS directory. Make sure to move it under the profiles directory inside the default seccomp directory before creating the pod</code></pre></div>\n<h3 id=\"q4-answer\" style=\"position:relative;\"><a href=\"#q4-answer\" aria-label=\"q4 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q4 Answer</h3>\n<ul>\n<li>mv /root/CKS/audit.json /var/lib/kubelet/seccomp/profiles</li>\n<li>Seccomp 적용하여 pod replace하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  apiVersion: v1\n  kind: Pod\n  metadata:\n    labels:\n      run: nginx\n    name: audit-nginx\n  spec:\n    securityContext:\n      seccompProfile:\n        type: Localhost\n        localhostProfile: profiles/audit.json\n    containers:\n    - image: nginx\n      name: nginx</code></pre></div>\n</li>\n</ul>\n<h3 id=\"q5\" style=\"position:relative;\"><a href=\"#q5\" aria-label=\"q5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q5</h3>\n<p>The CIS Benchmark report for the Controller Manager and Scheduler is available at the tab called CIS Report 1.</p>\n<p>Report 내용:</p>\n<ul>\n<li>[FAIL] 1.1.12 Ensure that the etcd data directory ownership is set to etcd:etcd (Automated)</li>\n<li>[FAIL] 1.3.2 Ensure that the —profiling argument is set to false (Automated)</li>\n<li>[FAIL] 1.4.1 Ensure that the —profiling argument is set to false (Automated)</li>\n</ul>\n<h3 id=\"q5-answer\" style=\"position:relative;\"><a href=\"#q5-answer\" aria-label=\"q5 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q5 Answer</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">The fixes are mentioned in the same report. Update the Controller Manager and Scheduler static pod definition file as per the recommendations.\n1. Make sure that the --profiling=false parameter is set.</code></pre></div>\n<h3 id=\"q6\" style=\"position:relative;\"><a href=\"#q6\" aria-label=\"q6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q6</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">There is something suspicious happening with one of the pods running an httpd image in this cluster.\nThe Falco service shows frequent alerts that start with: File below a known binary directory opened for writing.\n\nIdentify the rule causing this alert and update it as per the below requirements:\n\nOutput should be displayed as: CRITICAL File below a known binary directory opened for writing (user_id=user_id file_updated=file_name command=command_that_was_run)\nAlerts are logged to /opt/security_incidents/alerts.log\n\nDo not update the default rules file directly. Rather use the falco_rules.local.yaml file to override.\nNote: Once the alert has been updated, you may have to wait for up to a minute for the alerts to be written to the new log location.</code></pre></div>\n<h3 id=\"q6-answer\" style=\"position:relative;\"><a href=\"#q6-answer\" aria-label=\"q6 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q6 Answer</h3>\n<ul>\n<li><code class=\"language-text\">/etc/falco/falco.yaml</code>에서 file_output을 enable 하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  file_output:\n    enabled: true\n    keep_alive: false\n    filename: /opt/security_incidents/alerts.log</code></pre></div>\n</li>\n<li><code class=\"language-text\">/etc/falco/falco_rules.local.yaml</code>에서 rule 작성하기\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  - rule: Write below binary dir\n    desc: an attempt to write to any file below a set of binary directories\n    condition: >\n      bin_dir and evt.dir = &lt; and open_write\n      and not package_mgmt_procs\n      and not exe_running_docker_save\n      and not python_running_get_pip\n      and not python_running_ms_oms\n      and not user_known_write_below_binary_dir_activities\n    output: >\n      File below a known binary directory opened for writing (user_id=%user.uid file_updated=%fd.name command=%proc.cmdline)\n    priority: CRITICAL\n    tags: [filesystem, mitre_persistence]</code></pre></div>\n</li>\n<li><code class=\"language-text\">kill -1 $(cat /var/run/falco.pid)</code></li>\n</ul>\n<h3 id=\"q7\" style=\"position:relative;\"><a href=\"#q7\" aria-label=\"q7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q7</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A pod called busy-rx100 has been created in the production namespace. Secure the pod by recreating it using the runtimeClass called gvisor. You may delete and recreate the pod.``</code></pre></div>\n<h3 id=\"q7-answer\" style=\"position:relative;\"><a href=\"#q7-answer\" aria-label=\"q7 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q7 Answer</h3>\n<ul>\n<li>아래 yaml파일로 gvisor runtimeClass로 pod 생성하기</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: v1\nkind: Pod\nmetadata:\n    labels:\n        run: busy-rx100\n    name: busy-rx100\n    namespace: production\nspec:\n    runtimeClassName: gvisor\n    containers:\n        -\n            image: nginx\n            name: busy-rx100</code></pre></div>\n<h3 id=\"q8\" style=\"position:relative;\"><a href=\"#q8\" aria-label=\"q8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q8</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">We need to make sure that when pods are created in this cluster, they cannot use the latest image tag, irrespective of the repository being used.\n\nTo achieve this, a simple Admission Webhook Server has been developed and deployed. A service called image-bouncer-webhook is exposed in the cluster internally. \nThis Webhook server ensures that the developers of the team cannot use the latest image tag.\nMake use of the following specs to integrate it with the cluster using an ImagePolicyWebhook:\n\nCreate a new admission configuration file at /etc/admission-controllers/admission-configuration.yaml\nThe kubeconfig file with the credentials to connect to the webhook server is located at /root/CKS/ImagePolicy/admission-kubeconfig.yaml. \n\nNote: The directory /root/CKS/ImagePolicy/ has already been mounted on the kube-apiserver at path /etc/admission-controllers so use this path to store the admission configuration.\nMake sure that if the latest tag is used, the request must be rejected at all times.\nEnable the Admission Controller.\n\nFinally, delete the existing pod in the magnum namespace that is in violation of the policy and recreate it, ensuring the same image but using the tag 1.27.\n\nNOTE: If the kube-apiserver becomes unresponsive, this can affect the validation of this exam. In such a case, please restore the kube-apiserver using the backup file created at: /root/backup/kube-apiserver.yaml, wait for the API to be available again and proceed.\n</code></pre></div>\n<h3 id=\"q8-answer\" style=\"position:relative;\"><a href=\"#q8-answer\" aria-label=\"q8 answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q8 Answer</h3>\n<ul>\n<li>\n<ol>\n<li>아래와 같은 <code class=\"language-text\">admission-configuration.yaml</code> 파일을 k8s doc의 ImagePolicyWebhook plugin 예시를 참조하여 <code class=\"language-text\">/root/CKS/ImagePolicy</code> 경로에 생성한다.</li>\n</ol>\n<ul>\n<li><code class=\"language-text\">/root/CKS/ImagePolicy</code> 경로는 문제에서 kube-apiserver pod의 <code class=\"language-text\">/etc/admission-contollers</code> 경로에 마운트 된다. 따라서 kubeConfigFile의 경로 또한 <code class=\"language-text\">/root/CKS/ImagePolicy/admission-kubeconfig.yaml</code> 가 아닌 <code class=\"language-text\">/etc/admission-controllers/admission-kubeconfig.yaml</code>로 아래와 같이 설정하는 것이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apiserver.config.k8s.io/v1\nkind: AdmissionConfiguration\nplugins:\n- name: ImagePolicyWebhook\n  configuration:\n    imagePolicy:\n      kubeConfigFile: /etc/admission-controllers/admission-kubeconfig.yaml\n      allowTTL: 50\n      denyTTL: 50\n      retryBackoff: 500\n      defaultAllow: false</code></pre></div>\n<ul>\n<li>실제 kube-apiserver에서 volume mount에 대한 설정을 확인해 볼 수도 있다.</li>\n</ul>\n</li>\n<li>\n<ol start=\"2\">\n<li>kube-apiserverd에서 ImagePolicyWebhook을 enable시키고, 위에서 작성한 admission-configuration.yaml파일을 config로 사용하도록 설정한다. 여기서 유의해야 할점은 kubeConfigFile 의 경로와 마찬가지로 pod 내의 경로를 기준으로 하여 작성해야 한다는 점이다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- --admission-control-config-file=/etc/admission-controllers/admission-configuration.yaml\n- --enable-admission-plugins=NodeRestriction,ImagePolicyWebhook</code></pre></div>\n</li>\n</ul>","frontmatter":{"date":"November 01, 2023","title":"[CKS] Mockexam 1","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks-mockexam1/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/cks6/","nextSlug":"/etl1/","prevSlug":"/cks-mockexam1/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}