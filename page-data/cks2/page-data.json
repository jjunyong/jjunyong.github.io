{"componentChunkName":"component---src-templates-blog-template-js","path":"/cks2/","result":{"data":{"cur":{"id":"4fa327e2-34c6-5b05-9c04-378e99ff5edf","html":"<h3 id=\"kubeconfig\" style=\"position:relative;\"><a href=\"#kubeconfig\" aria-label=\"kubeconfig permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KubeConfig</h3>\n<p>~/.kube/config 에 config 파일로서 certification 에 대한 경로 등을 저장하는 것을 통해 kubectl 시 별도의 인증서 명시 또는 apiserver에 대한 주소 명시 등을 할 필요가 없게 된다. KubeConfig 파일은 세 부분으로 구성된다.</p>\n<ul>\n<li>Cluster</li>\n<li>Contexts : Context는 어떤 유저가 어떤 Cluster를 사용할 것인지에 대해 정의한다.</li>\n<li>Users</li>\n</ul>\n<h3 id=\"api-groups\" style=\"position:relative;\"><a href=\"#api-groups\" aria-label=\"api groups permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>API Groups</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACLElEQVQoz12RS08TURiG5+/qQuPKJcYlEmNi8LIigUTZEUi4tZQWsSiXcinSlqql0+tMW+Z+PTPTRzsVMS6e75yTL++TNzmSqRuYms7dafxzt2wLvdJBXivRzZSxVA3TNKf7/3J3SJpno0cummuhC3eK72AIFxPB4MsPOm+L9JeO0UYahvAwonsmeU04KROP1CvdoG5eMThromQqqPkawwsZNVNlsFNjWGrSLDWpb1foF+qMyi3UbBU1V0PdqTI4b6Lu1lByVZTNK6T2ehn5eQYlX6O7cEh38Rglf01rLk9rroCy/g11s0J3vkhv8Rh1r07nTZHOuwPak+a5Kq3X+8izu7TnPyOpG5fIj1dR9q/T+lbo4hIxXD6j93QDq6HiaBaeCPCJ8eIQn3GKR4JDxODDCb2ZbQxdR7p1LJSjBjdP1mg8WmXwtYEjK7gjHT3/nf6zLP2ZLPpOnSAR+HGInq/Tny2gzBfpv9xjsHyKZVnpB0maa3N72KD7cIXWgxWGBw3Mj0XsbJlwHBPGgjCJCCNBGATp25VHmEdNzPM2+kkT/bI9FZomkubYKBctfr4oIL/6hFbuMFjIoW+dIsYJYRAiQoEQU8IwJBxHhCT4CLyxwIl8bNtOpZJumCiaQde0GPoujuWivM+gbZ0SM04lcRQRxzFRFCGiqTTwA3zPw3NcHNu5F06GY9t4toPneQSWi7pUQC9cpsKJLEmSv6TSP02DIEgzruumQvO38BfaZNxcmpUzPwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/b986b73108885dfe03dfcde7e2d1c3ec/37523/image1.png\"\n        srcset=\"/static/b986b73108885dfe03dfcde7e2d1c3ec/e9ff0/image1.png 180w,\n/static/b986b73108885dfe03dfcde7e2d1c3ec/f21e7/image1.png 360w,\n/static/b986b73108885dfe03dfcde7e2d1c3ec/37523/image1.png 720w,\n/static/b986b73108885dfe03dfcde7e2d1c3ec/302a4/image1.png 1080w,\n/static/b986b73108885dfe03dfcde7e2d1c3ec/07a9c/image1.png 1440w,\n/static/b986b73108885dfe03dfcde7e2d1c3ec/36405/image1.png 2486w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br>\n아래 명령을 통해 어떤 리소스가 어떤 API Group에 속했는지 확인 가능하다. RBAC에서 리소스에 대한 apiGroup을 명시해야 하는데, 이 때 아래 명령을 활용하여 참고하면 좋다. 또한 어떤 리소스가 namespace에 국한되지 않는 cluster 리소스인지도 확이할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl api-resources </code></pre></div>\n<h3 id=\"authorization\" style=\"position:relative;\"><a href=\"#authorization\" aria-label=\"authorization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization</h3>\n<ul>\n<li>\n<p>Node Authorizor</p>\n<ul>\n<li>kubelet과 같이 <strong>system:node</strong>:node01 ‘system:node’라는 이름이 client certificate에 명시되어 있으면 Node Authorizor가 승인한다.</li>\n</ul>\n</li>\n<li>\n<p>ABAC</p>\n<ul>\n<li>일일히 유저 별로 권한 나열</li>\n</ul>\n</li>\n<li>\n<p>RBAC\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVQoz22SXW/TMBSG+/9vuEZCSPwBuNodAqQhtAqkgfbRrkm6dEnTJmnjc44du2m7vchOuw9YpEcnjuPHPud4EGUl/sQZrm/nSOclmAj0D8z8CL0y/5zB6dUdToZjnAxHuEoLyMY8SXwk7uH/eVVotMBqgXMGuqghn34/LhBrIK7to9EQrSEiAfZ4qRGQFhATiBkDb1VKgVqNJspRvP0KahQoKaAuUqjLGSiaQ6oG0hC01tCiw7vfTJ9G4GGCRhi0anphSNHvuFJQP5P+NOUaPF2A0yVoMkdzFoFGGYyz0CRYlTWyLEc8vMDyZgbTGqij0NdInAHFBao3nyGKg4zGOTguIPGiJ6tgnYURjbKqcDkZ49foAtd3CVaswIowONZLGwNa1CjPY+g1wbCGTkvIzbxnlEPPKrhuAyMmpO1rtspKLGcF6mYNbg5C8ULX9qf5cAZTKbTZCi5foyPzhLHYdBs462ClhWWDtiK4mmGUhLoOjl1rjUFDhC/fhmitBfsxCxT7DvZRtEHXdQFrLbpth+vxFN9/nIdSKHomdM5hUZR4/+4jlGLk2QKTmymSeIYkuUM0SZHnS+z2O2y3W7RtG5qZ3s4QTZJQNtWoXuivgv/BGAMRDind3+8BPBw4Pg9BttvtwgmJGLfTFFGUoK5XYfxCGNI4pNTTL97v9y/w3/yctQ5tayG+Sf5+ao2/5u6KN4iRlBYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/f6de89b06d18db01fa1e29247d5a6544/37523/image2.png\"\n        srcset=\"/static/f6de89b06d18db01fa1e29247d5a6544/e9ff0/image2.png 180w,\n/static/f6de89b06d18db01fa1e29247d5a6544/f21e7/image2.png 360w,\n/static/f6de89b06d18db01fa1e29247d5a6544/37523/image2.png 720w,\n/static/f6de89b06d18db01fa1e29247d5a6544/302a4/image2.png 1080w,\n/static/f6de89b06d18db01fa1e29247d5a6544/07a9c/image2.png 1440w,\n/static/f6de89b06d18db01fa1e29247d5a6544/2b36a/image2.png 2268w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>권한 체크 명렁어\n<ul>\n<li>kubectl auth can-i\n<ul>\n<li>ex) kubectl auth can-i create deployments</li>\n</ul>\n</li>\n<li>kubectl auth can-i —as ‘{username}’</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Webhook</p>\n<ul>\n<li>써드파티 인증을 위해 사용</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"authorization-mode\" style=\"position:relative;\"><a href=\"#authorization-mode\" aria-label=\"authorization mode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Mode</h4>\n<ul>\n<li>kube-apiserver의 Authorization mode 설정에 명시한 순서대로 인증한다. 아래의 경우 Node Authorizor -> RBAC -> Webhook 순서로 인증한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACaElEQVQ4y52SS0hUURiAbwS2tVWNGDPbpChaFmREGyOC2gRBD4ZAV7ZIyJF04aq2rYsCg9oELiJKxIRQyUW+ZiZKnUkcHRzHO+dxz713nNEv7h3H1E3QgY///OdwvvP4j7W4WmQivcTX2cWQyfRvJlJZvkzNM57MMD2/zOj0AmPJLCNT82RyazhaIYRAShnGvVjLBZu5zApzCzl+ZFdJZ1dJZVZCUdBfyBX4uZQnuTOWWyuGwkC2l12hVhLXUXiOxt3BMxrfNWE0UuC5JszLnsE4GqXULgelligJSkpSqu8STJYE0i4hCuvIjQ3kehElJEoqtFJoUSPID4otoSViLVhko7QK0ZRRFQdd8XDKPrpqcKhgqj5m08dQxVDBqfpopVH676ktUXURz0eRA5PILQ+ZL1LseMf6rdfYT4eQ37PY8bds3HyFfD+FHEpRvPuG4p0B7JdjOBWvduodqSWDij0bRr4YR7kOyhbI4TTqYxL9LYPJ28jPKdSHOcyvPCZbQH9K1ZhdxvgejuOEwgArvHvZUHQFUkmMMXhs4bGNRxVddtFU8IEyVcrbFcoQ5h4VXOOGa+rSUFh/cFuWQmT4xwRCCbRx8Ixbw3VxAxyDq4OK/xXtvmG9Ewz6frAvbLHN/zarXvLNzU1mZmboetRF4nE3ie4EPYkeep/00tfbF+YPOzvp6OjYR3t7exjj8Tj9/f01YfD/gjY4OIh1+BBNzU0cixyn+UQzjUcbaTjSgGVZ/yQWi2HV7x+0kdERTl5r4fKDK1y810rr/Uucv32B09fPcPbGOVquniIaixKN7icQRSIR2tra+ANwH2wrflEtrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/8bd564524b915e03905ed14e917496e7/37523/image3.png\"\n        srcset=\"/static/8bd564524b915e03905ed14e917496e7/e9ff0/image3.png 180w,\n/static/8bd564524b915e03905ed14e917496e7/f21e7/image3.png 360w,\n/static/8bd564524b915e03905ed14e917496e7/37523/image3.png 720w,\n/static/8bd564524b915e03905ed14e917496e7/302a4/image3.png 1080w,\n/static/8bd564524b915e03905ed14e917496e7/07a9c/image3.png 1440w,\n/static/8bd564524b915e03905ed14e917496e7/098d4/image3.png 2142w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"roles--rolebinding--clusterrole--clusterrolebinding\" style=\"position:relative;\"><a href=\"#roles--rolebinding--clusterrole--clusterrolebinding\" aria-label=\"roles  rolebinding  clusterrole  clusterrolebinding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Roles &#x26; Rolebinding / ClusterRole &#x26; ClusterRoleBinding</h3>\n<h3 id=\"kubelet-보안\" style=\"position:relative;\"><a href=\"#kubelet-%EB%B3%B4%EC%95%88\" aria-label=\"kubelet 보안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubelet 보안</h3>\n<p>K8S 아키텍처와 kubelet\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACh0lEQVQoz13SS28TZxjF8fmO/R5dtR+gBaT0ogoqaLupetsWVEDqgnJxAEVJCDEmIcH2+DLj8Xgu7/2diz0G/lWC1EUXz/anc3SeoCwFT05mPBjMefwm5ekw5+HJkt1XY/ZPQ3b7I3ovxxwMIgZnKf3TJbao0FJSlCXl/y4ohCIenhA9/JXZX9+S3LlGfP86k9mcJCuIlxnPJ32uPv+BL5/d5PPe11w5/J4kWyKFREiBlAIhBEVZEAghkfMz8t0/MI9u4f+5gX/yE7pIMdZijeY4HvDdwY98s3+Trw6us3Nwg0WWkJc5w2hMuJgS5wnCSYIyXSDKnHlacjRKOB4v6YcpssgRskQYiXeGtWuoTIOQDVo15LJgVWaM4wmjKKQwAtt6gmKV4Izl5ZsRV3/+k51fbrPz212yQiCKBa+HIc8mGuM8vUnOJ/cmfPooIpeSTGSX2DgKCeMJ02RGsJpHhK9jzvoz3k4WjKMl4WKFMQYlM5alYpRXKNdgnSfTjnlpyJRAaUkhCrIyZ5WnjOOUIJ1HHO4OOdkLsUJReUddeSrnMEZiKov1CuU00iqaxrI3HHEaRzSVx1qL0QajNWkuCfLhjGU/YjXN0a5G+RZbb6jrFnsJGpq1xzUOW1t0ZbBeI6zAOfcRvGij1OXaQXarR/bZA9TTAdX53+T7dzBHt2njV1hdcjaZc7TwmLrjXdexXm/YbjpsZXHe4Z2//AatNVJeJPx9j+yLHmr/LdXimCo8pJm+oM2nVJUlNTWjosG1He+2W7quw9Yt0lt85fH+Y+0L0GhFIJIFKskxymCrFt9sqNdb1nVNVTvaruXD+45u29Fu1nx4v+VFGHG+TFi3zX+gt4bzVPAvFYohlvnbVVMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/d85cf4be275cefcc7c934ee9897be0f5/37523/image4.png\"\n        srcset=\"/static/d85cf4be275cefcc7c934ee9897be0f5/e9ff0/image4.png 180w,\n/static/d85cf4be275cefcc7c934ee9897be0f5/f21e7/image4.png 360w,\n/static/d85cf4be275cefcc7c934ee9897be0f5/37523/image4.png 720w,\n/static/d85cf4be275cefcc7c934ee9897be0f5/302a4/image4.png 1080w,\n/static/d85cf4be275cefcc7c934ee9897be0f5/07a9c/image4.png 1440w,\n/static/d85cf4be275cefcc7c934ee9897be0f5/900ee/image4.png 2544w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>kubelet 설치 시에 kubeadm이 kubelet을 설치해주지 않으며 직접 kubelet을 설치해야 한다.</p>\n</li>\n<li>\n<p>그러나 kubeadm join 명령을 통해 node들에 kubelet-config 파일을 자동 설정해주는 역할은 한다. 과거에는 kubelet.service에 직접 config를 설정해야 했지만 1.10버전 이후로 kubelet-config파일로서 대체되고 config파일 경로만 명시해주게 되었다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAUlEQVQoz3WQz0+SARjH37sQmsDoByDY69owxlioc85eaElWhzqEWIsFLSceckHqbNVwy007pL5AWzgL6C/IP0G0O7c4KJ4N2HAJNIefxtvs5rN99t338jzf7yMk0p+IxWIsxGKsfFwhm8mS/pohk86QzXxTSCaSyGtxZDmOvCb/Jy7HScSTJOIJlpeXSX1OIYRCISRJ4sbwMOP+cWZezTD9Yprg0yB+/ziBJwEKhQLHx8fUjmrUaqfUqVarVCoVhXK5TLlURnA6nej1erq7uzGbzBgvGblguIhKpUYQBIVcLsfBwS92d/fYL+5T3CtS+FmgVCrzp9Hg6Oi3cuTw8BBhYGCArq4ubDYbPWIPxstGVCoVavU5Rdva2tjObfN6bo7HY2MEgyFCwWf4HvpYfL/IxsYX1lPrrK6usvl9899CtVqNTqtFo9Gg7dTSeb6TjvYONJp2Jf3Ozg8CD+7hcfYyKg0xOnIL74iXPlcf4hVRCWMwGJicDCO0zGm1s9jayvH8kY+7/Xa8Q/3cdEu4rrtwOBzY7XZFRVEkGo0iTExMMDg4iNvtRpLcirbweDyKbyXJ5/Pcv3MbV+9VnNdsiFYLFosFk8mE2WzGarWi0+kIh8MIjUaDZrPJyckJZ029Xkf+sMTifJSld/MsvH3D7OwskUiEyMsI0UiUqakp5Z9/AewAb9Bf5RSvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/bd27f560d171c61d51d39d5830481cf9/37523/image5.png\"\n        srcset=\"/static/bd27f560d171c61d51d39d5830481cf9/e9ff0/image5.png 180w,\n/static/bd27f560d171c61d51d39d5830481cf9/f21e7/image5.png 360w,\n/static/bd27f560d171c61d51d39d5830481cf9/37523/image5.png 720w,\n/static/bd27f560d171c61d51d39d5830481cf9/302a4/image5.png 1080w,\n/static/bd27f560d171c61d51d39d5830481cf9/07a9c/image5.png 1440w,\n/static/bd27f560d171c61d51d39d5830481cf9/8078c/image5.png 2218w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><code class=\"language-text\">ps -aux | grep kubelet</code> 명령을 통해 각 노드에서 kubelet의 config.yaml파일이 어디 존재하는지 알 수 있다.</p>\n</li>\n</ul>\n<h4 id=\"kubelet-authentication\" style=\"position:relative;\"><a href=\"#kubelet-authentication\" aria-label=\"kubelet authentication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubelet Authentication</h4>\n<p>kubelet이 어떻게 Kube-apiserver로부터만 통신하도록 설정할 수 있는가?</p>\n<ul>\n<li>기본적으로 kubelet은 해당 노드의 10250, 10255 포트에서 누구나 접속 가능하도록 api 서버를 열고 있다.</li>\n<li>따라서 kubelet-config.yaml에서 authentication.anonymous.enabled = false로 설정해주어야 한다.</li>\n<li>그리고 앞서 공부한 것처럼 kube-apiserver는 kubelet client certificate,key를 가지고 있어서 그것으로 인증하게 된다.</li>\n</ul>\n<h4 id=\"kubelet-authorization\" style=\"position:relative;\"><a href=\"#kubelet-authorization\" aria-label=\"kubelet authorization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubelet Authorization</h4>\n<ul>\n<li><code class=\"language-text\">authorization.mode : Webhook</code>으로 설정하여 kube-apiserver의 RBAC와 통합할 수 있다</li>\n<li><code class=\"language-text\">readOnlyPort: 0</code> 으로 설정하여 10255(read-only port)로의 접근을 막을 수 있다.</li>\n</ul>\n<h3 id=\"kubectl-proxy\" style=\"position:relative;\"><a href=\"#kubectl-proxy\" aria-label=\"kubectl proxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubectl Proxy</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVQoz2WRvU9TURjGWz5aCgkfpbQLA3+BUTQxsFB1kMWQfsysLroZJ6VI3ByMi4l/gMaBRBcXY1RYRDAiBqJSpe0l9N7e9vae20O5JZb8zDkGE2R4cp7hnN953ucN2NUqNcehUqkgXMHnrQ1u3blNbi5HLjfH/YV75ObnmZ2dJZ1Ok81mSaVS2qtTKZPJMDMzo+8E9swKvwolypaNWaliWTYFo4yxZ7L502D1e4mSYXDp8hUGBgYIh8OEQiGCwSCBQOC0CsU8N25exxVVhBB4wqVaF7RbB7z9ZvHoXZG2Lzk7foH+/n5iIyP09PTQ1dVFR0cHnZ2dJ+ELd59w/sw1Hj54qtMZpV22DYsv2wbP3qzx+NVHtvI7nBsf16Dh4WEikYj2Ssor6D/g4vP3vFxc4cXiMqZpYZQMDMvh684eS6vrLK9tsJkvcnV6mt7eXvr6+jToOJlK2d3drWtQPmA7NmufVhBS4HkenidwPUljv0n7sAVHvzn0D7g4MalBiUSCWCzG4OAg0WhUf3Lcq076Y2eX10sf2C6V8RoNmvuSuiepCUnLP2DX2We9aJOcmiIejzM2NqY1Ojqq4SrxiQ7LtqMfFy0Hs+YiPInjSSxXUnElhaokb7pMTkzox6pDpaGhIZ3u1JZrNYd6vf53w40GDSlpNpv4vo/vtzhqt3XSZDKpN6tGUyMqqe7+B/4BMqGvYo/WuagAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/7e9829e16bc498c64a34c671d8656557/37523/image6.png\"\n        srcset=\"/static/7e9829e16bc498c64a34c671d8656557/e9ff0/image6.png 180w,\n/static/7e9829e16bc498c64a34c671d8656557/f21e7/image6.png 360w,\n/static/7e9829e16bc498c64a34c671d8656557/37523/image6.png 720w,\n/static/7e9829e16bc498c64a34c671d8656557/302a4/image6.png 1080w,\n/static/7e9829e16bc498c64a34c671d8656557/07a9c/image6.png 1440w,\n/static/7e9829e16bc498c64a34c671d8656557/91a65/image6.png 2476w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">kubectl proxy &amp;</code> 명령 실행하면 해당 localhost:8001에서 kubectl proxy가 실행된다.</li>\n</ul>\n<h3 id=\"kubectl-port-forward\" style=\"position:relative;\"><a href=\"#kubectl-port-forward\" aria-label=\"kubectl port forward permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubectl Port Forward</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJklEQVQoz2WSTWsTURSGJ2livigNhbqumxZXlYJ/QtAfIFZp/RHuRFptm103onQRGhJ0pbYqChVUEOpOhFKqSdN20kwyM/feTOajoW2ER+Yu3Hjg4YXLveec9+UaHdtFyB5d28V2BI6QOK7EFRJbCI47Do5UuFIihMB1Y1wcx9HYtq3pdrtajZOOxbPnT1GewmxZNOpNdhsnNNouey2Xxfd7/Bme8/LtK5aWFlldXWVlZUWzvLystVQqadbW1jBqtS2uTl9n8/U2QigO6g0O2w5HlsuXnw2ebP3A6joEQUQYhgRB8I9+v4/v+3Q6HUzTpNVqYTx+VOXhgzKlpReYZpvDgyMOWg7f9002P+/w+tM3dnYbfPy6TblcplqtUtnYoFKpUKvVWF9fp9ls6gFSSgzLtqnXfyOUpOd5KCno+QH9ICTwfX0prtt358jn8+TzBdLpNOn0JVKpFIaRYGpqmtnZWWZmrmHsN4958+4DRycWfd/nNAxR/QDVDxmenxFGp0RDuDN3j+JYkbFiUTeOmxqG8T9mx6XtKJqWwJaezilu5ngh0o/4ZSl2xQU3bt5iZGSEyckrjI6Oks3myOXy5HI5stksiURCY8TfQ6keQnnIno+n7Ub40SleNMCPBtrywsJ9/TiTyWhiy/GWqVRaW08mkySTCQylFJ7n6bzCMCCKIgaDAednZwwvLrTGNT8/r/ObmLjM+Pi4th1vmM1k9XmhUNAD/wI9kggnFHIXzQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image7\"\n        title=\"image7\"\n        src=\"/static/d08a73246f4ebf82631cf79bf30dbb2b/37523/image7.png\"\n        srcset=\"/static/d08a73246f4ebf82631cf79bf30dbb2b/e9ff0/image7.png 180w,\n/static/d08a73246f4ebf82631cf79bf30dbb2b/f21e7/image7.png 360w,\n/static/d08a73246f4ebf82631cf79bf30dbb2b/37523/image7.png 720w,\n/static/d08a73246f4ebf82631cf79bf30dbb2b/302a4/image7.png 1080w,\n/static/d08a73246f4ebf82631cf79bf30dbb2b/07a9c/image7.png 1440w,\n/static/d08a73246f4ebf82631cf79bf30dbb2b/1cab1/image7.png 2444w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"kubernetes-dashboard\" style=\"position:relative;\"><a href=\"#kubernetes-dashboard\" aria-label=\"kubernetes dashboard permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes Dashboard</h3>\n<ul>\n<li>k8s dasahboard service는 ClusterIP 타입이다.\n<ul>\n<li>따라서 외부에서 접근이 불가능하며 kubectl proxy를 통해 신뢰할 수 있는 사용자들만 접근하도록 설정한다.</li>\n</ul>\n</li>\n<li>kuberenetes dashboard authentication\n<ul>\n<li>Token\n<ul>\n<li>RBAC</li>\n</ul>\n</li>\n<li>kubeconfig</li>\n</ul>\n</li>\n</ul>","excerpt":"KubeConfig ~/.kube/config 에 config 파일로서 certification 에 대한 경로 등을 저장하는 것을 통해 kubectl 시 별도의 인증서 명시 또는 apiserver에 대한 주소 명시 등을 할 필요가 없게 된다. KubeConfig 파일은 세 부분으로 구성된다. Cluster Contexts : Context는 어떤 유저가 어떤 Cluster를 사용할 것인지에 대해 정의한다. Users API Groups \n\n아래 명령을 통해 어떤 리소스가 어떤 API Group에 속했는지 확인 가능하다. RBAC에서 리소스에 대한 apiGroup을 명시해야 하는데, 이 때 아래 명령을 활용하여 참고하면 좋다. 또한 어떤 리소스가 namespace에 국한되지 않는 cluster 리소스인지도 확이할 수 있다. Authorization Node Authorizor kubelet과 같이 system:node:node01 ‘system:node’라는 이름이 client ce…","frontmatter":{"date":"September 16, 2022","title":"[CKS] Cluster setup & hardening 2","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks2/"}},"next":{"id":"3cbcd176-52ff-50b2-a8f2-be9e16279145","html":"<h3 id=\"cloud-native-보안의-4c\" style=\"position:relative;\"><a href=\"#cloud-native-%EB%B3%B4%EC%95%88%EC%9D%98-4c\" aria-label=\"cloud native 보안의 4c permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloud Native 보안의 4C</h3>\n<ul>\n<li>Cloud : Datacenter, network, servers</li>\n<li>Cluster : Auth, Admission, NP</li>\n<li>Container : Restrict image, supply chain, sandboxing, privileged</li>\n<li>Code : Code security</li>\n</ul>\n<h3 id=\"cis-benchmark\" style=\"position:relative;\"><a href=\"#cis-benchmark\" aria-label=\"cis benchmark permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CIS Benchmark</h3>\n<ul>\n<li>CIS는 커뮤니티 기반의 오픈소스 단체로서 세상의 사이버 보안을 향상하는 데 기여한다.</li>\n<li>CIS는 k8s 뿐만 아니라 다양한 IT 표준 기술들( web, was, db, OS, network )에 대해서 보안에 대한 best practice를 제공한다.</li>\n<li>CIS-CAT을 사용하면 현재 k8s 클러스터의 취약점을 html로 생성해준다.\n<ul>\n<li>그러나 CIS-CAT pro만 k8s assessment를 지원하며 유료이다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"lab--cis-benchmark-on-ubuntu-os-cis-cat\" style=\"position:relative;\"><a href=\"#lab--cis-benchmark-on-ubuntu-os-cis-cat\" aria-label=\"lab  cis benchmark on ubuntu os cis cat permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lab : CIS benchmark on Ubuntu OS (CIS-CAT)</h3>\n<ul>\n<li>CIS-CAT 실행\n<ul>\n<li><code class=\"language-text\">sh ./Assessor-CLI.sh -i -rd /var/www/html/ -nts -rp index</code></li>\n<li>OS 선택 Ubuntu 20.04 LTS</li>\n<li>Profile 선택 : Level1 - server</li>\n</ul>\n</li>\n</ul>\n<p>이렇게 하면 /var/www/html 경로에 index.html 파일로 현재 설치된 OS인 ubuntu 20.04 에 대한 취약점 보고서가 생성되며 보고서의 remediation을 참고하여 보안에 필요한 설정을 조치하면 된다.</p>\n<h3 id=\"lab--kube-bench\" style=\"position:relative;\"><a href=\"#lab--kube-bench\" aria-label=\"lab  kube bench permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lab : Kube-bench</h3>\n<ul>\n<li>kube-bench 설치</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://github.com/aquasecurity/kube-bench/releases/download/v0.4.0/kube-bench_0.4.0_linux_amd64.tar.gz <span class=\"token parameter variable\">-o</span> kube-bench_0.4.0_linux_amd64.tar.gz\n<span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xvf</span> kube-bench_0.4.0_linux_amd64.tar.gz</code></pre></div>\n<ul>\n<li>kube-bench test</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./kube-bench --config-dir <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">`</span></span>/cfg <span class=\"token parameter variable\">--config</span> <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">`</span></span>/cfg/config.yaml</code></pre></div>\n<ul>\n<li>\n<p>controlplane, worker, master, etcd 등 k8s 주요 컴포넌트에 대한 security 항목 pass/fail 결과를 알 수 있다.</p>\n</li>\n<li>\n<p>kube-bench test 결과의 가이드에 따른 취약점 조치</p>\n<ul>\n<li>주로 static pod ( kube-scheduler, kube-controller-manger)</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"k8s-security-primitive\" style=\"position:relative;\"><a href=\"#k8s-security-primitive\" aria-label=\"k8s security primitive permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>K8S Security Primitive</h2>\n<p>Kube-apiserver가 거의 대부분의 cluster 작업이 가능하기 때문에 이것으로의 접근을 제어하고 권한을 관리하는 것이 매우 중요하다.</p>\n<h3 id=\"authentication--who-can-access-\" style=\"position:relative;\"><a href=\"#authentication--who-can-access-\" aria-label=\"authentication  who can access  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authentication ( who can access ?)</h3>\n<h4 id=\"users\" style=\"position:relative;\"><a href=\"#users\" aria-label=\"users permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Users</h4>\n<ul>\n<li>k8s는 직접 ‘user’라는 리소스를 관리하지는 않는다.</li>\n<li>username, password/token 에 대한 파일을 kube-apiserver가 참조하여 인증하도록 할 수 있지만 권장되지는 않는 방법이며 최신 k8s에서는 지원되지 않는다.</li>\n</ul>\n<h4 id=\"serviceaccount\" style=\"position:relative;\"><a href=\"#serviceaccount\" aria-label=\"serviceaccount permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>serviceaccount</h4>\n<ul>\n<li>Prometheus, Jenkins, k8s dashboard와 같이 다른 application에서 kube-apiserver와 상호작용이 필요할 때 serviceaccount를 생성하여 사용한다.</li>\n<li>serviceaccount를 생성하면 secret으로 토큰값을 관리하며, sa는 이를 참조한다. curl로 api-server에 접속 시에는 이 토큰 값을 header authorization에 bearer로 넣어주면 인증이 가능해진다.</li>\n<li>3rd party application이 클러스터 내에 존재한다면, pod에 volume으로서 sa의 secret을 mount해주면 자동 인증이 된다.</li>\n<li>모든 k8s의 namespace에는 ‘default serviceaccount’ 가 자동 생성되며 pod를 띄우게 되면 별도 명시해주지 않아도 pod에 sa의 secret과 token이 자동으로 마운트 되었다.</li>\n</ul>\n<h4 id=\"serviceaccount의-변화--v122-v124\" style=\"position:relative;\"><a href=\"#serviceaccount%EC%9D%98-%EB%B3%80%ED%99%94--v122-v124\" aria-label=\"serviceaccount의 변화  v122 v124 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serviceaccount의 변화 : v1.22, v1.24</h4>\n<ul>\n<li>v1.22\n<ul>\n<li>v1.22 이전에는 serviceaccount가 생성 시 secret이 자동 생성되며 secret은 token 값을 내포하고 있었다. 이것은 expiration이 따로 없고 특정 사용자에 귀속된 것도 아니었다. pod를 생성하면 자동으로 default serviceaccount의 secret이 pod에 마운트 되어서 인증에 사용되는 방식이었다.</li>\n<li>그러나 v1.22 부터는 ‘Token request API’ 를 사용하는 방식으로 개선되었다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAACr0lEQVQ4y6VVzU8TQRydfuy23X6Hfm+hn9t23W6/tpaipiGotKVpSxsQJWJiJGBQ48WDEROCl97UGA54N16N/4A3z57UuzcOHjxw4PTMDJZIjEkph5eZ2Z198+bN/N6S7uMWFuotLLQW0Gq10G630el0GBYXF9Htdk/6/X6f9ev1Onq9HhqNBjRNw2AwwOHhIQ4ODkCkdBLFYhGKoiAej0MURTgcDrhcLjidzlMYPhu+p60gCAgEApBlGZlMBiQWjbFBMpmEXq8HIeR8MFvMTHY6nWYK6apmsxkGg2FkEp1OdwJCCeh2w+Ewk+71elmfko6l0G63IxKJMO88Hg+MRuN5t02YolqthlQqBa1cAmfiQHTkNM5CSFVKKQlqVkU0FAch//rHGXlYLBZmBc/zDCaTiY1pS8cnhNTMYrGE6uUKlp/NY+n5HFZfNHFzp45bu00sb89DLkoI+kMQwyLzmcLv9yMYDCIUCsHn8x0T0tPkOI55GI3EIM/EUbgqIz0TQVBxQ8xNYLLgBWcd8dRNZh5qLotyqYx8U8K1Rxpq6/lj3MtjdrOEqBY6vh563WgeGgiPmJhAYVrFdCOHREVEtpZATAsgVg7AE3WOfiiVlRTu7M/h7qsONvb6uL52CVbejgm3Z7xrs/m+iY/Yxv7RFt782sTu9zU8+bSEp59XsPNlDQ8/dFFoJ2GbsIxGuPp6Fm+PHmDv530Mvq5j8G0DL39sYeNdG6VeCjO3ZVy8kYHDJ4xGyAscBJcZbp8TSl5G9UoFgUnf+SplCMFiRS6bg8PmgNfjhWC1jEeo+1NaNpsNSlZBIhGHolzA1NQUqw4aICMTssghhH2oqirLRkmSGDkNT9parVYM551py7R8CoUCK6WxU4fW4xBut5uppP+MarXKcpImOc1Jutjfc/+H37BgFJZjSeELAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/98d53f997a41abe34077f9b52b3bc4f7/37523/image2.png\"\n        srcset=\"/static/98d53f997a41abe34077f9b52b3bc4f7/e9ff0/image2.png 180w,\n/static/98d53f997a41abe34077f9b52b3bc4f7/f21e7/image2.png 360w,\n/static/98d53f997a41abe34077f9b52b3bc4f7/37523/image2.png 720w,\n/static/98d53f997a41abe34077f9b52b3bc4f7/302a4/image2.png 1080w,\n/static/98d53f997a41abe34077f9b52b3bc4f7/203d3/image2.png 1322w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>serviceaccount admission controller가 Token request API로부터 얻은 토큰을 projected volume으로 pod에 위와 같이 마운트 시켜 주게 되었다.</li>\n</ul>\n</li>\n<li>v1.24\n<ul>\n<li>그리고 나아가서 v1.24 부터는 serviceaccount를 생성 시에 secret과 token이 생성되지 않고, <code class=\"language-text\">kubectl create token &lt;sa-name></code> 을 해야 해당 sa에 대한 token이 expiry를 가지고 생성되게 되었다.</li>\n<li>예전 방식 대로 secret을 사용하기 위해서는 아래와 같이 하면 된다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6klEQVQoz4WSS4viQBDH8zX0IGrUnSTdndjdSYw6vnZZxcMM7FlYH6D42IMXYTArLvN5/HSiJ+G/dMeRlRH28ONf1Y/q6qoy/ry/4227xTaOEf/eIVYax9jtdlitfuFwOOByueB4POJ0Ot04n88PfaPXrONZeGj6HDXhQZTLoJSCEIJisYh2u43JZILh8CeGw+EnRqMRxuMxBoMBNpsNjNdOAy3OUK1EqEc1SCmvASlc14VlWTBNE6ZZgFkooFAoaF9pPm8il8shn88jnU6j1WrB+PGthY5w0YgiVMIKhJDgXOhgyvb9QCO1hgiCUK+HlQicc/0TxhhKpRL6/T6MbqOOXsjRlBxSSHic6wtSBvBcT2do23aCZd38D3UcRwdVGfd6PRiNaoQGZ4i4h7ovUBMchDKN7RBY6rJt4+mq2rYS/QjsOLYuQ7fbhVEJQ9Q8hu+hREdyfPU5fJehWnbxzD1UuYeo7KKuHhQeAo+h7XNIl0FIiSAMdUkoZXh5eYURBAEs6wkupWCqHpSAKiUEHiVwyRWaoPbKjIISRzdPBVL1LpW+JDWMokinTq6jkpDYzs0nd3t6/Z/zd01Rr2QyGd3+h2SzyP4HNTapVCoZm/V6jdlshvl8fsdisfjEcrl8yGq1wnQ6xX6/x195bYrOqomIqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/edcbe144270102bb2ba566d4d0aca3bd/37523/image1.png\"\n        srcset=\"/static/edcbe144270102bb2ba566d4d0aca3bd/e9ff0/image1.png 180w,\n/static/edcbe144270102bb2ba566d4d0aca3bd/f21e7/image1.png 360w,\n/static/edcbe144270102bb2ba566d4d0aca3bd/37523/image1.png 720w,\n/static/edcbe144270102bb2ba566d4d0aca3bd/302a4/image1.png 1080w,\n/static/edcbe144270102bb2ba566d4d0aca3bd/58354/image1.png 1396w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n</li>\n</ul>\n<p>아래와 같이 serviceaccount를 설정하면 7일 동안 토큰이 유지되고 7일 뒤 자동으로 새로운 토큰으로 갱신하게 된다. 그리고 automountServiceAccountToken 설정을 true로 하면 자동으로 pod에 토큰을 마운트하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>service<span class=\"token punctuation\">-</span>account\n<span class=\"token key atrule\">automountServiceAccountToken</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">expirationSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">604800</span> <span class=\"token comment\"># 7일 동안 토큰을 유지</span></code></pre></div>\n<blockquote>\n<p>참고: ( <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/#service-account-token-secrets\">https://kubernetes.io/docs/concepts/configuration/secret/#service-account-token-secrets</a> )\nKubernetes 버전 1.22 이전에서는 Kubernetes API에 액세스하기 위한 자격 증명을 자동으로 생성했습니다. 이전 메커니즘은 실행 중인 Pod에 마운트할 수 있는 토큰 Secrets를 >생성하는 것을 기반으로 했습니다. 더 최근 버전인 Kubernetes v1.28을 포함한 Kubernetes의 최신 버전에서는 API 자격 증명을 직접 TokenRequest API를 사용하여 얻고, 프로젝트된 >볼륨을 사용하여 Pods에 마운트합니다. 이 방법으로 얻는 토큰은 제한된 수명을 가지며, 해당 Pod가 삭제될 때 자동으로 무효화됩니다.</p>\n<p>여전히 토큰이 만료되지 않는 토큰이 필요한 경우 수동으로 서비스 계정 토큰 Secret을 생성할 수 있습니다. 그러나 API에 액세스하기 위한 토큰을 얻기 위해 TokenRequest 하위 리소스를  >사용하는 것이 권장됩니다. kubectl create token 명령을 사용하여 TokenRequest API에서 토큰을 얻을 수 있습니다.</p>\n</blockquote>\n<h3 id=\"tls\" style=\"position:relative;\"><a href=\"#tls\" aria-label=\"tls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TLS</h3>\n<ul>\n<li>비대칭키 방식을 사용하여 암호화한다.\n<ul>\n<li>private key 와 public Lock 으로 생각하면 쉽다.</li>\n</ul>\n</li>\n<li>SSH의 비대칭키 암호화 방식 활용예\n<ul>\n<li>자물쇠인 공개키를 서버에 두고 서버에 접속하려는 사용자는 개인키를 가지고 서버에 접근한다.</li>\n</ul>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/ElEQVQoz2WST08TQRiH9wN4IKVUUj6GifHg3QsGrG31aOGg+BVMPBj9HMZDTyYeDMrNaFgPNv6hGCkqAUSg3e2yO/tvdrcNPGam7SpxkmfzziTz5N3fO4YQAoUnBIHv69r3fU0QBOcIg0Cfd7tdOlsdHMfBdV19NvEYcehzZJ/weO0bjitGlyaCMNQEQUiWSDZ3D3myuoFpvmexsqiFkwZyofp82Onyqn2A4wkiJRiLoijKSaTkoNfH/H5Iq9Vi4do8Jyfu/8Ke7WB+3SELfeJoJFOCOI41UkpNLCWplJyepdibv+jcfYHruIhxNBOpoQr12yKJ8q7+FSVJkpOlCcMswes5HLV+IjxPi9S9Se6GyktYLvZa55xMCdI0zWWnwwG7x32erW/zub3Bg0cPEeLv8HJhOJCI33327q8SWh4yS0jkSJZlGcPhUANn7Fkez78cYq6bXLl0WTeQRxLHem94P3r0X24RyZgkHYkmMrX3Az/PJ/J9BlnE7qdt3tx7SvfoGMu2sG0by7KwbBvD2e+y/7pN4IzeonpXagBqvf34jsrtCo07DVZWVlhaWqaxvMytGzXqV+ep3qxSq9Wo1+tUq1UWrs9jeIGgH3tEcYQ/Hr1qX61ms4lhGBQKBcrlMtPT07ouzhSZmZulWCxSKpW4ODtLYWqKC6U5/gAVELWfPdJMxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/75d08b1c288fa1d7cb5db96556db6a22/37523/image3.png\"\n        srcset=\"/static/75d08b1c288fa1d7cb5db96556db6a22/e9ff0/image3.png 180w,\n/static/75d08b1c288fa1d7cb5db96556db6a22/f21e7/image3.png 360w,\n/static/75d08b1c288fa1d7cb5db96556db6a22/37523/image3.png 720w,\n/static/75d08b1c288fa1d7cb5db96556db6a22/302a4/image3.png 1080w,\n/static/75d08b1c288fa1d7cb5db96556db6a22/07a9c/image3.png 1440w,\n/static/75d08b1c288fa1d7cb5db96556db6a22/fc477/image3.png 2426w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>https의 경우 이보다 다소 복잡하다. 대칭키, 비대칭키 암호화 방식을 모두 사용한다.\n<ul>\n<li>대칭키를 전달하기 위해서 비대칭키 암호화 방식을 사용한다.</li>\n<li>메시지를 전달할 때는 클라이언트/서버에서 동일한 개인키로 암/복호화한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"https의-tls-동작-원리\" style=\"position:relative;\"><a href=\"#https%EC%9D%98-tls-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC\" aria-label=\"https의 tls 동작 원리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTTPS의 TLS 동작 원리</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACbUlEQVQoz42Sz0tUURTH3z+TGLTQUaFtuawWYjoi5E5QXFlEiBRuWrQrCLGFmJBBIUilmDmMo5MwSQqlNtjMqDNOPt+8mffr3nnam3E+MW+yX6u+8OEeDvd8z7mHq9iWhfUHiUSCeDzO3t4ehlFgLbbB5PMZbo884M6te3zLqkgp/Lu2ZWP5/K5XrH8MVVXl8PAQTdPI5/PoOZ3IyioLoQibn79gFAyE4+DYFtKxKVaRDo5waoaf9jUyWgHh1Do5joMQwqcau65LJpNGz2l4Jc8vfhSO0zERo3MixqXRKBPhOE6ugGnbKHnDxDAtHNuudf7JmWmVYrGIlEU/X5SS+c0DRlcSPI58ZWR2m7GpdXY29hGuQKnu0JUOKTXPk2jCn9Q0zdqObNs3sWzLz51xImxKwgKOibxcY2Z8FfdEYhkFlOp0rrD5kFS5O7uFblhIIZBS1iYrSrzvHmeqVCqUT085PqnlpifWmHz43o+z+jGK6QgyRzlS+xkKuk5W09FtiZDS31+5VCaV3eXt4gJL4SXC4fBfhBZDzM3Ns7gwx9iLZRTTFDjiO65X4jCromU1zLxLOp32p6zq2fQULRdbaL3cSiAQoKGhgaamJpqbm2lsbKT+fD11deeovxBAOcoekN7ZxfPKJLbWia6+4ePqOKnUrv/kql6FXtMevE7PjR6CwSDd3d10dnbS3t5OW1sbHR0dBLu6uHb1Ckr1G1Ap45VKWFvv2I49ZTl2n73kLu6x6xtGossM3hxkaGiI4eFh/xwYGKC/v5++vr5f9Pb2ohiGScEwyOVyqEcmhbxAzaokk0k8z6NULvO/KlXgB6hO8qkP9HwHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/624b014af18ff35afdb13f39e6a12ce1/37523/image4.png\"\n        srcset=\"/static/624b014af18ff35afdb13f39e6a12ce1/e9ff0/image4.png 180w,\n/static/624b014af18ff35afdb13f39e6a12ce1/f21e7/image4.png 360w,\n/static/624b014af18ff35afdb13f39e6a12ce1/37523/image4.png 720w,\n/static/624b014af18ff35afdb13f39e6a12ce1/302a4/image4.png 1080w,\n/static/624b014af18ff35afdb13f39e6a12ce1/07a9c/image4.png 1440w,\n/static/624b014af18ff35afdb13f39e6a12ce1/ba40d/image4.png 2524w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>ssh-keygen에서 했던 것과 유사하게 openssl 명령을 활용하여 서버에서 개인키/공개키를 생성한다.</li>\n<li>사용자가 처음 웹 서버에 접근 할 때 사용자는 서버로부터 1에서 생성한 공개키를 전달받는다.</li>\n</ol>\n<ul>\n<li>이 때 공개키를 전달 받을 때 ‘인증서’안에 담아서 전달 받도록 한다. 그 이유는 뒤에 나온다.</li>\n</ul>\n<ol start=\"3\">\n<li>사용자는 대칭키를 서버로부터 받은 공개키로 암호화하여 서버로 전달한다.</li>\n<li>해커는 공개키에 대한 개인키가 없을 것이므로 대칭키를 알아낼 수 없고, 서버는 가지고 있는 개인키로 복호화하여 대칭키를 득한다.</li>\n</ol>\n<p>그러나 또 다른 문제가 남아 있다. 만약에 해커가 신뢰할 만한 서버인 것처럼 사이트 UI등을 속여서 사용자가 해당 시스템에 접속하는 데 성공하게 했다고 가정하자.\n그렇다면 사용자는 해커 서버로부터 공개키를 전달받게 된다. 이 때 앞서 언급했듯이 인증서를 통해 해당 공개키를 전달함으로써 신뢰할 수 있는 시스템으로부터 온 것인지를 검증할 수 있다.\n인증서에는 아래와 같은 정보가 담겨 있다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9klEQVQoz2WSTU8aYRSFxwSpKQEDMREignHhgg0oARJwXxf8t8a02rRpa2uIDaEGC5SPgiJSrdBU9zbRGT5mDIMiVDdunmZeUzddPHnzbs6955wrlQ92ye+VBLndAtlKnkz5KzulLOlihs+5NMlMikptD1mWGY1GDAaD/7i5uRFIu9+r9HQdva9zrlxwLj8gtxRUTaWrquT3irzdfM/KsxXi8TjhcJilpSWCwSChUOjxHwgEkOqNQ+7u7oT69fU17U4bpaVwdXWFbgzq6ewf1lh7s87Ekwmmp6fxeDzMzMzgcrnwer243W4sFguSJCHVjg4YDof0+30uLy+5UGQh2O120TSNTqdDqVoWgpanFux2u9hkbm6O2dlZHA4Hk5OTOJ1ObDYbUvWwJgTPfp/RaDRoNpvi/XF8zMnpKe12m0KlxOqrF7icLqamppifn8fv97O4uMjCwoIQNAaZzWYjw31u/9zS6+liy67aFeFrqkqr1UKRFXKlPM/XVhkfHxe2rFarsOrz+YTtsbExTCbTg+V04QuNk580fhk0OTiqi0ar9RrlaoV8qcC7xAYvX68TDoXFVkYZ0WhUFLS8vCyIxWJEIhGkYvUbO4WMYDuXJpXZJplOkUh9YjOZYGPrIx+2Nklnd9BUjfv7e1GigXFCRlxGof/O5y9kZraPRWHPXQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/fb32e27908fb2d5314f2a6e157560b5a/37523/image5.png\"\n        srcset=\"/static/fb32e27908fb2d5314f2a6e157560b5a/e9ff0/image5.png 180w,\n/static/fb32e27908fb2d5314f2a6e157560b5a/f21e7/image5.png 360w,\n/static/fb32e27908fb2d5314f2a6e157560b5a/37523/image5.png 720w,\n/static/fb32e27908fb2d5314f2a6e157560b5a/302a4/image5.png 1080w,\n/static/fb32e27908fb2d5314f2a6e157560b5a/07a9c/image5.png 1440w,\n/static/fb32e27908fb2d5314f2a6e157560b5a/db7ce/image5.png 2404w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그러나 또 여전히 문제가 남아있다. 해커가 certificate 까지 자기 임의로 만들어서 속일 수 있기 때문이다. 이를 self-signed certificate이라고 한다. 모든 브라우저는 인증서가 신뢰할만한 CA로부터 sign된 인증서인지를 체크하도록 만들어져 있다.</p>\n<p>그래서 아래와 같이 Symantec과 같은 CA(Certificate Authority) 기관에 CSR(Certificate Signing Request)을 통해 인증서를 sign받게 된다.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACiUlEQVQoz2XQ3WsTWRzG8bmtvbYIFutVa/Fa/Y+kV7tIFAottWjxhbrLrloWiqsie7EXIliqiMW+Ga2duNm0adokzXZrmslkZrLOmTNvSZPpVzIqrnrx4Xc48DznRRFC8C1XusxqczyqPuWdtceeVqFSq6LXDcy6QUWvoBs6NctAuALhfckqtrD5lnQkD8uz/L77B2WrjFWvU61WKJe20UyDclXjna5j1k1saWP/v9B3PAIZEEg/nqEb4kpJ6O8TWHvk116RLW6zq75ld/ImM+kianGPZMlESIkjna9ep5SsHbaMAnmzSMHaZsssYAoTz/Uo7hTZ2MqyUdhEVVf4a34e873Aei+o/SdwpER+4jgfi5Xb+Ttcyv3Elc1fuLZ5k9HsVVQ9TcNtxEV6TUfTNP75d4dniy+QjiAMAwLfw3Xd2OfCDiVyW+BFHHgR+AcQwH7QRLqS9HqGbC7H35m3LC/P8Xh2Jg4FYYjn+3je96XK/dKf3CrcYXr7QWwyP8W6lSNqtFnbWGd+aZGFpQWePnvCypsVfN8nCIJ4ep1bem58eOcv48Kk9oaFSpJkdZWkvsqctkRZVDhoRUQHEa1Wi3a7TRRFsc461moTBRFtv03La9EMmzQaDRTLtjBsE1NYWE491gk+X5njhws/Mn5xnJGREUZHRxkbG2NiYiLeGx4f5vxUgsRUgqHJIc6eO0viXALl1/w0l3M/c33zFjfyvzGcmSAflrg3fZfDPYcZHBykv7+fgYEB+vr6ONp7lGO9x+g53kPXqS66Tx+i+8whuo50cfLESRTbsekQUuB4EulLmvtNjJpBNpuN5XK5WCaTIZVKoaoqqdUUqVcp1GQK9aXK6+Rr0uk0HwC2Z/G9g8EdDAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/c335328bf930bfd6ec8289161369c152/37523/image6.png\"\n        srcset=\"/static/c335328bf930bfd6ec8289161369c152/e9ff0/image6.png 180w,\n/static/c335328bf930bfd6ec8289161369c152/f21e7/image6.png 360w,\n/static/c335328bf930bfd6ec8289161369c152/37523/image6.png 720w,\n/static/c335328bf930bfd6ec8289161369c152/302a4/image6.png 1080w,\n/static/c335328bf930bfd6ec8289161369c152/07a9c/image6.png 1440w,\n/static/c335328bf930bfd6ec8289161369c152/f60cd/image6.png 2318w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>브라우저는 어떻게 가짜 CA가 아닌 신뢰할 수 있는 CA로부터 sign된 것인지를 알 수 있는가? CA들은 모두 각자 개인키/공개키 쌍을 지니고 있고 <strong>인증서를 sign할 때는 CA자체 개인키를 사용한다.</strong> 그리고 모든 CA들의 공개키는 브라우저에 빌트인되어 있기 때문에 이를 이용하여 인증서가 정말로 신뢰할 수 있는 CA로부터 사인되었는지를 검증한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACXklEQVQoz12S604TURSF59V8Mf3hSxhjQowEAaFRqFqKtJVargVKW+iFubVz75kzl84AVWI+Q9Wg7OTLSnaydvZKlpKmKY/J0owNZ5vDsIXrugzNK1TfwvQttJGK7Y4wbBNHWEyzKWny4FWSJOExaZrR91ucDBpc9HpYgUN/ZQ37/Iye41JunhPGIfWBSfzIqzwcSZn+Jcu5TQTO4ADH9UhkhL2+ydQccWoGnF3ZjCYJ+1cB+XT6XzolTmLSJCGKIkL5gJACz1FJ85w8Scjujdc56tglSWLGfoiQ8o9PEobhXBUvEPhS0DIMlmv7FPaabDY7FI/bFE86lI7PkDJCxhEHp4c0jhp83a9T2/tKpVGlXN+hvLtDqVrmc2ULJRIjEvuQm5FHtWey27dwxxZ5lhHnM2zXx7FtRCjYru9guw6u53Klq2iGjmYaWI6NqmssrS+jyDBi0LPIwinZ3U/aqos61OkNDJKxwDFNPN+fH9w9+EaWZdxc3xDHMbbjzPUez/N4t1FAkROPi297SJnBTzC7HfqWTq32kebWc0aWxiQQTEJBtVEjiiSGYdDudGidn891bDnz3fzDPEv5cR1ze33Dj7s7gstF7HfP+FR6ykL5Cd3mFjKaEoiAnXpl3gJdNxgOh3S6XXoXXYYXRxi6weLqEspsNuPfEY7ke3pLFPhEzhET10YIQRhJNssfOeu0aF92aV92aBwdcHjcoPL5FduVbV4svES5z65pKpqm/UY30A0TwxyjGS69/mDe0/sCl2tf+FAqslEqUii+Z22jwHJhlaW1FV6/fcOb5UV+AYMTFYJzIE/8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image7\"\n        title=\"image7\"\n        src=\"/static/42a16eb68723956bd3fd2f2ce5d5ac27/37523/image7.png\"\n        srcset=\"/static/42a16eb68723956bd3fd2f2ce5d5ac27/e9ff0/image7.png 180w,\n/static/42a16eb68723956bd3fd2f2ce5d5ac27/f21e7/image7.png 360w,\n/static/42a16eb68723956bd3fd2f2ce5d5ac27/37523/image7.png 720w,\n/static/42a16eb68723956bd3fd2f2ce5d5ac27/302a4/image7.png 1080w,\n/static/42a16eb68723956bd3fd2f2ce5d5ac27/07a9c/image7.png 1440w,\n/static/42a16eb68723956bd3fd2f2ce5d5ac27/5496c/image7.png 2452w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>엔터프라이즈 환경에서는 private CA 서버를 구축하여 CA의 공개키를 직원들의 브라우저에 빌트인 시키고 인증서를 private CA로부터 sign받게 하는 등 자체적으로 CA를 구축할 수도 있다.</p>\n</blockquote>\n<p>이러한 모든 일련의 환경와 구조를 가리켜 PKI라고 한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACQklEQVQoz02Ry2sTURTG8zdJNW1aENGFC3Wj4MaVSysoBW3pokVKH2nzmMxMMk2kqaaY0E6mybwSBWt1Jyh0YxGkaGNmkmZeWUZU+OTeO0ldfJzLnHt+8333RDwjC1fj4eoCrZ4uwNE4fJJn0KqvoVNNoC3HYVXXR7KVDXRqSXrP0wR4ZC5UZAgkIAbj0anz6FaX8O3FPL6Xl+EaAk4rSdhKCq7Ow9EyVOdzfGgqBBIyAZ2pGZypPE7kNBw1A/vVLO1Ze+s4Kc6iV0vB08XQlQBfF2Dtc1R+mJABdYGC2jVu5JQ0CdQzRHyRnuJrYW70fSjfEGDLKXSqaQSmyCITm3ZlHk6dQ7ucoPbJYK+eRqu8DGt3DfZenJ5b5RUq0hv+uKukcSwt4YhbBDEXcQ0RgZqktj9vrzLrugDfFNFRkvi5G0dgZqkb3xBp/T9Fv5nFx/gC3jy4j7elHQbsqTyOKwko/CI9kyECsasJ/CivoN/IUVhgZEMoE3sWDqeVBKztBRglhb2hvc/RpQy3NhoyRQQNEZ7JMxlE533yPN1aGj2Vg6txsGoCc0hi0s2FUcjlfiOLwcEmfh8W8PfDFtWf988xOMjTHoU283BLc3AKD+GaEjw9gwiJaMsbI7lkszqJzOPJvRu4dSWG21djuHNtEjcvj+PR3etwdY69qZmDU5yBk5+Gq4voaxwiXnMTnpmD15DgNyVaB++2IK8+xtTEJUxNRDE5fhGx6BiiYxdo3Xk2jV+HRTZTT8J/nUdg5nDUfIl/j8ajbB8vF3sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image8\"\n        title=\"image8\"\n        src=\"/static/af418af75cda6312f304cc492fe6409e/37523/image8.png\"\n        srcset=\"/static/af418af75cda6312f304cc492fe6409e/e9ff0/image8.png 180w,\n/static/af418af75cda6312f304cc492fe6409e/f21e7/image8.png 360w,\n/static/af418af75cda6312f304cc492fe6409e/37523/image8.png 720w,\n/static/af418af75cda6312f304cc492fe6409e/302a4/image8.png 1080w,\n/static/af418af75cda6312f304cc492fe6409e/07a9c/image8.png 1440w,\n/static/af418af75cda6312f304cc492fe6409e/8201f/image8.png 2554w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h4 id=\"naming-convention\" style=\"position:relative;\"><a href=\"#naming-convention\" aria-label=\"naming convention permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Naming convention</h4>\n<ul>\n<li>공개키를 지니는 인증서는 보통 .pem, .crt 확장자를 지닌다.</li>\n<li>개인키는 보통 .key, -key.pem의 확장자를 지닌다.</li>\n</ul>\n<br>\n<hr>\n<p><u><strong>HTTPS 암호화 통신의 원리를 정리하면 다음과 같다.</strong></u></p>\n<ol>\n<li>openssl 명령을 활용하여 서버에서 개인키/공개키를 생성한다. 여기서 공개키는 곧 인증서를 의미한다.</li>\n<li>CA에서도 개인키/공개키를 가지고 있으며 서버에서는 CSR을 통해 1에서 생성한 자신의 인증서(공개키)를 sign해줄 것을 CA 서버에 요청한다.</li>\n<li>CA서버에서는 CA개인키를 통해 인증서를 sign하여 요청한 웹 서버에 전달해준다.</li>\n<li>이후 클라이언트가 웹 서버에 접근 하려고 할 때 사용자는 서버로부터 sign된 인증서(공개키)를 전달받게 된다.</li>\n<li>모든 브라우저에서는 CA공개키를 지니고 있기에 이를 활용하여 4에서 전달받은 인증서가 유효한지를 체크한다.</li>\n<li>클라이언트에서 메시지 암복호화를 위한 대칭키를 생성한다.</li>\n<li>클라이언트는 대칭키를 서버로부터 받은 인증서(공개키)로 암호화하여 서버로 전송한다.</li>\n<li>서버는 지니고 있는 개인키로 (1에서 생성한) 복호화하여 대칭키를 득한다.</li>\n<li>사용자는 앞으로 서버와 통신할 때 개인키로 암호화해서 메시지를 전송하며 서버는 7에서 최종적으로 득한 대칭키를 활용하여 복호화함으로써 안전한 보안 통신이 가능하게 되었다.</li>\n</ol>\n<hr>\n<h3 id=\"kubernetes에서의-tls\" style=\"position:relative;\"><a href=\"#kubernetes%EC%97%90%EC%84%9C%EC%9D%98-tls\" aria-label=\"kubernetes에서의 tls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes에서의 TLS</h3>\n<h4 id=\"server-인증서\" style=\"position:relative;\"><a href=\"#server-%EC%9D%B8%EC%A6%9D%EC%84%9C\" aria-label=\"server 인증서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Server 인증서</h4>\n<ul>\n<li>Kube-api server\n<ul>\n<li>apiserver.crt</li>\n<li>apiserver.key</li>\n</ul>\n</li>\n<li>ETCD server\n<ul>\n<li>etcdserver.crt</li>\n<li>etcdserver.key</li>\n</ul>\n</li>\n<li>Kubelet server\n<ul>\n<li>kubelet.crt</li>\n<li>kubelet.key</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"client-인증서\" style=\"position:relative;\"><a href=\"#client-%EC%9D%B8%EC%A6%9D%EC%84%9C\" aria-label=\"client 인증서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client 인증서</h4>\n<ul>\n<li>Admin 유저\n<ul>\n<li>admin.crt</li>\n<li>admin.key</li>\n</ul>\n</li>\n<li>Kube-scheduler</li>\n<li>Kube-controller-manager</li>\n<li>Kube-proxy</li>\n<li>kube-apiserver는 ETCD server에 대한 유일한 client이며 kubelet에 대한 client이기도 하다.</li>\n<li>kubelet은 또한 kube-apiserver에 대한 client 이기도 하다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACPklEQVQoz02SW4sUVxSF67fmV+i7gj8giAQjOg8R1OhDIIQZfAgEFBMdx6G7M9WXul/61DlVp6pO9anq6vbTLsiQh8Xe+2F/sFjLqeua/6vSGtPUqEojVIXSDUGcslz7BFHC2g/x/JCbGxc/CKZZVdXtv1MIgZISVRSIouA6EJy990llRdcZjGkRheRqtmblJ0RxjiwU119chCjY5oJKlyglkbLAmYdbglyyDDNSIbmYJfzw/JovXsZms6ZuNR/mKx69Ouen1xf8+WmO7TviOGf2zmPxIeDmysffJHjrCGfhxWzinCjbEmdbvChh5q5JcoGUkm5nmHkRL9++n/Tx3w3WdihVcfMpwL0M8JcpSbQlThROG85pMh+deugix/7zguH8AfbqN3bDONnu+57dsMMOFmst3a6b7C6XS4QQeEFAkQf87WqcUqSUckulCupGY0yJqbd0VmP7fgL8B7ndbYdUisuPc5QqyXJBq0vcqMZZzZeEXoi39ohcH/12RXmxpDp32ZUt/X5g6Adsb29D6rqOnbXUdYMxZrpbY2ibBkcvErS/pYoEzSpnePaZ8cWc4cklNq3oj3v2w34ChHlBkGQ0bcNh7Bn3PVpXU8Kntpzq4ywWLv4mIEoTfD/k16e/88vDN7w5+4OmMRwOB8ZxZD+O1P2IGQ7EuuevVcEsbSjqjkK3ZFKjTz08xZ/nglJVhFHGvfs/c+fuj9y7/xhV1Ry/HifYCXw8HjgeRqQZmKU1nuyoux5tdtStoflu+Rvsp+FWPXS7OgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image9\"\n        title=\"image9\"\n        src=\"/static/25b1618f40533bd8693a9651ddee1fda/37523/image9.png\"\n        srcset=\"/static/25b1618f40533bd8693a9651ddee1fda/e9ff0/image9.png 180w,\n/static/25b1618f40533bd8693a9651ddee1fda/f21e7/image9.png 360w,\n/static/25b1618f40533bd8693a9651ddee1fda/37523/image9.png 720w,\n/static/25b1618f40533bd8693a9651ddee1fda/302a4/image9.png 1080w,\n/static/25b1618f40533bd8693a9651ddee1fda/07a9c/image9.png 1440w,\n/static/25b1618f40533bd8693a9651ddee1fda/ba40d/image9.png 2524w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACy0lEQVQ4yz2Ty2/cVBjF579nwwqJPSzYVGIDQkItLaWCpE3TJE0yjsczfj/uta99/X6NJ/2hMaiLs/x+OufofJu87kiyHD8WuFFCkEjcWBClCt321HVN2zSrqqom1Q1+LHFDyd4N8UKJF0mSrCAtWzaiqLDCDCtM2fmCfZgishw3TnFFTpBkRFKtKsoK3bREscLa+V9lGi5ZXlJUDZtDJPGCEFVoHD8kFClBqjEPLubOwg8jDrbD1rQIRMYwdMhI4exjCl0iZIZrRZRFSV1XbMy44IOnV4gRKkJV46YVjhdjPTkMfU9VaFSWI5Sm7ztyqbENwfajj/uUkLjZCqzOwCjw2dkuhmFgWTt8z0WKhO0h4Lc3V1w/7rm4M/lk2Mi8ZBx6MqU5HBKMh4Dtg49lReS6XPveaBkirDvKQpGKBCFiGpVwazpcbm3eb23+ube4eDgQZZplnghkzt2DudbhBwEHLyDOctq2YVOLgPn+d3rjHf3nl8zWBY2M8IKYw94mV4ooDIkTQaprjvNEkpc4bkQSSXwvJojkWkd3BlZ7h+juhvD6A+nnW/yP79E7lzDOubl5IokzVK4pypqsbDgtR2Kl+eN6y8X9nr9uTV5ePSJVQde1bGpdE/uC2JdkTU2YCOq0wtjHvLp65N2NuR5dPNioqmU5zgzjRKorIpERy2ydWdN2/0VuU033p0P3i0l/6TG8tplkTdeMJConOI9cpAzTzDgdOR6PjNNM3U+odqRsO/Kqpe3OwJaNZ/rYfxvs326x325xLneEVkQ3TCTNjFsMJNXIMC9Mx2WN3E9HXD1yG1aYsiXQ4+qwOwPPQzYPDtXQkpY5icqQRUHZjgTlvB54ekJ1C8vpxLIsq8uz47YfV3X9SN/3dF3HJi1Kfn7xim+/+ZHvv3vBTz/8uv5l3w/wfAK+wJfnVc/Pz5z+hy7Hc/yZeZoYx+Er8F+6OsELmf13igAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image10\"\n        title=\"image10\"\n        src=\"/static/4710559c58048b6861cc934d2d5a7274/37523/image10.png\"\n        srcset=\"/static/4710559c58048b6861cc934d2d5a7274/e9ff0/image10.png 180w,\n/static/4710559c58048b6861cc934d2d5a7274/f21e7/image10.png 360w,\n/static/4710559c58048b6861cc934d2d5a7274/37523/image10.png 720w,\n/static/4710559c58048b6861cc934d2d5a7274/302a4/image10.png 1080w,\n/static/4710559c58048b6861cc934d2d5a7274/07a9c/image10.png 1440w,\n/static/4710559c58048b6861cc934d2d5a7274/1d94f/image10.png 2264w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이러한 인증서를 생성하기 위해서는 CA가 필요한데, k8s에서는 최소 1개 이상의 CA를 요구한다. ETCD 서버를 위한 별도의 CA를 두기도 한다.\n그리고 CA는 CA만의 certificate(공인키)와 key(개인키)를 지닌다.</p>\n<h4 id=\"인증서-생성하기\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"인증서 생성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증서 생성하기</h4>\n<p>openssl 명령을 사용한다.</p>\n<ul>\n<li>CA에서의 작업\n<ul>\n<li>\n<ol>\n<li>Key 생성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  openssl genrsa <span class=\"token parameter variable\">-out</span> ca.key <span class=\"token number\">2048</span></code></pre></div>\n</li>\n<li>\n<ol start=\"2\">\n<li>CSR ( Certificate Signing Request ) 생성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  openssl req <span class=\"token parameter variable\">-new</span> <span class=\"token parameter variable\">-key</span> ca.key <span class=\"token parameter variable\">-subj</span> <span class=\"token string\">\"/CN=KUBERNETES-CA\"</span> <span class=\"token parameter variable\">-out</span> ca.csr</code></pre></div>\n</li>\n<li>\n<ol start=\"3\">\n<li>Certificate Sign하기 ( self-sign )</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  openssl x509 <span class=\"token parameter variable\">-req</span> <span class=\"token parameter variable\">-in</span> ca.csr <span class=\"token parameter variable\">-signkey</span> ca.key <span class=\"token parameter variable\">-out</span> ca.crt</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<p>이제 CA는 private key와 root 인증서를 가지게 되었다.</p>\n<ul>\n<li>Admin 사용자에서의 작업 ( Client )\n<ul>\n<li>\n<ol>\n<li>Key 생성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  openssl genrsa <span class=\"token parameter variable\">-out</span> adin.key <span class=\"token number\">2048</span></code></pre></div>\n</li>\n<li>\n<ol start=\"2\">\n<li>CSR 생성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"> openssl req <span class=\"token parameter variable\">-new</span> <span class=\"token parameter variable\">-key</span> admin.key <span class=\"token parameter variable\">-subj</span> <span class=\"token string\">\"/CN=kube-admin/O=system:masters\"</span> <span class=\"token parameter variable\">-out</span> admin.csr</code></pre></div>\n<ul>\n<li>\n<p>/O=system:masters는 admin 사용자의 권한 부여를 위해 필요한 구문이다.</p>\n</li>\n<li>\n<p>kube-admin 이라고 적어준 것은 admin에 대한 네이밍을 한 것이며 어떤 이름이든 상관없다.</p>\n</li>\n</ul>\n</li>\n<li>\n<ol start=\"3\">\n<li>Certificate Sign ( CA-sign )</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  openssl x509 <span class=\"token parameter variable\">-req</span> <span class=\"token parameter variable\">-in</span> admin.csr <span class=\"token parameter variable\">-CA</span> ca.crt <span class=\"token parameter variable\">-CAkey</span> ca.key <span class=\"token parameter variable\">-out</span> admin.crt</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<p>admin 유저 뿐만 아니라 kube-proxy, scheduler 등의 다른 컴포넌트도 동일한 방식으로 client certificate을 발급한다.</p>\n<p>앞서 웹브라우저의 TLS에 대해서 얘기할 때 모든 브라우저는 CA의 공개키(public certificate)을 지니고 있어서 서버로부터 받은 certificate을 클라이언트 단에서 유효한지 검증할 수 있다고 한 것처럼, k8s에서도 kuberenets-CA가 발급한 public certificate을 모든 client들이 가지고 있어야 한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC10lEQVQ4y02S2YscVRSH+0/3QRBBFJ/EiCAiElEYTHAnJmMSJYmd6emq6qpeqmu9dWvvureWXmrCJ9NRmYfDjwPnfGedNE3DXVNKsdvteNf8iF/DJ4gs4VpaWJmDm3rIWqKVehv7X84dnbSqRTeaRr2F3WqnW/wyZCrnZ6CVLblKDUSeEFUxSmmU1uf4u3oLnfhFhF9JhCxwQ8E2EvhCEsaStKrJdvX/xWpVUTUKkdeEIsMLJL4vCcL07Oe1ZvLV5ls+ubqPaQucIOGV5bL0M5K8oqoVu6b9t6OWvuvRuqWsGxzDZ2FsuDJtLGPN2g6pdoqJLHMMP+LKTYjihOlmiy1d4qxi7QesvAA3jLFdj9U2oFGKYejxnRhjusGtPJzFFunnaK2YfLN9wOfTr7HnK0zTYm6ZzOwZSRBimkvCIOKw35NKSSgkZa3YDwOJlzN/tmXxPGQ1jZFBgboFurGFl61oFn/R6Qod2MjSZxVYWPMVr6cWutVEoaDcqfNYx+MBxw2xbBfL3mIs1riBoGtbJqaYYV4/ov79IfnTXyif/EDx4hJvYWOYDiISJCIhTRMqpakbzel4PANW9oaqKomCmCQvabVm8t36Ad8vH+I7PmEY4Hkegechl5LZbIllbdjVmqTMuJZLGt0zjifsreDl3ObSnjJzXBxP0Hcdk2OkuWlHsp+XNIakW+SItcc2dDGciMevFrwwXS6nDvNNyP5wPAMdX5w/Ympv+HPmsPRihr5n8nc45fEfj1h99hLj3jOsT5/jXLwm9VL6/RGZFQghyeuK7nBgHEfG00jUJgRFilYdRVnTdQP6docX3o/cv7pg7XjoQSNkSpQJlrHPcDjhFQ1J1eHWCWlfcDO+YTydaPo9m1wTFoqwbKl1T9t2TDJZIpKCD9//go8/+JL33rnHT789ZZX6VO2Ik3UskoZtfUTtb3hzc3MeuRlO+GWPmzXEu4FaD+cr/wPVqrVDvSCpBAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image11\"\n        title=\"image11\"\n        src=\"/static/f01aca82a4bd32f4de0e89c0c1f8b6c0/37523/image11.png\"\n        srcset=\"/static/f01aca82a4bd32f4de0e89c0c1f8b6c0/e9ff0/image11.png 180w,\n/static/f01aca82a4bd32f4de0e89c0c1f8b6c0/f21e7/image11.png 360w,\n/static/f01aca82a4bd32f4de0e89c0c1f8b6c0/37523/image11.png 720w,\n/static/f01aca82a4bd32f4de0e89c0c1f8b6c0/302a4/image11.png 1080w,\n/static/f01aca82a4bd32f4de0e89c0c1f8b6c0/07a9c/image11.png 1440w,\n/static/f01aca82a4bd32f4de0e89c0c1f8b6c0/f0293/image11.png 2250w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Kube-apiserver 에서의 작업 ( Server )  : 아래 그림 참조\n<ul>\n<li>\n<ol>\n<li>Key 생성</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>CSR 생성</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>Certificate Sign ( CA-sign )</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEUlEQVQozy2Qa09bBQCGzw9xMZEJg15OW0iUpdNtuiW7dAprmUNpdeybbrqwLK7OGEeiW8U4TczchK6ZU9PMwjYGW4YolFUYnG1AW1rlAL1faE9bNEXKl8dAfJPn0/vhefMKhWKJsBzhT3mRhUiMsLxENq+g5AsUC38Tj6dIxFJk0suslP6hXF5jdfVf1tcrVCoVKmsV1sv/s7aOkFMKyIsxluQI6USKeCJNJqdQKhYpFksUlSK+6Qm+/OYrvr/aTU+PE6fzGi6XC9c1F90/9HClt5urvT18d/0KQqm0ghSUGZMCjE+H8D4Oks0VWC2XWVlZYSNuj5ua2hp2GI3U19ej0WjQilp0GhHVdg1qsx6N2cDWF2oQFCVPNJFkPhJFjsZYiMXJLGfJ5pbJLmfJb/SRKJcufU378ePY7Xa6urpwXHTgcDhwXHDwxWcOLnR+zuVvLyNMzUiM+EbwTfoYmxjDO+5l+OEIQ95hHniH6bt3m4eTf3DOfhZx2/Nsb9BRrxcRdeLmSq1Oi86g47mtVbQfsyF4J8YIhILk8nkWlhaZl2X+kmUWI0uk0ikeSY/wDNziw9OnMIo1vCxqMNSpEEUtGq0alUaFWhSprtrCzsMfIGzY/XMBkqkUeUUhFo+TSCYpFAqkUilm/bN47t7CfqaDFw1qdtt20/iGEb3RgKpORW3VNuqq1dRWPUPj4bMIo+NjzIVDRGMxJiWJJ9NP8QcChMJhMukM0hMJ9x0PH506iaGhmqbRdl77rY29ziYaT+9Cu1eP/kADz1ZtodnyFsLvvlESyQSKohAKhZgLzhHwBwjOBYnFY0iPJX7qdXP+k3Psa36Fd26/h+Xim+yz7Ge/1cQB2yFMx15nx66XeP/kCYSh0V+ZeioxvyBvfjgT8DMzO4tvZgKfNM7A/Xtcd9/g465PsdqsvH3UhvVoG61HWmlpsnCkuWUTs9nMmY4OBN/UOHeHBhkcvk//gwH6Bu/wS38v7r6b/HjzZ5w3XHj6++g834nNZqPNZsXSYsFkMnHQdHAT0yETe17dQ+u7J/gPUuBwQOXNUeAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image12\"\n        title=\"image12\"\n        src=\"/static/b5de8bd0c64c336801656899ef5b8e73/37523/image12.png\"\n        srcset=\"/static/b5de8bd0c64c336801656899ef5b8e73/e9ff0/image12.png 180w,\n/static/b5de8bd0c64c336801656899ef5b8e73/f21e7/image12.png 360w,\n/static/b5de8bd0c64c336801656899ef5b8e73/37523/image12.png 720w,\n/static/b5de8bd0c64c336801656899ef5b8e73/302a4/image12.png 1080w,\n/static/b5de8bd0c64c336801656899ef5b8e73/07a9c/image12.png 1440w,\n/static/b5de8bd0c64c336801656899ef5b8e73/f3c07/image12.png 2516w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>kube-apiserver에서 이렇게 생성된 key들은 어떻게 설정되는가?\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACoElEQVQoz33R3WsTeRTG8V+0hpikaqyaTJqXJo1p2sykGenu1V4u640WU5RdUBBcaATRLuwfoC4s+M8IilZr9cqXZRG2StMkk7Zpk9YZbTo2M5F0gzdfaQQVFC8+nMMDBw48wrIsbPtLNjtZy35Hp/MeQ3+NYbyhVluj2bT5f7uDbbfY3t6m3W5/RewcNy2LrWaTt1tNLMvGNE0qlUVKpTKFwgLFYpFisYSmVbr5x1lB07SvCH1jk/nyMpVqjdJilZrRYPbhQ44mE8gZmUw2w7GxY6SVNMlUkkAwgMfrwev1du3sHs9nQm9sUtGq6Gs6xtorrHdt7tyd5oBzP8lwkkR/gkQwgc/lwyEcCCG+z2iYPHlR4nmhwtO5BYqrBg8ezRIYD5DNq2Qns8i/KwydS3Uz/6kAvWovrqALV3Qve47swbHL8ZFDIPQ3Df6dL/NfucqzlyXKqzr3Zmfwn/WT/kNGnlIYupRCviyjTCmkr8gEfpMI5CSkXyW8P/R++m6X6xCivFynvKDx1jQxGxtYVoub09OEzveT+XOU4SsjxCbjJPIJ4pNxjuaTDOYHieVjDFwcwH/cj+9HH/tG3biiA4iVdYMXcwusvzKo19dptdrcnplBOikhX1BQLigMnx8hMhFBOiERHA8SzoUJTYQI5UIETwbp+7kPZ9iJw9WDqNZ1lrRlmltNNjc26HQ63J6+z0GXj3ggTiqSYlAa7BYTPRwl1BfC4/DQI3pwCiduh5vdYvfnUupGg3+eFyhoK5SWa+gNm1sP7uO/fIShv1IMXx8hdTXF2I0x1L9Vhq+N0D/Vj/snN+LAN1pumFu8XFxlfqnOnFZl5bXJ42dPUXIy2TMqSi7TJZ+SGZ3IdqmnVdQzKulf0kRjUSKRHRHCAzE+ACs9BEstOz11AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image13\"\n        title=\"image13\"\n        src=\"/static/cdf45d03e8c11102f79c6ccf1fcaad74/37523/image13.png\"\n        srcset=\"/static/cdf45d03e8c11102f79c6ccf1fcaad74/e9ff0/image13.png 180w,\n/static/cdf45d03e8c11102f79c6ccf1fcaad74/f21e7/image13.png 360w,\n/static/cdf45d03e8c11102f79c6ccf1fcaad74/37523/image13.png 720w,\n/static/cdf45d03e8c11102f79c6ccf1fcaad74/302a4/image13.png 1080w,\n/static/cdf45d03e8c11102f79c6ccf1fcaad74/07a9c/image13.png 1440w,\n/static/cdf45d03e8c11102f79c6ccf1fcaad74/fc477/image13.png 2426w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br></p>\n<ul>\n<li>위 그림의 설정에서 볼 수 있는 것처럼 apiserver는 ETCD, Kubelet에 대하여는 client이기 때문에 각각의 컴포넌트에 접근하기 위한 client certificate, key를 가지고 있어야 한다</li>\n<li>client-ca-file에서는 apiserver로 접근하려는 client가 가지고 있어야 할 ca인증서에 대한 정보를 설정하고 있다.</li>\n<li>ETCD, kubelet 관련한 ca 설정에서도 동일한 경로의 ca인증서 정보로 설정하고 있음을 알 수 있다. 동일 클러스터에서 CA 인증서는 모두 동일하기 때문이다.</li>\n<li>tls-cert-file,, tls-private-key에서는 apiserver의 서버 crt, 서버 key에 대해서 설정한다.</li>\n</ul>\n</li>\n<li>\n<p>Kubelet에서의 작업, 설정</p>\n<ul>\n<li>kubelet-config에서 yaml로 설정하여 관리하며 kube-apiserver에 대한 kubelet의 client certificate도 마찬가지로 여기서 관리한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACgUlEQVQoz42S22oTURSG5zm8rTFpksZWbBFsm1RKBBW98kIUX0AQxFcQreKFIN6JeCe1UqugLQpW25raBmypaZJJmsMkmUmnaWYyk/PJTyYtCIrgho+91uJf/96wllAqlfgTwzAo7O0jSRmy2SzpdJpUyiJFNisfav7usxD+ZVgqGRiGyX5RR1ULPYqa3qv/1vyHoSW0ME2zx65mIhVKKAWdgmZgmOaB2aGhrusUi0U0TeshmIcC665UKpTL5R5WXKnWkPU6oqKzo5oUzAaNZvOARoN6vU6r1aTb7dLpdOh02ghiPEY0JhKKbLMV+kE8sYNVs/JwNEI8mSAajyEm4qysBnj08CFT96a4f/8Bd+/c48njJ8zNzvFqeoaZV3MIyXSSXC5HbCfO7NvXpKQUck5GjInMf1hgOxJGkiSUvMKLl9N4T3gYcdpxu104hpzYBx3Yh5zYnEewea8jWK8ufV1m/uMCs29eE1j7xlJghfcf5nm38J7V9TU+ffnM4vIiT58/wz96Cv/ICUaGB3H5XQyc9+A+58Hl72PwwjWEUDRGYCNMcGOLjJRGTCQJbEb4/iOMosjI+V2CoRjhnTTBYJCLk17GTh7nuGcIzzEPA0cHcPe5D7C7EaqVKlshBSVfot1u0Wm3iYgqUlYDfmKdZLpIJlcmn1e4NHqa0X47w6ddeCad9J9x4vA5cEw4sA3bELSiTiaVp6Bq1Go1qtUqal6jsKvTarV601MVHX2/iizLXLlxiQtXxzl72Yf35ji+2z68t3yM3x5n4soYgrUy25tJ5MwejUadZrNBQpTJJFW6P7u9XyrZYi+34kq7htmqUi5VMPdNjD0DXdXR8xrrKZVfd8vTxesx6hEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image14\"\n        title=\"image14\"\n        src=\"/static/c2fed3e7189d711c9ceb10639a137bf0/37523/image14.png\"\n        srcset=\"/static/c2fed3e7189d711c9ceb10639a137bf0/e9ff0/image14.png 180w,\n/static/c2fed3e7189d711c9ceb10639a137bf0/f21e7/image14.png 360w,\n/static/c2fed3e7189d711c9ceb10639a137bf0/37523/image14.png 720w,\n/static/c2fed3e7189d711c9ceb10639a137bf0/302a4/image14.png 1080w,\n/static/c2fed3e7189d711c9ceb10639a137bf0/07a9c/image14.png 1440w,\n/static/c2fed3e7189d711c9ceb10639a137bf0/36405/image14.png 2486w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"cluster-내의-인증서-확인하기\" style=\"position:relative;\"><a href=\"#cluster-%EB%82%B4%EC%9D%98-%EC%9D%B8%EC%A6%9D%EC%84%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"cluster 내의 인증서 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cluster 내의 인증서 확인하기</h4>\n<ul>\n<li>직접 설정하기 vs kubeadm</li>\n<li>kubeadm으로 프로비저닝 했을 때 인증서 관련된 설정이 어디에 있는 지는 아래와 같다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACfUlEQVQ4y22SSW/bVhRG+f9XdYqiTQuk6KLI0DhNbCSGk6DRHFWyBmviKFGURJGiOIqUZCeLU/BZcaKgi4Pv4rsHb3OfFMUxguh/iGPCKCZJNsznC2RZYWpZRHFy5Hyb0i5L2GUb9ts7bnJ2d3Pe5/PtPiVNQtaeQxL53O7Se2ebJfduntJv5zq/nuucPFc4OVV4cKrww3OFn19pPHpj8OCFKvqfXmr8cWny8Nzg5PSu++VM5/cLQ+wenmn8+EJFqmghOQU5OKKkhlT1r31RCagZMWU15MPIF+RzTQ8pKYGYi3KApPtbxjnBd/hbjEM/CXboXspg7qOtEqbRDWa0P3K+vCHJboayypBz3Jz0wKHP09vSMT1eF1u8b4yojSw65vqwv/PzOUca2AnDZcLwkCMnFY8Plxv6i4iBHQuxa/lcVDq8q/d5+7FHQ7WPHsy93JcKHY3ytU6hrVDpGXRND8PfM1hEtMcu19Ya3d8huxuudJvOxBWO4m7Q1ls0b4vqZXTNFe2xg3RRl3nX1LhsqJSHC6qKQ3uWUJWXvG2oImuKy9U0pmtndBY5Ke3ZRnTNSUjTDCmPlhT78/zbXPGkqPHnPyOelg0eFxRedz1eNhf8VZ1w3nY4azu86a2PuOj7vGotOa1b/N2Yi3xWHSNdtiaURg6FgU1ZWVEcLinLKz4aARXVo6J4lEYuVW1Nc7qhOU1omomYa7ovdrlTN0Jaswyp2NUpdXU+tBSqfZN/5Rl1eSau2hq79GYB/XkoDvblkgIvY2jH9OahOMa15QtPMiybycxhMnewbI9VmBKke9xww2IV4Cc7kv1n4t0nou3tPWF2c8hbgvRGuNbS4z+Ed6TORF+C+QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image15\"\n        title=\"image15\"\n        src=\"/static/e1906d17f72cee48edac4cfec50b169b/37523/image15.png\"\n        srcset=\"/static/e1906d17f72cee48edac4cfec50b169b/e9ff0/image15.png 180w,\n/static/e1906d17f72cee48edac4cfec50b169b/f21e7/image15.png 360w,\n/static/e1906d17f72cee48edac4cfec50b169b/37523/image15.png 720w,\n/static/e1906d17f72cee48edac4cfec50b169b/302a4/image15.png 1080w,\n/static/e1906d17f72cee48edac4cfec50b169b/07a9c/image15.png 1440w,\n/static/e1906d17f72cee48edac4cfec50b169b/1ffbd/image15.png 2108w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>kubeadm 환경으로 했을 때는 static pod의 log를 보고 설정을 확인할 수 있다.</li>\n<li>kube-apiserver, etcd같은게 죽었을 때는 docker 명령으로 컨테이너를 들여다 봐야 할 수 있다.</li>\n</ul>\n<h4 id=\"certificate-api\" style=\"position:relative;\"><a href=\"#certificate-api\" aria-label=\"certificate api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Certificate API</h4>\n<ul>\n<li>k8s는 csr object를 사용하여 k8s 리소스로서 사용자 별로 csr를 관리하고 그 역할을 controller-manager가 한다.</li>\n<li>k8s에서 CA란 CA key, crt 파일 그 자체이며 이 파일들을 보관하고 있는 master node가 곧 CA 서버이다.</li>\n</ul>","frontmatter":{"date":"September 16, 2022","title":"[CKS] Cluster setup & hardening 1","categories":"DevOps","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/cks1/"}},"prev":{"id":"12da607d-f519-5b82-bb76-4a94eca42bb2","html":"<h1 id=\"1-리눅스-기초\" style=\"position:relative;\"><a href=\"#1-%EB%A6%AC%EB%88%85%EC%8A%A4-%EA%B8%B0%EC%B4%88\" aria-label=\"1 리눅스 기초 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 리눅스 기초</h1>\n<h2 id=\"디렉토리와-파일\" style=\"position:relative;\"><a href=\"#%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC%EC%99%80-%ED%8C%8C%EC%9D%BC\" aria-label=\"디렉토리와 파일 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디렉토리와 파일</h2>\n<ul>\n<li>기본 명령어\n<ul>\n<li>ls, pwd, mkdir, touch, cd, rm 등</li>\n<li>명령어에 옵션을 붙일 수 있음\n<ul>\n<li>ls -al, rm -r, mkdir -p, ls -S( file size sort desc )</li>\n</ul>\n</li>\n<li>. , .., ~ 의 의미</li>\n</ul>\n</li>\n<li>—help와 man\n<ul>\n<li>man 명령어는 전용 페이지로 넘어가서 보다 상세한 설명을 알려줌.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"sudo\" style=\"position:relative;\"><a href=\"#sudo\" aria-label=\"sudo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sudo</h2>\n<p>관리자의 권한으로 명령을 실행 시 필요함.</p>\n<h2 id=\"패키지-매니저\" style=\"position:relative;\"><a href=\"#%ED%8C%A8%ED%82%A4%EC%A7%80-%EB%A7%A4%EB%8B%88%EC%A0%80\" aria-label=\"패키지 매니저 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>패키지 매니저</h2>\n<p>다양한 소프트웨어들을 패키지라고 한다. 가령 ls, mkdir, man등도 모두 패키지이다.\n하지만 기본적으로 제공하는 프로그램이 아닌 다른 것들은 패키지 매니저를 통해 설치해야 한다.\n일종의 앱스토어라고 생각하면 된다. 우분투 계열의 패키지 매니저인 apt-get 사용법을 알아보자. ( redhat 계열 : yum )</p>\n<p>htop 을 활용하면 CLI기반에서도 꽤나 GUI와 같은 형태로 리소스의 상태를 확인할 수 있다.</p>\n<ul>\n<li>패키지 설치\n<ul>\n<li>sudo apt-get install htop</li>\n</ul>\n</li>\n<li>패키지 검색\n<ul>\n<li>sudo apt-cache search htop</li>\n</ul>\n</li>\n<li>특정 패키지 업데이트\n<ul>\n<li>sudo apt-get upgrade htop</li>\n</ul>\n</li>\n<li>패키지 일괄 업그레이드\n<ul>\n<li>sudo apt-get upgrade</li>\n</ul>\n</li>\n<li>패키지 목록 업데이트\n<ul>\n<li>\n<ul>\n<li>sudo apt-get update</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>패키지 삭제\n<ul>\n<li>sudo apt-get remove htop</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"다운로드-방법\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-%EB%B0%A9%EB%B2%95\" aria-label=\"다운로드 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다운로드 방법</h2>\n<p>웹 url을 통해서 다운로드 받는 방법에 대해서 알아보자.</p>\n<ul>\n<li>wget\n<ul>\n<li>wget을 통해서 이미지 다운받기</li>\n</ul>\n</li>\n<li>git\n<ul>\n<li>git을 통해서 repo 다운받기</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1 id=\"2-io-redirection\" style=\"position:relative;\"><a href=\"#2-io-redirection\" aria-label=\"2 io redirection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. IO Redirection</h1>\n<p>리눅스에서 돌아가는 process의 결과를 IO redirection을 사용하면 다른 파일로 redirection 할 수 있다.\nredirection 하는 대상은 stdin, stdout, stderr 이다.</p>\n<h3 id=\"output\" style=\"position:relative;\"><a href=\"#output\" aria-label=\"output permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Output</h3>\n<ul>\n<li>stdout</li>\n<li>stderr\n<ul>\n<li>예를 들어 존재하지 않는 파일을 삭제하면 stderr가 출력된다.\n<ul>\n<li>rm non-existing.txt > output.txt 를 하면 안되고 rm non-existing.txt 2> output.txt 이렇게 해줘야 함. rm의 결과로 나오는 에러메시지가 stdout이 아니라 stderr이기 때문이다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"input\" style=\"position:relative;\"><a href=\"#input\" aria-label=\"input permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Input</h3>\n<ul>\n<li>stdin\n<ul>\n<li>stdin은 기본적으로 키보드로 입력받는 input으로 생각하면 된다. stdin이 아닌 다른 input을 process의 입력값으로 주고 싶다면 아래와 같이 파일이나 다른 명령어의 결과를 redirection 시킬 수 있다.\n<ul>\n<li>cat &#x3C; input.txt</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>command-line arguments\n<ul>\n<li>명령어에 필요한 옵션, 인자 같은 것들.</li>\n</ul>\n</li>\n<li>Env variable\n<ul>\n<li>PATH, LANG, HOME, USER, 그 외 사용자 정의 환경변수들..</li>\n<li>env 명령을 통해 환경변수 확인 가능.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1 id=\"스터디-문제\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%84%B0%EB%94%94-%EB%AC%B8%EC%A0%9C\" aria-label=\"스터디 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스터디 문제</h1>\n<p>각자의 /home/{사번}/week1에서 문제를 풀고 마지막에 answer.txt 파일에 답안을 작성해주셔야 합니다. ( 답안 작성 방법은 13번 문제참조 )\n처음 디렉토리는 /home/{사번}/week1인 것으로 가정합니다.</p>\n<ol>\n<li>“Question”라는 이름의 디렉토리를 생성하고, 해당 디렉토리로 이동해보세요.</li>\n<li>이동한 디렉토리에서 q2이라는 empty파일을 만들어보세요.</li>\n<li>해당 디렉토리에서 q3라는 파일을 만들고 vi 편집기 또는 nano편집기를 사용하여 본인의 이메일과 이름을 적어주세요.</li>\n<li>해당 디렉토리에서 파일 목록을 상세하게 리스팅하고, 파일 크기에 따라 내림차순으로 정렬하여 출력하세요.</li>\n<li>현재 디렉토리의 모든 파일/디렉토리를 숨김 파일 포함하여 출력해보세요.</li>\n<li>wget 명령을 사용해서 <a href=\"http://www.example.com/empty.txt\">http://www.example.com/empty.txt</a> url로 파일을 다운받으세요.(가정, 안되더라도 명령어 실행하기)</li>\n<li>git 명령을 사용해서 <a href=\"https://github.com/jjunyong/mdparser\">https://github.com/jjunyong/mdparser</a> 저장소를 다운받으세요.(가정, 안되더라도 명령어 실행하기)</li>\n<li>5번 문제의 결과를 IO redirection을 사용하여 q8이라는 파일로 저장해보세요.</li>\n<li>2번에서 만든 q2 파일을 삭제하세요.</li>\n<li>9번에서 삭제 시 사용한 명령을 그대로 실행하고, 출력되는 stderr 결과를 IO redirection을 사용하여 q10.txt에 저장하세요</li>\n<li>man mkdir 명령을 입력하면 mkdir명령의 매뉴얼이 조회됩니다. 이 내용을 q11 파일에 저장하세요.</li>\n<li>IO redirection을 활용하여 q11 파일의 내용을 q12 파일로 복사하세요.</li>\n<li>문제풀이의 과정을 답안으로 제출하기 위해 최근 사용된 명령어를 확인할 수 있는 ‘history’ 명령을 활용하여 최근 사용된 100개 명령어를 ~/week1/answer/txt에 저장해주세요</li>\n</ol>\n<ul>\n<li>history | tail -n 100 > ~/week1/answer.txt</li>\n</ul>\n<hr>\n<h1 id=\"추가-논의\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80-%EB%85%BC%EC%9D%98\" aria-label=\"추가 논의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추가 논의</h1>\n<hr>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/%EC%83%9D%ED%99%9C%EC%BD%94%EB%94%A9-%EB%A6%AC%EB%88%85%EC%8A%A4-%EA%B0%95%EC%A2%8C/\">https://www.inflearn.com/course/%EC%83%9D%ED%99%9C%EC%BD%94%EB%94%A9-%EB%A6%AC%EB%88%85%EC%8A%A4-%EA%B0%95%EC%A2%8C/</a></li>\n</ul>","frontmatter":{"date":"June 28, 2023","title":"[리눅스 스터디] 1. 리눅스 기초 & IO redirecdtion","categories":"Linux","author":"jjunyong","emoji":"🧢"},"fields":{"slug":"/linux-w1/"}},"site":{"siteMetadata":{"siteUrl":"https://jjunyong.github.io","comments":{"utterances":{"repo":"jjunyong/jjunyong.github.io"}}}}},"pageContext":{"slug":"/cks2/","nextSlug":"/cks1/","prevSlug":"/linux-w1/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}